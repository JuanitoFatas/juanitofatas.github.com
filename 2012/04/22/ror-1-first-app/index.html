<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>你的第一个 Rails 应用 - 001 | I'm Juanito Fatas</title>
  <meta name="author" content="Juanito Fatas">
  
  <meta name="description" content="This site contains technical articles, presentations, thoughts, software, and other materials by Juanito Fatas.">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="你的第一个 Rails 应用 - 001"/>
  <meta property="og:site_name" content="I'm Juanito Fatas"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="I'm Juanito Fatas" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  
    <link rel="stylesheet" type="text/css" href="//cdn.moot.it/1/moot.css">
  
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
  <script>
  $(document).ready(function() {
    $('#sidebar').delay(400).animate({ width: '285px' }, 500, function() {
      $('.personal-info').css({display: 'table'}).hide().fadeIn(500);
    });
  });
  </script>
  
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-41041908-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

</head>


<body>
  <header id="header" class="inner"><!-- <div class="alignleft">
  <h1><a href="/">I'm Juanito Fatas</a></h1>
  <h2><a href="/">C-x C-f...C-x C-s...</a></h2>
</div>
 --><!-- <nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">首頁</a></li>
    
      <li><a href="/archives">彙整</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
 --></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignright"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon depth"></div>
        <time class="depth" datetime="2012-04-22T14:11:00.000Z"><a href="/2012/04/22/ror-1-first-app/">Apr 22 2012</a></time>
      
      
  
    <h1 class="depth title">你的第一个 Rails 应用 - 001</h1>
  

    </header>
    <div class="entry depth">
      
        <p><strong>1000 個小時學會 Rails 系列</strong></p>
<h2>001 你的第一个 Rails 应用</h2>
<p>在我们来做第一个 Rails 应用之前，先讲讲 Rails 框架的三大哲学：</p>
<ul>
<li><p>DRY 不是 DIY 阿，可别看错了。意思是不要重造轮子，要在前人的大树下乘凉。</p>
</li>
<li><p>Convention Over Configuration，约定优于配置，很多事儿大牛们都替你想好了。</p>
</li>
<li><p>REST 网络应用最佳模式，让你组织你的应用，符合标准的 HTTP 操作。</p>
</li>
</ul>
<p>型別</p>
<p>再来不免俗的我也来讲讲 MVC，MVC 是 Model View Controller 的缩写，模型、视图、控制器。恩不负责任的解释一下大概是：</p>
<ul>
<li><p>模型 -- 让程序员远离操作数据库的恶梦</p>
</li>
<li><p>视图 -- 用户看到的页面</p>
</li>
<li><p>控制器 -- 模型与视图的仲介，跟模型要资料拿给视图显示。</p>
</li>
</ul>
<p>为神马要使用 MVC 呢？恩，让业务逻辑脱离页面，还记得<strong>那些年我们一起在 HTML 里面塞 PHP 代码的日子吗？</strong>放心，都过去了，一切都会好起来的。还有一个好处是，让你重复利用你的代码、让你的代码可以更简单的维护。但是这样听起来还是很抽象，等你学了 200 小时左右，你差不多就能有点感觉了，还是没感觉的话，那去 OGC 吧（头转 90 度...）。</p>
<p>好现在让我们开始一个最简单的 Rails 应用... 在这之前，得先安装好环境。</p>
<h3>安装 Rails</h3>
<ul>
<li><p>Windows 有 Installer -&gt; <a href="http://railsinstaller.org/">点我点我点我</a></p>
</li>
<li><p>Mac 的朋友可以看看这个安装脚本：<a href="https://github.com/thoughtbot/laptop">ThoughtBot Laptop Script</a></p>
</li>
</ul>
<p>还可以顺便装一下 RVM，RVM 是 Ruby 版本管理工具，可以让你尝鲜安装最新版的 Ruby，也可以装往日美好的 Ruby，重要的是它还替你的 Gems 造了一个空间，让你不怕把系统弄坏！更多信息：<a href="http://beginrescueend.com/">RVM 官网</a>、<a href="http://blog.eddie.com.tw/2011/04/08/rvm-and-gemsets/">RVM 与 Gemset</a>。</p>
<p>我使用 Rails 3.2.3 版本来讲解之后的例子，你可能需要 Ruby 1.9.3：</p>
<p><code>rvm install 1.9.3</code> (设为缺省：<code>rvm use --default 1.9.3</code> )</p>
<p>如果你的电脑已经有了 Ruby 1.9.2+ 与 <a href="http://ruby.taobao.org/">RubyGems</a>，Mac/Unix 安装 Rails 就是：</p>
<p>  gem install rails -v 3.2.3</p>
<p>也可说是一键安装了...</p>
<p><strong>为什么坊间及各大论坛有无数的帖子及书籍教你如何装 Rails？</strong></p>
<p>恩，很高兴你这么问，Rails 受益于它集成了很多个第三方的 Gems，这可能是你家楼下卖油条的老伯写的 Gem，或是远在太平洋那端美国小伙子边喝酒边写的，也可能是德艺双馨苍老师写的 Gem ，谁知道呢？说不定那人不维护了，以及 Rails 的版本更迭很快，Gem 的版本也更新的很快，同时 Ruby 也在更新，这些组织起来就会有兼容问题，新的好功能不支援旧语法，就变成现在这个情况了，呃。。。每一次 bundle 胆颤心惊，building native ... 看到这个讯息，很有可能又不兼容了，啊！！！！！！！而 GFW 又大大的加大了我们的难度（详见：<a href="RGC">RubyGems 镜像</a>），真是用心，这样子磨练我们，为了让我们都成为一个更好的人，一个更好的程序员。</p>
<p>但是我们不怕，其实我略懂命理，我算过了，萤幕前的你，上辈子的名字是... 折腾。</p>
<p><strong>活著就是快乐的折腾著！</strong></p>
<p>好了，我相信你已经成功安装 Rails。上车吧，动车要开动了。。。</p>
<p>呜——呜—— 呜——呜——</p>
<h3>第一个 Rails 应用</h3>
<p>这个例子呢，叫做 <code>girls_I_loved</code> ，这个应用呢主要是记录我们曾经深爱过的女孩，唉也只是曾经了。</p>
<p>首先我们使用 <code>rails</code> 命令来创建这个应用：</p>
<pre><code><span class="title">rails</span> new girls_I_loved
</code></pre>
<p>接下来，啪拉，一堆信息喷出，<strong>DONT PANIC！</strong> 握紧你的鼠标，真是激动人心的一刻，你终于成为一个大菜鸟 Rails 程序员了。这些产生出来的文件，我们之后会慢慢解释。</p>
<p><em>温馨提示</em> ：<code>rails help</code> 可以看到 <code>rails</code> 命令的帮助信息。</p>
<h4>启动你的应用</h4>
<p>要启动你的应用呢，首先先来一招 <code>cd girls_I_loved</code> 俐落地切换到应用目录下</p>
<p>(<code>[path-to-your-app/girls_I_loved] $</code>)</p>
<p>接下来我们使用 <code>rails server</code> 来启动我们的应用，缺省是使用 Ruby 标配的 WEBrick 服务器，端口三千，打开你的浏览器，</p>
<p>到 <code>http://0.0.0.0:3000/</code> 或是 <code>http://localhost:3000/</code> 或是 <code>http://127.0.0.1:3000/</code> ，</p>
<p>取决于你的喜好，你会看到一个安心上路的页面：</p>
<p><img src="https://github.com/JuanitoFatas/Girls_I_Loved/raw/master/app/assets/images/Ruby%20on%20Rails_%20Welcome%20aboard.png" alt="welcome-page"></p>
<p>右边有两个关于 Rails 的链接，两个 Ruby 文档的链接，你还可以进入：</p>
<p>About your application’s environment 看看你的 Rails 环境。</p>
<p>在里面你会看到有一行：</p>
<p>Environment development</p>
<p>Rails 提供你三种环境：<code>development</code>, <code>test</code>, <code>production</code> ，开发、测试、生产。缺省是 <code>development</code> 模式，在开发模式下呢，你的类不会被缓存的（cached），也就是说你在类里改动你的代码，不需重启服务器，嘿嘿。但是生产模式就不是如此了。</p>
<p>还有这行告诉我们正使用缺省的 <code>sqlite3</code> 数据库：</p>
<p>Database adapter  sqlite3</p>
<p><em>温馨提示</em> ：要跳出服务器，可以按 <code>ctrl + C</code> 。<code>rails s</code> ＝ <code>rails server</code>。</p>
<h4>给我一个鹰架，我可以搭起整个 Rails 应用。</h4>
<p><strong>scaffold</strong> 是 Rails 提供的一个命令，搭载许多基本的功能，让你快速建个原型来看看，我们将会使用鹰架来演示这个例子，基本上实际的项目是不用鹰架的，因为根据不同客户的需求，我们手工打造我们的应用，也有人称 Rails 程序员是 craftman 就是这个缘故。</p>
<p>让我们来创建这个 <code>我们深爱过的女孩</code> 应用吧：</p>
<pre><code>rails generate scaffold girl <span class="property">name</span>:<span class="type">string</span> <span class="type">number</span>:<span class="type">integer</span>
</code></pre>
<p>又是一堆信息，别慌张，其实就是产生了模型、视图、控制器、剩下的稍后叙述。</p>
<p>而</p>
<pre><code>girl <span class="property">name</span>:<span class="type">string</span> <span class="type">number</span>:<span class="type">integer</span>
</code></pre>
<p>这段命令是什么呢？首先 <code>girl</code> 是你深爱过的女孩，<code>name</code> 是她的芳名，类别是字串；<code>number</code> 是第几任，类别是整数。。。</p>
<p>这个命令顺便也替你把数据库、物件属性（attribute）相关的东西都搞好了，接下来让我们在数据库创建这个表。要创建这个表呢，在 Rails 当中叫做迁移（Migration）。</p>
<p>迁移是 Rails 管理数据库版本的一种形式，让你的数据库可以滚动增加它的 schema。为什么说它可以管理数据库的版本呢？嗯，每一个迁移都会盖上一个时间戳章（Timestamp），注明了数据库的日期。这样子别人来跟你一起开发应用时，就知道你确切的数据库日期了。不过这个我们深爱过的女孩应用，还是自己开发就好了，你有注意到刚刚产生的信息中，有一个这样子的文件吗：</p>
<p>db/migrate/[YYYYMMDDHHMMSS]_create_girls.rb</p>
<p>让我们打开这个文件看看（在 <code>db/migrate/</code> 目录下）：</p>
<pre><code><span class="class"><span class="keyword">class</span> <span class="title">CreateGirls</span> &lt; <span class="title">ActiveRecord</span>::<span class="title">Migration</span>
  <span class="title">def</span> <span class="title">change</span>
    <span class="title">create_table</span> :<span class="title">girls</span> <span class="title">do</span> |<span class="title">t</span>|
      <span class="title">t</span>.<span class="title">string</span> :<span class="title">name</span>
      <span class="title">t</span>.<span class="title">integer</span> :<span class="title">number</span>

      <span class="title">t</span>.<span class="title">timestamps</span>
    <span class="title">end</span>
  <span class="title">end</span>
<span class="title">end</span>
</code></pre>
<p>可以看到这个类继承自 <code>ActiveRecord::Migration</code> ，在类里面呢，定义了一个 <code>change</code> 方法。</p>
<p>让我们接著看下去：</p>
<pre><code>create_table <span class="symbol">:girls</span> <span class="keyword">do</span> |t|
</code></pre>
<p>很显然的替我们在数据库建立一个叫做 <code>girls</code> 的表，带有名字与任号，后面的 <code>t.timestamps</code> 就是我刚刚说的时间戳章，会设置成目前的时间（ <code>created_at</code> 与 <code>updated_at</code> ）。有了这个时间戳，Rails 之后还能帮我们恢复数据呢（术语叫做回滚 rollback）！其实呢，这个 <code>change</code> 方法隐含了 <code>up</code> 与 <code>down</code> ，建立与删除资料表，但我们现在不用担心这个，等到你的迁移够复杂时，在拆开来写就好。</p>
<p>OK! 接下来让我们正式迁移看看，敲入这行命令 <code>rake db:migrate</code> ，产生：</p>
<pre><code><span class="comment">==</span>  <span class="comment">CreateGirls:</span> <span class="comment">migrating</span> <span class="comment">====================================================</span>
<span class="literal">-</span><span class="literal">-</span> <span class="comment">create_table(:girls)</span>
   <span class="literal">-</span>&gt; <span class="comment">0</span>.<span class="comment">0021s</span>
<span class="comment">==</span>  <span class="comment">CreateGirls:</span> <span class="comment">migrated</span> <span class="comment">(0</span>.<span class="comment">0022s)</span> <span class="comment">===========================================
</code></pre>
<p>这个 <code>rake db:migrate</code> 命令实际调用了隐含的 <code>up</code> 方法，因为这是你第一次运行迁移命令， Rails 会产生一个 <code>db/development.sqlite3</code> 文件，并产生 <code>girls</code> 表。注意！这个 <code>rake db:migrate</code> 不仅仅只执行一个迁移，它会依序执行你所有的迁移！</p>
<p>Rails 同时也持续关注你的一个文件 <code>db/schema.rb</code> ：</p>
<pre><code>ActiveRecord::Schema<span class="variable">.define</span>(:version =&gt; YYYYMMDDHHMMSS) <span class="keyword">do</span>

  create_table <span class="string">"girls"</span>, :force =&gt; <span class="literal">true</span> <span class="keyword">do</span> |t|
    t<span class="variable">.string</span>   <span class="string">"name"</span>
    t<span class="variable">.integer</span>  <span class="string">"number"</span>
    t<span class="variable">.datetime</span> <span class="string">"created_at"</span>, :null =&gt; <span class="literal">false</span>
    t<span class="variable">.datetime</span> <span class="string">"updated_at"</span>, :null =&gt; <span class="literal">false</span>
  <span class="keyword">end</span>

<span class="keyword">end</span>
</code></pre>
<p>这里的 <code>YYYYMMDDHHMMSS</code> 应跟你的迁移档</p>
<p>（ <code>db/migrate/[YYYYMMDDHHMMSS]_create_girls.rb</code> ）匹配，这让你之后可以这样子加载旧的数据库：</p>
<pre><code><span class="tag">rake</span> <span class="tag">db</span><span class="pseudo">:schema</span><span class="pseudo">:load</span>
</code></pre>
<p><em>温馨提示</em> ：回滚可以透过 <code>rake db:rollback</code> 来给最新一次的迁移做 <code>down</code> 方法。</p>
<h4>加入及浏览深爱过的女孩</h4>
<p>让我们再次启动服务器： <code>rails s</code> ，并开启这个页面： <a href="http://localhost:3000/girls/">http://localhost:3000/girls/</a> ：</p>
<p><img src="https://github.com/JuanitoFatas/Girls_I_Loved/raw/master/app/assets/images/GirlsILoved.png" alt="GirlsILoved"></p>
<p>还没有深爱过的女孩列在上面，让我们按 <code>New Girl</code> 来添加一个：</p>
<p><img src="https://github.com/JuanitoFatas/Girls_I_Loved/raw/master/app/assets/images/NewGirl.png" alt="NewGirl"></p>
<p>你看到你刚刚产生的栏位了吧（名字、任号），这个页面实际上是 <code>GirlsController</code> 的 <code>new</code> 动作（action）的结果。</p>
<p>而这个视图就放在 <code>app/views/girls/new.html.erb</code> ，其内容为：</p>
<pre><code><span class="tag">&lt;<span class="title">h1</span>&gt;</span>New girl<span class="tag">&lt;/<span class="title">h1</span>&gt;</span>

<span class="vbscript">&lt;%= render <span class="comment">'form' %&gt;</span></span>

<span class="vbscript">&lt;%= link_to <span class="comment">'Back', girls_path %&gt;</span></span>
</code></pre>
<p>这是一个 ERB 文件，什么是 ERB 呢？Embedded RuBy。其实是嵌入 Ruby 代码的 HTML 文件。可以这样嵌入：</p>
<p><code>&lt;%=  %&gt;</code> 以及 <code>&lt;%  %&gt;</code> ，带等号会输出在页面上，没带等号不会输出至页面。你可以拿不带等号的来创一些变量：</p>
<pre><code><span class="vbscript">&lt;% hot=<span class="literal">true</span> %&gt;</span>
</code></pre>
<p>呵呵... 在这个 ERB 文件里，</p>
<p>第一行我们可以看到，我们给这个页面下了一个 <code>h1</code> 标题，<code>render</code> 方法传入了一个字串 <code>&#39;form&#39;</code> ，这个 <code>render</code> 方法会去渲染（render）这个字串名字的 <code>partial</code> 。</p>
<p>什么是 <code>partial</code> ？一个 <code>partial</code> 是一个模版，我们可以把它加进来，达到不重用代码的最高原则 DRY！！！！！！</p>
<p><code>link_to</code> 方法替你产生了一个 <code>a</code> 标签，带有 <code>Back</code> 名字，其 <code>href</code> 属性设置为 <code>girls_path</code> ，会自动转成 <code>/girls</code> ，至于为什么我们以后再谈。</p>
<p>很好！现在我们来看看 <code>_form.html.erb</code> 这个文件：</p>
<pre><code>&lt;%= form_for(@girl) do |f| %&gt;
  <span class="keyword">...</span>
&lt;% end %&gt;
</code></pre>
<p>这里定义了一个表单，使用了 <code>form_for</code> 这个 helper。<code>form_for</code> 方法传入了一个参数，一个实体变量叫做 <code>@gril</code> ， 并用这个变量 <code>@girl</code> 来产生一个表单，这个变量是从哪来的呢？茫茫人海中。。。</p>
<p>是从 <code>GirlsController</code> 控制器的 <code>new</code> 动作来的：</p>
<pre><code><span class="function"><span class="keyword">def</span> <span class="title">new</span></span>
  <span class="variable">@girl</span> = <span class="constant">Girl</span>.new

  respond_to <span class="keyword">do</span> |format|
    format.html <span class="comment"># new.html.erb</span>
    format.json { render <span class="symbol">json:</span> <span class="variable">@girl</span> }
  <span class="keyword">end</span>
<span class="keyword">end</span>
</code></pre>
<p>第一行我们呼叫了 Girl 模型的 <code>new</code> 方法，建立了一个实体变量 <code>@girl</code> 。而这个实体变量 <code>@girl</code> 自动由 Rails 替你传给视图。</p>
<p>接下来，有一个 <code>respond_to</code> 方法，定义了这个动作回应的方法（HTML 与 JSON 格式），这里 <code>format.html</code> 会渲染 <code>new.html.erb</code> 这个文件，<code>format.json</code> 会回传一个 <code>@girl</code> 的 JSON 版本。</p>
<p>呼，直到现在你只写了一行代码：</p>
<pre><code>rails generate scaffold girl <span class="property">name</span>:<span class="type">string</span> <span class="type">number</span>:<span class="type">integer</span>
</code></pre>
<p>就得到了这么多，<a href="http://www.washingtonpost.com/business/technology/steve-jobss-last-words-oh-wow-oh-wow-oh-wow/2011/10/31/gIQA3vKCZM_story.html">喔！哇！喔！哇！喔！哇！</a></p>
<p>让我们再回来看看 <code>_form.html.erb</code> ，在 <code>&lt;%= form_for(@girl) do |f| %&gt;</code> 与 <code>&lt;% end %&gt;</code> 之间的区块：</p>
<pre><code>&lt;% <span class="keyword">if</span> @girl.errors.any? %&gt;
  <span class="xml"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"error_explanation"</span>&gt;</span>
    <span class="tag">&lt;<span class="title">h2</span>&gt;</span><span class="vbscript">&lt;%= pluralize(@girl.errors.count, <span class="string">"error"</span>) %&gt;</span> prohibited this girl from being saved:<span class="tag">&lt;/<span class="title">h2</span>&gt;</span>

    <span class="tag">&lt;<span class="title">ul</span>&gt;</span>
    <span class="vbscript">&lt;% @girl.errors.full_messages.<span class="keyword">each</span> <span class="keyword">do</span> |msg| %&gt;</span>
      <span class="tag">&lt;<span class="title">li</span>&gt;</span><span class="vbscript">&lt;%= msg %&gt;</span><span class="tag">&lt;/<span class="title">li</span>&gt;</span>
    <span class="vbscript">&lt;% <span class="keyword">end</span> %&gt;</span>
    <span class="tag">&lt;/<span class="title">ul</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
<span class="vbscript">&lt;% <span class="keyword">end</span> %&gt;</span></span>
</code></pre>
<p>先是检查 <code>@girl</code> 对象是否有任何错误（挑女孩可不能这样哦！），这些错误会从模型来，比如你的这个 <code>@girl</code> 对象没有通过模型所设置的验证（validation）需求，验证稍后讲解。如果有任何错误存在的话，就会被渲染成 <code>if</code> 区块内的内容。</p>
<p>让我们来看看这个 <code>_form.html.erb</code> 的后半部：</p>
<pre><code><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"field"</span>&gt;</span>
  <span class="vbscript">&lt;%= f.label :name %&gt;</span><span class="tag">&lt;<span class="title">br</span> /&gt;</span>
  <span class="vbscript">&lt;%= f.text_field :name %&gt;</span>
<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
<span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"field"</span>&gt;</span>
  <span class="vbscript">&lt;%= f.label :number %&gt;</span><span class="tag">&lt;<span class="title">br</span> /&gt;</span>
  <span class="vbscript">&lt;%= f.number_field :number %&gt;</span>
<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
<span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"actions"</span>&gt;</span>
  <span class="vbscript">&lt;%= f.submit %&gt;</span>
<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
</code></pre>
<p>相信聪明如你，已经看出来这里建立了给我们填入的栏位及按钮。</p>
<p>现在让我们回到浏览器，填入深爱过的女孩的名字，你会看到类似于下图的结果：</p>
<p><img src="https://github.com/JuanitoFatas/Girls_I_Loved/raw/master/app/assets/images/new%20girl%2001.png" alt="new girl 01"></p>
<p>让我们来深入探讨一下是如何得到这个结果的（孤单、寂寞、D 槽）：</p>
<p>当你按下 <code>submit</code> 按钮时，它帮你把数据传给控制器的 <code>create</code> 动作：</p>
<pre><code><span class="function"><span class="keyword">def</span> <span class="title">create</span></span>
  <span class="variable">@girl</span> = <span class="constant">Girl</span>.new(params[<span class="symbol">:girl</span>])

  respond_to <span class="keyword">do</span> |format|
    <span class="keyword">if</span> <span class="variable">@girl</span>.save
      format.html { redirect_to <span class="variable">@girl</span>, <span class="symbol">notice:</span> <span class="string">'Girl was successfully created.'</span> }
      format.json { render <span class="symbol">json:</span> <span class="variable">@girl</span>, <span class="symbol">status:</span> <span class="symbol">:created</span>, <span class="symbol">location:</span> <span class="variable">@girl</span> }
    <span class="keyword">else</span>
      format.html { render <span class="symbol">action:</span> <span class="string">"new"</span> }
      format.json { render <span class="symbol">json:</span> <span class="variable">@girl</span>.errors, <span class="symbol">status:</span> <span class="symbol">:unprocessable_entity</span> }
    <span class="keyword">end</span>
  <span class="keyword">end</span>
<span class="keyword">end</span>
</code></pre>
<p>这里你同样使用了你在 <code>new</code> 动作看过的 <code>Girl.new</code> 。但这次你传入了一个参数，<code>params[:girl]</code> 。params 是 parameters 的缩写，会回传一个从表单传来的像是哈希 (hash) 的对象。当你把这个 <code>params[:girl]</code> 传给 <code>new</code> 方法时，Rails 使用表单的值帮你设定对象的属性。</p>
<p>在 <code>respond_to</code> 是一个 <code>if-else</code> 结构，if 这里的 <code>@girl.save</code> 确保这个记录（record）是合法的，如果储存成功即返回真并存入数据库。</p>
<p>如果我与苍老师之间是真愛，这个 <code>redirect_to</code> 方法将你重導向至新產生的 <code>@girl</code> 对象，这个方法接受一个路径或对象，替你转成相应的路径。这个 <code>redirect_to</code> 方法解读你传入的 <code>@girl</code> 对象，并判断你要到 <code>girl_path</code> 因为这是一个 Girl 模型的对象。这个路径把你带到控制器的 <code>show</code> 动作。里面的 <code>notice:</code> 会显示一个 <code>flash</code> 信息。一个 <code>flash</code> 信息是一个在下次请求（request）所显示的信息。（也就是上图上方的绿色字体）</p>
<p>那要是我跟苍老师的愛是禁断的愛恋怎么办？（not valid），<code>@girl.save</code> 会返回假（任何不是 <code>nil</code> <code>false</code> 视为假）。并使用 <code>render</code> 方法来显示 <code>new</code> 动作的模版。但注意，这里并没有呼叫 <code>new</code> 动作，仅显示模版而已（要让他再次呼叫 <code>new</code> 动作可是非常难的一件事情，这个我留给 Ruby-china 社区的大神解释）。</p>
<p>我们可以使用验证 (validation)，让 <code>@girl</code> 不合法。让我们看看如何做吧！</p>
<h4>验证你与女孩之间的愛</h4>
<p>你可以在模型里加入验证，比如你娘亲要求你只能跟有名字的女孩交往，不能用程序员的方式定义任号（从第一任开始，而不是第零任），且每个女孩只能独立一任。。。世上只有妈妈最伟大，我们只好硬著头皮来实现这个艰钜的请求。</p>
<p>让我们来看看如何实现吧，打开 <code>Girl</code> 模型（ <code>app/models/girl.rb</code>），并将其内容改为：</p>
<pre><code><span class="class"><span class="keyword">class</span> <span class="title">Girl</span> &lt; <span class="title">ActiveRecord</span>::<span class="title">Base</span>
  <span class="title">attr_accessible</span> :<span class="title">name</span>, :<span class="title">number</span>
  <span class="title">validates</span> :<span class="title">name</span>, :<span class="title">presence</span> =&gt; <span class="title">true</span>
  <span class="title">validates</span> :<span class="title">number</span>, :<span class="title">presence</span> =&gt; <span class="title">true</span>,
                     :<span class="title">uniqueness</span> =&gt; <span class="title">true</span>,
                     :<span class="title">numericality</span> =&gt; {</span> :greater_than =&gt; <span class="number">1</span> }
end
</code></pre>
<p>你使用了 <code>validates</code> 方法来定义一个验证，确保有输入名字，任号确保有输入、唯一、大于一。现在让我们试试看，打开这个页面：<a href="http://localhost:3000/girls">http://localhost:3000/girls</a> 按下 <code>New Girl</code> 链接，并直接按 <code>Create Girl</code> 按钮，你会看到如下图般的错误：</p>
<p><img src="https://github.com/JuanitoFatas/Girls_I_Loved/raw/master/app/assets/images/validate-errors.png" alt="validate-errors"></p>
<p>如你预期的错误，现在你可以依照伟大母亲大人的指示输入栏位，</p>
<p>name：<code>&quot;#{初恋情人}&quot;</code></p>
<pre><code>希望不是 NameError: undefined <span class="keyword">local</span> variable <span class="keyword">or</span> method <span class="string">`初恋情人' for main:Object
</code></pre>
<p>让我们在试试看我们的 <code>greater_than</code> 有没有起作用，任号输入 <code>-1</code> 看看：</p>
<p><img src="https://github.com/JuanitoFatas/Girls_I_Loved/raw/master/app/assets/images/minus1.png" alt="minus-one"></p>
<p>It works! 让我们完成这些栏位：</p>
<p><img src="https://github.com/JuanitoFatas/Girls_I_Loved/raw/master/app/assets/images/first-love.png" alt="first-love"></p>
<p>有的朋友会问，怎么任号是 2 了，不对吧？不好意思各位，<strong>1 号的位置我留给了永远的苍老师。</strong></p>
<p>在网址栏的结尾你会看到</p>
<p><a href="http://localhost:3000/girls/N">http://localhost:3000/girls/N</a></p>
<p><code>N</code> 是模型 Girl 中一个独一无二的数字 ID。这哪来的？让我们看看控制器中的 <code>show</code> 动作的视图模版（在 <code>app/views/girls/show.html.erb</code> ）：</p>
<pre><code><span class="tag">&lt;<span class="title">p</span> <span class="attribute">id</span>=<span class="value">"notice"</span>&gt;</span><span class="vbscript">&lt;%= notice %&gt;</span><span class="tag">&lt;/<span class="title">p</span>&gt;</span>

<span class="tag">&lt;<span class="title">p</span>&gt;</span>
  <span class="tag">&lt;<span class="title">b</span>&gt;</span>Name:<span class="tag">&lt;/<span class="title">b</span>&gt;</span>
  <span class="vbscript">&lt;%= @girl.name %&gt;</span>
<span class="tag">&lt;/<span class="title">p</span>&gt;</span>

<span class="tag">&lt;<span class="title">p</span>&gt;</span>
  <span class="tag">&lt;<span class="title">b</span>&gt;</span>Number:<span class="tag">&lt;/<span class="title">b</span>&gt;</span>
  <span class="vbscript">&lt;%= @girl.number %&gt;</span>
<span class="tag">&lt;/<span class="title">p</span>&gt;</span>


<span class="vbscript">&lt;%= link_to <span class="comment">'Edit', edit_girl_path(@girl) %&gt;</span></span> |
<span class="vbscript">&lt;%= link_to <span class="comment">'Back', girls_path %&gt;</span></span>
</code></pre>
<p>第一行是 <code>notice</code> 方法，显示由 <code>create</code> 动作内，重定向 <code>redirec_to</code> 里设置的 <code>notice</code> ：</p>
<p>  format.html { redirect_to @girl, notice: &#39;Girl was successfully created.&#39; }</p>
<p>之后在 <code>p</code> 标签里，呼叫 <code>@girl</code> 的 <code>name</code> 与 <code>number</code> 方法，显示名字及任号，这个对象是在你控制器的 <code>show</code> 动作所定义的：</p>
<pre><code>def show
  @girl = Girl.find(params[:id])

  <span class="keyword">...</span>
end
</code></pre>
<p>这个 <code>Girl</code> 类别的 <code>find</code> 方法让你找到 ID 是 <code>params[:id]</code> 的纪录（record），创建一个新的 <code>Girl</code> 对象，并把 <code>params[:id]</code> 作为网址的结尾数字 <code>N</code>。</p>
<p>让我们在回到 <code>show.html.erb</code> 文件的下方：</p>
<pre><code>&lt;<span class="variable">%=</span> link_to <span class="string">'Edit'</span>, edit_girl_path(<span class="variable">@girl</span>) <span class="variable">%&gt;</span> |
&lt;<span class="variable">%=</span> link_to <span class="string">'Back'</span>, girls_path <span class="variable">%&gt;</span>
</code></pre>
<p>产生了两个链接，Edit 与 Back。第一个 <code>link_to</code> 方法的第二个参数 <code>edit_girl_path(@girl)</code> 方法是由 <code>config/routes.rb</code> 里的一个方法调用所提供的。让我们现在来看看 <code>config/routes.rb</code> 。</p>
<h4>陆游：山重水复疑无路，柳暗花明又一村</h4>
<p>看来我们南宋朝的诗人就懂得 Rails 的路由了。。。（唉你现在知道为什么这篇文章分类是瞎扯淡了吧）</p>
<p>这柳暗花明又一村呢，是哪一村，让我们看看 <code>config/routes.rb</code> 这一村（没有注解）：</p>
<pre><code>GirlsILoved::Application<span class="variable">.routes</span><span class="variable">.draw</span> <span class="keyword">do</span>
  resources :girls
<span class="keyword">end</span>
</code></pre>
<p>每个 Rails 应用的 <code>config/routes.rb</code> 文件，都用了简洁的 Ruby 语法定义了应用程序的路由。这个文件里使用的方法，定义了请求至控制器之间的路线。</p>
<pre><code><span class="title">resources</span> :girls
</code></pre>
<p>在 Rails 当中，相似对象的集合，称为资源（resources）。这个方法定义了路由（routes）与路由的 helpers，这个 helper 比如我们使用的这个 <code>edit_girl_path</code> 。下表列出了路由以及对应的 helper：</p>
<p><img src="https://github.com/JuanitoFatas/Girls_I_Loved/raw/master/app/assets/images/helpers-routes.png" alt="helpers-routes"></p>
<p>在这个表里，:id 可以被记录的 ID 替换。每一个路由的 helper 都有一个替代版本，可以给你全部的网址。把 <code>girls_path</code> 换成 <code>girls_url</code> 就会给你完整的网址：<a href="http://localhost:3000/girls。">http://localhost:3000/girls。</a></p>
<p>另外，有两个路由会根据不同的请求（request），做出不同的动作。如果你使用 <code>GET</code> 请求的话，第一个路由：<code>/girls</code> 会带你到 <code>GirlsController</code> 的 <code>index</code> 动作。<code>GET</code> 请求是标准浏览器的请求之一，这是你对这个应用做的第一个请求（到 <a href="http://localhost:3000/">http://localhost:3000/</a> 页面）如果你对这个路由 <code>/girls</code> 做 <code>POST</code> 请求，它会去调用控制器的 <code>create</code> 动作。这也是你先前按下 New Girl 的动作。恩，我讲你可能不太相信，让我带你看看，先跳到 <a href="http://localhost:3000/girls/new">http://localhost:3000/girls/new</a> 页面，并鼠标右键 -&gt; 检视源代码，你会看到表单中：</p>
<pre><code><span class="tag">&lt;<span class="title">form</span> <span class="attribute">accept-charset</span>=<span class="value">"UTF-8"</span> <span class="attribute">action</span>=<span class="value">"/girls"</span> <span class="attribute">class</span>=<span class="value">"new_girl"</span> <span class="attribute">id</span>=<span class="value">"new_girl"</span> <span class="attribute">method</span>=<span class="value">"post"</span>&gt;</span>

<span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">"/purchases"</span> <span class="attribute">class</span>=<span class="value">"new_purchase"</span> <span class="attribute">id</span>=<span class="value">"new_purchase"</span> <span class="attribute">method</span>=<span class="value">"post"</span>&gt;</span>
</code></pre>
<p>嘿嘿！这里有两个要注意的属性，就是 <code>action</code> 与 <code>method</code> 属性。<code>action</code> 指出了这个表单要去的路由，而 <code>method</code> 告诉浏览器何种 HTTP 请求。</p>
<p>这个表单是在哪渲染的呢？呵呵，你先前已经看过了，在 <code>app/views/girls/new.html.erb</code> ：</p>
<pre><code><span class="tag">&lt;<span class="title">h1</span>&gt;</span>New girl<span class="tag">&lt;/<span class="title">h1</span>&gt;</span>

<span class="vbscript">&lt;%= render <span class="comment">'form' %&gt;</span></span>

<span class="vbscript">&lt;%= link_to <span class="comment">'Back', girls_path %&gt;</span></span>
</code></pre>
<p>这里我们渲染了一个 <code>partial</code>，位于 <code>app/views/girls/_form.html.erb</code> 的 <code>form</code>：</p>
<pre><code>&lt;<span class="variable">%=</span> form_for(<span class="variable">@girl</span>) <span class="keyword">do</span> |f| <span class="variable">%&gt;</span>
</code></pre>
<p>这一行伟大的代码产生了 <code>form</code> 表单！等会儿我们看看 <code>edit</code> 动作时，你会发现同样的表单有不同的结果，太猛了！</p>
<p>另一个不同的路由是 <code>/girls/{id}</code> 路由，这个路由有三个方式。第一个是你已经看过的，你加入一个你深愛的女孩，使用 GET 请求来重定向的 <code>show</code> 动作，第二个是我们现在要讨论的 <code>update</code> ，更新你深愛的女孩的数据。</p>
<p>现在让我们来改动一下女孩的任号，或许初恋情人是你的第五任也说不定（有的人觉得直到他找到对的女孩才算初恋，之前的一点恋愛感觉都没有）打开
<a href="http://localhost:3000/girls">http://localhost:3000/girls</a> 页面，按下 Edit 链接，你会看到如下的图示：</p>
<p><img src="https://github.com/JuanitoFatas/Girls_I_Loved/raw/master/app/assets/images/edit-first-love.png" alt="edit-first-love"></p>
<p>这个页面跟我们看到的 <code>new</code> 动作所产生的页面相似。体会到 <code>partial</code> 的威力了么？你可以根据不同的请求，使用同样的代码。这个 <code>edit.html.erb</code> 的内容为：</p>
<pre><code><span class="tag">&lt;<span class="title">h1</span>&gt;</span>Editing girl<span class="tag">&lt;/<span class="title">h1</span>&gt;</span>

<span class="vbscript">&lt;%= render <span class="comment">'form' %&gt;</span></span>

<span class="vbscript">&lt;%= link_to <span class="comment">'Show', @girl %&gt;</span></span> |
<span class="vbscript">&lt;%= link_to <span class="comment">'Back', girls_path %&gt;</span></span>
</code></pre>
<p>然而这个动作呢，你在修改的是先前存在的对象，而不是像你在 <code>new</code> 动作所使用的一个新的对象。这个已经存在的对象是透过 <code>GirlsController</code> 的 <code>edit</code> 动作找到的：</p>
<pre><code><span class="function"><span class="keyword">def</span> <span class="title">edit</span></span>
  <span class="variable">@girl</span> = <span class="constant">Girl</span>.find(params[<span class="symbol">:id</span>])
<span class="keyword">end</span>
</code></pre>
<p>如何找到一个对象的代码跟之前我们看过的 <code>show action</code> 一模一样！！！！！！！也就是说咱重复了代码，但现在先不讨论这个。</p>
<p>再回到刚刚的 <code>edit.html.erb</code> ：</p>
<pre><code><span class="tag">&lt;<span class="title">h1</span>&gt;</span>Editing girl<span class="tag">&lt;/<span class="title">h1</span>&gt;</span>

<span class="vbscript">&lt;%= render <span class="comment">'form' %&gt;</span></span>

<span class="vbscript">&lt;%= link_to <span class="comment">'Show', @girl %&gt;</span></span> |
<span class="vbscript">&lt;%= link_to <span class="comment">'Back', girls_path %&gt;</span></span>
</code></pre>
<p>下面你使用了 <code>link_to</code> 来创建两个链接，Show 与 Back 链接。Show 链接连到你在控制器的 <code>edit</code> 动作设置好的 <code>@girl</code> 对象。按下这个链接会带你到 <code>girl_path(@girl)</code> (<code>/girls/:id</code>)。Rails 会自己根据对象的类别，想出链接接下来要去哪，使用这种 Rails 特殊的语法，它会去调用 <code>girl_path</code> 方法（因为这个对象是 Girl 类别），并且产生相应的网址给你。</p>
<p>接下来看看 Back 链接，使用了 <code>girls_path</code>。它不能使用一个对象，因为没道理，你要返回的是你深爱过的女人的清单。。。而呼叫 <code>girls_path</code> 是一个回到 <code>index</code> 动作的简单方法。</p>
<p>好现在我们来试试看填入这个表单，举例来说，把初恋情人改为第五任好了，并按下 Update Girl 按钮，你会看到：</p>
<p><img src="https://github.com/JuanitoFatas/Girls_I_Loved/raw/master/app/assets/images/fifth.png" alt="fifth"></p>
<p>按下 Update Girl 会带你回到 <code>show</code> 页面。这是怎么发生的？按下 Back 按钮回到清单，并看看此页的源代码 ( <a href="http://localhost:3000/2/edit/)，你会看到：">http://localhost:3000/2/edit/)，你会看到：</a></p>
<pre><code class="lang-html">  <span class="tag">&lt;<span class="title">form</span> <span class="attribute">accept-charset</span>=<span class="value">"UTF-8"</span> <span class="attribute">action</span>=<span class="value">"/girls/2"</span> <span class="attribute">class</span>=<span class="value">"edit_girl"</span> <span class="attribute">id</span>=<span class="value">"edit_girl_2"</span> <span class="attribute">method</span>=<span class="value">"post"</span>
  &lt;<span class="attribute">div</span> <span class="attribute">style</span>=<span class="value">"margin:0;padding:0;display:inline"</span>&gt;</span><span class="tag">&lt;<span class="title">input</span> <span class="attribute">name</span>=<span class="value">"utf8"</span> <span class="attribute">type</span>=<span class="value">"hidden"</span> <span class="attribute">value</span>=<span class="value">"&amp;#x2713;"</span> /&gt;</span><span class="tag">&lt;<span class="title">input</span> <span class="attribute">name</span>=<span class="value">"_method"</span> <span class="attribute">type</span>=<span class="value">"hidden"</span> <span class="attribute">value</span>=<span class="value">"put"</span> /&gt;</span>...
  <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
</code></pre>
<p>这个表单的 <code>action</code> 指向 <code>/girls/2</code> ，也就是 <code>GirlsController</code> 的 <code>show</code> 动作。这里使用的 <code>method</code> 使用的是 POST。结束了吗？还没，看看下面透过 <code>_method</code> 参数的 <code>input</code> 标签，其中 <code>value</code> 被设为 PUT。Rails 注意到这个参数，并且把这个 POST 请求变成 PUT 请求。这是我们刚刚说的三个方式之一，这是第二个。藉由给这个路由 <code>/girls/{id}</code> 发送一个 PUT 请求，你被带到了 <code>GirlsController</code> 的 <code>update</code> 动作，让我们来看看 <code>update</code> 动作都干了什么：</p>
<pre><code>def update
  @girl = <span class="transposed_variable">Girl.</span><span class="built_in">find</span>(params<span class="matrix">[:id]</span>)

  respond_to do |format|
    <span class="keyword">if</span> @<span class="transposed_variable">girl.</span>update_attributes(params<span class="matrix">[:girl]</span>)
      <span class="transposed_variable">format.</span>html <span class="cell">{ redirect_to @girl, notice: <span class="string">'Girl was successfully updated.'</span> }</span>
      <span class="transposed_variable">format.</span>json <span class="cell">{ head :no_content }</span>
    <span class="keyword">else</span>
      <span class="transposed_variable">format.</span>html <span class="cell">{ render action: "edit" }</span>
      <span class="transposed_variable">format.</span>json <span class="cell">{ render json: @girl.errors, status: :unprocessable_entity }</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span>
<span class="keyword">end</span>
</code></pre>
<p>和 <code>show</code> 与 <code>edit</code> 动作一样，你用 <code>find</code> 把对象拿出来。而表单的参数和 <code>create</code> 动作使用一样的路数透过 <code>params[:girl]</code> 传进来。而下面不同的是，这里用的是一个 <code>update_attributes</code> 方法。这个方法人如其名，更新属性！而这个方法的名字还有一件你不知道的事儿，它同时也验证了属性，确保你的属性是合法的，如果合法的话呢，更新、储存、返回真。念起来真顺口，哈哈！</p>
<p>当 <code>update_attributes</code> 返回真的时候呢，你被重定向至这个女孩的 <code>show</code> 动作。那返回假的时候呢？你被显示在 <code>edit</code> 模版，并提示出错的信息，这里跟我们之前看过的 <code>create</code> 方法一样，只是回页面，没有使用 <code>edit</code> 动作：</p>
<pre><code>def create
<span class="keyword">...</span>
<span class="keyword">else</span>
  format.html { render action: <span class="string">"new"</span> }
  format.json { render json: @girl.errors, status: :unprocessable_entity }
end
</code></pre>
<p>呼，终于讲完验证了，希望你可以让你的娘亲高兴。</p>
<h4>删除... 删除那些不愉快的记忆</h4>
<p>好，要是那个女孩伤你很深，你要把它从记录中抹去呢？（抹的掉记录，抹不掉回忆的。。。）</p>
<p>在 Rails，<code>DELETE</code> 用一个更强硬的名字，<code>DESTROY</code> ！！！一旦 <code>DESTROY</code> 了，那就是掰掰了，再也不见了。</p>
<p>好，现在把页面切换到 <a href="http://localhost:3000/girls">http://localhost:3000/girls</a> ：</p>
<p><img src="https://github.com/JuanitoFatas/Girls_I_Loved/raw/master/app/assets/images/delete.png" alt="delete"></p>
<p>按下 Destroy ：</p>
<p><img src="https://github.com/JuanitoFatas/Girls_I_Loved/raw/master/app/assets/images/only-one.png" alt="only-one"></p>
<p>现在你应该只看到苍老师，唯一的苍老师（或是你输入的）。</p>
<p>好，现在来讲讲这是怎么工作的。让我们看看 <code>app/views/girls/index.html.erb</code> 中间这一段 ：</p>
<pre><code><span class="tag">&lt;<span class="title">h1</span>&gt;</span>Listing girls<span class="tag">&lt;/<span class="title">h1</span>&gt;</span>

...

<span class="vbscript">&lt;% @girls.<span class="keyword">each</span> <span class="keyword">do</span> |girl| %&gt;</span>
  <span class="tag">&lt;<span class="title">tr</span>&gt;</span>
    <span class="tag">&lt;<span class="title">td</span>&gt;</span><span class="vbscript">&lt;%= girl.name %&gt;</span><span class="tag">&lt;/<span class="title">td</span>&gt;</span>
    <span class="tag">&lt;<span class="title">td</span>&gt;</span><span class="vbscript">&lt;%= girl.number %&gt;</span><span class="tag">&lt;/<span class="title">td</span>&gt;</span>
    <span class="tag">&lt;<span class="title">td</span>&gt;</span><span class="vbscript">&lt;%= link_to <span class="comment">'Show', girl %&gt;</span></span><span class="tag">&lt;/<span class="title">td</span>&gt;</span>
    <span class="tag">&lt;<span class="title">td</span>&gt;</span><span class="vbscript">&lt;%= link_to <span class="comment">'Edit', edit_girl_path(girl) %&gt;</span></span><span class="tag">&lt;/<span class="title">td</span>&gt;</span>
    <span class="tag">&lt;<span class="title">td</span>&gt;</span><span class="vbscript">&lt;%= link_to <span class="comment">'Destroy', girl, confirm: 'Are you sure?', method: :delete %&gt;</span></span><span class="tag">&lt;/<span class="title">td</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">tr</span>&gt;</span>
<span class="vbscript">&lt;% <span class="keyword">end</span> %&gt;</span>
<span class="tag">&lt;/<span class="title">table</span>&gt;</span>

<span class="tag">&lt;<span class="title">br</span> /&gt;</span>

<span class="vbscript">&lt;%= link_to <span class="comment">'New Girl', new_girl_path %&gt;</span></span>
</code></pre>
<p>在这里，<code>@girls</code> 是一个从 <code>Girl</code> 模型来的所有对象的集合，很难懂吗？所有我们深爱过的女孩。我们遍历每一个女孩，并把每个特别的女孩关在一个小房间里：<code>|girl|</code> 呵呵，我相信你们都这么做过！哈哈，正经的说呢，这么做就是给下面的区块创了一个 <code>girl</code> 变量。</p>
<p><code>name</code> 与 <code>number</code> 方法跟我们在 <code>app/views/girls/show.html.erb</code> 使用过的一样，是用来显示栏位值的。在这之后，建了三个链接， Show, Edit, Destroy。</p>
<p>第一个链接把 <code>girl</code> 对象传进来，藉由一个像是 <code>/girls/{id}</code> 的路由连到 <code>GirlsController</code> 的 <code>show</code> 动作， <code>{id}</code> 是这个对象在表里面的 ID。</p>
<p>第二个链接使用 <code>edit_girl_path</code> 并传入 <code>girl</code> 对象连到 <code>edit</code> 动作，这个 helper 对应的路径是 <code>/girls/{id}/edit</code> 。</p>
<p>第三个链接和第一个一样把 <code>girl</code> 对象传进来，但是后面指名了方法是 <code>:delete</code> ，这也就是我们的第三个方式，也是这个路由 <code>/girls/{id}</code> 有的最后一个方式。因为你把 <code>method:</code> 设为 <code>:delete</code> Rails 理解你要忘记一个女孩，并带你到 <code>GirlsController</code> 的 <code>destroy</code> 动作：</p>
<p>  def destroy
    @girl = Girl.find(params[:id])
    @girl.destroy</p>
<pre><code><span class="title">respond_to</span> do |format|
  format.html { <span class="title">redirect_to</span> girls_url }
  format.json { <span class="title">head</span> :no_content }
end
</code></pre>
<p>  end</p>
<p>就跟我们之前看过的 <code>show</code> , <code>edit</code> , <code>update</code> 动作一样，先把 <code>@girl</code> 对象取出来（ <code>Girl.find(params[:id]</code> ）。</p>
<p>然后摧毁她（<code>@girl.destroy</code>）。。。再见了，我的愛人。</p>
<p>这把你数据库的纪录永远地删除了。然后把你重定向至 <code>girls_url</code> 也就是这里 <a href="http://localhost:3000/girls">http://localhost:3000/girls</a> 。注意！！！ 这里使用的是 <code>girls_url</code> （ <code>path</code> 换成 <code>url</code> ），会产生一个完整的 URL。</p>
<p>呼，讲到这里讲完了你的第一个 Rails 应用，是不是很简单呢？</p>
<p>最后献上苍老师的图片一只：</p>
<p><a href="http://zh.wikipedia.org/wiki/%E8%92%BC%E4%BA%95%E7%A9%BA"><img src="http://ww2.sinaimg.cn/bmiddle/67b532d1jw1dq6lvk4vylj.jpg" alt="蒼井そら"></a></p>
<p>距离学会 Rails 还有 970 个小时。。。</p>
<p>つづく</p>
<h4>延伸阅读：</h4>
<p><a href="http://ihower.tw/rails3/basic.html">打造 CRUD by ihower</a></p>
<p><a href="http://guides.rubyonrails.org/routing.html">Rails Routing from the Outside In</a></p>
<p><a href="http://ruby.railstutorial.org/chapters/a-demo-app">Demo App from Learn Rails By Example</a></p>
<p><a href="http://railsforzombies.org/">Rails For Zombies</a></p>

      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/Rails/">Rails</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/Rails/">Rails</a>
  </div>

        
  <div class="addthis addthis_toolbox addthis_default_style">
    
      <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
    
    
      <a class="addthis_button_tweet"></a>
    
    
      <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    
    
      <a class="addthis_button_pinterest_pinit" pi:pinit:layout="horizontal"></a>
    
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script>

      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



<a class="moot" href="https://moot.it/i/lisp_es">
   <h1 class="title">留言</h1>
</a></div></div>
    <aside id="sidebar" class="alignleft"><!-- 
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜尋">
    <input type="hidden" name="q" value="site:lisp.es/">
  </form>
</div>

  
<div class="widget twitter">
  <h3 class="title">推文</h3>
  <ul id="tweets"></ul>
</div>

<script type="text/javascript">
var twitter_stream = ['JuanitoFatas', 5, false];
var moment_js_path = '/js/moment.min.js';
</script>
<script src="/js/twitter.js"></script>


 -->
<div class="personal-info">
  <figure>
    
      <a href="/">
        <img class="personal-photo" src="https://secure.gravatar.com/avatar/771951f55ed37335f238e1a80dfda9cd?s=420&d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-user-420.png" alt="Juanito Fatas">
      </a>
    
    <figcaption>
      <h3 class=>Juanito Fatas</h3>
      <p>城市中的迷途小碼農</p>
    </figcaption>
  </figure>
  <section class="social">
    
      <a target="_blank" class="icon twitter depth" href="http://twitter.com/JuanitoFatas"></a>
    
    
    
      <a target="_blank" class="icon github depth" href="http://github.com/JuanitoFatas"></a>
    
    
      <a target="_blank" class="icon email depth" href="mailto:katehuang0320@gmail.com"></a>
    
  </section>
</div>
</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignright depth">
  <a class="footer-link" href="/about">About Me</a>
  <a class="footer-link" href="http://github.com/thiagopnts/hexo-persona-dark">Based on Persona Dark Theme</a> 
  &copy; - 2013 Juanito Fatas
  
</div>
<div class="clearfix"></div></footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



<script src="//cdn.moot.it/latest/moot.min.js"></script>

</body>
</html>