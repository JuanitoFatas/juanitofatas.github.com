
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Android 原始碼下載及版本控制 - 使用git與repo - 台北小碼農</title>
  <meta name="author" content="Juanito Fatas Huang">

  
  <meta name="description" content="要取得Android的原始碼，會需要用到Git和Repo還有Gerrit。
以下解釋一些工具，太冗長，可直接拉到最下方看如何取得Android原始碼。 什麼是Git? Git is an open-source version-control system designed to handle &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://JuanitoFatas.github.com/blog/2011/11/08/get-android-source">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/cloud.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="台北小碼農" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-26995626-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">台北小碼農</a></h1>
  
    <h2>Hello, World!</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:JuanitoFatas.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/about">關於我</a></li>
  <li><a href="/blog/archives">文章列表</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Android 原始碼下載及版本控制 - 使用git與repo</h1>
    
    
      <p class="meta">
        




  

<time datetime="2011-11-08T10:39:00+08:00" pubdate>Nov 8<span>th</span>, 2011</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>要取得Android的原始碼，會需要用到<em>Git</em>和<em>Repo</em>還有<em>Gerrit</em>。
以下解釋一些工具，太冗長，可直接拉到最下方看如何取得Android原始碼。</p>

<h3>什麼是<a href="http://en.wikipedia.org/wiki/Git_(software)">Git</a>?</h3>

<blockquote><p>Git is an open-source version-control system designed to handle
very large projects that are distributed over multiple repositories.</p></blockquote>

<h3>那Git for Android是?</h3>

<blockquote><p>In the context of Android, we use Git for local operations such as
local branching, commits, diffs, and edits. One of the challenges
in setting up the Android project was figuring out how to best support
the outside community&#8211;from the hobbiest community to large OEMs
building mass-market consumer devices. We wanted components to be
replaceable, and we wanted interesting components to be able to grow a
life of their own outside of Android. We first chose a distributed
revision control system, then further narrowed it down to Git.</p></blockquote>

<h3>什麼是<a href="http://en.wikipedia.org/wiki/Repo_(script)">Repo</a>?</h3>

<blockquote><p>Repo is a tool that Google built on top of Git
to manage the many Git repositories, do the uploads
to revision control system, and automate parts of the
Android development workflow.
- from wikipedia</p></blockquote>

<h3>什麼是Gerrit?</h3>

<blockquote><p>Gerrit is a web-based code review system for projects that use git.
Gerrit encourages more centralized use of Git by allowing all authorized
users to submit changes, which are automatically merged if they pass code
review. In addition, Gerrit makes reviewing easier by displaying changes
side by side in-browser and enabling inline comments.</p></blockquote>

<h4>我覺得簡單來說就是：</h4>

<ul>
<li>Git 是玩遊戲存檔的複雜工具</li>
<li>Git for Android 是玩Android遊戲存檔的複雜工具</li>
<li>Repo 是Google推出的遊戲存檔工具</li>
<li>Gerrit 給使用git專案的雲端code review伺服器</li>
</ul>


<h3>安裝Git</h3>

<p>請至<a href="http://git-scm.com/">Git官網</a>下載適合版本。</p>

<h3>安裝repo ( Mac OSX 為例 )</h3>

<p>首先在HOME目錄建立bin資料夾（如果沒有）</p>

<p><code>$ mkdir ~/bin</code></p>

<p>將此資料夾加入環境變數 $PATH</p>

<p><code>$ PATH=~/bin:$PATH</code></p>

<p>下載repo至~/bin/並設置權限為可執行</p>

<p><code>$ curl https://dl-ssl.google.com/dl/googlesource/git-repo/repo &gt; ~/bin/repo</code>
<code>$ chmod a+x ~/bin/repo</code></p>

<h2>基本的工作流程</h2>

<p><img src="http://source.android.com/images/submit-patches-0.png" style="float:right"></p>

<p><ol>
<li>用repo開始一個新的分支</li>
<li>編輯檔案</li>
<li>用git加入Stage changes</li>
<li>用git commit來commit變更</li>
<li>用repo upload來上傳變更至review server</li>
</ol></p>


<p></img></p>

<h2>基本的工作項目：</h2>

<h3>同步clinet端</h3>

<p>同步所有現有的專案：</p>

<p><code>$ repo sync</code></p>

<p>同步被選擇的的專案</p>

<p>`$ repo sync project0 project1 &#8230; projectN</p>

<h3>建立topic branches</h3>

<p>開始一個新分支</p>

<p><code>$ repo start BRANCH_NAME</code></p>

<p>確認是否建立成功</p>

<p><code>$ repo status</code></p>

<p>使用topic branches</p>

<p><code>$ repo start BRANCH_NAME PROJECT</code></p>

<p>切換分支</p>

<p><code>$ git checkout BRANCH_NAME</code></p>

<p>分支列表</p>

<p><code>$ git branch</code> 或是 <code>$ repo branches</code></p>

<p>當下的分支前面有個*號</p>

<p>注意：
有一個bug會使 <code>repo sync</code> 重置到local topic branch。
如果在你運行 <code>repo sync</code> 之後 <code>git branch</code> 顯示 *(no branch)
再運行一次 <code>git checkout</code> 即可。</p>

<h3>Staging files</h3>

<p>添加檔案到stage</p>

<p><code>$ git add ARGUMENTS</code></p>

<p>ARGUMENTS可以是檔案、資料夾&#8230;etc。</p>

<h3>檢視Client的狀態</h3>

<p>列出檔案狀態的清單</p>

<p><code>$ repo status</code></p>

<p>看還沒commit的編輯</p>

<p><code>$ repo diff</code></p>

<h4>git diff與repo diff的差別?</h4>

<p><code>repo diff</code> 顯示本機的編輯（ 不會 列入commit）
<code>git diff</code> 顯示本機的編輯（ 會 列入commit）</p>

<p>在執行<code>git diff</code>之前，確定你是在專案的目錄底下：</p>

<p><code>$ cd ~/WORKING_DIRECTORY/PROJECT</code>  <br/>
<code>$ git diff --cached</code></p>

<h3>提交變更</h3>

<p>提交</p>

<p><code>$ git commit</code></p>

<p>要輸入commit message否則會提交失敗</p>

<h3>上傳變更到Gerrit</h3>

<p>在上傳之前，先更新到最新版本。</p>

<p><code>$ repo sync</code></p>

<p>之後執行</p>

<p><code>$ repo upload</code></p>

<p>會問你要選擇哪個分支到 review server</p>

<h3>修復Sync衝突</h3>

<p>如果 <code>repo sync</code> 顯示 sync conflicts:</p>

<ul>
<li>檢視還沒merged的檔案 (status code = U)</li>
<li><p>去修改編輯有衝突的地方</p></li>
<li><p>變更相關的專案目錄</p></li>
</ul>


<p><code>$ git add .</code>  <br/>
<code>$ git commit</code>  <br/>
<code>$ git rebase --continue</code></p>

<ul>
<li>當rebase完成後開始sync</li>
</ul>


<p><code>$ repo sync PROJECT0 PROJECT1 ... PROJECTN</code></p>

<h3>清理client檔案</h3>

<p>變動之後更新本機工作目錄</p>

<p><code>$ repo sync</code></p>

<p>安全移除舊的topic branches</p>

<p><code>$ repo prune</code></p>

<p>刪除一個client</p>

<p><code>$ rm -rf WORKING_DIRECTORY</code></p>

<p>注意：會永久刪除所有你還沒有上傳的變更</p>

<h1>Git &amp; Repo Cheatsheet</h1>

<p><img src="http://source.android.com/images/git-repo-1.png" style="float:center"></p>

<h2>那究竟怎麼取得 Android 原始碼呢？</h2>

<h3>首先建立一個 <em>Repo Client</em></h3>

<p>建立要放置Android 原始碼的資料夾並切換至此資料夾</p>

<p><code>$ mkdir WORKING_DIRECTORY</code>  <br/>
<code>$ cd WORKING_DIRECTORY</code></p>

<p>初始化repo</p>

<p><code>$ repo init -u https://android.googlesource.com/platform/manifest</code></p>

<p>要使用Gerrit code-review工具，需要輸入與google連結之email、名字。</p>

<p>取得特定Android branch</p>

<p><code>$ repo init -u https://android.googlesource.com/platform/manifest -b android-2.3.7_r1</code></p>

<h3>取得檔案</h3>

<p><code>$ repo sync</code></p>

<p>記得要在剛剛的 WORKING_DIRECTORY</p>

<h3>輸入Android原始碼的公用金鑰</h3>

<h4>會使用到<a href="http://www.gnupg.org/gph/en/manual.html#AEN84">gpg</a> &#8211;import sample_name.gpg</h4>

<p>打開記事本輸入以下內容並另存為 xxx.gpg</p>

<div><script src='https://gist.github.com/1347589.js?file='></script>
<noscript><pre><code>-----BEGIN PGP PUBLIC KEY BLOCK-----
Version: GnuPG v1.4.2.2 (GNU/Linux)

mQGiBEnnWD4RBACt9/h4v9xnnGDou13y3dvOx6/t43LPPIxeJ8eX9WB+8LLuROSV
lFhpHawsVAcFlmi7f7jdSRF+OvtZL9ShPKdLfwBJMNkU66/TZmPewS4m782ndtw7
8tR1cXb197Ob8kOfQB3A9yk2XZ4ei4ZC3i6wVdqHLRxABdncwu5hOF9KXwCgkxMD
u4PVgChaAJzTYJ1EG+UYBIUEAJmfearb0qRAN7dEoff0FeXsEaUA6U90sEoVks0Z
wNj96SA8BL+a1OoEUUfpMhiHyLuQSftxisJxTh+2QclzDviDyaTrkANjdYY7p2cq
/HMdOY7LJlHaqtXmZxXjjtw5Uc2QG8UY8aziU3IE9nTjSwCXeJnuyvoizl9/I1S5
jU5SA/9WwIps4SC84ielIXiGWEqq6i6/sk4I9q1YemZF2XVVKnmI1F4iCMtNKsR4
MGSa1gA8s4iQbsKNWPgp7M3a51JCVCu6l/8zTpA+uUGapw4tWCp4o0dpIvDPBEa9
b/aF/ygcR8mh5hgUfpF9IpXdknOsbKCvM9lSSfRciETykZc4wrRCVGhlIEFuZHJv
aWQgT3BlbiBTb3VyY2UgUHJvamVjdCA8aW5pdGlhbC1jb250cmlidXRpb25AYW5k
cm9pZC5jb20+iGAEExECACAFAknnWD4CGwMGCwkIBwMCBBUCCAMEFgIDAQIeAQIX
gAAKCRDorT+BmrEOeNr+AJ42Xy6tEW7r3KzrJxnRX8mij9z8tgCdFfQYiHpYngkI
2t09Ed+9Bm4gmEO5Ag0ESedYRBAIAKVW1JcMBWvV/0Bo9WiByJ9WJ5swMN36/vAl
QN4mWRhfzDOk/Rosdb0csAO/l8Kz0gKQPOfObtyYjvI8JMC3rmi+LIvSUT9806Up
hisyEmmHv6U8gUb/xHLIanXGxwhYzjgeuAXVCsv+EvoPIHbY4L/KvP5x+oCJIDbk
C2b1TvVk9PryzmE4BPIQL/NtgR1oLWm/uWR9zRUFtBnE411aMAN3qnAHBBMZzKMX
LWBGWE0znfRrnczI5p49i2YZJAjyX1P2WzmScK49CV82dzLo71MnrF6fj+Udtb5+
OgTg7Cow+8PRaTkJEW5Y2JIZpnRUq0CYxAmHYX79EMKHDSThf/8AAwUIAJPWsB/M
pK+KMs/s3r6nJrnYLTfdZhtmQXimpoDMJg1zxmL8UfNUKiQZ6esoAWtDgpqt7Y7s
KZ8laHRARonte394hidZzM5nb6hQvpPjt2OlPRsyqVxw4c/KsjADtAuKW9/d8phb
N8bTyOJo856qg4oOEzKG9eeF7oaZTYBy33BTL0408sEBxiMior6b8LrZrAhkqDjA
vUXRwm/fFKgpsOysxC6xi553CxBUCH2omNV6Ka1LNMwzSp9ILz8jEGqmUtkBszwo
G1S8fXgE0Lq3cdDM/GJ4QXP/p6LiwNF99faDMTV3+2SAOGvytOX6KjKVzKOSsfJQ
hN0DlsIw8hqJc0WISQQYEQIACQUCSedYRAIbDAAKCRDorT+BmrEOeCUOAJ9qmR0l
EXzeoxcdoafxqf6gZlJZlACgkWF7wi2YLW3Oa+jv2QSTlrx4KLM=
=Wi5D
-----END PGP PUBLIC KEY BLOCK-----</code></pre></noscript></div>


<p>把此金鑰加入到gpg key database裡</p>

<p><code>gpg --import sample_name.gpg</code></p>

<p>加入金鑰後可以用來確認git的tag</p>

<p><code>$ git tag -v TAG_NAME</code></p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Juanito Fatas Huang</span></span>

      




  

<time datetime="2011-11-08T10:39:00+08:00" pubdate>Nov 8<span>th</span>, 2011</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://JuanitoFatas.github.com/blog/2011/11/08/get-android-source/" data-via="" data-counturl="http://JuanitoFatas.github.com/blog/2011/11/08/get-android-source/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2011/11/03/psych-issue/" title="Previous Post: couldn't parse YAML, psych.rb:148">&laquo; couldn't parse YAML, psych.rb:148</a>
      
      
        <a class="basic-alignment right" href="/blog/2011/11/16/test/" title="next Post: test">test &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2011/11/16/test/">test</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/11/08/get-android-source/">Android 原始碼下載及版本控制 - 使用git與repo</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/11/03/psych-issue/">couldn't parse YAML, psych.rb:148</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/11/03/micro-ruby/">micro ruby notes</a>
      </li>
    
  </ul>
</section>




<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/u/0/116526763595254359821?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>


<section>
  <h1>Friends</h1>
  <ul>
    <li><a href="http://fengdidiblog.wordpress.com//" target="_blank">泰安小碼農</a></li>
  </ul>
</section>
<section>
  <h1> Recommend Books </h1>
  <!--The Little schemer-->
  <p> 
    <a href="http://www.amazon.com/Little-Schemer-Daniel-P-Friedman/dp/0262560992?SubscriptionId=AKIAJEAFZO7Z2CDEA3CQ&tag=zanshinnet&linkCode=xm2&camp=2025&creative=165953&creativeASIN=0262560992"><img src="http://ecx.images-amazon.com/images/I/51Pm9ijyRzL.jpg" /></a>
  </p>
  <p>
    <a href="http://www.amazon.com/Little-Schemer-Daniel-P-Friedman/dp/0262560992?SubscriptionId=AKIAJEAFZO7Z2CDEA3CQ&tag=zanshinnet&linkCode=xm2&camp=2025&creative=165953&creativeASIN=0262560992">The Little Schemer - 4th Edition</a>
    by Daniel P. Friedman and Matthias Felleisen
  </p>
  <h1>Recent Readings</h1>
  <!--Paradigms of Artificial Intelligence, case study common lisp-->
  <p> 
    <a href="http://www.amazon.com/Paradigms-Artificial-Intelligence-Programming-Studies/dp/1558601910?SubscriptionId=AKIAJEAFZO7Z2CDEA3CQ&tag=zanshinnet&linkCode=xm2&camp=2025&creative=165953&creativeASIN=1558601910"><img src="http://ecx.images-amazon.com/images/I/410NLClvxgL._SL160_.jpg" /></a>
  </p>
  <p>
    <a href="http://www.amazon.com/Paradigms-Artificial-Intelligence-Programming-Studies/dp/1558601910?SubscriptionId=AKIAJEAFZO7Z2CDEA3CQ&tag=zanshinnet&linkCode=xm2&camp=2025&creative=165953&creativeASIN=1558601910">Paradigms of Artificial Intelligence Programming: Case Studies in Common Lisp</a>
    by Peter Norvig
  </p>
  <!--AI modern approach-->
  <p> 
    <a href="http://www.amazon.com/Artificial-Intelligence-Modern-Approach-3rd/dp/0136042597?SubscriptionId=AKIAJEAFZO7Z2CDEA3CQ&tag=zanshinnet&linkCode=xm2&camp=2025&creative=165953&creativeASIN=0136042597"><img src="http://ecx.images-amazon.com/images/I/51bi4EnYE1L._SL160_.jpg" /></a>
  </p>
  <p>
    <a href="http://www.amazon.com/Artificial-Intelligence-Modern-Approach-3rd/dp/0136042597?SubscriptionId=AKIAJEAFZO7Z2CDEA3CQ&tag=zanshinnet&linkCode=xm2&camp=2025&creative=165953&creativeASIN=0136042597">Artificial Intelligence: A Modern Approach (3rd Edition)</a>
    by Stuart Russell and Peter Norvig
  </p>
</section>
  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2011 - Juanito Fatas Huang -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'juanfatas';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://JuanitoFatas.github.com/blog/2011/11/08/get-android-source/';
        var disqus_url = 'http://JuanitoFatas.github.com/blog/2011/11/08/get-android-source/';
        var disqus_script = 'embed.js';
      

    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>


<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
