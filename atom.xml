<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[I'm Juanito Fatas]]></title>
  <subtitle><![CDATA[C-x C-f...C-x C-s...]]></subtitle>
  <link href="http://lisp.es//atom.xml" rel="self"/>
  <link href="http://lisp.es/"/>
  <updated>2013-07-19T08:24:19.379Z</updated>
  <id>http://lisp.es//</id>
  <author>
    <name><![CDATA[Juanito Fatas]]></name>
    <email><![CDATA[katehuang0320@gmail.com]]></email>
  </author>
  <generator uri="http://zespia.tw/hexo">Hexo</generator>
  <entry>
    <title type="html"><![CDATA[山寨与版权的故事一则]]></title>
    <link href="http://lisp.es//2013/07/19/clone-and-grow/"/>
    <id>http://lisp.es//2013/07/19/clone-and-grow/</id>
    <published>2013-07-18T16:00:56.000Z</published>
    <updated>2013-07-18T16:02:10.000Z</updated>
    <content type="html"><![CDATA[<p><strong>轉載文章，出處不明。</strong></p>
<p>19 世纪的美国是假货天堂。英国文豪查尔斯·狄更斯曾在 1842 年到访美国，令他吃惊的是美国好多地方都摆着自己作品的盗版。狄更斯呼吁美国社会保护著作权，但没有人理睬。不光没有人理睬，一家擅自转载英国作家小说的美国报纸还谩骂说“狄更斯不是绅士，只是一个贪得无厌的无赖”。19 世纪中期正是美国依靠模仿欧洲的技术和创意巩固自己经济基础的时期。</p>
<p>有人说创造始于模仿。罗马人在模仿希腊文化的同时建立起自己独自的文化。而罗马又被英法德等欧洲各国模仿，这些国家 19 世纪在文化和科学技术领域引领了世界潮流。从 19 世纪模仿欧洲的美国来看，“欧洲也模仿过，我有什么不可以？”。日本也模仿过欧洲，程度比美国还厉害。19 世纪末的明治时代，日本文人都争相翻译欧洲小说来过活，但没有听说过谁付过版权费。当时的日本企业也把欧美的商品拆开，然后制造销售“山寨”。</p>
<p>美国对待知识产权的态度大概是从 19 世纪后半期开始转变的。继托马斯•爱迪生发明了电灯和格拉汉姆•贝尔发明了电话之后 20 世纪莱特兄弟又发明了飞机。模仿欧洲的时代已经成为过去，美国开始渐渐取代英国成为世界第一经济大国。随着自主发明和创造日益增多，立场也发生了变化，反倒必须要保护知识产权。虽然日本在第二次世界大战后还在继续模仿欧美，但明显的假冒越来越少。从自主发明开始增多的 1970 年前后开始，日本社会也逐渐将保护知识产权挂在嘴边。</p>
]]></content>
    <category scheme="http://lisp.es//tags/essay/" term="essay"/>
  </entry>
  <entry>
    <title type="html"><![CDATA[Metaobject 元对象]]></title>
    <link href="http://lisp.es//2013/07/07/meta-object-intro/"/>
    <id>http://lisp.es//2013/07/07/meta-object-intro/</id>
    <published>2013-07-07T05:01:23.000Z</published>
    <updated>2013-07-07T05:08:11.000Z</updated>
    <content type="html"><![CDATA[<p>元对象 metaobject
在计算机科学里，一个元对象是任何可以操作、创建、描述或实现别的对象的实体。</p>
<p>基础对象 base object
关于 metaobject 的对象称作基础对象。</p>
<p>一个元对象可储存的信息为基础对象的类型 (type)、介面 (interface)、类别 (class)、方法 (methods)、属性 (attributes)、变量 (variables)、函数 (functions)、控制结构 (control structures) 等。</p>
<p>一个元对象协议 (metaobject protocol) 是一个程序语义的直译器，而此直译器是公开且可扩展的。因此，一个 MOP 决定了一个程序的行为与意义是什么，并且 MOP 是可扩展的，使得一个程序员可以通过扩展 MOP 的部分，来改变程序的行为。MOP 揭露了直译器某些或全部的内部结构给程序员。MOP 也许表现的像是一组类别与方法，允许一个程序来检查支援系统的状态以及改变系统的行为。MOP 面向对象的程序所实现，其中所有的对象是元对象</p>
<p>MOP 分成执行期或编译期两种。执行期 MOP 的元对象于程序运行、执行时存在。而编译期 MOP 的元对象仅在程序编译时存在。它们或许可以改变或扩展编译过程，但当程序运行时它们是不存在的。</p>
<p>最为人所知的执行期 MOP 是 The Art of Metaobject Protocol (AMOP) 所描述的 MOP。它应用在 Common Lisp 对象系统上 (CLOS)，并允许我们可以操作继承、方法派发、类别实例化…等等，这些机制。在全录帕罗奥多研究中心 Xerox PARC，AMOP 作者之一，Gregor Kiczales，在 Scheme 上开发了一个小巧但威力强大的基于 MOP 的执行期对象系统，称为 TinyCLOS。被移植到许多 Scheme 实现上。</p>
<p>一个 MOP 的用途例子是改变多重继承的实作。一个反覆出现的议题是如何解决 slot 的冲突与方法的 superclass。通常语言设计者选择一个解决方案，而语言使用者必须遵循它。取而代之的，元对象协议使得我们可以改变继承的规则，并替每一个单一类别选择不同的解决方案。一个元对象是一种实现 aspect-oriented programming 语言的方法。许多早期 MOP 的创始者，包括 Gregor Kiczales 为早期 aspect-oriented 程序设计的提倡者。</p>
<p>未完待續...</p>
]]></content>
    <category scheme="http://lisp.es//tags/Metaobject/" term="Metaobject"/>
    <category scheme="http://lisp.es//categories/Metaobject/" term="Metaobject"/>
  </entry>
  <entry>
    <title type="html"><![CDATA[西文一些結尾問候語的說法]]></title>
    <link href="http://lisp.es//2013/07/07/spanish-ending-words/"/>
    <id>http://lisp.es//2013/07/07/spanish-ending-words/</id>
    <published>2013-07-07T04:58:30.000Z</published>
    <updated>2013-07-07T05:07:37.000Z</updated>
    <content type="html"><![CDATA[<p>一些禮貌性的結尾問候語：</p>
<ul>
<li>un beso (A kiss)</li>
<li>un besote (A big kiss)</li>
<li>un besazo (A big big kiss)</li>
<li>un besito （小親親，有那種親小孩的感覺，啾啾啾的那種親親）</li>
<li>un besico （跟 besito 一樣，但是妳如果跟從 zaragoza 來的人，說 besico，他們會很驚訝！）</li>
<li>un besiko （跟 besico 一樣，只是 k 的音跟 c 一樣。）</li>
</ul>
<p><code>-ito</code> <code>-ico</code> 字根，就是變小的意思</p>
<p><code>-azo</code> 字根，有變大的意思</p>
<ul>
<li>un abrazo （擁抱）</li>
<li>un abrazo fuerte （一個強烈的擁抱，抱的很緊的那種）</li>
<li>un beso enorme （超大的親親）</li>
<li>un superbesote de vaca （像牛一樣舔妳的臉。乳牛的舌頭很長，這句很有趣喔!）</li>
<li>un morreo （台灣話的喇舌）</li>
<li>mua! （就是 <strong>ㄇㄨㄚˋ</strong> 一下囉）</li>
<li>un saludo (a greeting)</li>
<li>TQM Te quiero mucho (I love you very much!!)</li>
<li>Cuidate (take care)</li>
</ul>
<p>可以在問候語的後面加很多東西，譬如：un beso guapisimo (大帥哥）</p>
<p>還有很多囉，其實就只是好玩而已，是西班牙人表達禮貌與思念的方式!</p>
<p>un beso a todos ; ) !!!</p>
]]></content>
    <category scheme="http://lisp.es//tags/Spanish/" term="Spanish"/>
    <category scheme="http://lisp.es//categories/Spanish/" term="Spanish"/>
  </entry>
  <entry>
    <title type="html"><![CDATA[Hello Ruby，走進琳達里優可絲的夢遊仙境。]]></title>
    <link href="http://lisp.es//2013/07/02/hello-ruby/"/>
    <id>http://lisp.es//2013/07/02/hello-ruby/</id>
    <published>2013-07-01T17:57:51.000Z</published>
    <updated>2013-07-01T18:53:57.000Z</updated>
    <content type="html"><![CDATA[<p>來分享一下，一個人、一本書。</p>
<p>那個人？<a href="http://lindaliukas.fi/">Linda Liukas</a>，Rails Girls 共同創辦人，Codecademy 的社群管理員。2013 年的 Ruby 英雄。哪本書？由她所寫的 Ruby 童書<a href="http://helloruby.com/">《Hello Ruby》</a>，我是從 Heroku Waza 2013 Conf 看到的一個影片，由 Codecademy 的 Linda 小姐帶來的題目：人人有程編，發現到這位 Linda 小姐。</p>
<p>她分享了兩個故事，前半段簡略的講了下《Hello Ruby》，後半段講她的心路歷程，提到編程世界的女權問題、教學問題、文化問題，很精采也很有感染力，我就不多說了，留給你與她來一個面對面的交流！</p>
<p>我這邊稍稍介紹下《Hello Ruby》。</p>
<p>由 Linda Liukas (念法：琳達●里優可絲）撰寫的 Ruby 童書，《Hello Ruby》，不久之後即將推出，這是一本什麼樣的書呢？</p>
<p>故事的內容大概是這樣：有一個古靈精怪充滿好奇心、調皮搗蛋又頑強的可愛小女孩，叫做“露比”，</p>
<p><img src="https://raw.github.com/JuanitoFatas/Foto/master/hello-ruby/01-little-ruby.png" alt=""></p>
<p>有一天，她與她的好朋友，“潔姆絲”們，在一起玩耍，突然間北風叔叔來了，北風叔叔把她的好朋友潔姆絲吹走了，散落到世界各地。於是露比踏上了冒險的旅途，要找回她的好朋友們。在旅途當中，她碰到許許多多的人，並在旅途中，向遇到的人們尋求幫助。</p>
<p><img src="https://raw.github.com/JuanitoFatas/Foto/master/hello-ruby/02-android.png" alt=""></p>
<p>有一次她遇到了機器人安卓依，有數以百計的安卓依，正在快樂地烘焙拐杖糖、餅乾、牛奶與彩虹糖，她問安卓依有看到潔姆絲嗎？安卓依們看起來很奇怪，總是同時一起說話，她感到很混亂，但仍然很喜歡安卓依。</p>
<p><img src="https://raw.github.com/JuanitoFatas/Foto/master/hello-ruby/03-snow-leopard.png" alt=""></p>
<p>她遇到了喜歡簡單美好事物的的美麗小雪豹：絲諾梨歐趴，小雪豹喜歡一人獨處，但她與 Ruby 相處的很好。</p>
<p><img src="https://raw.github.com/JuanitoFatas/Foto/master/hello-ruby/04-penguins.png" alt=""></p>
<p>她遇到了充滿好奇心的小企鵝們，小企鵝們很愛胡思亂想也很聒噪，有著許許多多的意見，有時候露比聽不懂小企鵝們在說什麼，但她認為小企鵝們很聰明並有很多知識。</p>
<p><img src="https://raw.github.com/JuanitoFatas/Foto/master/hello-ruby/05-firefox.png" alt=""></p>
<p>她遇到了小火狐，小火狐喜歡很多小東西，就如同她喜歡與小露比一起玩。</p>
<p><img src="https://raw.github.com/JuanitoFatas/Foto/master/hello-ruby/06-Django.png" alt=""></p>
<p>她遇到了一個小男孩，嬉皮士姜狗，姜狗試著要與露比來一場對決。。。</p>
<p>露比的朋友每個都很不一樣，每個人都不是完美的，有著各自調皮的地方，露比從他們每個人身上學到許多東西，而這個世界需要他們。</p>
<p><img src="https://raw.github.com/JuanitoFatas/Foto/master/hello-ruby/07-magic-book.png" alt=""></p>
<p>Linda Liukas 如是說：“我相信每個人小時候，都有一本屬於童年的魔法書。一本讓你看到世界是如此美麗，充滿著無限可能性的一本魔法書。而這本是我的魔法書（笑）。”</p>
<p>聽聽她精妙絕倫的演講，找回編程最初的感動吧！</p>
<p>傳送門：<a href="https://vimeo.com/61113155">https://vimeo.com/61113155</a></p>
]]></content>
    <category scheme="http://lisp.es//tags/ruby/" term="ruby"/>
    <category scheme="http://lisp.es//categories/ruby/" term="ruby"/>
  </entry>
  <entry>
    <title type="html"><![CDATA[在 Sublime Text 里面运行 Ruby 测试]]></title>
    <link href="http://lisp.es//2013/06/20/ruby-test-in-sublime-with-spork/"/>
    <id>http://lisp.es//2013/06/20/ruby-test-in-sublime-with-spork/</id>
    <published>2013-06-19T17:08:44.000Z</published>
    <updated>2013-06-19T17:10:52.000Z</updated>
    <content type="html"><![CDATA[<ol>
<li>安装 package:</li>
</ol>
<p>安装办法见 Ruby Tests GitHub 说明页面：<a href="https://github.com/maltize/sublime-text-2-ruby-tests">https://github.com/maltize/sublime-text-2-ruby-tests</a></p>
<p>安装好后，重启 Sublime Text，RubyTest 提供了以下热键：</p>
<ul>
<li>Command-Shift-R: run a single test (if run on an it block) or group of tests (if run on a describe block)</li>
<li>Command-Shift-E: run the last test(s)</li>
<li>Command-Shift-T: run all the tests in current file</li>
</ul>
<p>由于测试总运行的暴慢，能单独运行是非常好的。</p>
<p>一个工作流程示例：</p>
<ol>
<li>终端启动 Spork。</li>
<li>写个测试。</li>
<li>Command-Shift-R 确保测试为失败（红灯）。</li>
<li>写相应的代码。</li>
<li>Command-Shift-E 运行刚刚的测试，确保测试通过（绿灯）。</li>
<li>反覆操作 2-5。</li>
</ol>
<p>等代码写到一个阶段的时候， <del>或是女朋友来了</del> ，则抓紧时间运行 <code>rspec spec/</code> ，来确保整组测试通过。</p>
]]></content>
    <category scheme="http://lisp.es//tags/Test/" term="Test"/>
    <category scheme="http://lisp.es//tags/Ruby/" term="Ruby"/>
    <category scheme="http://lisp.es//tags/Spork/" term="Spork"/>
    <category scheme="http://lisp.es//tags/Sublime-Text/" term="Sublime Text"/>
    <category scheme="http://lisp.es//tags/Rails/" term="Rails"/>
    <category scheme="http://lisp.es//categories/Rails/" term="Rails"/>
  </entry>
  <entry>
    <title type="html"><![CDATA[JQuery bind() live() delegate() on() 差别]]></title>
    <link href="http://lisp.es//2012/11/21/jquery-bind-live-delegate/"/>
    <id>http://lisp.es//2012/11/21/jquery-bind-live-delegate/</id>
    <published>2012-11-21T13:43:00.000Z</published>
    <updated>2012-11-24T06:21:32.000Z</updated>
    <content type="html"><![CDATA[<h2>bind() live() delegate()...and on()</h2>
<p><strong>这些都是干嘛的？</strong></p>
<p><strong>为什么我们需要这些方法？</strong></p>
<p>首先给一个示例用 html:</p>
<script src="https://gist.github.com/4124940.js"></script>

<p>很好！ 让我们开始吧！</p>
<a name="more"></a>

<p>假定今天我们想要在按下 <code>h2</code> 的时候，克隆几个 <code>h2</code> 出来吓唬吓唬人，</p>
<p>展示咱的 jQuery 水平，哈哈，该怎么做？</p>
<p>首先我们必须在给 h2 绑个 click 事件，可以在 <strong>自调用函数</strong> 内加入这段代码：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'h2'</span>).on(<span class="string">'click'</span>, ...);
</pre></td></tr></table></figure>

<p>或是用 jQuery 提供的辅助方法 (helper)：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'h2'</span>).click(...);
</pre></td></tr></table></figure>

<p>但秉持著爱学习、追根究柢的精神，让我们看看用 <code>click()</code> 跟 <code>on()</code> 方法究竟差在哪里？</p>
<p>打开 jQuery 1.7.1 源代码，看到这段：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="code"><pre>jQuery.each( (<span class="string">"blur focus focusin focusout load resize scroll unload click dblclick "</span> +
<span class="literal">true</span><span class="string">"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave "</span> +
<span class="literal">true</span><span class="string">"change select submit keydown keypress keyup error contextmenu"</span>).split(<span class="string">" "</span>), <span class="keyword">function</span>( i, name ) {

<span class="literal">true</span><span class="comment">// Handle event binding</span>
truejQuery.fn[ name ] = <span class="keyword">function</span>( data, fn ) {
truetrueif ( fn == <span class="literal">null</span> ) {
truetruetruefn = data;
truetruetruedata = <span class="literal">null</span>;
truetrue}

truetruereturn arguments.length &gt; <span class="number">0</span> ?
truetruetruethis.on( name, <span class="literal">null</span>, data, fn ) :
truetruetruethis.trigger( name );
<span class="literal">true</span>};

trueif ( jQuery.attrFn ) {
truetruejQuery.attrFn[ name ] = <span class="literal">true</span>;
<span class="literal">true</span>}

trueif ( rkeyEvent.test( name ) ) {
truetruejQuery.event.fixHooks[ name ] = jQuery.event.keyHooks;
<span class="literal">true</span>}

trueif ( rmouseEvent.test( name ) ) {
truetruejQuery.event.fixHooks[ name ] = jQuery.event.mouseHooks;
<span class="literal">true</span>}
});
</pre></td></tr></table></figure>

<p>有木有看到， <code>.each()</code> 里面那一沱所有的函數，其实最后都会重定向到 <code>on()</code> ：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="keyword">return</span> arguments.length &gt; <span class="number">0</span> ?
truethis.on( name, <span class="literal">null</span>, data, fn ) :
truethis.trigger( name );
</pre></td></tr></table></figure>

<p>老旧的 jQuery 书都使用 bind() 方法来办到这件事：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'h2'</span>).bind(<span class="string">'click'</span>);
</pre></td></tr></table></figure>

<p>思路是这样的，先选出你要操纵的 DOM 元素，绑定事件，说明要干啥，DONE!</p>
<p>这其实没啥不对啦，挺靠谱的，但别这么用了，因为这些 <code>bind()</code> , <code>live()</code> , <code>delegate()</code> 方法啦，</p>
<p>最后还是会回到 <code>on()</code> 的 (jQuery 1.7+)，那为什么我们不保持一致性，使用 <code>on()</code> 就好呢 ^_^?</p>
<p>先讲讲这几个的差别，假定场景为：</p>
<p><strong>只要按下 <code>h2</code> ，就克隆新的 <code>h2</code> 出来，并加至 <code>body</code> 里。</strong></p>
<blockquote>
<p>会用到的工具:
克隆： <code>clone()</code> 接受一个元素，并拷贝一个副本出来。
appendTo(target): 附加到 target 的尾端。</p>
</blockquote>
<p>看看用 bind() 怎么办到...</p>
<h3>bind() &amp; unbind()</h3>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>$(<span class="string">'h2'</span>).bind(<span class="string">'click'</span>, <span class="keyword">function</span>() {
<span class="literal">true</span>$(<span class="keyword">this</span>).clone().appendTo(<span class="string">'body'</span>);
});
</pre></td></tr></table></figure>

<p>这个其实只绑定当下的 4 个 <code>h2</code> ，之后新加入的那个并没有绑定 click 事件。</p>
<p>所以不符合我们的需求：</p>
<p><strong>只要按下 <code>h2</code> ，就克隆新的 <code>h2</code> 出来，并加至 <code>body</code> 里。</strong></p>
<p>那该怎办？</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>$(<span class="string">'h2'</span>).bind(<span class="string">'click'</span>, <span class="keyword">function</span>() {
<span class="literal">true</span>$(<span class="keyword">this</span>).clone(<span class="literal">true</span>).appendTo(<span class="string">'body'</span>);
});
</pre></td></tr></table></figure>

<p><code>clone()</code> 可以传入一个布尔直， 为 <code>true</code> 时就会顺道把绑定在被克隆的元素的事件一起拷贝。</p>
<p>阿哈，problem solved。</p>
<p>现在看看用 <code>live()</code> 怎么搞...</p>
<h3>live() &amp; die()</h3>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>$(<span class="string">'h2'</span>).live(<span class="string">'click'</span>, <span class="keyword">function</span>() {
<span class="literal">true</span>$(<span class="keyword">this</span>).clone().appendTo(<span class="string">'body'</span>);
});
</pre></td></tr></table></figure>

<p><code>live()</code> 跟 <code>bind()</code> 不一样的是，它会给 <code>document</code> 加上一个 event handler，</p>
<blockquote>
<p>live() -- Attach an event handler for all elements which match the current selector, now and in the future.</p>
</blockquote>
<p>上述代码会在 h2 被按下时，执行后面那个函数：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="keyword">function</span>() {
<span class="literal">true</span>$(<span class="keyword">this</span>).clone().appendTo(<span class="string">'body'</span>);
}
</pre></td></tr></table></figure>

<p>阿哈，开启 browser 试试看，成功了，因为 <code>live()</code> 跟 <code>bind()</code> 不一样， <code>bind()</code> 绑定至当下所有的 <code>h2</code> (代价昂贵阿!)，而 <code>live()</code> 是给当下的 document 加一个 event handler()。</p>
<p>在 <code>live()</code> 之后出来了 <code>delegate()</code> ... 让我们接著看</p>
<h3>delegate() undelegate()</h3>
<blockquote>
<p>Attach a handler to one or more events for all elements that match the selector, now or in the future, based on a specific set of root elements.</p>
</blockquote>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>$(<span class="string">'body'</span>).delegate(<span class="string">'h2'</span>, <span class="string">'click'</span>, <span class="keyword">function</span>() {
<span class="literal">true</span>$(<span class="keyword">this</span>).clone().appendTo(<span class="string">'body'</span>);
});
</pre></td></tr></table></figure>

<p>现在让我们看看 jQuery 1.7.1 的源代码。</p>
<p>如果你想找某个方法怎么用，只要这么搜就可以了：</p>
<p><code>method:</code></p>
<p>搜搜看 <code>bind()</code> , <code>live()</code> , <code>delegate()</code> 你会发现，他们只不过是构建在 <code>on()</code> 之上的抽象而已:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="code"><pre><span class="comment">// grab from jQuery 1.7.1 source</span>

truebind: <span class="keyword">function</span>( types, data, fn ) {
truetruereturn <span class="keyword">this</span>.on( types, <span class="literal">null</span>, data, fn );
<span class="literal">true</span>},
<span class="literal">true</span><span class="comment">//...</span>
truelive: <span class="keyword">function</span>( types, data, fn ) {
truetruejQuery( <span class="keyword">this</span>.context ).on( types, <span class="keyword">this</span>.selector, data, fn );
truetruereturn <span class="keyword">this</span>;
<span class="literal">true</span>},
<span class="literal">true</span><span class="comment">//...</span>
truedelegate: <span class="keyword">function</span>( selector, types, data, fn ) {
truetruereturn <span class="keyword">this</span>.on( types, selector, data, fn );
<span class="literal">true</span>},
<span class="literal">true</span><span class="comment">//...</span>
</pre></td></tr></table></figure>

<p>而对应的 <code>unbind()</code> , <code>die()</code> , <code>undelegate()</code> 是构建在 <code>off()</code> 的抽象而已。</p>
<p>So...</p>
<p>为什么不直接使用 <code>on()</code> , <code>off()</code> 就好呢 ^_^...</p>
<p>希望这篇文章对你有帮助。</p>
]]></content>
    <category scheme="http://lisp.es//tags/jQuery/" term="jQuery"/>
    <category scheme="http://lisp.es//categories/jQuery/" term="jQuery"/>
  </entry>
  <entry>
    <title type="html"><![CDATA[Common Lisp 的 Scope 与 Extent]]></title>
    <link href="http://lisp.es//2012/06/05/scope-and-extent-in-cl/"/>
    <id>http://lisp.es//2012/06/05/scope-and-extent-in-cl/</id>
    <published>2012-06-04T16:24:00.000Z</published>
    <updated>2013-07-01T13:22:38.000Z</updated>
    <content type="html"><![CDATA[<h2>为什么要理解 Scope 与 Extent?</h2>
<p>这两个概念在理解许多 Common Lisp 语言的特色时是很有用的，这两个概念出现在某个对象 (object) 或建构子 (construct) 需要被一个程序的某个部分参照时。</p>
<h2>Scope</h2>
<p>Scope 在一个程序中或是一个程序中特定的范围里，参照可能发生的地方。</p>
<h2>Extent</h2>
<p>Extent 参照可能发生的时间区间。</p>
<p>一个简单的例子：</p>
<figure class="highlight lang-cl"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="list">(<span class="title">defun</span><span class="body"> copy-cell <span class="list">(<span class="title">x</span><span class="body">)</span></span>
  <span class="list">(<span class="title">cons</span><span class="body"> <span class="list">(<span class="title">car</span><span class="body"> x)</span></span> <span class="list">(<span class="title">cdr</span><span class="body"> x)</span></span>)</span></span>)</span></span>
</pre></td></tr></table></figure>

<p>在这个例子里，我们只能在 <code>copy-cell</code> 函数主体中来参照到 <code>x</code> 参数，这个就是参数 <code>x</code> 的 scope。而参数 <code>x</code> 的 extent 是当函数 <code>copy-cell</code> 被调用至离开的这段时间区间。但是参数的 extent 是有可能在离开函数后仍存在的，但上面这个简单的例子是不可能发生的。</p>
<p>数种描述 Common Lisp 特别有用的 scope 与 extent:</p>
<ul>
<li>Lexical scope 由某个特殊建构子所建立的程序區塊（通常是一個主體 body）。可以想想 Common Lisp 的 let、defun 所設立的參數。</li>
</ul>
<p>例子 1:</p>
<figure class="highlight lang-cl"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="list">(<span class="title">let</span><span class="body"> <span class="list">(<span class="body"><span class="list">(<span class="title">x</span><span class="body"> <span class="number">1</span>)</span></span>
      <span class="list">(<span class="title">y</span><span class="body"> <span class="number">2</span>)</span></span>)</span></span>
  <span class="list">(<span class="title">+</span><span class="body"> x y)</span></span>)</span></span>
</pre></td></tr></table></figure>

<p>x 与 y 的 scope 就是由 let 建构子所建构的主体。</p>
<p>例子 2:</p>
<figure class="highlight lang-cl"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="list">(<span class="title">defun</span><span class="body"> foo <span class="list">(<span class="title">x</span><span class="body">)</span></span>
true<span class="list">(<span class="title">+</span><span class="body"> x <span class="number">1</span>)</span></span>)</span></span>
</pre></td></tr></table></figure>

<p><code>x</code> 的 scope 在 defun 建构子所建构的主体。</p>
<ul>
<li><p>Indefinite scope. 在程序任何地方都可以參照的叫做 Indefinite scope。</p>
</li>
<li><p>Dynamic extent 参照可以发生在配置 (established) 与释放 (disestablished) entity 时发生。 Entity 通常可以想成是对象 (如 cons 核、符號）、变量绑定或是 go 可以到的地方。什么时候释放呢？在配置的 entity 执行完毕或是终止时。因此有 dynamic extent 的 entity 遵循著一种类似栈的规范，同时有著平行执行嵌套的建构。</p>
</li>
</ul>
<p>例子：<code>with-open-file</code> 建构子开启了一个与文件 (file) 的连接并构造了一个流对象来表示这个连接。流对象有著 <code>indefinite extent</code> ，但开启文件的连接有著 dynamic extent: 当 <code>with-open-file</code> 建构子交出控制权时，流会自动关闭。</p>
<p>例子 2: 一个“特殊”变量的绑定是 dynamic extent。</p>
<ul>
<li>Indefinite extent Entity 在离开建构子所设立的区块时，仍有参照的可能性存在。</li>
</ul>
<p>例子：大多数的 Common Lisp 数据对象 (data objecs) 是 indefinite extent 的。
例子：绑定一个函数 lexcially scoped 的参数是 indefinite extent 的。</p>
<p>考虑以下函数定义：</p>
<figure class="highlight lang-cl"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="list">(<span class="title">defun</span><span class="body"> compose <span class="list">(<span class="title">f</span><span class="body"> g)</span></span>
  #<span class="quoted">'(lambda (x)
      (funcall f (funcall g x)))</span>)</span></span>
</pre></td></tr></table></figure>

<p>当给定两个参数时，返回一个函数作为返回值。参数 <code>f</code> 与 <code>g</code> 的绑定由于返回的函数存在，所以并没有消失。当我们调用这个返回的函数时，我们仍可以参照到 <code>f</code> 与 <code>g</code> 。因此</p>
<figure class="highlight lang-cl"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre><span class="list">(<span class="title">funcall</span><span class="body"> <span class="list">(<span class="title">compose</span><span class="body"> #'sqrt #'abs)</span></span> <span class="number">-9.0</span>)</span></span>
</pre></td></tr></table></figure>

<p>会返回 <code>3.0</code> 。</p>
<p>除了上面这些术语之外，通常我们把 dynamic scope 定义成表示 indefinite scope 与 dynamic extent。所以我们说特殊的变数有著 dynamic scope，或是被 dynamically scoped 了，因为它们有 indefinite scope 与 dynamic extent: 一个特别变数可以在任何地方被参照，只要它的绑定 (binding) 仍有效。</p>
<h2>Shadowing</h2>
<p>以上的定义没有考虑到 Shadowing，当我们定义两个同样名称的 entities 时，第二个会遮蔽了第一个，在这个情况下，我们就无法参照到第一个了。</p>
<p>在 lexcial scope 的情况，如果两个建构子设置了同名的 entities 时，会做嵌套的动作。内部的会遮蔽外部的。举个例子：</p>
<figure class="highlight lang-cl"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre><span class="list">(<span class="title">defun</span><span class="body"> foo <span class="list">(<span class="title">x</span><span class="body"> z)</span></span>
  <span class="list">(<span class="title">let</span><span class="body"> <span class="list">(<span class="body"><span class="list">(<span class="title">z</span><span class="body"> <span class="list">(<span class="title">*</span><span class="body"> x <span class="number">2</span>)</span></span>)</span></span>)</span></span>
    <span class="list">(<span class="title">print</span><span class="body"> z)</span></span>)</span></span>
  z)</span></span>
</pre></td></tr></table></figure>

<p>内部的 <code>z</code> 会是 <code>(* x 2)</code>，而外部的 z 会是传入的参数 <code>z</code> 。</p>
<p>在 dynamic extent 的情况，如果两个 entities 的发生时间区间重叠时，一个会被嵌套在另一个里面。</p>
<p>一个有著 dynamic extent 的 entity 透过名字来参照时，总是参照到最近一次尚未被释放的 (disestablished) entity。比如：</p>
<figure class="highlight lang-cl"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre><span class="list">(<span class="title">defun</span><span class="body"> fun<span class="number">1</span> <span class="list">(<span class="title">x</span><span class="body">)</span></span>
  <span class="list">(<span class="title">catch</span><span class="body"> 'trap <span class="list">(<span class="title">+</span><span class="body"> <span class="number">3</span> <span class="list">(<span class="title">fun2</span><span class="body"> x)</span></span>)</span></span>)</span></span>)</span></span>

<span class="list">(<span class="title">defun</span><span class="body"> fun<span class="number">2</span> <span class="list">(<span class="title">y</span><span class="body">)</span></span>
  <span class="list">(<span class="title">catch</span><span class="body"> 'trap <span class="list">(<span class="title">*</span><span class="body"> <span class="number">5</span> <span class="list">(<span class="title">fun3</span><span class="body"> y)</span></span>)</span></span>)</span></span>)</span></span>

<span class="list">(<span class="title">defun</span><span class="body"> fun<span class="number">3</span> <span class="list">(<span class="title">z</span><span class="body">)</span></span>
  <span class="list">(<span class="title">throw</span><span class="body"> 'trap z)</span></span>)</span></span>
</pre></td></tr></table></figure>

<p>调用 <code>(fun1 7)</code> 的结果会是 <code>10</code>。在 <code>throw</code> 执行时，同时有两个 <code>catch</code> 在监看 <code>trap</code> : 一个由 <code>fun1</code> 配置的，另一个是 <code>fun2</code> 。第二个 <code>fun2</code> 是最新的那个，所以 <code>7</code> 会在 <code>fun2</code> 里返回。从 <code>fun3</code> 内部来看， <code>fun2</code> 遮蔽了 <code>fun1</code> 。</p>
<p>若是 <code>fun2</code> 是这样定义的话：</p>
<figure class="highlight lang-cl"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="list">(<span class="title">defun</span><span class="body"> fun<span class="number">2</span> <span class="list">(<span class="title">y</span><span class="body">)</span></span>
  <span class="list">(<span class="title">catch</span><span class="body"> 'snare <span class="list">(<span class="title">*</span><span class="body"> <span class="number">5</span> <span class="list">(<span class="title">fun3</span><span class="body"> y)</span></span>)</span></span>)</span></span>)</span></span>
</pre></td></tr></table></figure>

<p>那么两个 <code>catch</code> 会有不同的名称，因此 <code>fun1</code> 不会被遮蔽。<code>(fun1 7)</code> 结果会是 <code>7</code>。</p>
]]></content>
    <category scheme="http://lisp.es//tags/lisp/" term="lisp"/>
    <category scheme="http://lisp.es//categories/Lisp/" term="Lisp"/>
  </entry>
  <entry>
    <title type="html"><![CDATA[jQuery 事件简介（下）]]></title>
    <link href="http://lisp.es//2012/05/19/jquery-events-2/"/>
    <id>http://lisp.es//2012/05/19/jquery-events-2/</id>
    <published>2012-05-18T18:40:00.000Z</published>
    <updated>2013-05-18T19:15:29.000Z</updated>
    <content type="html"><![CDATA[<p>注意，若是看不到下方的图片请留言，我再换到 GFW 友好的 HOST 服务上。</p>
<p>其实下面也就一张图。。。</p>
<p>OK，现在你有了基本的事件知识，现在我们看看如何实现一个简单的 FAQ，</p>
<p>型別</p>
<p>给定一个 HTML:</p>
<figure class="highlight lang-html"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="code"><pre>&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
true&lt;meta charset=utf-8&gt;
true&lt;title&gt;jQuery 事件（下）&lt;/title&gt;
true&lt;link rel="stylesheet" href="style.css"&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;dl&gt;
true&lt;dt&gt;FAQ 问题一 &lt;/dt&gt;
true&lt;dd&gt; 答案一 &lt;/dd&gt;
true&lt;dt&gt;FAQ 问题二 &lt;/dt&gt;
true&lt;dd&gt; 答案二 &lt;/dd&gt;
true&lt;dt&gt;FAQ 问题三 &lt;/dt&gt;
true&lt;dd&gt; 答案三 &lt;/dd&gt;
true&lt;dt&gt;FAQ 问题四 &lt;/dt&gt;
true&lt;dd&gt; 答案四 &lt;/dd&gt;
true&lt;dt&gt;FAQ 问题五 &lt;/dt&gt;
true&lt;dd&gt; 答案五 &lt;/dd&gt;
&lt;/dl&gt;

&lt;script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"&gt;&lt;/script&gt;
&lt;script&gt;

&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre></td></tr></table></figure>

<p>以及一些简单的 CSS 样式 <strong>style.css</strong> :</p>
<figure class="highlight lang-css"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="code"><pre><span class="tag">body</span> <span class="rules">{
    <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">960</span>px;</span></span>
    <span class="rule"><span class="attribute">margin</span>:<span class="value"> auto;</span></span>
    <span class="rule"><span class="attribute">text-align</span>:<span class="value"> center;</span></span>
<span class="rule">}</span></span>

<span class="tag">dd</span> <span class="rules">{
    <span class="rule"><span class="attribute">margin</span>:<span class="value"> <span class="number">0</span>;</span></span>
    <span class="rule"><span class="attribute">padding</span>:<span class="value"> <span class="number">1</span>em <span class="number">0</span>;</span></span>
<span class="rule">}</span></span>

<span class="tag">dt</span> <span class="rules">{
    <span class="rule"><span class="attribute">cursor</span>:<span class="value"> pointer;</span></span>
    <span class="rule"><span class="attribute">font-weight</span>:<span class="value"> bold;</span></span>
    <span class="rule"><span class="attribute">font-size </span>:<span class="value"> <span class="number">1.5</span>em;</span></span>
    <span class="rule"><span class="attribute">line-height</span>:<span class="value"> <span class="number">2</span>em;</span></span>
    <span class="rule"><span class="attribute">background</span>:<span class="value"> <span class="hexcolor">#b94846</span>;</span></span>
    <span class="rule"><span class="attribute">border-bottom</span>:<span class="value"> <span class="number">2</span>px solid <span class="hexcolor">#6f2b2a</span>;</span></span>
    <span class="rule"><span class="attribute">border-top</span>:<span class="value"> <span class="number">2</span>px solid white;</span></span>
<span class="rule">}</span></span>

<span class="tag">dt</span><span class="pseudo">:first-child</span> <span class="rules">{ <span class="rule"><span class="attribute">border-top</span>:<span class="value"> none;</span></span> <span class="rule">}</span></span>
<span class="tag">dt</span><span class="pseudo">:nth-last-child(2)</span> <span class="rules">{ <span class="rule"><span class="attribute">border-bottom</span>:<span class="value"> none;</span></span> <span class="rule">}</span></span>

<span class="class">.hide</span> <span class="rules">{ <span class="rule"><span class="attribute">display</span>:<span class="value"> none;</span></span><span class="rule">}</span></span>
</pre></td></tr></table></figure>

<p>注意 <code>dt</code> 下方我们用了一个较深的红色 border，上方用白色 border，来与别的区块做区别。</p>
<figure class="highlight lang-css"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="tag">dt</span><span class="pseudo">:first-child</span> <span class="rules">{ <span class="rule"><span class="attribute">border-top</span>:<span class="value"> none;</span></span> <span class="rule">}</span></span>
<span class="tag">dt</span><span class="pseudo">:nth-last-child(2)</span> <span class="rules">{ <span class="rule"><span class="attribute">border-bottom</span>:<span class="value"> none;</span></span> <span class="rule">}</span></span>
</pre></td></tr></table></figure>

<p>第一行是，最上方的 FAQ 有多馀的白色 border，因为没有上方元素，不需要加上白色来区别。</p>
<p>第二行是，最下方的 FAQ 有多馀的红色 border，因为是最后的元素，不需要加上红色来区别。</p>
<p>我用 <code>2px</code> 让它看起来更明显，实际上你可以使用 <code>1px</code>，或是你喜欢的大小。</p>
<p>你可能会使用 <code>dt:last-child</code> ，这是不对的，请参考我的这篇文章：<a href="http://blog.lisp.tw/blog/2012/05/12/nth-child-common-gotcha/">CSS 一个常见 Nth-child 的误区</a></p>
<img src="https://img.skitch.com/20120518-jgbpd1k1i2cjwt5eq7g31cf5gd.png">

<p>当我们鼠标悬停至 FAQ 标题时 (<code>dt</code>)，就显示相对应的答案 (<code>dd</code>)。</p>
<p><em>下面讲述的代码请放至 <code>&lt;/body&gt;</code> 上方的 script 标签内。</em></p>
<h2>hide() show() fadeIn() slideDown() toggle()</h2>
<p>好，现在让我们看看如何做到隐藏的效果:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
truevar $dd = $(<span class="string">'dd'</span>);

<span class="literal">true</span>$dd.hide();
<span class="literal">true</span><span class="comment">// $dd.toggle();</span>
<span class="literal">true</span><span class="comment">// $dd.show();</span>
<span class="literal">true</span><span class="comment">// $dd.fadeIn();</span>
<span class="literal">true</span><span class="comment">// $dd.slideDown();</span>
})();
</pre></td></tr></table></figure>

<p>你可以试试看我放在注解里的代码，看看是什么效果。</p>
<blockquote>
<p>toggle() 可视变不可视、不可视变可视。</p>
</blockquote>
<p>当我们使用 <code>dd.hide()</code> 的时候，实际上 jQuery 是把 <code>dd</code> 加上 <code>style=&quot;display: none;&quot;</code></p>
<p>第二种方法是先写一个 CSS 类别 <code>.hide { display: none; }</code>，把选中的元素添加类上去：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$dd.addClass(<span class="string">'hide'</span>);
</pre></td></tr></table></figure>

<h2>filter()</h2>
<p>OK。现在我们知道如何先把答案藏起来，不过通常用户来到我们页面时，我们通常会想显示第一个问题及第一个答案：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
truevar $dd = $(<span class="string">'dd'</span>);
<span class="literal">true</span>$dd.(<span class="string">':nth-child(n+4)'</span>).addClass(<span class="string">'hide'</span>);
})();
</pre></td></tr></table></figure>

<p>filter() 函数根据你传入的选择器，返回匹配的元素。</p>
<p>这个博大精深的 <code>:nth-child(n+4)</code> 是啥？看起来好可怕！DONT PANIC! 这是 CSS3 选择器，这其实是说，我要选中由第 4 个开始的所有元素，也就是</p>
<figure class="highlight lang-html"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre>&lt;dl&gt;
true&lt;dt&gt;FAQ 问题一 &lt;/dt&gt;
true&lt;dd&gt; 答案一 &lt;/dd&gt;
true&lt;dt&gt;FAQ 问题二 &lt;/dt&gt;
true&lt;dd&gt; 答案二 &lt;/dd&gt;
true&lt;dt&gt;FAQ 问题三 &lt;/dt&gt;
true&lt;dd&gt; 答案三 &lt;/dd&gt;
true&lt;dt&gt;FAQ 问题四 &lt;/dt&gt;
true&lt;dd&gt; 答案四 &lt;/dd&gt;
true&lt;dt&gt;FAQ 问题五 &lt;/dt&gt;
true&lt;dd&gt; 答案五 &lt;/dd&gt;
&lt;/dl&gt;
</pre></td></tr></table></figure>

<p>1, 2, 3, 4，选中 <code>&lt;dd&gt; 答案二 &lt;/dd&gt;</code> 以及之后所有的元素。你可以试试看 console.log 一下，看看 <code>dd.(&#39;:nth-child(n+4)&#39;)</code> 选中的是什么，你就理解了。</p>
<p>OK. 讲解到这里，差不多 HTML CSS 都讲明白了，接下来看看怎么绑定事件上元素，来实现我们想要的功能。</p>
<h2>mouseenter() siblings()</h2>
<p>先讲简单的方法：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
truevar $dd = $(<span class="string">'dd'</span>);
<span class="literal">true</span>$dd.(<span class="string">':nth-child(n+4)'</span>).addClass(<span class="string">'hide'</span>);

<span class="literal">true</span>$(<span class="string">'dt'</span>).on(<span class="string">'mouseenter'</span>, <span class="keyword">function</span>() {
truetrue$(<span class="keyword">this</span>).next().show();
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>我们给 <code>dt</code> 绑定一个 mouseenter 事件，在鼠标进入 <code>dt</code> 时，我们知道 <code>dd</code> 是 <code>dt</code> 的下一个，我们显示它：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="keyword">this</span>).next().show();
</pre></td></tr></table></figure>

<p>但是显示完我们还得隐藏它：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
truevar $dd = $(<span class="string">'dd'</span>);
<span class="literal">true</span>$dd.(<span class="string">':nth-child(n+4)'</span>).addClass(<span class="string">'hide'</span>);

<span class="literal">true</span>$(<span class="string">'dt'</span>).on(<span class="string">'mouseenter'</span>, <span class="keyword">function</span>() {
truetrue$(<span class="keyword">this</span>).next().siblings(<span class="string">'dd'</span>).hide();
truetrue$(<span class="keyword">this</span>).next().show();
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>我们鼠标移到某个特定 <code>dt</code> 时，把所有 <code>dd</code> 的 <code>siblings(&#39;dd&#39;)</code> 都隐藏起来就可以了。</p>
<p>注意到我故意使用重复的代码，让我们重构它：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
truevar $dd = $(<span class="string">'dd'</span>);
<span class="literal">true</span>$dd.(<span class="string">':nth-child(n+4)'</span>).addClass(<span class="string">'hide'</span>);

<span class="literal">true</span>$(<span class="string">'dt'</span>).on(<span class="string">'mouseenter'</span>, <span class="keyword">function</span>() {
truetrue$(<span class="keyword">this</span>)
truetruetrue.next()
truetruetruetrue.show()
truetruetruetrue.siblings(<span class="string">'dd'</span>)
truetruetruetruetrue.hide();
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>看你是要排成一行，还是像我这样有缩排，喜好问题。</p>
<p>OK. 成功拉，现在让我们加上 animation，与其隐藏，我们可以使用 <code>slideUp() slideDown()</code>：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
truevar $dd = $(<span class="string">'dd'</span>);
<span class="literal">true</span>$dd.(<span class="string">':nth-child(n+4)'</span>).addClass(<span class="string">'hide'</span>);

<span class="literal">true</span>$(<span class="string">'dt'</span>).on(<span class="string">'mouseenter'</span>, <span class="keyword">function</span>() {
truetrue$(<span class="keyword">this</span>)
truetruetrue.next()
truetruetruetrue.slideDown(<span class="number">300</span>)
truetruetruetrue.siblings(<span class="string">'dd'</span>)
truetruetruetruetrue.slideUp(<span class="number">300</span>);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p><code>slideDown()</code>, <code>slideUp()</code> 这种函数你可以传入参数，指定毫秒数，通常 200-400 ms，看起来挺舒服的。</p>
<p>OK. 现在功能出来了，看看有没有什么可以改善的，永远记得，在 <strong>功能完整后再改进</strong> 。</p>
<p>现在我们的代码实际上只用到了一次 <code>$(&#39;dd&#39;)</code>，所以不需要将它存到变量里，节省空间：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){

<span class="literal">true</span>$(<span class="string">'dd'</span>).(<span class="string">':nth-child(n+4)'</span>).addClass(<span class="string">'hide'</span>);

<span class="literal">true</span>$(<span class="string">'dt'</span>).on(<span class="string">'mouseenter'</span>, <span class="keyword">function</span>() {
truetrue$(<span class="keyword">this</span>)
truetruetrue.next()
truetruetruetrue.slideDown(<span class="number">300</span>)
truetruetruetrue.siblings(<span class="string">'dd'</span>)
truetruetruetruetrue.slideUp(<span class="number">300</span>);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>现在看看这行代码：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>$(<span class="string">'dt'</span>).on(<span class="string">'mouseenter'</span>, <span class="keyword">function</span>() {
<span class="literal">true</span>...
}
</pre></td></tr></table></figure>

<p>这行代码不太好，要是咱页面有一百个 <code>dt</code>，那效能不好，最好是你给 <code>dl</code> 上一个 <code>id=&quot;FAQ&quot;</code>，将选择器改为 <code>dl#FAQ</code>，这样子每次我们只会选中 FAQ，而不会去选到其他的，在这里我们演示的关系，选中 <code>$(&#39;dl&#39;)</code> 就好了。</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){

<span class="literal">true</span>$(<span class="string">'dd'</span>).(<span class="string">':nth-child(n+4)'</span>).addClass(<span class="string">'hide'</span>);

<span class="literal">true</span>$(<span class="string">'dl'</span>).on(<span class="string">'mouseenter'</span>, <span class="string">'dt'</span>, <span class="keyword">function</span>() {
truetrue$(<span class="keyword">this</span>)
truetruetrue.next()
truetruetruetrue.slideDown(<span class="number">300</span>)
truetruetruetrue.siblings(<span class="string">'dd'</span>)
truetruetruetruetrue.slideUp(<span class="number">300</span>);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>注意我在 <code>on</code> 函数里又多传了一个参数，<code>&#39;dt&#39;</code> ，这叫做 选择器字串 (slector string)。</p>
<p>现在这整行代码的意思是，当用户鼠标进入 <code>dl</code> 时，选中 <code>dl</code> 的 <code>dt</code>：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'dl'</span>).on(<span class="string">'mouseenter'</span>, <span class="string">'dt'</span>, <span class="keyword">function</span>()
</pre></td></tr></table></figure>

<p>仅仅重构了这一下，我们省去了给所有 <code>dt</code> 加上 event listener，只给特定的 <code>dt</code> 加上 event listener，尽量养成这样子的习惯，首先写一个能动的 jQuery，想想该怎么重构，并重构它。</p>
<p>打完收工。</p>
]]></content>
    <category scheme="http://lisp.es//tags/jQuery/" term="jQuery"/>
    <category scheme="http://lisp.es//categories/jQuery/" term="jQuery"/>
  </entry>
  <entry>
    <title type="html"><![CDATA[jQuery 事件简介（上）]]></title>
    <link href="http://lisp.es//2012/05/18/jquery-events-1/"/>
    <id>http://lisp.es//2012/05/18/jquery-events-1/</id>
    <published>2012-05-18T14:11:00.000Z</published>
    <updated>2013-05-18T19:15:28.000Z</updated>
    <content type="html"><![CDATA[<p>什么是事件？</p>
<p>比如一个链接被按下、鼠标悬停在某元素上面，这都是事件。</p>
<p>假设今天我们想要实现，按下某个按钮套用不同的 CSS。</p>
<p>给定一个 HTML:</p>
<p>型別</p>
<figure class="highlight lang-html"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="code"><pre>&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
true&lt;meta charset=utf-8&gt;
true&lt;title&gt;jQuery 事件（上）&lt;/title&gt;
true&lt;link rel="stylesheet" href="day.css"&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;h1&gt; 我的网站 &lt;/h1&gt;

&lt;button&gt;Day&lt;/button&gt;
&lt;button&gt;Night&lt;/button&gt;

&lt;script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"&gt;&lt;/script&gt;
&lt;script&gt;

&lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;
</pre></td></tr></table></figure>

<p>以及两个 CSS, day.css, night.css:</p>
<h4>night.css</h4>
<figure class="highlight lang-css"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre><span class="tag">body</span> <span class="rules">{
<span class="rule"><span class="attribute">truebackground</span>:<span class="value"> black;</span></span>
<span class="rule"><span class="attribute">truecolor</span>:<span class="value"> white;</span></span>
<span class="rule">}</span></span>
</pre></td></tr></table></figure>

<h4>night.css</h4>
<figure class="highlight lang-css"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="tag">body</span> <span class="rules">{
<span class="rule"><span class="attribute">truebackground</span>:<span class="value"> yellow;</span></span>
<span class="rule">}</span></span>
</pre></td></tr></table></figure>

<p>下面讲述的代码请加至 <code>&lt;/body&gt;</code> 上方的 script 标签内。</p>
<p>当按下 Day 按钮的时候要套用 day.css、按下 Night 按钮的时候要套用 night.css。</p>
<p>OK. 我们要怎么达到我们想做的功能呢？第一是我们要有一个监听按钮状态的方法，给按钮加上 event listener。</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){

})();
</pre></td></tr></table></figure>

<p>首先这个奇怪的:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){

})();
</pre></td></tr></table></figure>

<p>是什么？这是一个 <strong>自调用函数</strong> (self invoke function)。</p>
<p>可以想成是这样子:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre><span class="function"><span class="keyword">function</span> <span class="title">myFunc</span><span class="params">()</span>{</span>

}

myFunc();
</pre></td></tr></table></figure>

<p>这里宣告了 <code>myFunc()</code> ，在碰到这一行： <code>myFunc();</code> 的时候才会调用。</p>
<p>所以：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){

})();
</pre></td></tr></table></figure>

<p>一但载入这个 script 时，就会调用。</p>
<p>OK. 让我们继续往下看，那要怎么加入 event listener 呢？</p>
<h2>click() 函数</h2>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
<span class="literal">true</span>$(<span class="string">'button'</span>).click(<span class="keyword">function</span>() {
truetrueconsole.log(<span class="string">'button was clicked!'</span>);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>这跟 jQuery 说，哈罗，去 DOM 里帮我把 button 的元素都找出来，并在按下时在 cosole 记录信息：<code>&#39;button was clicked!&#39;</code></p>
<p>你可以去浏览器试试看是否成功。</p>
<p>现在我们知道如何加入一个 click 事件，现在让我们看看如何在按下按钮时，换一个 CSS 样式表。</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
<span class="literal">true</span>$(<span class="string">'button'</span>).click(<span class="keyword">function</span>() {
truetrueconsole.log(<span class="string">'button was clicked!'</span>);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<h2>this?</h2>
<p>现在让我们简单的看一下 this。</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
<span class="literal">true</span>$(<span class="string">'button'</span>).click(<span class="keyword">function</span>() {
truetrueconsole.log(<span class="keyword">this</span>);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>这里的 <code>this</code> 会参照到现在被按的这个按钮。但是要注意的是，这个 <code>this</code> 所返回的 <strong>不是</strong> 一个 jQuery 对象，仅是一个 DOM 对象，所以无法继续使用 jQuery 所提供的函数。</p>
<p>那如果我想要使用 <em>this</em> 来得到参照的对象，又想继续使用 jQuery 提供的函数呢？我们可以用 <code>$()</code> 把返回的 DOM 对象包起来：</p>
<p><code>$(this)</code> 呵呵，这样大概理解了吧？</p>
<p>有的时候，我们可能常常要用到 <code>$(this)</code> ，用到两次以上的东西，都用个变量存起来，来避免 jQuery 一直跑到 DOM 查询，假设我们一个页面有三十个按钮，一直重复的去查询 DOM 会大幅降低效能。</p>
<p>比如说上面我们改变了被参照的对象的 text()，之后又替它加上一个类，之后可能又移除那个类：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
<span class="literal">true</span>$(<span class="string">'button'</span>).click(<span class="keyword">function</span>() {
truetrue$(<span class="keyword">this</span>).text(...);

truetrue<span class="comment">// some code goes here...</span>
truetrue$(<span class="keyword">this</span>).addClass(...);

truetrue<span class="comment">// ...other codes</span>
truetrue$(<span class="keyword">this</span>).removeClass(...);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>可以这样子重构代码：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
<span class="literal">true</span>$(<span class="string">'button'</span>).click(<span class="keyword">function</span>() {
truetrue$<span class="keyword">this</span> = $(<span class="keyword">this</span>);
truetrue$<span class="keyword">this</span>.text(...);

truetrue<span class="comment">// some code goes here...</span>
truetrue$<span class="keyword">this</span>.addClass(...);

truetrue<span class="comment">// ...other codes</span>
truetrue$<span class="keyword">this</span>.removeClass(...);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p><code>$this</code> 前面的 <strong>$</strong> 号可以表明这是一个 jQuery 对象，this 可以代表是现在所参照的对象。</p>
<p>这 <code>$this</code> 称为是现在参照的对象 <code>this</code> 的缓存版本 (cached version)。</p>
<h2>attr()</h2>
<p>现在回到我们刚刚的问题，如何按下按钮时，改变 CSS 样式表：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
<span class="literal">true</span>$(<span class="string">'button'</span>).click(<span class="keyword">function</span>() {
truetrue$(<span class="string">'link'</span>).attr(<span class="string">'href'</span>, <span class="string">'night.css'</span>);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>这个 <code>attr()</code> 当传入一个参数时，返回这个参数名字的属性:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre><span class="keyword">var</span> href = $(<span class="string">'link'</span>).attr(<span class="string">'href'</span>);
</pre></td></tr></table></figure>

<p>我们就可以取得一个 link 的 href 属性。</p>
<p>传入两个参数时，是替第一个参数为名的属性设值:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'link'</span>).attr(<span class="string">'href'</span>, <span class="string">'night.css'</span>);
</pre></td></tr></table></figure>

<p>OK. 现在到浏览器试试看，你会发现无论按下哪个按钮时，样式表都会换成 night.css。</p>
<p>这样不行，我们要有一个办法来指定按下 day 按钮时，换成 day.css。</p>
<p>让我们试试看：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
<span class="literal">true</span>$(<span class="string">'button'</span>).click(<span class="keyword">function</span>() {
truetruevar stylesheet = $(<span class="keyword">this</span>).text().toLowerCase();
truetrue$(<span class="string">'link'</span>).attr(<span class="string">'href'</span>, stylesheet + <span class="string">'.css'</span>);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>这样子在按下按钮时，我们得到按下按钮的 text，并转成小写，并替换 link 的 href。</p>
<p>这样是可以工作的，但是会被按钮的 text 限制了 css 文件的名字，以及有很大的不弹性，让我们看看怎么样做的更好：</p>
<p>改动 HTML：</p>
<figure class="highlight lang-html"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre>&lt;button data-file="day"&gt;Day&lt;/button&gt;
&lt;button data-file="night"&gt;Night&lt;/button&gt;
</pre></td></tr></table></figure>

<p>加上 <code>data-file</code> 属性。</p>
<p>也可以自定义属性，只要前缀是 <code>data-</code> 即可，比如 <code>data-yourCustomAttr</code>。</p>
<p>要取得这个 <code>data-file</code>，我们可以用刚刚学过的 <code>attr()</code>，仅传入一个参数：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
<span class="literal">true</span>$(<span class="string">'button'</span>).click(<span class="keyword">function</span>() {
truetruevar stylesheet = $(<span class="keyword">this</span>).attr(<span class="string">'data-file'</span>);
truetrue$(<span class="string">'link'</span>).attr(<span class="string">'href'</span>, stylesheet + <span class="string">'.css'</span>);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>但是 jQuery 有一个更好的方法：<code>data()</code>：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="keyword">this</span>).data(<span class="string">'file'</span>);
</pre></td></tr></table></figure>

<p>这里因为用的是，<code>data()</code> 方法，所以不需要使用多馀的 <code>data-</code> 前缀。</p>
<p>看看这行：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'link'</span>).attr(<span class="string">'href'</span>, stylesheet + <span class="string">'.css'</span>);
</pre></td></tr></table></figure>

<p>每次我们按下按钮时，jQuery 都会跑到 DOM 里面去寻找符合选择器条件的元素，这样非常的没有效率，所以我们可以缓存起来：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
truevar $link = $(<span class="string">'link'</span>);
<span class="literal">true</span>$(<span class="string">'button'</span>).click(<span class="keyword">function</span>() {
truetruevar stylesheet = $(<span class="keyword">this</span>).attr(<span class="string">'data-file'</span>);
truetrue$link.attr(<span class="string">'href'</span>, stylesheet + <span class="string">'.css'</span>);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>现在另一个问题来了，当前是 day.css，按下 night 按钮时，会换成 night.css，换成 night.css 再按下 night 按钮时，还是会调用这个自调用函数，并换成 night.css，这样子还是浪费资源，我们可以：</p>
<ul>
<li><p>停用当前 CSS 的按钮（day.css 就停用 day 按钮、night.css 就停用 night 按钮）</p>
</li>
<li><p>写一个判断式侦测按下按钮是否为现下的 CSS，是的话就不做任何事，不是的话替换成另一个 CSS。</p>
</li>
</ul>
<p>我们试试看第一个方法：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
truevar $link = $(<span class="string">'link'</span>);
<span class="literal">true</span>$(<span class="string">'button'</span>).click(<span class="keyword">function</span>() {
truetruevar $<span class="keyword">this</span> = $(<span class="keyword">this</span>);
truetruevar stylesheet = $<span class="keyword">this</span>.attr(<span class="string">'data-file'</span>);
truetrue$link.attr(<span class="string">'href'</span>, stylesheet + <span class="string">'.css'</span>);
truetrue$<span class="keyword">this</span>.attr(<span class="string">'disabled'</span>, <span class="string">'disabled'</span>);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>这边我们缓存了用到两次的 <code>$(this)</code> : <code>$this</code>。</p>
<p>记得 <code>attr()</code> 一个参数是返回属性、两个是设值：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>$<span class="keyword">this</span>.attr(<span class="string">'disabled'</span>, <span class="string">'disabled'</span>);
<span class="comment">// 等同于</span>
$<span class="keyword">this</span>.attr(<span class="string">'disabled'</span>, <span class="string">''</span>);
</pre></td></tr></table></figure>

<p>传入第二个参数是为了设值的目的。</p>
<p>你到浏览器试试看会发现一旦 disabled 以后，按钮就死了，回不去了。</p>
<h2>siblings()</h2>
<p><code>siblings()</code> 可以取得目前参照对象的 siblings (同层元素)，可以选择性的传入选择器来筛选匹配的元素。</p>
<blockquote>
<p>Get the siblings of each element in the set of matched elements, optionally filtered by a selector.</p>
</blockquote>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
truevar $link = $(<span class="string">'link'</span>);
<span class="literal">true</span>$(<span class="string">'button'</span>).click(<span class="keyword">function</span>() {
truetruevar $<span class="keyword">this</span> = $(<span class="keyword">this</span>);
truetruevar stylesheet = $<span class="keyword">this</span>.attr(<span class="string">'data-file'</span>);

truetrue$<span class="keyword">this</span>.siblings(<span class="string">'button'</span>).removeAttr(<span class="string">'disabled'</span>);

truetrue$link.attr(<span class="string">'href'</span>, stylesheet + <span class="string">'.css'</span>);
truetrue$<span class="keyword">this</span>.attr(<span class="string">'disabled'</span>, <span class="string">'disabled'</span>);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>哎呀，又发现一个可以重构的地方：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="keyword">var</span> $<span class="keyword">this</span> = $(<span class="keyword">this</span>);
<span class="keyword">var</span> stylesheet = $<span class="keyword">this</span>.attr(<span class="string">'data-file'</span>);
</pre></td></tr></table></figure>

<p>尽量使用单一个 var 来宣告变量：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="keyword">var</span> $<span class="keyword">this</span> = $(<span class="keyword">this</span>),
truetruestylesheet = $<span class="keyword">this</span>.attr(<span class="string">'data-file'</span>);
</pre></td></tr></table></figure>

<p>并把相同的代码放在一起、把 <code>$link.attr(...)</code> 移上去，这样下面那行就可以结合：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
truevar $link = $(<span class="string">'link'</span>);
<span class="literal">true</span>$(<span class="string">'button'</span>).click(<span class="keyword">function</span>() {
truetruevar $<span class="keyword">this</span> = $(<span class="keyword">this</span>),
truetruetruetruestylesheet = $<span class="keyword">this</span>.attr(<span class="string">'data-file'</span>);

truetrue$link.attr(<span class="string">'href'</span>, stylesheet + <span class="string">'.css'</span>);

truetrue$<span class="keyword">this</span>
truetruetruetrue.siblings(<span class="string">'button'</span>).removeAttr(<span class="string">'disabled'</span>)
truetruetruetrue.removeAttr(<span class="string">'disabled'</span>);

truetrue$<span class="keyword">this</span>.attr(<span class="string">'disabled'</span>, <span class="string">'disabled'</span>);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>如果这样是不行的：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre>	$<span class="keyword">this</span>
truetruetrue.siblings(<span class="string">'button'</span>).removeAttr(<span class="string">'disabled'</span>)
truetruetrue.removeAttr(<span class="string">'disabled'</span>)
truetruetrue.attr(<span class="string">'disabled'</span>, <span class="string">'disabled'</span>);
</pre></td></tr></table></figure>

<p>因为这时第三行 <code>.attr(&#39;disabled&#39;, &#39;disabled&#39;);</code> 所参照的是 <code>siblings()</code> 而不是本来按下的按钮。</p>
<h2>end() 函数</h2>
<p>如果想要这样子写的话，可以使用 jQuery 的 <code>end()</code> 函数。</p>
<blockquote>
<p>End the most recent filtering operation in the current chain and return the set of matched elements to its previous state.</p>
</blockquote>
<p>终止最近的过滤操作，并返回到先前匹配的状态：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre>	$<span class="keyword">this</span>
truetruetrue.siblings(<span class="string">'button'</span>).removeAttr(<span class="string">'disabled'</span>)
truetruetruetrue.removeAttr(<span class="string">'disabled'</span>)
truetruetruetrue.end()
truetruetrue.attr(<span class="string">'disabled'</span>, <span class="string">'disabled'</span>);
</pre></td></tr></table></figure>

<p>再提一下，这个 <code>click()</code> 函数也可以换成 <code>on()</code> ：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre>$(<span class="string">'button'</span>).click(<span class="keyword">function</span>() { ... }) <span class="comment">// 等同于</span>
$(<span class="string">'button'</span>).on(<span class="string">'click'</span>, <span class="keyword">function</span>() { ... })
</pre></td></tr></table></figure>

<p>我会建议你使用 jQuery 的 <code>on()</code> 函数，这个理由下集再谈吧。</p>
<p>有问题、讲错的欢迎下面留言发问。</p>
]]></content>
    <category scheme="http://lisp.es//tags/jQuery/" term="jQuery"/>
    <category scheme="http://lisp.es//categories/jQuery/" term="jQuery"/>
  </entry>
  <entry>
    <title type="html"><![CDATA[使用 jQuery 查询 DOM]]></title>
    <link href="http://lisp.es//2012/05/18/jquery-query-dom/"/>
    <id>http://lisp.es//2012/05/18/jquery-query-dom/</id>
    <published>2012-05-17T17:04:00.000Z</published>
    <updated>2013-05-18T19:15:28.000Z</updated>
    <content type="html"><![CDATA[<p>哈罗，你又来看我文章了，谢谢，这篇讲的是巨基本的使用 jQuery 来查询 DOM。</p>
<p>给定一个 HTML：</p>
<figure class="highlight lang-html"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre></td><td class="code"><pre>&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
true&lt;meta charset=utf-8&gt;
true&lt;title&gt;&lt;/title&gt;
true&lt;style&gt;
trueli { color: black }
true&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;div class="container"&gt;
true&lt;h1&gt;Welcome to My Website &lt;/h1&gt;
true&lt;p&gt;
truetrueLorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
truetruetempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
truetruequis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
truetrueconsequat.
true&lt;/p&gt;

true&lt;ul class="emphasis"&gt;
truetrue&lt;li&gt;item 1&lt;/li&gt;
truetrue&lt;li&gt;item 2&lt;/li&gt;
truetrue&lt;li&gt;item 3&lt;/li&gt;
truetrue&lt;li&gt;item 4&lt;/li&gt;
truetrue&lt;li&gt;item 5&lt;/li&gt;
truetrue&lt;li&gt;
truetruetrue&lt;ul&gt;
truetruetruetrue&lt;li&gt;hello from the nest.&lt;/li&gt;
truetruetrue&lt;/ul
truetrue&lt;/li&gt;
true&lt;/ul&gt;
&lt;/div&gt;

&lt;script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.js"&gt;&lt;/script&gt;

&lt;script&gt;

&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre></td></tr></table></figure>
型別

为了讲解方便，我直接使用 CDN 来引用 jQuery。之后讲述的代码请放在 <code>&lt;/body&gt;</code> 前面的 <code>&lt;script&gt;</code> 标签内。

OK! 开始！

## children() find() next() prev() first()

假设今天我们想要选中类是 emphasis 的 <code>ul</code>：

<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'ul.emphasis'</span>);
</pre></td></tr></table></figure>

<p>上面这行：嘿，jQuery，帮我根据这个 CSS 选择器 <code>ul.emphasis</code> 去 DOM 把符合条件的找出来。</p>
<p>取出 <code>ul</code> 的第一个 <code>li</code> ，并添加绿色：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'ul.emphasis'</span>).children(<span class="string">'li'</span>).css(<span class="string">'color'</span>, <span class="string">'green'</span>);
</pre></td></tr></table></figure>

<p>这等同于 CSS:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>ul.emphasis &gt; li { color: green; }
</pre></td></tr></table></figure>

<p><strong>注意</strong> 这个 <code>&gt;</code> 在这边起的作用，这说明了我们只选中第一阶层的小孩，direct children。</p>
<p>试试看这个代码</p>
<p>你会发现嵌套的那个 ul li 是黑色，不是绿色。这样应该明白 direct children 了吧。</p>
<p>你也可以使用 jQuery 的 <code>find</code> 来找到：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'ul.emphasis'</span>).find(<span class="string">'li'</span>).css(<span class="string">'color'</span>, <span class="string">'green'</span>);
</pre></td></tr></table></figure>

<p>但要注意的是，这会从 <code>ul.emphasis</code> 搜寻所有的 li (all descendent)，等同于 CSS 的：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>ul.emphasis li { color: green; }
</pre></td></tr></table></figure>

<p>好，现在我们在 <code>style</code> 标签内添加一个样式：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>.emphasis { color: green; }
</pre></td></tr></table></figure>

<p>并移除刚刚那行代码。</p>
<p>现在我们想替 <code>ul.emphasis</code> 的第一个 <code>li</code> 加上类名的办法来上色，该怎么做呢？</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre>$(<span class="string">'ul.emphasis'</span>).children(<span class="string">'li:nth-child(1)'</span>).addClass(<span class="string">'emphasis'</span>);
<span class="comment">// 或是</span>
$(<span class="string">'ul.emphasis'</span>).find(<span class="string">'li:nth-child(1)'</span>).addClass(<span class="string">'emphasis'</span>);
<span class="comment">// 或是</span>
$(<span class="string">'ul.emphasis'</span>).children(<span class="string">'li:first'</span>).addClass(<span class="string">'emphasis'</span>);
</pre></td></tr></table></figure>

<p>你可能会说，干嘛不用 CSS 就好了，因为使用 jQuery 的话，这些新潮的 CSS3 选择器可以支援 IE6+。</p>
<p>都是万恶的 IE 害的，呜呜。。。</p>
<p>注意这行代码内的选择器：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'ul.emphasis'</span>).children(<span class="string">'li:first'</span>).addClass(<span class="string">'emphasis'</span>);
</pre></td></tr></table></figure>

<p>不是 CSS 的选择器，而是 jQuery 提供的 Helper。如果有自带的 CSS 选择器可用的话，就使用 CSS 选择器，再来才是使用 jQuery 提供的 Helper。因为这比使用 jQuery 提供的来得快一点点。</p>
<p>刚刚那行代码，使用 CSS 有的选择器：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'ul.emphasis'</span>).children(<span class="string">'li:first-child'</span>).addClass(<span class="string">'emphasis'</span>);
</pre></td></tr></table></figure>

<p>好，那 jQuery 还有别的方法可用吗，有：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'ul.emphasis'</span>).children(<span class="string">'li'</span>).first().addClass(<span class="string">'emphasis'</span>);
</pre></td></tr></table></figure>

<p>我们用了一个 jQuery 提供的 <code>first()</code>，作用一样。</p>
<p>那想选中第二个 <code>li</code> (item2) 呢，并把文字改为 Hello from jQuery？</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>$(<span class="string">'ul.emphasis'</span>).children(<span class="string">'li:nth-child(2)'</span>).text(<span class="string">'Hello from jQuery'</span>);
<span class="comment">// 或是</span>
$(<span class="string">'ul.emphasis'</span>).children(<span class="string">'li'</span>).eq(<span class="number">1</span>).text(<span class="string">'Hello from jQuery'</span>);
</pre></td></tr></table></figure>

<p>注意到，<code>eq(1)</code>，因为 Javascript 跟大多数程序语言一样是 <strong>零索引的</strong> ，从零开始数。</p>
<p>好如果我想要先选中 item2，再往后一个，该怎么写呢：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'ul.emphasis'</span>).children(<span class="string">'li'</span>).eq(<span class="number">1</span>).next().text(<span class="string">'Hello from jQuery'</span>);
</pre></td></tr></table></figure>

<p>这串长不拉机的东东有个术语叫做 <em>chaining</em> ，它能这么干的原因是每一个调用都返回一个 jQuery 对象。</p>
<p>但是别 chian 的太长了。</p>
<p>有 <code>next()</code> 也有 <code>prev()</code> 。</p>
<p>一个要写出 jQuery 的秘诀是写之前先念一遍，再直观地写出来，大部分都是对的哈哈。</p>
<p>不过这个贼长的 jQuery 你一般都会写成：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>$(<span class="string">'ul.emphasis'</span>).children(<span class="string">'li'</span>).eq(<span class="number">1</span>).next().text(<span class="string">'Hello from jQuery'</span>);
<span class="comment">// better</span>
$(<span class="string">'ul.emphasis li:nth-child(2)'</span>).text(<span class="string">'Hello from jQuery'</span>);
</pre></td></tr></table></figure>

<p>chaining 比较慢，代码也比较长，但你还是会需要动态地使用 chaining。</p>
<p>这么长的代码也可以这样缩排：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre>$(<span class="string">'ul.emphasis'</span>).children(<span class="string">'li'</span>).eq(<span class="number">1</span>).next().text(<span class="string">'Hello from jQuery'</span>);

<span class="comment">// 等同于</span>
$(<span class="string">'ul.emphasis'</span>)
truetrue.children(<span class="string">'li'</span>)
truetruetrue.eq(<span class="number">1</span>)
truetruetrue.next().text(<span class="string">'Hello from jQuery'</span>);
</pre></td></tr></table></figure>

<h2>parent() parents() closest()</h2>
<p>HTML 实际上就是一个语法树，不懂语法树就想成家庭树，有爷爷奶奶老爸老妈儿子女儿孙子孙女。</p>
<p>好，看个例子，今天我们想要移除 <code>li</code> 的父节点的类别</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(li).parent().removeClass(<span class="string">'emphasis'</span>);
</pre></td></tr></table></figure>

<p>也可以显式指定要找的 parent 的类型：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(li).parent(<span class="string">'ul'</span>).removeClass(<span class="string">'emphasis'</span>);
</pre></td></tr></table></figure>

<p>你可以使用浏览器的开发工具查看源代码来检查是否移除成功。</p>
<p>现在让我们加入一个新样式：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>.container { color: green; }
</pre></td></tr></table></figure>

<p>刷新页面，整面绿油油。如果我不想要整片绿油油，我想要移除 parent 的类：container，</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(li).parent(<span class="string">'.container'</span>).removeClass(<span class="string">'emphasis'</span>);
</pre></td></tr></table></figure>

<p>刷新页面，擦，没作用，这是因为这跟 direct children 一样，只会找到上一层的 parent，如果我把 parent 换成：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(li).parents(<span class="string">'.container'</span>).removeClass(<span class="string">'emphasis'</span>);
</pre></td></tr></table></figure>

<p>注意那个 <strong>s</strong> ，这样就会像 <code>find</code> 一样，一直往上找。</p>
<p>你也可以更具体的说，你要移除的是这个 <code>div.container</code> 元素:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(li).parents(<span class="string">'div.container'</span>).removeClass(<span class="string">'emphasis'</span>);
</pre></td></tr></table></figure>

<p>而这行代码等同于：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(li).closest(<span class="string">'div.container'</span>).removeClass(<span class="string">'emphasis'</span>);
</pre></td></tr></table></figure>

<p>让我们到 <a href="http://api.jquery.com/">http://api.jquery.com/</a> 查查这个函数是干嘛使的。</p>
<h2>.closest()</h2>
<blockquote>
<p>Get the first element that matches the selector, beginning at the current element and progressing up through the DOM tree.</p>
</blockquote>
<p>我们这个例子是，从 <code>$(li)</code> 开始往上爬 DOM 树，寻找第一个匹配 <code>(&#39;div.container&#39;)</code> 的元素。</p>
<h2>.removeClass()</h2>
<blockquote>
<p>Remove a single class, multiple classes, or all classes from each element in the set of matched elements.</p>
</blockquote>
<p>移除匹配元素集合中的每一个元素的单一、多个或整个类别。</p>
<h2>parents() 与 closest() 的差异？</h2>
<p>其实是一个微妙的差异，你可以研读一下 API，或是这次我直接跟你说了吧：</p>
<p><code>parents()</code> 会根据选择器条件，往上爬树，找出所有符合的。</p>
<p><code>closest()</code> 只会根据选择器条件，找到最近符合的那一个。</p>
<p>查询 API 与源代码是学习 jQuery 的不二法门。</p>
<p>本篇结束。</p>
]]></content>
    <category scheme="http://lisp.es//tags/jQuery/" term="jQuery"/>
    <category scheme="http://lisp.es//categories/jQuery/" term="jQuery"/>
  </entry>
  <entry>
    <title type="html"><![CDATA[jQuery 1.7 介绍（下）]]></title>
    <link href="http://lisp.es//2012/05/18/jquery-intro-2/"/>
    <id>http://lisp.es//2012/05/18/jquery-intro-2/</id>
    <published>2012-05-17T16:31:00.000Z</published>
    <updated>2013-05-18T19:15:28.000Z</updated>
    <content type="html"><![CDATA[<p>建议不要看我写的文章，赶快到这里学会时下最火最流行的 jQuery!</p>
<p><a href="http://tutsplus.com/course/30-days-to-learn-jquery/">30 天学会 jQuery</a></p>
<h2>＄号</h2>
<p>我希望你还记得 <code>$</code> 号是什么：</p>
<p>型別</p>
<pre><code>window<span class="preprocessor">.jQuery</span> = window.$ = jQuery<span class="comment">;</span>
</code></pre>
<p>拿来引用 jQuery 函数的快捷方式。</p>
<p>首先讲 jQuery 之前，假定我们有一个 HTML 文件：</p>
<figure class="highlight lang-html"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="code"><pre>&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
true&lt;meta charset=utf-8&gt;
true&lt;title&gt;&lt;/title&gt;
true&lt;style&gt;
true.emphasis { font-weight: bold;}
true&lt;/style&gt;
true&lt;script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.js"&gt;&lt;/script&gt;
true&lt;script&gt;

true&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;ul&gt;
true&lt;li&gt;hello&lt;/li&gt;
true&lt;li&gt;hello 2&lt;/li&gt;
true&lt;li&gt;hello 3&lt;/li&gt;
&lt;/ul&gt;

&lt;/body&gt;
&lt;/html&gt;
</pre></td></tr></table></figure>

<p>下面讲述的代码请填入 <code>&lt;/head&gt;</code> 上方的 script 标签内。</p>
<p>OK. 开始。</p>
<p>假设我们要取得 <code>ul</code> 的第一个 <code>li</code>：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'li:first-child'</span>).addClass(<span class="string">'emphasis'</span>);
</pre></td></tr></table></figure>

<p>打开你的浏览器看看，干，怎么不行，这是因为。。。</p>
<p>你的代码放在 head 标签内，下面的 HTML 都还没有载入完毕 (DOM)，就执行了这行代码，执行代码的时候，这会儿根本还没有看到 ul li 呢。</p>
<p>你可以把 <code>&lt;script&gt; ... &lt;/script&gt;</code> 搬到 <code>&lt;/body&gt;</code> 上方，这样就可以了。要是你很坚持你的代码要放在 head 标签内，没问题，使用 jQuery 的 ready 函数：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="keyword">var</span> foo = <span class="keyword">function</span>() {};
$(document).ready(foo);
</pre></td></tr></table></figure>

<p><code>$(document)</code> 叫 jQuery 去把 DOM 抓出来。</p>
<p>等到 document 载入完毕，准备好要给我们玩弄的时候，执行 <code>ready</code> 函数内的 <code>foo</code> 函数。</p>
<p>更简洁的写法、传入匿名函数、或叫回呼函数 (callback function)：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>$(document).ready(<span class="keyword">function</span>() {

});
</pre></td></tr></table></figure>

<p>接下来在这个匿名函数内放入我们之前想做的事儿：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>$(document).ready(<span class="keyword">function</span>() {
truetrue$(<span class="string">'li:first-child'</span>).addClass(<span class="string">'emphasis'</span>);
});
</pre></td></tr></table></figure>

<p>这个 ready 函数会大概每 10 ms 去检查 DOM 准备好给我们玩弄了没，准备好了就执行里面的函数。</p>
<p>把 <code>$(document).ready()</code> 变得更简洁一点：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>$(<span class="keyword">function</span>() {
<span class="literal">true</span>$(<span class="string">'li:first-child'</span>).addClass(<span class="string">'emphasis'</span>);
});
</pre></td></tr></table></figure>

<p>好了，好奇的你又问了，这是为什么？</p>
<p>请看 <a href="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.js">jQuery 源代码</a>，搜索这个关键字 <code>jQuery.fn = jQuery.prototype = {</code></p>
<p>这下面一整段代码，说明了我们调用 jQuery 函数 <code>$()</code> 时，碰到选择器、函数、上下文时该怎么处理。</p>
<p>好，我们现在是传入了一个函数：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>$(<span class="keyword">function</span>() {
<span class="literal">true</span>$(<span class="string">'li:first-child'</span>).addClass(<span class="string">'emphasis'</span>);
});
</pre></td></tr></table></figure>

<p>看到没有，<code>$( function() { ... } )</code>，我们来找找处理传入函数的源代码，一直往下找：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre><span class="comment">// HANDLE: $(function)</span>
<span class="comment">// Shortcut for document ready</span>
} <span class="keyword">else</span> <span class="keyword">if</span> ( jQuery.isFunction( selector ) ) {
truereturn rootjQuery.ready( selector );
}
</pre></td></tr></table></figure>

<p>阿哈，这里写的明明白白，document ready 的缩写。</p>
<p>这里的 <code>selector</code> 就是我们所传入的：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="keyword">function</span>() {
<span class="literal">true</span>$(<span class="string">'li:first-child'</span>).addClass(<span class="string">'emphasis'</span>);
}
</pre></td></tr></table></figure>

<p>而它说:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="keyword">if</span> ( jQuery.isFunction( selector ) ) {
truereturn rootjQuery.ready( selector );
}
</pre></td></tr></table></figure>

<p>如果传入的 <code>selector</code> 是函数的话，返回 <code>rootjQuery.ready( selector );</code></p>
<p>呵呵。。。所以这两段代码是等效的：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre>$(document).ready(<span class="keyword">function</span>() {
<span class="literal">true</span>$(<span class="string">'li:first-child'</span>).addClass(<span class="string">'emphasis'</span>);
});

$(<span class="keyword">function</span>() {
<span class="literal">true</span>$(<span class="string">'li:first-child'</span>).addClass(<span class="string">'emphasis'</span>);
});
</pre></td></tr></table></figure>

<p>很多人觉得使用第二种这个缩写不太好，第一种的可读性比较高，这是你个人的选择，如果你知道你在干什么，两个都很好。</p>
<p>本篇结束。</p>
]]></content>
    <category scheme="http://lisp.es//tags/jQuery/" term="jQuery"/>
    <category scheme="http://lisp.es//categories/jQuery/" term="jQuery"/>
  </entry>
  <entry>
    <title type="html"><![CDATA[jQuery 1.7 介绍（上）]]></title>
    <link href="http://lisp.es//2012/05/17/jquery-intro/"/>
    <id>http://lisp.es//2012/05/17/jquery-intro/</id>
    <published>2012-05-17T15:43:00.000Z</published>
    <updated>2013-05-18T19:15:28.000Z</updated>
    <content type="html"><![CDATA[<p>建议不要看我写的文章，赶快到这里学会时下最火最流行的 jQuery!</p>
<p><a href="http://tutsplus.com/course/30-days-to-learn-jquery/">30 天学会 jQuery</a></p>
<h2>神马是 jQuery？</h2>
<p>地球上最受欢迎的 Javascript 函式库、软件攻城狮必备技能之一、网页看起来美妙的魔法之一。</p>
<p>2012.05.17 现在的版本是 1.7.2。</p>
<p>型別</p>
<h2>去哪里获得 jQuery</h2>
<p>通常有开发版本与生产版本 <strong>32KB</strong> ，建议本地开发使用开发版本 <strong>247KB</strong> ，使用 jQuery 时顺便研读源代码。</p>
<blockquote>
<p>开发版本：无压缩、带注释；生产版本：压缩过、不堪入目。</p>
</blockquote>
<p><a href="http://jquery.com/">jQuery 官网</a></p>
<p>jQuery CDN: <a href="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.js">1.7.2 development</a> <a href="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js">1.7.2 production</a></p>
<blockquote>
<p>不建议使用 CDN，可以参考我的不要使用 CDN 来放第三方 Javascript</p>
</blockquote>
<h2>怎么在 HTML 里面玩弄 Javascript 代码</h2>
<p>把 JS 代码放在 script 标签内即可。</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>&lt;script&gt;

&lt;<span class="regexp">/script&gt;
</pre></td></tr></table></figure>

<h2>如何引用 jQuery 至你的 HTML</h2>
<p>假设我有一个 app 目录，下面有一个 js 文件夹、一个 index.html，js 目录下有一个 jquery-1.7.1.js。</p>
<p>使用 script 标签引用：</p>
<figure class="highlight lang-html"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>&lt;script src="js/jquery-1.7.1.js"&gt;&lt;/script&gt;
</pre></td></tr></table></figure>

<p>使用 CDN 引用：</p>
<figure class="highlight lang-html"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>&lt;script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.js"&gt;&lt;/script&gt;
</pre></td></tr></table></figure>

<p><strong>建议摆放位置</strong> <code>&lt;/body&gt;</code> 标签的正上方。</p>
<p>理由：浏览器一旦碰到 script 得载入完或下载完才会继续往下载入，所以放在 <code>&lt;/body&gt;</code> 上方可以确保你的页面先载入 HTML 以及 CSS。</p>
<h2>第一个 jQuery 代码</h2>
<h3>如何引用 jQuery?</h3>
<p>jQuery 其实就是一个函数，你可以这样子引用它：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>jQuery(...)
</pre></td></tr></table></figure>

<p>好，让我们看看怎么让 jQuery 玩弄页面的 CSS。</p>
<p>假设我们有一个 HTML 页面:</p>
<figure class="highlight lang-html"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="code"><pre>&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
true&lt;meta charset=utf-8&gt;
true&lt;title&gt;&lt;/title&gt;
true&lt;style&gt;
true.emphasis{ color: green; }
true&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;ul&gt;
true&lt;li&gt;hello&lt;/li&gt;
true&lt;li&gt;hello 2&lt;/li&gt;
true&lt;li&gt;hello 3&lt;/li&gt;
&lt;/ul&gt;
&lt;script src="js/jquery-1.7.1.js"&gt;&lt;/script&gt;
&lt;script&gt;

&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre></td></tr></table></figure>

<p>以下代码添加至 <code>&lt;/body&gt;</code> 上方的 script 标签。</p>
<p>要怎么样用 jQuery 来添加 CSS 样式？</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>jQuery(<span class="string">'ul li'</span>);
</pre></td></tr></table></figure>

<p>这一行的作用是，你跟 jQuery 说，帮我根据这个 CSS 选择器搜寻一下 DOM。</p>
<p>存到一个变量里，并打印到浏览器的 console 看看：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="keyword">var</span> lis = jQuery(<span class="string">'ul li'</span>);
console.log(lis);
</pre></td></tr></table></figure>

<p>阿哈，你打开浏览器、打开开发者工具，切换到 console tab，会看到</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>[&lt;li&gt;​hello​&lt;<span class="regexp">/li&gt;​, &lt;li&gt;​hello 2​&lt;/</span>li&gt;​, &lt;li&gt;​hello <span class="number">3</span>​&lt;<span class="regexp">/li&gt;​]
</pre></td></tr></table></figure>

<p><code>console.log()</code> 可以当之后调试代码的手段之一。</p>
<p>猛阿，基本上只要懂 CSS 选择器，jQuery 几乎都学会了！呵呵。。。</p>
<p>再举个例子，怎么给这些清单元素添加红色呢？</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>jQuery(<span class="string">'ul li'</span>).css(<span class="string">'color'</span>,<span class="string">'red'</span>);
</pre></td></tr></table></figure>

<blockquote>
<p>尽量把所有的样式交给 CSS 来做，你偶尔才会需要用到 jQuery 来更改样式。</p>
</blockquote>
<p>另一个例子，给这些清单元素添加 <code>style</code> 标签内的 <code>.emphasis</code> 这个类：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>jQuery(<span class="string">'ul li'</span>).addClass(<span class="string">'.emphasis'</span>);
</pre></td></tr></table></figure>

<h3>使用缩写引用 jQuery</h3>
<p>这一行</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>jQuery(<span class="string">'ul li'</span>).addClass(<span class="string">'.emphasis'</span>);
</pre></td></tr></table></figure>

<p>等同于</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'ul li'</span>).addClass(<span class="string">'.emphasis'</span>);
</pre></td></tr></table></figure>

<p>等同于</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>window.jQuery(<span class="string">'ul li'</span>).addClass(<span class="string">'.emphasis'</span>);
</pre></td></tr></table></figure>

<p><strong>你怎么知道的！？</strong></p>
<p>请看 <a href="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.js">jQuery 源代码</a>的最下方：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="comment">// Expose jQuery to the global object</span>
window.jQuery = window.$ = jQuery;
</pre></td></tr></table></figure>

<p>呵呵，人家都写在那呢。</p>
<p>这篇就介绍到这儿吧。</p>
]]></content>
    <category scheme="http://lisp.es//tags/jQuery/" term="jQuery"/>
    <category scheme="http://lisp.es//categories/jQuery/" term="jQuery"/>
  </entry>
  <entry>
    <title type="html"><![CDATA[Python 简易解析 XML JSON]]></title>
    <link href="http://lisp.es//2012/05/17/parse-xml-json/"/>
    <id>http://lisp.es//2012/05/17/parse-xml-json/</id>
    <published>2012-05-17T14:06:00.000Z</published>
    <updated>2013-05-18T19:15:28.000Z</updated>
    <content type="html"><![CDATA[<h3>XML</h3>
<h4>使用轻量快速的 minidom 函式库</h4>
<p>引用 minidom:</p>
<pre><code><span class="title">from</span> xml.dom <span class="import"><span class="keyword">import</span> minidom</span>
</code></pre>
<blockquote>
<p>DOM -- Document Object Model</p>
</blockquote>
<p>minidom 有一个 parseString 函数可以解析 XML 字串。</p>
<p>型別</p>
<p>解析一个随意取名的 XML 字串，存入 x：</p>
<pre><code>x = minidom.parseString("<span class="tag">&lt;<span class="title">foo</span>&gt;</span>Lorem ipsum<span class="tag">&lt;<span class="title">children</span>&gt;</span><span class="tag">&lt;<span class="title">item</span>&gt;</span>1<span class="tag">&lt;/<span class="title">item</span>&gt;</span><span class="tag">&lt;<span class="title">item</span>&gt;</span>2<span class="tag">&lt;/<span class="title">item</span>&gt;</span><span class="tag">&lt;<span class="title">item</span>&gt;</span>3<span class="tag">&lt;/<span class="title">item</span>&gt;</span><span class="tag">&lt;/<span class="title">children</span>&gt;</span><span class="tag">&lt;/<span class="title">foo</span>&gt;</span>")
</code></pre>
<p>x 现在是一个 xml.dom.minidom.Document instance 实例。</p>
<p><strong>注意</strong> XML 不像 HTML，严格要求每个 open 标签要有一个相应的 close 标签！</p>
<p>看看 x 有什么可以调用的属性、方法：</p>
<pre><code><span class="function"><span class="title">dir</span><span class="params">(x)</span>

[<span class="title">'ATTRIBUTE_NODE'</span>, <span class="title">'CDATA_SECTION_NODE'</span>, <span class="title">'COMMENT_NODE'</span>, <span class="title">'DOCUMENT_FRAGMENT_NODE'</span>, <span class="title">'DOCUMENT_NODE'</span>, <span class="title">'DOCUMENT_TYPE_NODE'</span>, <span class="title">'ELEMENT_NODE'</span>, <span class="title">'ENTITY_NODE'</span>, <span class="title">'ENTITY_REFERENCE_NODE'</span>, <span class="title">'NOTATION_NODE'</span>, <span class="title">'PROCESSING_INSTRUCTION_NODE'</span>, <span class="title">'TEXT_NODE'</span>, <span class="title">'__doc__'</span>, <span class="title">'__init__'</span>, <span class="title">'__module__'</span>, <span class="title">'__nonzero__'</span>, <span class="title">'_call_user_data_handler'</span>, <span class="title">'_child_node_types'</span> ... <span class="title">'standalone'</span>, <span class="title">'strictErrorChecking'</span>, <span class="title">'toprettyxml'</span>, <span class="title">'toxml'</span>, <span class="title">'unlink'</span>, <span class="title">'version'</span>, <span class="title">'writexml'</span>]
</code></pre>
<p>转回 xml:</p>
<pre><code><span class="attribute">x.toprettyxml()
</code></pre>
<p>印出来看看：</p>
<pre><code><span class="title">print</span> x.toprettyxml()
</code></pre>
<p>输出：</p>
<pre><code><span class="tag">&lt;<span class="title">foo</span>&gt;</span>
    Lorem ipsum
    <span class="tag">&lt;<span class="title">children</span>&gt;</span>
        <span class="tag">&lt;<span class="title">item</span>&gt;</span>
            1
        <span class="tag">&lt;/<span class="title">item</span>&gt;</span>
        <span class="tag">&lt;<span class="title">item</span>&gt;</span>
            2
        <span class="tag">&lt;/<span class="title">item</span>&gt;</span>
        <span class="tag">&lt;<span class="title">item</span>&gt;</span>
            3
        <span class="tag">&lt;/<span class="title">item</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">children</span>&gt;</span>
<span class="tag">&lt;/<span class="title">foo</span>&gt;</span>
</code></pre>
<p>取得第二个 item 标签内的值 2：</p>
<pre><code><span class="transposed_variable">x.</span>getElementsByTagName(<span class="string">'item'</span>)<span class="matrix">[<span class="number">1</span>].</span>childNodes<span class="matrix">[<span class="number">0</span>].</span>nodeValue
</code></pre>
<p>你可以看看 dir 里面有什么函数可以用，在 python 的直译器里面玩玩看。</p>
<h3>RSS</h3>
<p>比如说想要知道 <a href="http://www.nytimes.com/services/xml/rss/nyt/Science.xml">http://www.nytimes.com/services/xml/rss/nyt/Science.xml</a> 有几个 item：</p>
<pre><code><span class="title">from</span> xml.dom <span class="import"><span class="keyword">import</span> minidom</span>

<span class="import"><span class="keyword">import</span> urllib2</span>

<span class="title">contents</span> = urllib2.urlopen(<span class="string">"http://www.nytimes.com/services/xml/rss/nyt/Science.xml"</span>).read()

<span class="title">d</span> = minidom.parseString(contents)

<span class="title">len</span>(d.getElementsByTagName(<span class="string">"item"</span>)) # =&gt; <span class="number">38</span> on <span class="number">2012.05</span><span class="number">.17</span>
</code></pre>
<h3>JSON</h3>
<p>Javascript Object Notation</p>
<p>在 Python 用 dictionary 混 List 的形式储存 <code>{ foo: [{&quot;a&quot;: 1}, ... {&quot;c&quot;: 3}] }</code></p>
<p>使用 JSON 库：</p>
<pre><code><span class="import"><span class="keyword">import</span> json</span>
</code></pre>
<p>假设今天我们有一个 json 格式的字串 j，具有两个键 <code>mon</code> 与 <code>numbers</code>：</p>
<pre><code><span class="setting">j = <span class="value">'{<span class="string">"mon"</span>: <span class="number">1</span>, <span class="string">"numbers"</span>: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">9.9</span>]}'</span></span>
</code></pre>
<p>载入这个 json ，存到 d 里：</p>
<pre><code><span class="setting">d = <span class="value">json.loads(j)</span></span>
</code></pre>
<p>载入后我们得到一个 python 字典（无序）：</p>
<pre><code>{<span class="string">u'mon'</span>: <span class="number">1</span>, <span class="string">u'numbers'</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">9.9</span>]}
</code></pre>
<p>取出 <code>mon</code> 的值：</p>
<pre><code>d[<span class="string">'mon'</span>] <span class="comment"># =&gt; 1</span>
d[<span class="string">'numbers'</span>][2] <span class="comment"># =&gt; 9.9</span>
</code></pre>
<p>你也可以 <code>eval</code> 这个 json 格式的字串：</p>
<pre><code><span class="keyword">eval</span>(j)
<span class="comment"># =&gt; {'mon': 1, 'numbers': [1, 2, 9.9]}</span>
</code></pre>
<p><strong>永远别用 eval 来解析 json</strong> 。</p>
<p>Q: 加总 www.reddit.com 帖子的 up votes。</p>
<p>A:</p>
<figure class="highlight lang-python"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
</pre></td><td class="code"><pre>r = urllib2.urlopen(<span class="string">"http://www.reddit.com/.json"</span>)
j = json.loads(r)

j.keys() <span class="comment"># =&gt; [u'kind', u'data']</span>
j[<span class="string">'data'</span>].keys() <span class="comment"># =&gt; [u'modhash', u'children', u'after', u'before']</span>
j[<span class="string">'data'</span>][<span class="string">'children'</span>][<span class="number">0</span>].keys() <span class="comment"># =&gt; [u'kind', u'data']</span>
j[<span class="string">'data'</span>][<span class="string">'children'</span>][<span class="number">0</span>][<span class="string">'data'</span>].keys() <span class="comment"># =&gt; [..., u'ups']</span>
j[<span class="string">'data'</span>][<span class="string">'children'</span>][<span class="number">0</span>][<span class="string">'data'</span>][<span class="string">'ups'</span>] <span class="comment"># =&gt; 7902</span>

sum(c[<span class="string">'data'</span>][<span class="string">'ups'</span>] <span class="keyword">for</span> c <span class="keyword">in</span> j[<span class="string">'data'</span>][<span class="string">'children'</span>]) <span class="comment"># =&gt; 84500</span>
</pre></td></tr></table></figure>

<p>DONE.</p>
]]></content>
    <category scheme="http://lisp.es//tags/xml-json/" term="xml json"/>
    <category scheme="http://lisp.es//categories/xml-json/" term="xml json"/>
  </entry>
  <entry>
    <title type="html"><![CDATA[CSS 一个常见 nth-child 的误区]]></title>
    <link href="http://lisp.es//2012/05/12/nth-child-common-gotcha/"/>
    <id>http://lisp.es//2012/05/12/nth-child-common-gotcha/</id>
    <published>2012-05-12T15:04:00.000Z</published>
    <updated>2013-05-18T19:15:28.000Z</updated>
    <content type="html"><![CDATA[<p>给定有如下的 HTML 代码片段：</p>
<p>型別</p>
<figure class="highlight lang-html"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="code"><pre>&lt;html&gt;
...
&lt;style&gt;
truedt {
truetrueboder-top: 1px solid white;
truetrueboder-bottom: 1px solid gray;
true}
&lt;/style&gt;
&lt;body&gt;
true&lt;dl&gt;
truetrue&lt;dt&gt;How to install&lt;/dt&gt;
truetrue&lt;dd&gt;Check ...&lt;/dd&gt;
truetrue&lt;dt&gt;How to install&lt;/dt&gt;
truetrue&lt;dd&gt;Check ...&lt;/dd&gt;
truetrue&lt;dt&gt;How to install&lt;/dt&gt;
truetrue&lt;dd&gt;Check ...&lt;/dd&gt;
truetrue&lt;dt&gt;How to install&lt;/dt&gt;
truetrue&lt;dd&gt;Check ...&lt;/dd&gt;
truetrue&lt;dt&gt;How to install&lt;/dt&gt;
truetrue&lt;dd&gt;last ...&lt;/dd&gt;
true&lt;/dl&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre></td></tr></table></figure>

<p>假设这是一个 FAQ，我们有一个 Definition list (<code>dl</code>)，并有五个 item (<code>dt</code>)，五个 item 描述 (<code>dd</code>)，</p>
<p>每个 <code>dt</code> 的上下有边界，分别是白色、黑色。</p>
<p>今天假如我们想要第一个 <code>dt</code> 上方没有 boder，以及最后一个 <code>dt</code> 下方没有 boder，这时候 CSS 该怎么写呢？</p>
<p>我们可以使用 CSS3 的 <code>first-child</code>：</p>
<pre><code><span class="tag">dt</span><span class="pseudo">:first-child</span> <span class="rules">{ <span class="rule"><span class="attribute">boder-top</span>:<span class="value"> none;</span></span> <span class="rule">}</span></span>
</code></pre>
<p>现在你可能会想要使用 <code>last-child</code> 来把 最后一个 dd 的 boder-bottom 拿掉：</p>
<pre><code><span class="tag">dt</span><span class="pseudo">:last-child</span> <span class="rules">{ <span class="rule"><span class="attribute">boder-bottom</span>:<span class="value"> none;</span></span> <span class="rule">}</span></span>
</code></pre>
<p>而这样不行，因为 <code>last-child</code> 是选择 parent 的最后一个 child，这个例子里会选中：</p>
<pre><code>&lt;dd&gt;last <span class="keyword">...</span>&lt;/dd&gt;
</code></pre>
<p>那该怎么办呢？可以使用 <code>nth-last-child</code> ：</p>
<pre><code><span class="tag">dt</span><span class="pseudo">:nth-last-child(2)</span> <span class="rules">{ <span class="rule"><span class="attribute">boder-bottom</span>:<span class="value"> none;</span></span> <span class="rule">}</span></span>
</code></pre>
<p>这样子会从 <code>dl</code> 的最后一个 child 开始往上 2 个，也就是我们想要的最后一个 <code>dt</code>。</p>
<p>That&#39;s it!!!</p>
]]></content>
    <category scheme="http://lisp.es//tags/css/" term="css"/>
    <category scheme="http://lisp.es//categories/css/" term="css"/>
  </entry>
  <entry>
    <title type="html"><![CDATA[不要使用 CDN 来放第三方 Javascript]]></title>
    <link href="http://lisp.es//2012/05/12/dont-use-cdn-html5shiv/"/>
    <id>http://lisp.es//2012/05/12/dont-use-cdn-html5shiv/</id>
    <published>2012-05-12T09:33:00.000Z</published>
    <updated>2013-05-18T19:15:28.000Z</updated>
    <content type="html"><![CDATA[<p><a href="http://code.google.com/p/html5shiv/">HTML5shiv</a> 是一个让 IE 8 启用 HTML5 元素的第三方 JS，通常 CDN 引用的链接是：</p>
<p><a href="http://html5shiv.googlecode.com/svn/trunk/html5.js">http://html5shiv.googlecode.com/svn/trunk/html5.js</a></p>
<p>不要这么做的理由：</p>
<p>型別</p>
<ol>
<li><p>没有使用 HTTP 压缩</p>
</li>
<li><p>没有 cached，通常这个文件只缓存 180 秒。</p>
</li>
<li><p>googlecode.com 不支援 partial response (可以提高效能的东东)</p>
</li>
<li><p>你连到别人的地方，无法控制什么事情会发生，说不定那哥儿们不爽了直接删掉。。。</p>
</li>
<li><p>实际上压缩后才 1200 Bytes，造成很多额外的 Overhead (DNS lookup, TCP handshake...etc.)</p>
</li>
</ol>
<p>原始文章：<a href="http://zoompf.com/blog/2012/05/html5shiv-and-serving-content-from-code-repositories">html5shiv and Serving Content From Code Repositories</a></p>
]]></content>
    <category scheme="http://lisp.es//tags/HTML5/" term="HTML5"/>
    <category scheme="http://lisp.es//categories/HTML5/" term="HTML5"/>
  </entry>
  <entry>
    <title type="html"><![CDATA[Python 解决 Zebra 谜题]]></title>
    <link href="http://lisp.es//2012/05/10/python-zebra/"/>
    <id>http://lisp.es//2012/05/10/python-zebra/</id>
    <published>2012-05-10T14:35:00.000Z</published>
    <updated>2013-05-18T19:15:28.000Z</updated>
    <content type="html"><![CDATA[<p>爱因斯坦养鱼问题的学名就叫 Zebra Puzzle。之所以叫爱因斯坦养鱼问题是为了刊登在杂志上吸引读者的注意，其实这个问题不是爱因斯坦搞的...</p>
<p>问题可以到这里看：<a href="http://en.wikipedia.org/wiki/Zebra_Puzzle">Zebra Puzzle</a></p>
<p>型別</p>
<p>首先实现了 2 个 小函数，<code>imright</code> 跟 <code>nextto</code></p>
<p>确定某房是不是在某房右边、或是两个房挨著。</p>
<p>接下来给每个房子编上号，12345，</p>
<p>然后使用了 Python 自带的排列工具 <code>itertools.permutations</code> 给出房子可能的排列。</p>
<p>接著用了一个 Python 的奇技淫巧，叫做 Generator Expression，</p>
<p>语法是：<code>(term for- 子句 (选择性) for-if- 子句)</code></p>
<p>这个 generator expression 会返回一个 Generator 对象。</p>
<p>恩，给个例子好了：</p>
<p>先定义一个算平方的函数，然后用 Generator Expression：</p>
<pre><code><span class="function"><span class="keyword">def</span> <span class="title">sqr</span><span class="params">(x)</span>:</span> <span class="keyword">print</span> <span class="string">'调用 sqr, 参数 '</span>, x; <span class="keyword">return</span> x*x

g = (sq(x) <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">10</span>) <span class="keyword">if</span> x%<span class="number">2</span>==<span class="number">0</span>)
</code></pre>
<p>这个时候如果调用 g ：</p>
<pre><code>&gt;&gt;&gt; <span class="comment">g</span>
&lt;<span class="comment">GeneratorObject</span> <span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span>&gt;
</code></pre>
<p>不会去调用函数，只返回一个 Generator 对象、然而</p>
<pre><code>&gt;&gt;&gt; <span class="keyword">next</span>(g)
调用 <span class="built_in">sqr</span>, 参数 <span class="number">0</span>
<span class="number">0</span>
</code></pre>
<p>才会调用这个 Generator 所绑定的函数。。。汗。。。</p>
<p>这个问题要找，水在哪个房子被喝的，哪个房子养斑马。</p>
<p>藉由把 Constraint 移到对的地方，减少需要的计算，再搭配 Generator-exp 的特性，最后大概 0.00028 秒之类的就算好了，
本来用 嵌套 For-loop 要算 1 小时。</p>
<p>至于那个 c 函数 是拿来显示统计数据跟除错用的。</p>
<p>完整代码：</p>
<script src="https://gist.github.com/2653290.js"></script>]]></content>
    <category scheme="http://lisp.es//tags/Python/" term="Python"/>
    <category scheme="http://lisp.es//categories/Python/" term="Python"/>
  </entry>
  <entry>
    <title type="html"><![CDATA[Python For 循环的迭代器实现]]></title>
    <link href="http://lisp.es//2012/05/10/python-for-inside/"/>
    <id>http://lisp.es//2012/05/10/python-for-inside/</id>
    <published>2012-05-10T14:09:00.000Z</published>
    <updated>2013-05-18T19:15:28.000Z</updated>
    <content type="html"><![CDATA[<p>给定一段 Python 代码：</p>
<pre><code><span class="keyword">for</span> x <span class="keyword">in</span> items:
    <span class="built_in">print</span> x
</code></pre>
<p>这个 items 可以是字串、列表、等等，这种可以迭代的集合称之为 iterable。</p>
<p>型別</p>
<p>这个 iter 就是创一个迭代器出来，相信有学过 Java 的人都不陌生。</p>
<p>然后用一个 <code>try .. except</code> 语句包住，迭代至停为止，停时会抛出 StopIteration。</p>
<p>实际上是这样实现的：</p>
<pre><code>it = iter(items)
<span class="keyword">try</span>:
    <span class="keyword">while</span> <span class="built_in">True</span>
        x = next(it)
        <span class="keyword">print</span> x
<span class="keyword">except</span> StopIteration:
    <span class="keyword">pass</span>
</code></pre>
]]></content>
    <category scheme="http://lisp.es//tags/Python/" term="Python"/>
    <category scheme="http://lisp.es//categories/Python/" term="Python"/>
  </entry>
  <entry>
    <title type="html"><![CDATA[Homebrew Install growlnotify on Snow Leopard and Lion]]></title>
    <link href="http://lisp.es//2012/05/01/mac-install-growlnotify/"/>
    <id>http://lisp.es//2012/05/01/mac-install-growlnotify/</id>
    <published>2012-04-30T16:51:00.000Z</published>
    <updated>2013-05-18T19:15:28.000Z</updated>
    <content type="html"><![CDATA[<p>Currently homebrew already removed formula of growlnotify. If you want to use the Gem <a href="http://rubygems.org/gems/growl">growl</a> with a well-known app growlnotify and you may encounter this error with Growlnotify on Snow Leopard:</p>
<pre><code>dyld: Symbol <span class="keyword">not</span> found: _kSecRandomDefault
  Referenced from: <span class="regexp">/usr/local/bin/g</span>rowlnotify
  Expected <span class="keyword">in</span>: <span class="regexp">/System/Library/Frameworks/Security.framework/Versions/A/</span>Security
 <span class="keyword">in</span> <span class="regexp">/usr/local/bin/g</span>rowlnotify
Trace/BPT trap
</code></pre>
<p>型別</p>
<p>Here are the formulas:</p>
<h3>For Snow Leopard with growlnotify v1.2.2</h3>
<pre><code>brew install https://raw<span class="preprocessor">.github</span><span class="preprocessor">.com</span>/mxcl/homebrew/bd40f1e5f89fad962b021c827d56a9fdea0c847d/Library/Formula/growlnotify<span class="preprocessor">.rb</span>
</code></pre>
<h3>For Lion with growlnotify v1.3</h3>
<pre><code>brew install https://raw<span class="preprocessor">.github</span><span class="preprocessor">.com</span>/mxcl/homebrew/<span class="number">15</span>d6da0023924969fa6ad8a7cf743c4b39838e6e/Library/Formula/growlnotify<span class="preprocessor">.rb</span>
</code></pre>
<p>Alternatively you could try on their <a href="http://growl.info/downloads">offical download page</a></p>
]]></content>
    <category scheme="http://lisp.es//tags/MacOSX/" term="MacOSX"/>
    <category scheme="http://lisp.es//categories/MacOSX/" term="MacOSX"/>
  </entry>
  <entry>
    <title type="html"><![CDATA[Rails 3.2.3 使用 Spork + Guard + RSpec + Capybara]]></title>
    <link href="http://lisp.es//2012/04/30/sprok-guard-rspec/"/>
    <id>http://lisp.es//2012/04/30/sprok-guard-rspec/</id>
    <published>2012-04-30T05:46:00.000Z</published>
    <updated>2013-05-18T19:15:28.000Z</updated>
    <content type="html"><![CDATA[<h2>比较匆忙的同学请看</h2>
<p>0) <code>rails new appname --skip-test-unit --skip-bundle</code></p>
<p>1) 复制这个 Gemfile(<a href="https://gist.github.com/2555402">OSX</a> / <a href="https://gist.github.com/2555397">Linux</a> / <a href="https://gist.github.com/2555403">Windows</a>)，替换掉项目下的 Gemfile。</p>
<p>安装需要的 Gems，你有两个选择：</p>
<p>2-a) <code>bundle install</code> ，之后使用 <code>bundle exec xxx</code><br>2-b) <code>bundle install --binstubs</code>  ，之后使用 <code>bin/xxx</code></p>
<p>3) <code>rails g rspec:install</code></p>
<p>4) 运行 <code>bin/guard init rspec &amp;&amp; bin/guard init spork</code><br>5) 复制这个 <a href="https://gist.github.com/2555614">Guardfile</a>，覆盖掉项目下的 Guardfile。<br>6) 添加 <code>--drb</code> 至项目的根目录下的 <code>.rspec</code>。 
7) 复制这个 <a href="https://gist.github.com/2555618">spec/spec_helper.rb</a>，覆盖 <code>spec/spec_helper.rb</code>  </p>
<p>8-a) <code>bundle exec spork --bootstrap</code><br>8-b) <code>bin/sprok --bootstrap</code>  </p>
<p>9-a) <code>bundle exec guard</code><br>9-b) <code>bin/guard</code>  </p>
<p>型別</p>
<h2>有 10 分钟的同学请看</h2>
<h3>为什么使用 <a href="http://rubygems.org/gems/guard">Guard</a>？</h3>
<ol>
<li>要切回终端机敲 rspec 命令  </li>
<li>启动速度太慢 (使用 Spork 来加速)</li>
</ol>
<p>Guard 人如其名，自动侦测改动并运行测试。</p>
<h4>配置 Guard</h4>
<p>Gemfile:</p>
<p>在 <code>:development group</code> 加入：  </p>
<pre><code><span class="title">gem</span> <span class="string">'guard-rspec'</span>, <span class="string">'0.5.5'</span>
</code></pre>
<p>在 <code>:test group</code> 加入一些相依的 Gems，OSX 可能还需要安装 <a href="http://growl.info/downloads#generaldownloads">growl-notify</a>：</p>
<p><strong>MacOSX</strong></p>
<pre><code>gem <span class="string">'rb-fsevent'</span>, <span class="string">'0.4.3.1'</span>, :<span class="keyword">require</span> =&gt; <span class="keyword">false</span>
gem <span class="string">'growl'</span>, <span class="string">'1.0.3'</span>
</code></pre>
<p><strong>Linux</strong></p>
<pre><code><span class="title">gem</span><span class="string"> 'rb-inotify'</span>,<span class="string"> '0.8.8'</span>
<span class="title">gem</span><span class="string"> 'libnotify'</span>,<span class="string"> '0.5.9'</span>
</code></pre>
<p><strong>Windows</strong></p>
<pre><code><span class="title">gem</span><span class="string"> 'rb-fchange'</span>,<span class="string"> '0.0.5'</span>
<span class="title">gem</span><span class="string"> 'rb-notifu'</span>,<span class="string"> '0.0.4'</span>
<span class="title">gem</span><span class="string"> 'win32console'</span>,<span class="string"> '1.3.0'</span>
</code></pre>
<p>范例 Gemfile，放在 Gist:</p>
<p><a href="https://gist.github.com/2555278">MacOSX</a><br><a href="https://gist.github.com/2555344">Linux</a><br><a href="https://gist.github.com/2555343">Windows</a>  </p>
<p>Gemfile 配置好运行 <code>bundle install</code> ，初始化 Guard：</p>
<pre><code><span class="title">bundle</span> exec guard init rspec
</code></pre>
<p>或是运行 <code>bundle install --binstubs</code>，初始化 Guard：</p>
<pre><code><span class="title">bin</span>/guard init rspec
</code></pre>
<p>会产生一个 Guardfile，最上方加入此行：</p>
<pre><code><span class="title">require</span> <span class="string">'active_support/core_ext'</span>
</code></pre>
<p>并改动此行 <code>guard &#39;rspec&#39;, :version =&gt; 2 do</code> ：</p>
<pre><code>guard <span class="string">'rspec'</span>, <span class="symbol">:version</span> =&gt; <span class="number">2</span>, <span class="symbol">:all_after_pass</span> =&gt; <span class="keyword">false</span> <span class="keyword">do</span>
</code></pre>
<p>确保 Guard 不再一个失败测试通过后继续运行（加快<strong>红绿重构</strong>周期）</p>
<p>再添加：</p>
<pre><code>guard <span class="string">'rspec'</span>, <span class="symbol">:version</span> =&gt; <span class="number">2</span>, <span class="symbol">:all_after_pass</span> =&gt; <span class="keyword">false</span> <span class="keyword">do</span>
    .
    .
    .
    watch(%r{^app/controllers/(.+)<span class="number">_</span>(controller)\.rb<span class="variable">$}</span>)  <span class="keyword">do</span> |m|
      [<span class="string">"spec/routing/<span class="subst">#{m[<span class="number">1</span>]}</span>_routing_spec.rb"</span>,
       <span class="string">"spec/<span class="subst">#{m[<span class="number">2</span>]}</span>s/<span class="subst">#{m[<span class="number">1</span>]}</span>_<span class="subst">#{m[<span class="number">2</span>]}</span>_spec.rb"</span>,
       <span class="string">"spec/acceptance/<span class="subst">#{m[<span class="number">1</span>]}</span>_spec.rb"</span>,
       (m[<span class="number">1</span>][<span class="regexp">/_pages/</span>] ? <span class="string">"spec/requests/<span class="subst">#{m[<span class="number">1</span>]}</span>_spec.rb"</span> <span class="symbol">:</span> 
                         <span class="string">"spec/requests/<span class="subst">#{m[<span class="number">1</span>].singularize}</span>_pages_spec.rb"</span>)]
    <span class="keyword">end</span>
    watch(%r{^app/views/(.+)/}) <span class="keyword">do</span> |m|
      <span class="string">"spec/requests/<span class="subst">#{m[<span class="number">1</span>].singularize}</span>_pages_spec.rb"</span>
    <span class="keyword">end</span>
    .
    .
    .
<span class="keyword">end</span>
</code></pre>
<p>当 integration tests 及 views 有变动时，会自动运行测试。</p>
<p>这些都设置好了，启动 guard </p>
<pre><code><span class="title">bundle</span> exec guard
</code></pre>
<p>或</p>
<pre><code><span class="attribute">bin/guard
</code></pre>
<p>更多信息请参考：<a href="https://github.com/guard/guard">Guard Github 页面</a></p>
<h3>使用 Spork 来加速测试</h3>
<p>运行 rspec 很慢的原因是每次都得重加载整个 Rails 环境。Spork 测试服务器透过加载 Rails 环境，并维护一个进程池 (pool of processes) 给之后的测试使用。跟 Guard 搭配使用顺风顺水。</p>
<p>配置 Gemfile，将此行加入 <code>:test group</code>：</p>
<pre><code><span class="title">gem</span><span class="string"> 'guard-spork'</span>,<span class="string"> '0.3.2'</span>
<span class="title">gem</span><span class="string"> 'spork'</span>,<span class="string"> '0.9.0'</span>
</code></pre>
<p>范例 Gemfile，放在 Gist:</p>
<p><a href="https://gist.github.com/2555402">MacOSX</a><br><a href="https://gist.github.com/2555397">Linux</a><br><a href="https://gist.github.com/2555403">Windows</a>  </p>
<p>运行 <code>bundle install</code> 并运行 spork ：</p>
<pre><code><span class="comment">bundle</span> <span class="comment">exec</span> <span class="comment">spork</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">bootstrap
</code></pre>
<p>运行 <code>bundle install --binstubs</code> 并运行 spork：</p>
<pre><code><span class="comment">spork</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">bootstrap</span> <span class="comment">#</span> <span class="comment">or</span> <span class="comment">bin/spork</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">bootstrap
</code></pre>
<p>添加需加载的环境信息至 <code>spec/spec_helper.rb</code> 里的 <code>Spork.prefork</code>：</p>
<pre><code>require <span class="comment">'rubygems'</span>
require <span class="comment">'spork'</span>

Spork.prefork <span class="keyword">do</span>
  # Loading more <span class="keyword">in</span> this block will cause your tests <span class="keyword">to</span> run faster. However, 
  # <span class="keyword">if</span> you change any configuration <span class="keyword">or</span> code from libraries loaded here, you<span class="comment">'ll</span>
  # need <span class="keyword">to</span> restart spork <span class="keyword">for</span> it take effect.
  # This file <span class="keyword">is</span> copied <span class="keyword">to</span> spec/ when you run <span class="comment">'rails generate rspec:install'</span>
  ENV[<span class="string">"RAILS_ENV"</span>] ||= <span class="comment">'test'</span>
  require File.expand_path(<span class="string">"../../config/environment"</span>, __FILE__)
  require <span class="comment">'rspec/rails'</span>
  require <span class="comment">'rspec/autorun'</span>

  # Requires supporting ruby files <span class="keyword">with</span> custom matchers <span class="keyword">and</span> macros, etc,
  # <span class="keyword">in</span> spec/support/ <span class="keyword">and</span> its subdirectories.
  Dir[Rails.root.<span class="built_in">join</span>(<span class="string">"spec/support/**/*.rb"</span>)].<span class="keyword">each</span> {|f| require f}

  RSpec.configure <span class="keyword">do</span> |config|
    # == Mock Framework
    #
    # <span class="keyword">If</span> you prefer <span class="keyword">to</span> use mocha, flexmock <span class="keyword">or</span> RR, uncomment the appropriate line:
    #
    # config.mock_with :mocha
    # config.mock_with :flexmock
    # config.mock_with :rr
    config.mock_with :rspec

    # Remove this line <span class="keyword">if</span> you<span class="comment">'re not using ActiveRecord or ActiveRecord fixtures</span>
    config.fixture_path = <span class="string">"#{::Rails.root}/spec/fixtures"</span>

    # <span class="keyword">If</span> you<span class="comment">'re not using ActiveRecord, or you'd prefer not to run each of your</span>
    # examples within a transaction, remove the following line <span class="keyword">or</span> assign <span class="literal">false</span>
    # instead of <span class="literal">true</span>.
    config.use_transactional_fixtures = <span class="literal">true</span>

    # <span class="keyword">If</span> <span class="literal">true</span>, the base <span class="keyword">class</span> of anonymous controllers will be inferred
    # automatically. This will be the <span class="keyword">default</span> behavior <span class="keyword">in</span> future versions of
    # rspec-rails.
    config.infer_base_class_for_anonymous_controllers = <span class="literal">false</span>
  <span class="keyword">end</span>
<span class="keyword">end</span>

Spork.each_run <span class="keyword">do</span>
  # This code will be run <span class="keyword">each</span> <span class="built_in">time</span> you run your specs.

<span class="keyword">end</span>
</code></pre>
<p>启动 Spork 服务器：</p>
<p>之前使用 <code>bundle install</code>：</p>
<p><code>bundle exec spork</code> </p>
<p>之前使用 <code>bundle install --binstubs</code></p>
<p><code>bin/spork</code></p>
<p>加入此行至 <code>.rspec</code> ，让 RSpec 缺省使用 spork：</p>
<pre><code><span class="literal">-</span><span class="literal">-</span><span class="comment">drb
</code></pre>
<p><strong>提示</strong> ：</p>
<p>如果改动了 <code>routes.rb</code> 需重启 Spork 服务器，如果你觉得测试是对的，但是失败了，也可以重启 Spork 服务器试试看。</p>
<p>更多信息请参考 <a href="https://github.com/sporkrb/spork">Spork Github 页面</a></p>
<h3>Guard 搭配 Spork</h3>
<p>有了 Guard 与 Spork 以后，让它们合体：</p>
<pre><code><span class="title">bundle</span> exec guard init spork
<span class="title">bin</span>/guard init spork
</code></pre>
<p>加入此行至 Guardfile：</p>
<pre><code>guard <span class="string">'spork'</span>, <span class="symbol">:rspec_env</span> =&gt; { <span class="string">'RAILS_ENV'</span> =&gt; <span class="string">'test'</span> } <span class="keyword">do</span>
  watch(<span class="string">'config/application.rb'</span>)
  watch(<span class="string">'config/environment.rb'</span>)
  watch(%r{^config/environments/.+\.rb<span class="variable">$}</span>)
  watch(%r{^config/initializers/.+\.rb<span class="variable">$}</span>)
  watch(<span class="string">'Gemfile'</span>)
  watch(<span class="string">'Gemfile.lock'</span>)
  watch(<span class="string">'spec/spec_helper.rb'</span>)
  watch(<span class="string">'test/test_helper.rb'</span>)
  watch(<span class="string">'spec/support/'</span>)
<span class="keyword">end</span>

guard <span class="string">'rspec'</span>, <span class="symbol">:version</span> =&gt; <span class="number">2</span>, <span class="symbol">:all_after_pass</span> =&gt; <span class="keyword">false</span>, <span class="symbol">:cli</span> =&gt; <span class="string">'--drb'</span> <span class="keyword">do</span>
  .
  .
  .
<span class="keyword">end</span>
</code></pre>
<p>现在全都设定好了，以后只要</p>
<p><code>bundle exec guard</code> 或 <code>bin/guard</code> </p>
<p>Guard 就会自动启动 Spork 服务器并侦测你的改动！</p>
<p>打完收工。。。</p>
]]></content>
    <category scheme="http://lisp.es//tags/Rails/" term="Rails"/>
    <category scheme="http://lisp.es//categories/Rails/" term="Rails"/>
  </entry>
  <entry>
    <title type="html"><![CDATA[RSpec 行为驱动测试简介 - 003]]></title>
    <link href="http://lisp.es//2012/04/25/ror-3-rspec/"/>
    <id>http://lisp.es//2012/04/25/ror-3-rspec/</id>
    <published>2012-04-25T02:52:00.000Z</published>
    <updated>2013-05-18T19:15:28.000Z</updated>
    <content type="html"><![CDATA[<p><strong>1000 个小时学会 Rails 系列</strong></p>
<blockquote>
<p>关关雎鸠，在河之洲。
窈窕淑女，君子好逑。</p>
</blockquote>
<p>今天要介绍的是 RSpec 这个 Gem。</p>
<p>这个 Gem 是干啥用的呢，RSpec 是一个 BDD 测试工具，用起来跟 TDD 工具差不多，只是包了一层 DSL 外衣，也就是说语法比较接近咱人类在用的语言（据说这样开发者与客户可以直接沟通了？）；还有一个 Gem 叫做 Capybara，这个贼难念的单词是 Capybara，水豚，发音可以来<a href="http://goo.gl/mqpiQ">这里</a>听看看，声音没有 <a href="http://railscasts-china.com/">Rails 视频教程</a>的 Terry 老师 (@poshboytl) 那么性感就是了。Capybara 是一个整合测试 Rack 应用的工具，可以模拟真实用户使用你的网站的行为。Capybara 跟 RSpec 起来非常好用！</p>
<p>但今天先介绍 RSpec。。。</p>
<p>型別</p>
<p>接下来要讲的例子呢，你不需要有 Rails 的环境，只需要有 Ruby 与 RubyGems 即可。</p>
<p>Let&#39;s Dive in!!!</p>
<p>RSpec 的测试是用 Ruby <a href="http://en.wikipedia.org/wiki/Domain-specific_language">DSL</a> 写成的，看起来像是这样子：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre>describe Programmer <span class="keyword">do</span>
  it <span class="string">"is lonely"</span> <span class="keyword">do</span>
    Programmer<span class="variable">.lonely</span>?<span class="variable">.should</span> be_true
  <span class="keyword">end</span>
<span class="keyword">end</span>
</pre></td></tr></table></figure>

<p>程序员寂寞么？恩。。。。。。这语法看起来跟英语差不多吧 : ）这样写的好处是比较 Geek 一点的客户也能在<a href="http://en.wikipedia.org/wiki/Acceptance_testing">验收测试 (Acceptance Testing)</a>的阶段直接跟你讨论，看看上帝的要求有没有都满足了！我们这儿有句话说客户是上帝，不知道你们那。。。圣经有一段：上帝说有光，就有光，客户说这个，就这个。。。而这对一个开发人员呢有什么好处呢？可以看看，嗯，这个功能具体是要做什么，然后去实现它。另外一个用 DSL 写的好处是，客户、开发者、代码，都可以用这种近似英语的语言交流（理想、理想嘛）。</p>
<p>而实际上 RSpec 是扩展一些 <code>Test::Unit</code> 已经提供的方法。你喜欢的话，也可以在 RSpec 的测试里混著用。好，下面我们会用另外一个例子，讲讲怎么用这个 RSpec。。。</p>
<p>关关雎鸠，在河之洲，窈窕淑女，君子好逑。。。</p>
<h3>安装 RSpec</h3>
<p>一如往常的一键安装 <code>gem install rspec</code> （目前是 2.9.0 ＠20120423)</p>
<p>会顺便安装相依的 Gem：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre><span class="attribute">Fetching</span>: <span class="string">rspec-core-2.9.0.gem (100%)</span>
<span class="attribute">Fetching</span>: <span class="string">diff-lcs-1.1.3.gem (100%)</span>
<span class="attribute">Fetching</span>: <span class="string">rspec-expectations-2.9.1.gem (100%)</span>
<span class="attribute">Fetching</span>: <span class="string">rspec-mocks-2.9.0.gem (100%)</span>
<span class="attribute">Fetching</span>: <span class="string">rspec-2.9.0.gem (100%)</span>
</pre></td></tr></table></figure>

<p>最后一行你可以看到我们安了 <code>rspec-2.9.0.gem</code> ，而这些相依的 Gem 是要装的，就像水和鱼，过儿与龙儿，我和苍老师，是离不开彼此的。</p>
<h3>一个简单例子</h3>
<p>很好，很好，Gem 装好以后呢，让我们添加一个新的目录叫做 <code>girl</code> ，爱存哪就存哪，而下面再添加一个 <code>spec</code> 目录：</p>
<p>一键完成： <code>mkdir -p girl/spec</code> </p>
<p>在 <code>spec</code> 目录下建立一个文件叫做 <code>girl_spec.rb</code> ，注意到这个 <code>_spec</code> 了吗，这样一看就知道是一个 RSpec 的测试文件，有木有！！！！！用你喜欢的编辑器打开 <code>girl_spec.rb</code> 并敲入以下代码：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre><span class="title">describe</span> <span class="type">Girl</span> <span class="keyword">do</span>
<span class="title">trueit</span> <span class="string">"has chance?"</span> <span class="keyword">do</span>
<span class="title">truetrueGirl</span>.chance?.should be_true
<span class="title">trueend</span>
<span class="title">end</span>
</pre></td></tr></table></figure>

<p>好了，相信各位都看的懂这个例子，我们描述了一个女孩，有机会吗？应该有吧！让我们在更深入的理解以上这位女孩之前，不是，是深入理解这段代码。。。首先 <code>describe</code> 区块 (block) 包含了一个描述这个女孩的测试 (<code>it</code>)，而你宣称你应该有机会 (<code>Girl.chance?.should be_true</code>)。这跟断言有点像 (<code>assert</code>)。而如果其结果不如预期的话，RSpec 会报错并停止这个测试 (spec)。</p>
<p>那这个 <code>should</code> 哪来的，它还有一个兄弟 <code>should_not</code>，呵呵，RSpec 帮你定义好的。</p>
<blockquote>
<p>When RSpec executes specifications, 
  it defines #should and #should_not 
  on every object in the system. 
  These methods are your entry to the    magic of RSpec.
  -- <a href="http://rspec.info/">RSpec.info</a></p>
</blockquote>
<p>现在让我们运行看看，将终端切换到 <code>girl</code> 目录下：<code>[your-path-to/girl] $</code> ，接著输入：</p>
<p><code>rspec spec</code></p>
<p>究竟你跟她有没有机会呢。。。登登登。。。</p>
<p>神马！？</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre><span class="title">uninitialized</span> constant Girl (NameError)
</pre></td></tr></table></figure>

<p>你根本就不知道这女孩是谁，就想追人家了，好小子你，接下来让我们定义一下这个 Girl 常量（类）。要定义她的话，得先添加另外一个目录，叫做 <code>lib</code> ，为什么呢？因为女孩都喜欢住在房子里 (live in building，无恶意。。。)，不是，因为之后 RSpec 会替你识别这个目录，帮你引用进来。。。</p>
<p>在这个目录里添加一个 <code>girl.rb</code>，并填入：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="class"><span class="keyword">class</span> <span class="title">Girl</span>

<span class="title">end</span>
</pre></td></tr></table></figure>

<p>好了，再来我们还得回头告诉 RSpec 咱要追的是哪个女孩，回到 <code>girl_spec.rb</code> ，添加：<code>require girl</code> 呵呵，大家都需要。。。当你再次运行这个测试 <code>rspec spec</code> ，因为你告诉了 RSpec 要载入这个 <code>girl</code> ，RSpec 会把 <code>lib</code> 目录添加到与 <code>spec</code> 同一层，这就是为什么你可以找到 <code>lib/girl.rb</code> 的原因，但是唉妈呀！又出错了：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="code"><pre>F

Failures:

  <span class="number">1</span>) Girl has chance?
     Failure/<span class="keyword">Error</span>: Girl.chance?.should be_true
     NoMethodError:
       undefined method `chance?<span class="comment">' for Girl:Class</span>
     # ./spec/girl_spec.rb:<span class="number">5</span>:<span class="keyword">in</span> `block (<span class="number">2</span> levels) <span class="keyword">in</span> &lt;top (required)&gt;<span class="comment">'</span>

Finished <span class="keyword">in</span> <span class="number">0.00056</span> seconds
<span class="number">1</span> example, <span class="number">1</span> failure

Failed examples:
</pre></td></tr></table></figure>

<p>真是完整的错误信息阿！<code>F</code> 告诉我们失败了，就像你在 <code>Test::Unit</code> 里看到的一样，而下面它告诉你详细的错误信息，让你可以即时改正，所以说呢，女生找老公，找程序员是靠谱的了，每天都拼命找哪里犯了错，并且马上改！心动不如马上行动，有兴趣的姑娘立即发短信至 <a href="http://v.youku.com/v_show/id_XMjQzNTkzMDM2.html">13910733521</a>，童叟无欺。</p>
<p>回头看这到底哪儿错了：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre>NoMethodError:
trueundefined method `chance?' <span class="keyword">for</span> Girl:Class
</pre></td></tr></table></figure>

<p>哦，原来我们还没研究出，我们和一个女孩到底有没有戏的方法，让我们现在来定义一个：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre><span class="class"><span class="keyword">class</span> <span class="title">Girl</span>
<span class="title">truedef</span> <span class="title">self</span>.<span class="title">chance</span>?
<span class="title">truetruetrue</span>
<span class="title">trueend</span>
<span class="title">end</span>
</pre></td></tr></table></figure>

<p>这里我们用了 <code>self.chance?</code> ，在类的级别定义。意思是说呢，只要是女孩这个类的，都有戏！如果你没有加这个 <code>self</code> 的话，那就得是属于女孩这个类产生的实体才有戏了。现在我们在运行看看 <code>rspec spec</code> ：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre>.

Finished <span class="keyword">in</span> 0.00367 seconds
1 example, 0 failures
</pre></td></tr></table></figure>

<p>和 <code>Test::Unit</code> 一样，用一个极富深意的点，告诉我们测试通过！太棒了！这是我们写的第一个 RSpec 测试，欢呼！</p>
<p>好，假设今天，你不想要每个是女孩类别的都有戏，这样子太困扰了，每天都被骚扰。你只想要女孩类别所产生的实体有戏就好了。让我们看看怎么做，首先呢，你打开 <code>lib/girl.rb</code> ，并把 <code>self</code> 拿掉：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre><span class="class"><span class="keyword">class</span> <span class="title">Girl</span>
<span class="title">truedef</span> <span class="title">chance</span>?
<span class="title">truetruetrue</span>
<span class="title">trueend</span>
<span class="title">end</span>
</pre></td></tr></table></figure>

<p>并且相应的改动你的 spec：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre>require <span class="comment">'girl'</span>

describe Girl <span class="keyword">do</span>
  it <span class="string">"has chance?"</span> <span class="keyword">do</span>
    Girl.<span class="keyword">new</span>.chance?.should be_true
  <span class="keyword">end</span>
<span class="keyword">end</span>
</pre></td></tr></table></figure>

<p>运行： <code>rspec spec</code> ，呼，终于摆脱了一卡车的女孩了，呵呵！</p>
<p>现在让我们再来往这个测试添点东西，加入一个 <code>taken!</code> 方法，被把走了，也就是说这个女孩没戏了。这个方法呢，在 <code>Girl</code> 对象上创了一个实体变量叫做 <code>@taken</code>，而你将使用 <code>chance?</code> 方法来检验。</p>
<p>首先呢，你得先在测试里，测试这个 <code>taken!</code> 方法，是否是做你想要做的事儿。让我们在 <code>spec/girl_spec.rb</code> 里面再添一个例子：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="code"><pre>require <span class="comment">'girl'</span>

describe Girl <span class="keyword">do</span>
  it <span class="string">"has chance?"</span> <span class="keyword">do</span>
    Girl.<span class="keyword">new</span>.chance?.should be_true
  <span class="keyword">end</span>

  it <span class="string">"taken!"</span> <span class="keyword">do</span>
    girl = Girl.<span class="keyword">new</span>
    girl.taken!
    girl.should be_chance
  <span class="keyword">end</span>
<span class="keyword">end</span>
</pre></td></tr></table></figure>

<p>再我们测试之前，发现到了没有，有木有？你 YRY 了，You Repeat Yourself! 你可以看到我们定义了一个 <code>Girl.new</code> 然后第一个例子里又使用了 <code>Girl.new</code> ，而我们是果断支持 DRY 的，所以...</p>
<p>嗯嗯，让我们思索一下如何整理代码，1, 2, 3 秒，OK! 让我们把 <code>Bacon.new</code> 放到一个 <code>subject</code> 区块。 <code>subject</code> 允许你在所有位于 <code>describe</code> 区块内的测试里建立一个对象的索引。你可以这样定义一个 <code>subject</code> ：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>subject { Girl.<span class="keyword">new</span> }
</pre></td></tr></table></figure>

<p>而现在我们的测试文件：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="code"><pre>require <span class="comment">'girl'</span>

describe Girl <span class="keyword">do</span>

truesubject { Girl.<span class="keyword">new</span> }

  it <span class="string">"has chance?"</span> <span class="keyword">do</span>
    Girl.<span class="keyword">new</span>.chance?.should be_true
  <span class="keyword">end</span>

  it <span class="string">"taken!"</span> <span class="keyword">do</span>
    girl = Girl.<span class="keyword">new</span>
    girl.taken!
    girl.should be_chance
  <span class="keyword">end</span>
<span class="keyword">end</span>
</pre></td></tr></table></figure>

<p>你在这个测试的语境中，宣告了一个 <code>subject</code> ，然后我们来改写一下，比如第一个测试，有没有戏呢，你现在可以这样子替换：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre><span class="function"><span class="title">its</span><span class="params">(:chance?)</span> { <span class="title">should</span> <span class="title">be_true</span> }
</pre></td></tr></table></figure>

<p>这个 <code>its</code> 方法，接受一个方法的名字来调用这个 <code>subject</code> (Ruby 继承自 smalltalk，调用方法其实都是给对象发信息) 。然而后方这个 <code>{ ... }</code> 区块应该要包含一个预测这个方法调用完的结果。</p>
<p>然而我们还可以这样调用：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre>it <span class="string">"taken!"</span> <span class="keyword">do</span>
  subject<span class="variable">.taken</span>!
  subject<span class="variable">.should_not</span> be_chance
<span class="keyword">end</span>
</pre></td></tr></table></figure>

<p>而这里 <code>taken!</code> 方法必须使用 <code>subject</code> 来调用，因为我们只在 <code>Girl</code> 类别里有定义她。在这个情况，你没有使用 <code>its</code> ，因为你想要调用 <code>taken!</code> 方法，并且确认这个方法是否改变了 <code>chance?</code> 方法所返回的结果。</p>
<p>呼，意思就是女孩被追走了，还有没有戏啊？</p>
<p>而为了让我们的代码的可读性更猛一点，我使用了 <code>should_not</code> 来判断 <code>be_chance</code> 。</p>
<p>现在你的 <code>girl_spec.rb</code> 看起来是：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="code"><pre><span class="keyword">require</span> <span class="string">'girl'</span>

describe <span class="constant">Girl</span> <span class="keyword">do</span>

  subject { <span class="constant">Girl</span>.new }

  its(<span class="symbol">:chance?</span>) { should be_true }

  it <span class="string">"taken!"</span> <span class="keyword">do</span>
    subject.taken!
    subject.should_not be_chance
  <span class="keyword">end</span>
<span class="keyword">end</span>
</pre></td></tr></table></figure>

<p>好了，让我们运行看看，土地公公老爷爷阿，究竟女孩与我。。。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre>NoMethodError:
  undefined method `taken!' <span class="keyword">for</span> <span class="preprocessor">#&lt;Girl:0x0000010087bcb0&gt;</span>
</pre></td></tr></table></figure>

<p>搞半天我根本还没定义 <code>taken!</code> 方法啊，失败！立马定义一个，打开 <code>lib/girl.rb</code> ：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="function"><span class="keyword">def</span> <span class="title">taken!</span></span>
trueself.taken = be_true
<span class="keyword">end</span>
</pre></td></tr></table></figure>

<p>OK，再运行一次：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre>NoMethodError:
trueundefined method `taken=' <span class="keyword">for</span> <span class="preprocessor">#&lt;Girl:0x0000010087f838&gt;</span>
</pre></td></tr></table></figure>

<p>呜呜，咋回事儿呢？</p>
<p>原来我用了 <code>self.taken = true</code> ，Ruby 在跟我抱怨找不到这个 <code>taken=</code> 方法。我们可以使用 Ruby 提供的 <code>attr_accessor</code> 方法来定义这些琐碎的 <code>getter/setter</code> : ） 添加这行代码至 <code>lib/girl.rb</code> 最上方：</p>
<p><code>attr_accessor :taken</code></p>
<p>这里 <code>attr</code> 是 attribute 的缩写，学 Ruby 还学英语呢，真好！当你把一个符号（符号是一个冒号带名字 <code>:xxx</code>）传给这个 <code>attr_accessor</code> 方法时，它替你定义了把 <code>taken</code> 设定与取出值的方法。它也替你定义了一个实体变量叫做 <code>@taken</code> 给每一个这个类别的对象设值时使用。</p>
<p>好的，咱的女孩儿现在看起来像是这样：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="code"><pre><span class="class"><span class="keyword">class</span> <span class="title">Girl</span>

<span class="title">trueattr_accessor</span> :<span class="title">taken</span>

<span class="title">truedef</span> <span class="title">chance</span>?
<span class="title">truetruetrue</span>
<span class="title">trueend</span>

<span class="title">truedef</span> <span class="title">taken</span>!
<span class="title">truetrueself</span>.<span class="title">taken</span> = <span class="title">true</span>
<span class="title">trueend</span>

<span class="title">end</span>
</pre></td></tr></table></figure>

<p>再运行一次 <code>rspec spec</code>，月老公公老奶奶阿，看你的了阿：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre><span class="title">expected</span> chance? to return <span class="built_in">false</span>, got <span class="built_in">true</span>
</pre></td></tr></table></figure>

<p>唔？预期没戏，返回的结果是有戏，怎么会这样呢？哎呀，因为 <code>chance?</code> 永远都返回真嘛，我们应该要判断这个女孩是否被把走了，然后再下手。。。嗯嗯嗯：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="function"><span class="keyword">def</span> <span class="title">chance?</span></span>
<span class="keyword">true</span>!taken
<span class="keyword">end</span>
</pre></td></tr></table></figure>

<p>运行 <code>rspec spec</code> !</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre><span class="string">.</span><span class="string">.</span>

<span class="comment">Finished</span> <span class="comment">in</span> <span class="comment">0</span>.<span class="comment">00917</span> <span class="comment">seconds</span>
<span class="comment">2</span> <span class="comment">examples</span>, <span class="comment">0</span> <span class="comment">failures
</pre></td></tr></table></figure>

<p>阿哈，终于成功了！！！！！！！！</p>
<p>但是，要是我们粗心大意，不小心忘了加 <code>self</code> 前缀呢？现在让我们把 <code>self.taken</code> 的 <code>self</code> 拿掉看看。。。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="number">1</span>) Girl taken!
   Failure/Error: subject<span class="variable">.should_not</span> be_chance
     expected chance? to <span class="keyword">return</span> <span class="literal">false</span>, got <span class="literal">true</span>
</pre></td></tr></table></figure>

<p>RSpec 告诉我们：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="number">1</span>) 女孩被把了！
<span class="literal">true</span>失败 / 错误：subject<span class="variable">.should_not</span> be_chance
<span class="literal">true</span>预期没戏，却有戏。
</pre></td></tr></table></figure>

<p>这样还不用 RSpec 么？太牛了！哈哈哈哈。。。</p>
<p>好啦，RSpec 可以避免我们犯这种明显的错误，若犯错，即改之。如果你先写测试，然后让你的代码通过测试，你就会有很强大的自信，你的代码是工作的！而之后重构时，也可以一点一点的重构，在跑的过测试的前提之下。</p>
<p>好的，我们把它改回正确的吧：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="function"><span class="keyword">def</span> <span class="title">taken!</span></span>
trueself.taken = <span class="keyword">true</span>
<span class="keyword">end</span>
</pre></td></tr></table></figure>

<p>运行成功。。。</p>
<p>OK! 现在你对 RSpec 有了基础的认识，之后当你想要这样子开发你的应用时，当然不是我这样子轻浮的方式，是用行为驱动开发方式来开发应用时，你将会需要看看这本书：<a href="http://pragprog.com/book/achbd/the-rspec-book">The RSpec Book</a>。</p>
<p>最后，路上把妹的时候要注意阿各位，记得先测试一下。</p>
<p>待续。。。</p>
<p>延伸阅读：</p>
<p><a href="http://pragprog.com/book/achbd/the-rspec-book">The RSpec Book</a></p>
<p><a href="http://www.slideshare.net/ihower/rspec-7394497">RSpec 让你愛上写测试</a></p>
<p><a href="http://jhjguxin.sinaapp.com/2012/02/26/rspec-best-practices-and-tips/">RSpec Best practices and tips</a></p>
<p><a href="http://blog.csdn.net/onlyqi/article/details/6740930">CSDN 一篇不错的 对测试的认识</a></p>
<p><a href="http://www.letrails.cn/archives/20/">RSpec 简明指南</a></p>
<p><a href="http://vdisk.weibo.com/s/4vJBP">RSpec on Rails PDF</a></p>
<p><a href="http://bookapp.book.qq.com/origin/book/?workid=1956140">低成本泡妞</a></p>
]]></content>
    <category scheme="http://lisp.es//tags/Rails/" term="Rails"/>
    <category scheme="http://lisp.es//categories/Rails/" term="Rails"/>
  </entry>
</feed>
