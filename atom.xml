<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[I'm Juanito Fatas]]></title>
  <subtitle><![CDATA[C-x C-f...C-x C-s...]]></subtitle>
  <link href="http://lisp.es//atom.xml" rel="self"/>
  <link href="http://lisp.es/"/>
  <updated>2013-07-01T18:48:07.199Z</updated>
  <id>http://lisp.es//</id>
  <author>
    <name><![CDATA[Juanito Fatas]]></name>
    <email><![CDATA[katehuang0320@gmail.com]]></email>
  </author>
  <generator uri="http://zespia.tw/hexo">Hexo</generator>
  <entry>
    <title type="html"><![CDATA[Hello Ruby，走進琳達里優可絲的夢遊仙境。]]></title>
    <link href="http://lisp.es//2013/07/02/hello-ruby/"/>
    <id>http://lisp.es//2013/07/02/hello-ruby/</id>
    <published>2013-07-01T17:57:51.000Z</published>
    <updated>2013-07-01T18:48:03.000Z</updated>
    <content type="html"><![CDATA[<p>來分享一下，一個人、一本書。</p>
<p>那個人？<a href="http://lindaliukas.fi/">Linda Liukas</a>，Rails Girls 共同創辦人，Codecademy 的社群管理員。2013 年的 Ruby 英雄。哪本書？由她所寫的 Ruby 童書<a href="http://helloruby.com/">《Hello Ruby》</a>，我是從 Heroku Waza 2013 Conf 看到的一個影片，由 Codecademy 的 Linda 小姐帶來的題目：人人有程編，發現到這位 Linda 小姐。</p>
<p>她分享了兩個故事，前半段簡略的講了下《Hello Ruby》，後半段講她的心路歷程，提到編程世界的女權問題、教學問題、文化問題，很精采也很有感染力，我就不多說了，留給你與她來一個面對面的交流！</p>
<p>我這邊稍稍介紹下《Hello Ruby》。</p>
<p>由 Linda Liukas (念法：琳達●里優可絲）撰寫的 Ruby 童書，《Hello Ruby》，不久之後即將推出，這是一本什麼樣的書呢？</p>
<p>故事的內容大概是這樣：有一個古靈精怪充滿好奇心、調皮搗蛋又頑強的可愛小女孩，叫做“露比”，</p>
<p><img src="https://raw.github.com/JuanitoFatas/Foto/master/hello-ruby/01-little-ruby.png" alt=""></p>
<p>有一天，她與她的好朋友，“潔姆絲”們，在一起玩耍，突然間北風叔叔來了，北風叔叔把她的好朋友潔姆絲吹走了，散落到世界各地。於是露比踏上了冒險的旅途，要找回她的好朋友們。在旅途當中，她碰到許許多多的人，並在旅途中，向遇到的人們尋求幫助。</p>
<p><img src="https://raw.github.com/JuanitoFatas/Foto/master/hello-ruby/02-android.png" alt=""></p>
<p>有一次她遇到了機器人安卓依，有數以百計的安卓依，正在快樂地烘焙拐杖糖、餅乾、牛奶與彩虹糖，她問安卓依有看到潔姆絲嗎？安卓依們看起來很奇怪，總是同時一起說話，她感到很混亂，但仍然很喜歡安卓依。</p>
<p><img src="https://raw.github.com/JuanitoFatas/Foto/master/hello-ruby/03-snow-leopard.png" alt=""></p>
<p>她遇到了喜歡簡單美好事物的的美麗小雪豹：絲諾梨歐趴，小雪豹喜歡一人獨處，但她與 Ruby 相處的很好。</p>
<p><img src="https://raw.github.com/JuanitoFatas/Foto/master/hello-ruby/04-penguins.png" alt=""></p>
<p>她遇到了充滿好奇心的小企鵝們，小企鵝們很愛胡思亂想也很聒噪，有著許許多多的意見，有時候露比聽不懂小企鵝們在說什麼，但她認為小企鵝們很聰明並有很多知識。</p>
<p><img src="https://raw.github.com/JuanitoFatas/Foto/master/hello-ruby/05-firefox.png" alt=""></p>
<p>她遇到了小火狐，小火狐喜歡很多小東西，就如同她喜歡與小露比一起玩。</p>
<p><img src="https://raw.github.com/JuanitoFatas/Foto/master/hello-ruby/06-Django.png" alt=""></p>
<p>她遇到了一個小男孩，嬉皮士姜狗，姜狗試著要與露比來一場對決。。。</p>
<p>露比的朋友每個都很不一樣，每個人都不是完美的，有著各自調皮的地方，露比從他們每個人身上學到許多東西，而這個世界需要他們。</p>
<p><img src="https://raw.github.com/JuanitoFatas/Foto/master/hello-ruby/07-magic-book.png" alt=""></p>
<p>Linda Liukas 如是說：“我相信每個人小時候，都有一本屬於童年的魔法書。一本讓你看到世界是如此美麗，充滿著無限可能性的一本魔法書。而這本是我的魔法書（笑）。”</p>
<p>聽聽她精妙絕倫的演講，找回編程最初的感動吧！</p>
<p>傳送門：<a href="https://vimeo.com/61113155">https://vimeo.com/61113155</a></p>
<p><del>梨窩好可愛，她～好～正～啊～</del></p>
]]></content>
    <category scheme="http://lisp.es//tags/ruby/" term="ruby"/>
    <category scheme="http://lisp.es//categories/ruby/" term="ruby"/>
  </entry>
  <entry>
    <title type="html"><![CDATA[在 Sublime Text 里面运行 Ruby 测试]]></title>
    <link href="http://lisp.es//2013/06/20/ruby-test-in-sublime-with-spork/"/>
    <id>http://lisp.es//2013/06/20/ruby-test-in-sublime-with-spork/</id>
    <published>2013-06-19T17:08:44.000Z</published>
    <updated>2013-06-19T17:10:52.000Z</updated>
    <content type="html"><![CDATA[<ol>
<li>安装 package:</li>
</ol>
<p>安装办法见 Ruby Tests GitHub 说明页面：<a href="https://github.com/maltize/sublime-text-2-ruby-tests">https://github.com/maltize/sublime-text-2-ruby-tests</a></p>
<p>安装好后，重启 Sublime Text，RubyTest 提供了以下热键：</p>
<ul>
<li>Command-Shift-R: run a single test (if run on an it block) or group of tests (if run on a describe block)</li>
<li>Command-Shift-E: run the last test(s)</li>
<li>Command-Shift-T: run all the tests in current file</li>
</ul>
<p>由于测试总运行的暴慢，能单独运行是非常好的。</p>
<p>一个工作流程示例：</p>
<ol>
<li>终端启动 Spork。</li>
<li>写个测试。</li>
<li>Command-Shift-R 确保测试为失败（红灯）。</li>
<li>写相应的代码。</li>
<li>Command-Shift-E 运行刚刚的测试，确保测试通过（绿灯）。</li>
<li>反覆操作 2-5。</li>
</ol>
<p>等代码写到一个阶段的时候， <del>或是女朋友来了</del> ，则抓紧时间运行 <code>rspec spec/</code> ，来确保整组测试通过。</p>
]]></content>
    <category scheme="http://lisp.es//tags/Test/" term="Test"/>
    <category scheme="http://lisp.es//tags/Ruby/" term="Ruby"/>
    <category scheme="http://lisp.es//tags/Spork/" term="Spork"/>
    <category scheme="http://lisp.es//tags/Sublime-Text/" term="Sublime Text"/>
    <category scheme="http://lisp.es//tags/Rails/" term="Rails"/>
    <category scheme="http://lisp.es//categories/Rails/" term="Rails"/>
  </entry>
  <entry>
    <title type="html"><![CDATA[JQuery bind() live() delegate() on() 差别]]></title>
    <link href="http://lisp.es//2012/11/21/jquery-bind-live-delegate/"/>
    <id>http://lisp.es//2012/11/21/jquery-bind-live-delegate/</id>
    <published>2012-11-21T13:43:00.000Z</published>
    <updated>2012-11-24T06:21:32.000Z</updated>
    <content type="html"><![CDATA[<h2>bind() live() delegate()...and on()</h2>
<p><strong>这些都是干嘛的？</strong></p>
<p><strong>为什么我们需要这些方法？</strong></p>
<p>首先给一个示例用 html:</p>
<script src="https://gist.github.com/4124940.js"></script>

<p>很好！ 让我们开始吧！</p>
<a name="more"></a>

<p>假定今天我们想要在按下 <code>h2</code> 的时候，克隆几个 <code>h2</code> 出来吓唬吓唬人，</p>
<p>展示咱的 jQuery 水平，哈哈，该怎么做？</p>
<p>首先我们必须在给 h2 绑个 click 事件，可以在 <strong>自调用函数</strong> 内加入这段代码：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'h2'</span>).on(<span class="string">'click'</span>, ...);
</pre></td></tr></table></figure>

<p>或是用 jQuery 提供的辅助方法 (helper)：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'h2'</span>).click(...);
</pre></td></tr></table></figure>

<p>但秉持著爱学习、追根究柢的精神，让我们看看用 <code>click()</code> 跟 <code>on()</code> 方法究竟差在哪里？</p>
<p>打开 jQuery 1.7.1 源代码，看到这段：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="code"><pre>jQuery.each( (<span class="string">"blur focus focusin focusout load resize scroll unload click dblclick "</span> +
<span class="literal">true</span><span class="string">"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave "</span> +
<span class="literal">true</span><span class="string">"change select submit keydown keypress keyup error contextmenu"</span>).split(<span class="string">" "</span>), <span class="keyword">function</span>( i, name ) {

<span class="literal">true</span><span class="comment">// Handle event binding</span>
truejQuery.fn[ name ] = <span class="keyword">function</span>( data, fn ) {
truetrueif ( fn == <span class="literal">null</span> ) {
truetruetruefn = data;
truetruetruedata = <span class="literal">null</span>;
truetrue}

truetruereturn arguments.length &gt; <span class="number">0</span> ?
truetruetruethis.on( name, <span class="literal">null</span>, data, fn ) :
truetruetruethis.trigger( name );
<span class="literal">true</span>};

trueif ( jQuery.attrFn ) {
truetruejQuery.attrFn[ name ] = <span class="literal">true</span>;
<span class="literal">true</span>}

trueif ( rkeyEvent.test( name ) ) {
truetruejQuery.event.fixHooks[ name ] = jQuery.event.keyHooks;
<span class="literal">true</span>}

trueif ( rmouseEvent.test( name ) ) {
truetruejQuery.event.fixHooks[ name ] = jQuery.event.mouseHooks;
<span class="literal">true</span>}
});
</pre></td></tr></table></figure>

<p>有木有看到， <code>.each()</code> 里面那一沱所有的函數，其实最后都会重定向到 <code>on()</code> ：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="keyword">return</span> arguments.length &gt; <span class="number">0</span> ?
truethis.on( name, <span class="literal">null</span>, data, fn ) :
truethis.trigger( name );
</pre></td></tr></table></figure>

<p>老旧的 jQuery 书都使用 bind() 方法来办到这件事：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'h2'</span>).bind(<span class="string">'click'</span>);
</pre></td></tr></table></figure>

<p>思路是这样的，先选出你要操纵的 DOM 元素，绑定事件，说明要干啥，DONE!</p>
<p>这其实没啥不对啦，挺靠谱的，但别这么用了，因为这些 <code>bind()</code> , <code>live()</code> , <code>delegate()</code> 方法啦，</p>
<p>最后还是会回到 <code>on()</code> 的 (jQuery 1.7+)，那为什么我们不保持一致性，使用 <code>on()</code> 就好呢 ^_^?</p>
<p>先讲讲这几个的差别，假定场景为：</p>
<p><strong>只要按下 <code>h2</code> ，就克隆新的 <code>h2</code> 出来，并加至 <code>body</code> 里。</strong></p>
<blockquote>
<p>会用到的工具:
克隆： <code>clone()</code> 接受一个元素，并拷贝一个副本出来。
appendTo(target): 附加到 target 的尾端。</p>
</blockquote>
<p>看看用 bind() 怎么办到...</p>
<h3>bind() &amp; unbind()</h3>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>$(<span class="string">'h2'</span>).bind(<span class="string">'click'</span>, <span class="keyword">function</span>() {
<span class="literal">true</span>$(<span class="keyword">this</span>).clone().appendTo(<span class="string">'body'</span>);
});
</pre></td></tr></table></figure>

<p>这个其实只绑定当下的 4 个 <code>h2</code> ，之后新加入的那个并没有绑定 click 事件。</p>
<p>所以不符合我们的需求：</p>
<p><strong>只要按下 <code>h2</code> ，就克隆新的 <code>h2</code> 出来，并加至 <code>body</code> 里。</strong></p>
<p>那该怎办？</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>$(<span class="string">'h2'</span>).bind(<span class="string">'click'</span>, <span class="keyword">function</span>() {
<span class="literal">true</span>$(<span class="keyword">this</span>).clone(<span class="literal">true</span>).appendTo(<span class="string">'body'</span>);
});
</pre></td></tr></table></figure>

<p><code>clone()</code> 可以传入一个布尔直， 为 <code>true</code> 时就会顺道把绑定在被克隆的元素的事件一起拷贝。</p>
<p>阿哈，problem solved。</p>
<p>现在看看用 <code>live()</code> 怎么搞...</p>
<h3>live() &amp; die()</h3>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>$(<span class="string">'h2'</span>).live(<span class="string">'click'</span>, <span class="keyword">function</span>() {
<span class="literal">true</span>$(<span class="keyword">this</span>).clone().appendTo(<span class="string">'body'</span>);
});
</pre></td></tr></table></figure>

<p><code>live()</code> 跟 <code>bind()</code> 不一样的是，它会给 <code>document</code> 加上一个 event handler，</p>
<blockquote>
<p>live() -- Attach an event handler for all elements which match the current selector, now and in the future.</p>
</blockquote>
<p>上述代码会在 h2 被按下时，执行后面那个函数：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="keyword">function</span>() {
<span class="literal">true</span>$(<span class="keyword">this</span>).clone().appendTo(<span class="string">'body'</span>);
}
</pre></td></tr></table></figure>

<p>阿哈，开启 browser 试试看，成功了，因为 <code>live()</code> 跟 <code>bind()</code> 不一样， <code>bind()</code> 绑定至当下所有的 <code>h2</code> (代价昂贵阿!)，而 <code>live()</code> 是给当下的 document 加一个 event handler()。</p>
<p>在 <code>live()</code> 之后出来了 <code>delegate()</code> ... 让我们接著看</p>
<h3>delegate() undelegate()</h3>
<blockquote>
<p>Attach a handler to one or more events for all elements that match the selector, now or in the future, based on a specific set of root elements.</p>
</blockquote>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>$(<span class="string">'body'</span>).delegate(<span class="string">'h2'</span>, <span class="string">'click'</span>, <span class="keyword">function</span>() {
<span class="literal">true</span>$(<span class="keyword">this</span>).clone().appendTo(<span class="string">'body'</span>);
});
</pre></td></tr></table></figure>

<p>现在让我们看看 jQuery 1.7.1 的源代码。</p>
<p>如果你想找某个方法怎么用，只要这么搜就可以了：</p>
<p><code>method:</code></p>
<p>搜搜看 <code>bind()</code> , <code>live()</code> , <code>delegate()</code> 你会发现，他们只不过是构建在 <code>on()</code> 之上的抽象而已:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="code"><pre><span class="comment">// grab from jQuery 1.7.1 source</span>

truebind: <span class="keyword">function</span>( types, data, fn ) {
truetruereturn <span class="keyword">this</span>.on( types, <span class="literal">null</span>, data, fn );
<span class="literal">true</span>},
<span class="literal">true</span><span class="comment">//...</span>
truelive: <span class="keyword">function</span>( types, data, fn ) {
truetruejQuery( <span class="keyword">this</span>.context ).on( types, <span class="keyword">this</span>.selector, data, fn );
truetruereturn <span class="keyword">this</span>;
<span class="literal">true</span>},
<span class="literal">true</span><span class="comment">//...</span>
truedelegate: <span class="keyword">function</span>( selector, types, data, fn ) {
truetruereturn <span class="keyword">this</span>.on( types, selector, data, fn );
<span class="literal">true</span>},
<span class="literal">true</span><span class="comment">//...</span>
</pre></td></tr></table></figure>

<p>而对应的 <code>unbind()</code> , <code>die()</code> , <code>undelegate()</code> 是构建在 <code>off()</code> 的抽象而已。</p>
<p>So...</p>
<p>为什么不直接使用 <code>on()</code> , <code>off()</code> 就好呢 ^_^...</p>
<p>希望这篇文章对你有帮助。</p>
]]></content>
    <category scheme="http://lisp.es//tags/jQuery/" term="jQuery"/>
    <category scheme="http://lisp.es//categories/jQuery/" term="jQuery"/>
  </entry>
  <entry>
    <title type="html"><![CDATA[Common Lisp 的 Scope 与 Extent]]></title>
    <link href="http://lisp.es//2012/06/05/scope-and-extent-in-cl/"/>
    <id>http://lisp.es//2012/06/05/scope-and-extent-in-cl/</id>
    <published>2012-06-04T16:24:00.000Z</published>
    <updated>2013-07-01T13:22:38.000Z</updated>
    <content type="html"><![CDATA[<h2>为什么要理解 Scope 与 Extent?</h2>
<p>这两个概念在理解许多 Common Lisp 语言的特色时是很有用的，这两个概念出现在某个对象 (object) 或建构子 (construct) 需要被一个程序的某个部分参照时。</p>
<h2>Scope</h2>
<p>Scope 在一个程序中或是一个程序中特定的范围里，参照可能发生的地方。</p>
<h2>Extent</h2>
<p>Extent 参照可能发生的时间区间。</p>
<p>一个简单的例子：</p>
<figure class="highlight lang-cl"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="list">(<span class="title">defun</span><span class="body"> copy-cell <span class="list">(<span class="title">x</span><span class="body">)</span></span>
  <span class="list">(<span class="title">cons</span><span class="body"> <span class="list">(<span class="title">car</span><span class="body"> x)</span></span> <span class="list">(<span class="title">cdr</span><span class="body"> x)</span></span>)</span></span>)</span></span>
</pre></td></tr></table></figure>

<p>在这个例子里，我们只能在 <code>copy-cell</code> 函数主体中来参照到 <code>x</code> 参数，这个就是参数 <code>x</code> 的 scope。而参数 <code>x</code> 的 extent 是当函数 <code>copy-cell</code> 被调用至离开的这段时间区间。但是参数的 extent 是有可能在离开函数后仍存在的，但上面这个简单的例子是不可能发生的。</p>
<p>数种描述 Common Lisp 特别有用的 scope 与 extent:</p>
<ul>
<li>Lexical scope 由某个特殊建构子所建立的程序區塊（通常是一個主體 body）。可以想想 Common Lisp 的 let、defun 所設立的參數。</li>
</ul>
<p>例子 1:</p>
<figure class="highlight lang-cl"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="list">(<span class="title">let</span><span class="body"> <span class="list">(<span class="body"><span class="list">(<span class="title">x</span><span class="body"> <span class="number">1</span>)</span></span>
      <span class="list">(<span class="title">y</span><span class="body"> <span class="number">2</span>)</span></span>)</span></span>
  <span class="list">(<span class="title">+</span><span class="body"> x y)</span></span>)</span></span>
</pre></td></tr></table></figure>

<p>x 与 y 的 scope 就是由 let 建构子所建构的主体。</p>
<p>例子 2:</p>
<figure class="highlight lang-cl"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="list">(<span class="title">defun</span><span class="body"> foo <span class="list">(<span class="title">x</span><span class="body">)</span></span>
true<span class="list">(<span class="title">+</span><span class="body"> x <span class="number">1</span>)</span></span>)</span></span>
</pre></td></tr></table></figure>

<p><code>x</code> 的 scope 在 defun 建构子所建构的主体。</p>
<ul>
<li><p>Indefinite scope. 在程序任何地方都可以參照的叫做 Indefinite scope。</p>
</li>
<li><p>Dynamic extent 参照可以发生在配置 (established) 与释放 (disestablished) entity 时发生。 Entity 通常可以想成是对象 (如 cons 核、符號）、变量绑定或是 go 可以到的地方。什么时候释放呢？在配置的 entity 执行完毕或是终止时。因此有 dynamic extent 的 entity 遵循著一种类似栈的规范，同时有著平行执行嵌套的建构。</p>
</li>
</ul>
<p>例子：<code>with-open-file</code> 建构子开启了一个与文件 (file) 的连接并构造了一个流对象来表示这个连接。流对象有著 <code>indefinite extent</code> ，但开启文件的连接有著 dynamic extent: 当 <code>with-open-file</code> 建构子交出控制权时，流会自动关闭。</p>
<p>例子 2: 一个“特殊”变量的绑定是 dynamic extent。</p>
<ul>
<li>Indefinite extent Entity 在离开建构子所设立的区块时，仍有参照的可能性存在。</li>
</ul>
<p>例子：大多数的 Common Lisp 数据对象 (data objecs) 是 indefinite extent 的。
例子：绑定一个函数 lexcially scoped 的参数是 indefinite extent 的。</p>
<p>考虑以下函数定义：</p>
<figure class="highlight lang-cl"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="list">(<span class="title">defun</span><span class="body"> compose <span class="list">(<span class="title">f</span><span class="body"> g)</span></span>
  #<span class="quoted">'(lambda (x)
      (funcall f (funcall g x)))</span>)</span></span>
</pre></td></tr></table></figure>

<p>当给定两个参数时，返回一个函数作为返回值。参数 <code>f</code> 与 <code>g</code> 的绑定由于返回的函数存在，所以并没有消失。当我们调用这个返回的函数时，我们仍可以参照到 <code>f</code> 与 <code>g</code> 。因此</p>
<figure class="highlight lang-cl"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre><span class="list">(<span class="title">funcall</span><span class="body"> <span class="list">(<span class="title">compose</span><span class="body"> #'sqrt #'abs)</span></span> <span class="number">-9.0</span>)</span></span>
</pre></td></tr></table></figure>

<p>会返回 <code>3.0</code> 。</p>
<p>除了上面这些术语之外，通常我们把 dynamic scope 定义成表示 indefinite scope 与 dynamic extent。所以我们说特殊的变数有著 dynamic scope，或是被 dynamically scoped 了，因为它们有 indefinite scope 与 dynamic extent: 一个特别变数可以在任何地方被参照，只要它的绑定 (binding) 仍有效。</p>
<h2>Shadowing</h2>
<p>以上的定义没有考虑到 Shadowing，当我们定义两个同样名称的 entities 时，第二个会遮蔽了第一个，在这个情况下，我们就无法参照到第一个了。</p>
<p>在 lexcial scope 的情况，如果两个建构子设置了同名的 entities 时，会做嵌套的动作。内部的会遮蔽外部的。举个例子：</p>
<figure class="highlight lang-cl"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre><span class="list">(<span class="title">defun</span><span class="body"> foo <span class="list">(<span class="title">x</span><span class="body"> z)</span></span>
  <span class="list">(<span class="title">let</span><span class="body"> <span class="list">(<span class="body"><span class="list">(<span class="title">z</span><span class="body"> <span class="list">(<span class="title">*</span><span class="body"> x <span class="number">2</span>)</span></span>)</span></span>)</span></span>
    <span class="list">(<span class="title">print</span><span class="body"> z)</span></span>)</span></span>
  z)</span></span>
</pre></td></tr></table></figure>

<p>内部的 <code>z</code> 会是 <code>(* x 2)</code>，而外部的 z 会是传入的参数 <code>z</code> 。</p>
<p>在 dynamic extent 的情况，如果两个 entities 的发生时间区间重叠时，一个会被嵌套在另一个里面。</p>
<p>一个有著 dynamic extent 的 entity 透过名字来参照时，总是参照到最近一次尚未被释放的 (disestablished) entity。比如：</p>
<figure class="highlight lang-cl"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre><span class="list">(<span class="title">defun</span><span class="body"> fun<span class="number">1</span> <span class="list">(<span class="title">x</span><span class="body">)</span></span>
  <span class="list">(<span class="title">catch</span><span class="body"> 'trap <span class="list">(<span class="title">+</span><span class="body"> <span class="number">3</span> <span class="list">(<span class="title">fun2</span><span class="body"> x)</span></span>)</span></span>)</span></span>)</span></span>

<span class="list">(<span class="title">defun</span><span class="body"> fun<span class="number">2</span> <span class="list">(<span class="title">y</span><span class="body">)</span></span>
  <span class="list">(<span class="title">catch</span><span class="body"> 'trap <span class="list">(<span class="title">*</span><span class="body"> <span class="number">5</span> <span class="list">(<span class="title">fun3</span><span class="body"> y)</span></span>)</span></span>)</span></span>)</span></span>

<span class="list">(<span class="title">defun</span><span class="body"> fun<span class="number">3</span> <span class="list">(<span class="title">z</span><span class="body">)</span></span>
  <span class="list">(<span class="title">throw</span><span class="body"> 'trap z)</span></span>)</span></span>
</pre></td></tr></table></figure>

<p>调用 <code>(fun1 7)</code> 的结果会是 <code>10</code>。在 <code>throw</code> 执行时，同时有两个 <code>catch</code> 在监看 <code>trap</code> : 一个由 <code>fun1</code> 配置的，另一个是 <code>fun2</code> 。第二个 <code>fun2</code> 是最新的那个，所以 <code>7</code> 会在 <code>fun2</code> 里返回。从 <code>fun3</code> 内部来看， <code>fun2</code> 遮蔽了 <code>fun1</code> 。</p>
<p>若是 <code>fun2</code> 是这样定义的话：</p>
<figure class="highlight lang-cl"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="list">(<span class="title">defun</span><span class="body"> fun<span class="number">2</span> <span class="list">(<span class="title">y</span><span class="body">)</span></span>
  <span class="list">(<span class="title">catch</span><span class="body"> 'snare <span class="list">(<span class="title">*</span><span class="body"> <span class="number">5</span> <span class="list">(<span class="title">fun3</span><span class="body"> y)</span></span>)</span></span>)</span></span>)</span></span>
</pre></td></tr></table></figure>

<p>那么两个 <code>catch</code> 会有不同的名称，因此 <code>fun1</code> 不会被遮蔽。<code>(fun1 7)</code> 结果会是 <code>7</code>。</p>
]]></content>
    <category scheme="http://lisp.es//tags/lisp/" term="lisp"/>
    <category scheme="http://lisp.es//categories/Lisp/" term="Lisp"/>
  </entry>
  <entry>
    <title type="html"><![CDATA[jQuery 事件简介（下）]]></title>
    <link href="http://lisp.es//2012/05/19/jquery-events-2/"/>
    <id>http://lisp.es//2012/05/19/jquery-events-2/</id>
    <published>2012-05-18T18:40:00.000Z</published>
    <updated>2013-05-18T19:15:29.000Z</updated>
    <content type="html"><![CDATA[<p>注意，若是看不到下方的图片请留言，我再换到 GFW 友好的 HOST 服务上。</p>
<p>其实下面也就一张图。。。</p>
<p>OK，现在你有了基本的事件知识，现在我们看看如何实现一个简单的 FAQ，</p>
<p>型別</p>
<p>给定一个 HTML:</p>
<figure class="highlight lang-html"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="code"><pre>&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
true&lt;meta charset=utf-8&gt;
true&lt;title&gt;jQuery 事件（下）&lt;/title&gt;
true&lt;link rel="stylesheet" href="style.css"&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;dl&gt;
true&lt;dt&gt;FAQ 问题一 &lt;/dt&gt;
true&lt;dd&gt; 答案一 &lt;/dd&gt;
true&lt;dt&gt;FAQ 问题二 &lt;/dt&gt;
true&lt;dd&gt; 答案二 &lt;/dd&gt;
true&lt;dt&gt;FAQ 问题三 &lt;/dt&gt;
true&lt;dd&gt; 答案三 &lt;/dd&gt;
true&lt;dt&gt;FAQ 问题四 &lt;/dt&gt;
true&lt;dd&gt; 答案四 &lt;/dd&gt;
true&lt;dt&gt;FAQ 问题五 &lt;/dt&gt;
true&lt;dd&gt; 答案五 &lt;/dd&gt;
&lt;/dl&gt;

&lt;script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"&gt;&lt;/script&gt;
&lt;script&gt;

&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre></td></tr></table></figure>

<p>以及一些简单的 CSS 样式 <strong>style.css</strong> :</p>
<figure class="highlight lang-css"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="code"><pre><span class="tag">body</span> <span class="rules">{
    <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">960</span>px;</span></span>
    <span class="rule"><span class="attribute">margin</span>:<span class="value"> auto;</span></span>
    <span class="rule"><span class="attribute">text-align</span>:<span class="value"> center;</span></span>
<span class="rule">}</span></span>

<span class="tag">dd</span> <span class="rules">{
    <span class="rule"><span class="attribute">margin</span>:<span class="value"> <span class="number">0</span>;</span></span>
    <span class="rule"><span class="attribute">padding</span>:<span class="value"> <span class="number">1</span>em <span class="number">0</span>;</span></span>
<span class="rule">}</span></span>

<span class="tag">dt</span> <span class="rules">{
    <span class="rule"><span class="attribute">cursor</span>:<span class="value"> pointer;</span></span>
    <span class="rule"><span class="attribute">font-weight</span>:<span class="value"> bold;</span></span>
    <span class="rule"><span class="attribute">font-size </span>:<span class="value"> <span class="number">1.5</span>em;</span></span>
    <span class="rule"><span class="attribute">line-height</span>:<span class="value"> <span class="number">2</span>em;</span></span>
    <span class="rule"><span class="attribute">background</span>:<span class="value"> <span class="hexcolor">#b94846</span>;</span></span>
    <span class="rule"><span class="attribute">border-bottom</span>:<span class="value"> <span class="number">2</span>px solid <span class="hexcolor">#6f2b2a</span>;</span></span>
    <span class="rule"><span class="attribute">border-top</span>:<span class="value"> <span class="number">2</span>px solid white;</span></span>
<span class="rule">}</span></span>

<span class="tag">dt</span><span class="pseudo">:first-child</span> <span class="rules">{ <span class="rule"><span class="attribute">border-top</span>:<span class="value"> none;</span></span> <span class="rule">}</span></span>
<span class="tag">dt</span><span class="pseudo">:nth-last-child(2)</span> <span class="rules">{ <span class="rule"><span class="attribute">border-bottom</span>:<span class="value"> none;</span></span> <span class="rule">}</span></span>

<span class="class">.hide</span> <span class="rules">{ <span class="rule"><span class="attribute">display</span>:<span class="value"> none;</span></span><span class="rule">}</span></span>
</pre></td></tr></table></figure>

<p>注意 <code>dt</code> 下方我们用了一个较深的红色 border，上方用白色 border，来与别的区块做区别。</p>
<figure class="highlight lang-css"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="tag">dt</span><span class="pseudo">:first-child</span> <span class="rules">{ <span class="rule"><span class="attribute">border-top</span>:<span class="value"> none;</span></span> <span class="rule">}</span></span>
<span class="tag">dt</span><span class="pseudo">:nth-last-child(2)</span> <span class="rules">{ <span class="rule"><span class="attribute">border-bottom</span>:<span class="value"> none;</span></span> <span class="rule">}</span></span>
</pre></td></tr></table></figure>

<p>第一行是，最上方的 FAQ 有多馀的白色 border，因为没有上方元素，不需要加上白色来区别。</p>
<p>第二行是，最下方的 FAQ 有多馀的红色 border，因为是最后的元素，不需要加上红色来区别。</p>
<p>我用 <code>2px</code> 让它看起来更明显，实际上你可以使用 <code>1px</code>，或是你喜欢的大小。</p>
<p>你可能会使用 <code>dt:last-child</code> ，这是不对的，请参考我的这篇文章：<a href="http://blog.lisp.tw/blog/2012/05/12/nth-child-common-gotcha/">CSS 一个常见 Nth-child 的误区</a></p>
<img src="https://img.skitch.com/20120518-jgbpd1k1i2cjwt5eq7g31cf5gd.png">

<p>当我们鼠标悬停至 FAQ 标题时 (<code>dt</code>)，就显示相对应的答案 (<code>dd</code>)。</p>
<p><em>下面讲述的代码请放至 <code>&lt;/body&gt;</code> 上方的 script 标签内。</em></p>
<h2>hide() show() fadeIn() slideDown() toggle()</h2>
<p>好，现在让我们看看如何做到隐藏的效果:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
truevar $dd = $(<span class="string">'dd'</span>);

<span class="literal">true</span>$dd.hide();
<span class="literal">true</span><span class="comment">// $dd.toggle();</span>
<span class="literal">true</span><span class="comment">// $dd.show();</span>
<span class="literal">true</span><span class="comment">// $dd.fadeIn();</span>
<span class="literal">true</span><span class="comment">// $dd.slideDown();</span>
})();
</pre></td></tr></table></figure>

<p>你可以试试看我放在注解里的代码，看看是什么效果。</p>
<blockquote>
<p>toggle() 可视变不可视、不可视变可视。</p>
</blockquote>
<p>当我们使用 <code>dd.hide()</code> 的时候，实际上 jQuery 是把 <code>dd</code> 加上 <code>style=&quot;display: none;&quot;</code></p>
<p>第二种方法是先写一个 CSS 类别 <code>.hide { display: none; }</code>，把选中的元素添加类上去：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$dd.addClass(<span class="string">'hide'</span>);
</pre></td></tr></table></figure>

<h2>filter()</h2>
<p>OK。现在我们知道如何先把答案藏起来，不过通常用户来到我们页面时，我们通常会想显示第一个问题及第一个答案：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
truevar $dd = $(<span class="string">'dd'</span>);
<span class="literal">true</span>$dd.(<span class="string">':nth-child(n+4)'</span>).addClass(<span class="string">'hide'</span>);
})();
</pre></td></tr></table></figure>

<p>filter() 函数根据你传入的选择器，返回匹配的元素。</p>
<p>这个博大精深的 <code>:nth-child(n+4)</code> 是啥？看起来好可怕！DONT PANIC! 这是 CSS3 选择器，这其实是说，我要选中由第 4 个开始的所有元素，也就是</p>
<figure class="highlight lang-html"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre>&lt;dl&gt;
true&lt;dt&gt;FAQ 问题一 &lt;/dt&gt;
true&lt;dd&gt; 答案一 &lt;/dd&gt;
true&lt;dt&gt;FAQ 问题二 &lt;/dt&gt;
true&lt;dd&gt; 答案二 &lt;/dd&gt;
true&lt;dt&gt;FAQ 问题三 &lt;/dt&gt;
true&lt;dd&gt; 答案三 &lt;/dd&gt;
true&lt;dt&gt;FAQ 问题四 &lt;/dt&gt;
true&lt;dd&gt; 答案四 &lt;/dd&gt;
true&lt;dt&gt;FAQ 问题五 &lt;/dt&gt;
true&lt;dd&gt; 答案五 &lt;/dd&gt;
&lt;/dl&gt;
</pre></td></tr></table></figure>

<p>1, 2, 3, 4，选中 <code>&lt;dd&gt; 答案二 &lt;/dd&gt;</code> 以及之后所有的元素。你可以试试看 console.log 一下，看看 <code>dd.(&#39;:nth-child(n+4)&#39;)</code> 选中的是什么，你就理解了。</p>
<p>OK. 讲解到这里，差不多 HTML CSS 都讲明白了，接下来看看怎么绑定事件上元素，来实现我们想要的功能。</p>
<h2>mouseenter() siblings()</h2>
<p>先讲简单的方法：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
truevar $dd = $(<span class="string">'dd'</span>);
<span class="literal">true</span>$dd.(<span class="string">':nth-child(n+4)'</span>).addClass(<span class="string">'hide'</span>);

<span class="literal">true</span>$(<span class="string">'dt'</span>).on(<span class="string">'mouseenter'</span>, <span class="keyword">function</span>() {
truetrue$(<span class="keyword">this</span>).next().show();
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>我们给 <code>dt</code> 绑定一个 mouseenter 事件，在鼠标进入 <code>dt</code> 时，我们知道 <code>dd</code> 是 <code>dt</code> 的下一个，我们显示它：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="keyword">this</span>).next().show();
</pre></td></tr></table></figure>

<p>但是显示完我们还得隐藏它：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
truevar $dd = $(<span class="string">'dd'</span>);
<span class="literal">true</span>$dd.(<span class="string">':nth-child(n+4)'</span>).addClass(<span class="string">'hide'</span>);

<span class="literal">true</span>$(<span class="string">'dt'</span>).on(<span class="string">'mouseenter'</span>, <span class="keyword">function</span>() {
truetrue$(<span class="keyword">this</span>).next().siblings(<span class="string">'dd'</span>).hide();
truetrue$(<span class="keyword">this</span>).next().show();
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>我们鼠标移到某个特定 <code>dt</code> 时，把所有 <code>dd</code> 的 <code>siblings(&#39;dd&#39;)</code> 都隐藏起来就可以了。</p>
<p>注意到我故意使用重复的代码，让我们重构它：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
truevar $dd = $(<span class="string">'dd'</span>);
<span class="literal">true</span>$dd.(<span class="string">':nth-child(n+4)'</span>).addClass(<span class="string">'hide'</span>);

<span class="literal">true</span>$(<span class="string">'dt'</span>).on(<span class="string">'mouseenter'</span>, <span class="keyword">function</span>() {
truetrue$(<span class="keyword">this</span>)
truetruetrue.next()
truetruetruetrue.show()
truetruetruetrue.siblings(<span class="string">'dd'</span>)
truetruetruetruetrue.hide();
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>看你是要排成一行，还是像我这样有缩排，喜好问题。</p>
<p>OK. 成功拉，现在让我们加上 animation，与其隐藏，我们可以使用 <code>slideUp() slideDown()</code>：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
truevar $dd = $(<span class="string">'dd'</span>);
<span class="literal">true</span>$dd.(<span class="string">':nth-child(n+4)'</span>).addClass(<span class="string">'hide'</span>);

<span class="literal">true</span>$(<span class="string">'dt'</span>).on(<span class="string">'mouseenter'</span>, <span class="keyword">function</span>() {
truetrue$(<span class="keyword">this</span>)
truetruetrue.next()
truetruetruetrue.slideDown(<span class="number">300</span>)
truetruetruetrue.siblings(<span class="string">'dd'</span>)
truetruetruetruetrue.slideUp(<span class="number">300</span>);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p><code>slideDown()</code>, <code>slideUp()</code> 这种函数你可以传入参数，指定毫秒数，通常 200-400 ms，看起来挺舒服的。</p>
<p>OK. 现在功能出来了，看看有没有什么可以改善的，永远记得，在 <strong>功能完整后再改进</strong> 。</p>
<p>现在我们的代码实际上只用到了一次 <code>$(&#39;dd&#39;)</code>，所以不需要将它存到变量里，节省空间：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){

<span class="literal">true</span>$(<span class="string">'dd'</span>).(<span class="string">':nth-child(n+4)'</span>).addClass(<span class="string">'hide'</span>);

<span class="literal">true</span>$(<span class="string">'dt'</span>).on(<span class="string">'mouseenter'</span>, <span class="keyword">function</span>() {
truetrue$(<span class="keyword">this</span>)
truetruetrue.next()
truetruetruetrue.slideDown(<span class="number">300</span>)
truetruetruetrue.siblings(<span class="string">'dd'</span>)
truetruetruetruetrue.slideUp(<span class="number">300</span>);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>现在看看这行代码：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>$(<span class="string">'dt'</span>).on(<span class="string">'mouseenter'</span>, <span class="keyword">function</span>() {
<span class="literal">true</span>...
}
</pre></td></tr></table></figure>

<p>这行代码不太好，要是咱页面有一百个 <code>dt</code>，那效能不好，最好是你给 <code>dl</code> 上一个 <code>id=&quot;FAQ&quot;</code>，将选择器改为 <code>dl#FAQ</code>，这样子每次我们只会选中 FAQ，而不会去选到其他的，在这里我们演示的关系，选中 <code>$(&#39;dl&#39;)</code> 就好了。</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){

<span class="literal">true</span>$(<span class="string">'dd'</span>).(<span class="string">':nth-child(n+4)'</span>).addClass(<span class="string">'hide'</span>);

<span class="literal">true</span>$(<span class="string">'dl'</span>).on(<span class="string">'mouseenter'</span>, <span class="string">'dt'</span>, <span class="keyword">function</span>() {
truetrue$(<span class="keyword">this</span>)
truetruetrue.next()
truetruetruetrue.slideDown(<span class="number">300</span>)
truetruetruetrue.siblings(<span class="string">'dd'</span>)
truetruetruetruetrue.slideUp(<span class="number">300</span>);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>注意我在 <code>on</code> 函数里又多传了一个参数，<code>&#39;dt&#39;</code> ，这叫做 选择器字串 (slector string)。</p>
<p>现在这整行代码的意思是，当用户鼠标进入 <code>dl</code> 时，选中 <code>dl</code> 的 <code>dt</code>：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'dl'</span>).on(<span class="string">'mouseenter'</span>, <span class="string">'dt'</span>, <span class="keyword">function</span>()
</pre></td></tr></table></figure>

<p>仅仅重构了这一下，我们省去了给所有 <code>dt</code> 加上 event listener，只给特定的 <code>dt</code> 加上 event listener，尽量养成这样子的习惯，首先写一个能动的 jQuery，想想该怎么重构，并重构它。</p>
<p>打完收工。</p>
]]></content>
    <category scheme="http://lisp.es//tags/jQuery/" term="jQuery"/>
    <category scheme="http://lisp.es//categories/jQuery/" term="jQuery"/>
  </entry>
  <entry>
    <title type="html"><![CDATA[jQuery 事件简介（上）]]></title>
    <link href="http://lisp.es//2012/05/18/jquery-events-1/"/>
    <id>http://lisp.es//2012/05/18/jquery-events-1/</id>
    <published>2012-05-18T14:11:00.000Z</published>
    <updated>2013-05-18T19:15:28.000Z</updated>
    <content type="html"><![CDATA[<p>什么是事件？</p>
<p>比如一个链接被按下、鼠标悬停在某元素上面，这都是事件。</p>
<p>假设今天我们想要实现，按下某个按钮套用不同的 CSS。</p>
<p>给定一个 HTML:</p>
<p>型別</p>
<figure class="highlight lang-html"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="code"><pre>&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
true&lt;meta charset=utf-8&gt;
true&lt;title&gt;jQuery 事件（上）&lt;/title&gt;
true&lt;link rel="stylesheet" href="day.css"&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;h1&gt; 我的网站 &lt;/h1&gt;

&lt;button&gt;Day&lt;/button&gt;
&lt;button&gt;Night&lt;/button&gt;

&lt;script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"&gt;&lt;/script&gt;
&lt;script&gt;

&lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;
</pre></td></tr></table></figure>

<p>以及两个 CSS, day.css, night.css:</p>
<h4>night.css</h4>
<figure class="highlight lang-css"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre><span class="tag">body</span> <span class="rules">{
<span class="rule"><span class="attribute">truebackground</span>:<span class="value"> black;</span></span>
<span class="rule"><span class="attribute">truecolor</span>:<span class="value"> white;</span></span>
<span class="rule">}</span></span>
</pre></td></tr></table></figure>

<h4>night.css</h4>
<figure class="highlight lang-css"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="tag">body</span> <span class="rules">{
<span class="rule"><span class="attribute">truebackground</span>:<span class="value"> yellow;</span></span>
<span class="rule">}</span></span>
</pre></td></tr></table></figure>

<p>下面讲述的代码请加至 <code>&lt;/body&gt;</code> 上方的 script 标签内。</p>
<p>当按下 Day 按钮的时候要套用 day.css、按下 Night 按钮的时候要套用 night.css。</p>
<p>OK. 我们要怎么达到我们想做的功能呢？第一是我们要有一个监听按钮状态的方法，给按钮加上 event listener。</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){

})();
</pre></td></tr></table></figure>

<p>首先这个奇怪的:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){

})();
</pre></td></tr></table></figure>

<p>是什么？这是一个 <strong>自调用函数</strong> (self invoke function)。</p>
<p>可以想成是这样子:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre><span class="function"><span class="keyword">function</span> <span class="title">myFunc</span><span class="params">()</span>{</span>

}

myFunc();
</pre></td></tr></table></figure>

<p>这里宣告了 <code>myFunc()</code> ，在碰到这一行： <code>myFunc();</code> 的时候才会调用。</p>
<p>所以：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){

})();
</pre></td></tr></table></figure>

<p>一但载入这个 script 时，就会调用。</p>
<p>OK. 让我们继续往下看，那要怎么加入 event listener 呢？</p>
<h2>click() 函数</h2>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
<span class="literal">true</span>$(<span class="string">'button'</span>).click(<span class="keyword">function</span>() {
truetrueconsole.log(<span class="string">'button was clicked!'</span>);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>这跟 jQuery 说，哈罗，去 DOM 里帮我把 button 的元素都找出来，并在按下时在 cosole 记录信息：<code>&#39;button was clicked!&#39;</code></p>
<p>你可以去浏览器试试看是否成功。</p>
<p>现在我们知道如何加入一个 click 事件，现在让我们看看如何在按下按钮时，换一个 CSS 样式表。</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
<span class="literal">true</span>$(<span class="string">'button'</span>).click(<span class="keyword">function</span>() {
truetrueconsole.log(<span class="string">'button was clicked!'</span>);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<h2>this?</h2>
<p>现在让我们简单的看一下 this。</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
<span class="literal">true</span>$(<span class="string">'button'</span>).click(<span class="keyword">function</span>() {
truetrueconsole.log(<span class="keyword">this</span>);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>这里的 <code>this</code> 会参照到现在被按的这个按钮。但是要注意的是，这个 <code>this</code> 所返回的 <strong>不是</strong> 一个 jQuery 对象，仅是一个 DOM 对象，所以无法继续使用 jQuery 所提供的函数。</p>
<p>那如果我想要使用 <em>this</em> 来得到参照的对象，又想继续使用 jQuery 提供的函数呢？我们可以用 <code>$()</code> 把返回的 DOM 对象包起来：</p>
<p><code>$(this)</code> 呵呵，这样大概理解了吧？</p>
<p>有的时候，我们可能常常要用到 <code>$(this)</code> ，用到两次以上的东西，都用个变量存起来，来避免 jQuery 一直跑到 DOM 查询，假设我们一个页面有三十个按钮，一直重复的去查询 DOM 会大幅降低效能。</p>
<p>比如说上面我们改变了被参照的对象的 text()，之后又替它加上一个类，之后可能又移除那个类：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
<span class="literal">true</span>$(<span class="string">'button'</span>).click(<span class="keyword">function</span>() {
truetrue$(<span class="keyword">this</span>).text(...);

truetrue<span class="comment">// some code goes here...</span>
truetrue$(<span class="keyword">this</span>).addClass(...);

truetrue<span class="comment">// ...other codes</span>
truetrue$(<span class="keyword">this</span>).removeClass(...);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>可以这样子重构代码：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
<span class="literal">true</span>$(<span class="string">'button'</span>).click(<span class="keyword">function</span>() {
truetrue$<span class="keyword">this</span> = $(<span class="keyword">this</span>);
truetrue$<span class="keyword">this</span>.text(...);

truetrue<span class="comment">// some code goes here...</span>
truetrue$<span class="keyword">this</span>.addClass(...);

truetrue<span class="comment">// ...other codes</span>
truetrue$<span class="keyword">this</span>.removeClass(...);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p><code>$this</code> 前面的 <strong>$</strong> 号可以表明这是一个 jQuery 对象，this 可以代表是现在所参照的对象。</p>
<p>这 <code>$this</code> 称为是现在参照的对象 <code>this</code> 的缓存版本 (cached version)。</p>
<h2>attr()</h2>
<p>现在回到我们刚刚的问题，如何按下按钮时，改变 CSS 样式表：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
<span class="literal">true</span>$(<span class="string">'button'</span>).click(<span class="keyword">function</span>() {
truetrue$(<span class="string">'link'</span>).attr(<span class="string">'href'</span>, <span class="string">'night.css'</span>);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>这个 <code>attr()</code> 当传入一个参数时，返回这个参数名字的属性:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre><span class="keyword">var</span> href = $(<span class="string">'link'</span>).attr(<span class="string">'href'</span>);
</pre></td></tr></table></figure>

<p>我们就可以取得一个 link 的 href 属性。</p>
<p>传入两个参数时，是替第一个参数为名的属性设值:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'link'</span>).attr(<span class="string">'href'</span>, <span class="string">'night.css'</span>);
</pre></td></tr></table></figure>

<p>OK. 现在到浏览器试试看，你会发现无论按下哪个按钮时，样式表都会换成 night.css。</p>
<p>这样不行，我们要有一个办法来指定按下 day 按钮时，换成 day.css。</p>
<p>让我们试试看：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
<span class="literal">true</span>$(<span class="string">'button'</span>).click(<span class="keyword">function</span>() {
truetruevar stylesheet = $(<span class="keyword">this</span>).text().toLowerCase();
truetrue$(<span class="string">'link'</span>).attr(<span class="string">'href'</span>, stylesheet + <span class="string">'.css'</span>);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>这样子在按下按钮时，我们得到按下按钮的 text，并转成小写，并替换 link 的 href。</p>
<p>这样是可以工作的，但是会被按钮的 text 限制了 css 文件的名字，以及有很大的不弹性，让我们看看怎么样做的更好：</p>
<p>改动 HTML：</p>
<figure class="highlight lang-html"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre>&lt;button data-file="day"&gt;Day&lt;/button&gt;
&lt;button data-file="night"&gt;Night&lt;/button&gt;
</pre></td></tr></table></figure>

<p>加上 <code>data-file</code> 属性。</p>
<p>也可以自定义属性，只要前缀是 <code>data-</code> 即可，比如 <code>data-yourCustomAttr</code>。</p>
<p>要取得这个 <code>data-file</code>，我们可以用刚刚学过的 <code>attr()</code>，仅传入一个参数：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
<span class="literal">true</span>$(<span class="string">'button'</span>).click(<span class="keyword">function</span>() {
truetruevar stylesheet = $(<span class="keyword">this</span>).attr(<span class="string">'data-file'</span>);
truetrue$(<span class="string">'link'</span>).attr(<span class="string">'href'</span>, stylesheet + <span class="string">'.css'</span>);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>但是 jQuery 有一个更好的方法：<code>data()</code>：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="keyword">this</span>).data(<span class="string">'file'</span>);
</pre></td></tr></table></figure>

<p>这里因为用的是，<code>data()</code> 方法，所以不需要使用多馀的 <code>data-</code> 前缀。</p>
<p>看看这行：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'link'</span>).attr(<span class="string">'href'</span>, stylesheet + <span class="string">'.css'</span>);
</pre></td></tr></table></figure>

<p>每次我们按下按钮时，jQuery 都会跑到 DOM 里面去寻找符合选择器条件的元素，这样非常的没有效率，所以我们可以缓存起来：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
truevar $link = $(<span class="string">'link'</span>);
<span class="literal">true</span>$(<span class="string">'button'</span>).click(<span class="keyword">function</span>() {
truetruevar stylesheet = $(<span class="keyword">this</span>).attr(<span class="string">'data-file'</span>);
truetrue$link.attr(<span class="string">'href'</span>, stylesheet + <span class="string">'.css'</span>);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>现在另一个问题来了，当前是 day.css，按下 night 按钮时，会换成 night.css，换成 night.css 再按下 night 按钮时，还是会调用这个自调用函数，并换成 night.css，这样子还是浪费资源，我们可以：</p>
<ul>
<li><p>停用当前 CSS 的按钮（day.css 就停用 day 按钮、night.css 就停用 night 按钮）</p>
</li>
<li><p>写一个判断式侦测按下按钮是否为现下的 CSS，是的话就不做任何事，不是的话替换成另一个 CSS。</p>
</li>
</ul>
<p>我们试试看第一个方法：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
truevar $link = $(<span class="string">'link'</span>);
<span class="literal">true</span>$(<span class="string">'button'</span>).click(<span class="keyword">function</span>() {
truetruevar $<span class="keyword">this</span> = $(<span class="keyword">this</span>);
truetruevar stylesheet = $<span class="keyword">this</span>.attr(<span class="string">'data-file'</span>);
truetrue$link.attr(<span class="string">'href'</span>, stylesheet + <span class="string">'.css'</span>);
truetrue$<span class="keyword">this</span>.attr(<span class="string">'disabled'</span>, <span class="string">'disabled'</span>);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>这边我们缓存了用到两次的 <code>$(this)</code> : <code>$this</code>。</p>
<p>记得 <code>attr()</code> 一个参数是返回属性、两个是设值：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>$<span class="keyword">this</span>.attr(<span class="string">'disabled'</span>, <span class="string">'disabled'</span>);
<span class="comment">// 等同于</span>
$<span class="keyword">this</span>.attr(<span class="string">'disabled'</span>, <span class="string">''</span>);
</pre></td></tr></table></figure>

<p>传入第二个参数是为了设值的目的。</p>
<p>你到浏览器试试看会发现一旦 disabled 以后，按钮就死了，回不去了。</p>
<h2>siblings()</h2>
<p><code>siblings()</code> 可以取得目前参照对象的 siblings (同层元素)，可以选择性的传入选择器来筛选匹配的元素。</p>
<blockquote>
<p>Get the siblings of each element in the set of matched elements, optionally filtered by a selector.</p>
</blockquote>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
truevar $link = $(<span class="string">'link'</span>);
<span class="literal">true</span>$(<span class="string">'button'</span>).click(<span class="keyword">function</span>() {
truetruevar $<span class="keyword">this</span> = $(<span class="keyword">this</span>);
truetruevar stylesheet = $<span class="keyword">this</span>.attr(<span class="string">'data-file'</span>);

truetrue$<span class="keyword">this</span>.siblings(<span class="string">'button'</span>).removeAttr(<span class="string">'disabled'</span>);

truetrue$link.attr(<span class="string">'href'</span>, stylesheet + <span class="string">'.css'</span>);
truetrue$<span class="keyword">this</span>.attr(<span class="string">'disabled'</span>, <span class="string">'disabled'</span>);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>哎呀，又发现一个可以重构的地方：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="keyword">var</span> $<span class="keyword">this</span> = $(<span class="keyword">this</span>);
<span class="keyword">var</span> stylesheet = $<span class="keyword">this</span>.attr(<span class="string">'data-file'</span>);
</pre></td></tr></table></figure>

<p>尽量使用单一个 var 来宣告变量：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="keyword">var</span> $<span class="keyword">this</span> = $(<span class="keyword">this</span>),
truetruestylesheet = $<span class="keyword">this</span>.attr(<span class="string">'data-file'</span>);
</pre></td></tr></table></figure>

<p>并把相同的代码放在一起、把 <code>$link.attr(...)</code> 移上去，这样下面那行就可以结合：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
truevar $link = $(<span class="string">'link'</span>);
<span class="literal">true</span>$(<span class="string">'button'</span>).click(<span class="keyword">function</span>() {
truetruevar $<span class="keyword">this</span> = $(<span class="keyword">this</span>),
truetruetruetruestylesheet = $<span class="keyword">this</span>.attr(<span class="string">'data-file'</span>);

truetrue$link.attr(<span class="string">'href'</span>, stylesheet + <span class="string">'.css'</span>);

truetrue$<span class="keyword">this</span>
truetruetruetrue.siblings(<span class="string">'button'</span>).removeAttr(<span class="string">'disabled'</span>)
truetruetruetrue.removeAttr(<span class="string">'disabled'</span>);

truetrue$<span class="keyword">this</span>.attr(<span class="string">'disabled'</span>, <span class="string">'disabled'</span>);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>如果这样是不行的：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre>	$<span class="keyword">this</span>
truetruetrue.siblings(<span class="string">'button'</span>).removeAttr(<span class="string">'disabled'</span>)
truetruetrue.removeAttr(<span class="string">'disabled'</span>)
truetruetrue.attr(<span class="string">'disabled'</span>, <span class="string">'disabled'</span>);
</pre></td></tr></table></figure>

<p>因为这时第三行 <code>.attr(&#39;disabled&#39;, &#39;disabled&#39;);</code> 所参照的是 <code>siblings()</code> 而不是本来按下的按钮。</p>
<h2>end() 函数</h2>
<p>如果想要这样子写的话，可以使用 jQuery 的 <code>end()</code> 函数。</p>
<blockquote>
<p>End the most recent filtering operation in the current chain and return the set of matched elements to its previous state.</p>
</blockquote>
<p>终止最近的过滤操作，并返回到先前匹配的状态：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre>	$<span class="keyword">this</span>
truetruetrue.siblings(<span class="string">'button'</span>).removeAttr(<span class="string">'disabled'</span>)
truetruetruetrue.removeAttr(<span class="string">'disabled'</span>)
truetruetruetrue.end()
truetruetrue.attr(<span class="string">'disabled'</span>, <span class="string">'disabled'</span>);
</pre></td></tr></table></figure>

<p>再提一下，这个 <code>click()</code> 函数也可以换成 <code>on()</code> ：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre>$(<span class="string">'button'</span>).click(<span class="keyword">function</span>() { ... }) <span class="comment">// 等同于</span>
$(<span class="string">'button'</span>).on(<span class="string">'click'</span>, <span class="keyword">function</span>() { ... })
</pre></td></tr></table></figure>

<p>我会建议你使用 jQuery 的 <code>on()</code> 函数，这个理由下集再谈吧。</p>
<p>有问题、讲错的欢迎下面留言发问。</p>
]]></content>
    <category scheme="http://lisp.es//tags/jQuery/" term="jQuery"/>
    <category scheme="http://lisp.es//categories/jQuery/" term="jQuery"/>
  </entry>
  <entry>
    <title type="html"><![CDATA[使用 jQuery 查询 DOM]]></title>
    <link href="http://lisp.es//2012/05/18/jquery-query-dom/"/>
    <id>http://lisp.es//2012/05/18/jquery-query-dom/</id>
    <published>2012-05-17T17:04:00.000Z</published>
    <updated>2013-05-18T19:15:28.000Z</updated>
    <content type="html"><![CDATA[<p>哈罗，你又来看我文章了，谢谢，这篇讲的是巨基本的使用 jQuery 来查询 DOM。</p>
<p>给定一个 HTML：</p>
<figure class="highlight lang-html"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre></td><td class="code"><pre>&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
true&lt;meta charset=utf-8&gt;
true&lt;title&gt;&lt;/title&gt;
true&lt;style&gt;
trueli { color: black }
true&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;div class="container"&gt;
true&lt;h1&gt;Welcome to My Website &lt;/h1&gt;
true&lt;p&gt;
truetrueLorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
truetruetempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
truetruequis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
truetrueconsequat.
true&lt;/p&gt;

true&lt;ul class="emphasis"&gt;
truetrue&lt;li&gt;item 1&lt;/li&gt;
truetrue&lt;li&gt;item 2&lt;/li&gt;
truetrue&lt;li&gt;item 3&lt;/li&gt;
truetrue&lt;li&gt;item 4&lt;/li&gt;
truetrue&lt;li&gt;item 5&lt;/li&gt;
truetrue&lt;li&gt;
truetruetrue&lt;ul&gt;
truetruetruetrue&lt;li&gt;hello from the nest.&lt;/li&gt;
truetruetrue&lt;/ul
truetrue&lt;/li&gt;
true&lt;/ul&gt;
&lt;/div&gt;

&lt;script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.js"&gt;&lt;/script&gt;

&lt;script&gt;

&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre></td></tr></table></figure>
型別

为了讲解方便，我直接使用 CDN 来引用 jQuery。之后讲述的代码请放在 <code>&lt;/body&gt;</code> 前面的 <code>&lt;script&gt;</code> 标签内。

OK! 开始！

## children() find() next() prev() first()

假设今天我们想要选中类是 emphasis 的 <code>ul</code>：

<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'ul.emphasis'</span>);
</pre></td></tr></table></figure>

<p>上面这行：嘿，jQuery，帮我根据这个 CSS 选择器 <code>ul.emphasis</code> 去 DOM 把符合条件的找出来。</p>
<p>取出 <code>ul</code> 的第一个 <code>li</code> ，并添加绿色：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'ul.emphasis'</span>).children(<span class="string">'li'</span>).css(<span class="string">'color'</span>, <span class="string">'green'</span>);
</pre></td></tr></table></figure>

<p>这等同于 CSS:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>ul.emphasis &gt; li { color: green; }
</pre></td></tr></table></figure>

<p><strong>注意</strong> 这个 <code>&gt;</code> 在这边起的作用，这说明了我们只选中第一阶层的小孩，direct children。</p>
<p>试试看这个代码</p>
<p>你会发现嵌套的那个 ul li 是黑色，不是绿色。这样应该明白 direct children 了吧。</p>
<p>你也可以使用 jQuery 的 <code>find</code> 来找到：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'ul.emphasis'</span>).find(<span class="string">'li'</span>).css(<span class="string">'color'</span>, <span class="string">'green'</span>);
</pre></td></tr></table></figure>

<p>但要注意的是，这会从 <code>ul.emphasis</code> 搜寻所有的 li (all descendent)，等同于 CSS 的：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>ul.emphasis li { color: green; }
</pre></td></tr></table></figure>

<p>好，现在我们在 <code>style</code> 标签内添加一个样式：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>.emphasis { color: green; }
</pre></td></tr></table></figure>

<p>并移除刚刚那行代码。</p>
<p>现在我们想替 <code>ul.emphasis</code> 的第一个 <code>li</code> 加上类名的办法来上色，该怎么做呢？</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre>$(<span class="string">'ul.emphasis'</span>).children(<span class="string">'li:nth-child(1)'</span>).addClass(<span class="string">'emphasis'</span>);
<span class="comment">// 或是</span>
$(<span class="string">'ul.emphasis'</span>).find(<span class="string">'li:nth-child(1)'</span>).addClass(<span class="string">'emphasis'</span>);
<span class="comment">// 或是</span>
$(<span class="string">'ul.emphasis'</span>).children(<span class="string">'li:first'</span>).addClass(<span class="string">'emphasis'</span>);
</pre></td></tr></table></figure>

<p>你可能会说，干嘛不用 CSS 就好了，因为使用 jQuery 的话，这些新潮的 CSS3 选择器可以支援 IE6+。</p>
<p>都是万恶的 IE 害的，呜呜。。。</p>
<p>注意这行代码内的选择器：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'ul.emphasis'</span>).children(<span class="string">'li:first'</span>).addClass(<span class="string">'emphasis'</span>);
</pre></td></tr></table></figure>

<p>不是 CSS 的选择器，而是 jQuery 提供的 Helper。如果有自带的 CSS 选择器可用的话，就使用 CSS 选择器，再来才是使用 jQuery 提供的 Helper。因为这比使用 jQuery 提供的来得快一点点。</p>
<p>刚刚那行代码，使用 CSS 有的选择器：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'ul.emphasis'</span>).children(<span class="string">'li:first-child'</span>).addClass(<span class="string">'emphasis'</span>);
</pre></td></tr></table></figure>

<p>好，那 jQuery 还有别的方法可用吗，有：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'ul.emphasis'</span>).children(<span class="string">'li'</span>).first().addClass(<span class="string">'emphasis'</span>);
</pre></td></tr></table></figure>

<p>我们用了一个 jQuery 提供的 <code>first()</code>，作用一样。</p>
<p>那想选中第二个 <code>li</code> (item2) 呢，并把文字改为 Hello from jQuery？</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>$(<span class="string">'ul.emphasis'</span>).children(<span class="string">'li:nth-child(2)'</span>).text(<span class="string">'Hello from jQuery'</span>);
<span class="comment">// 或是</span>
$(<span class="string">'ul.emphasis'</span>).children(<span class="string">'li'</span>).eq(<span class="number">1</span>).text(<span class="string">'Hello from jQuery'</span>);
</pre></td></tr></table></figure>

<p>注意到，<code>eq(1)</code>，因为 Javascript 跟大多数程序语言一样是 <strong>零索引的</strong> ，从零开始数。</p>
<p>好如果我想要先选中 item2，再往后一个，该怎么写呢：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'ul.emphasis'</span>).children(<span class="string">'li'</span>).eq(<span class="number">1</span>).next().text(<span class="string">'Hello from jQuery'</span>);
</pre></td></tr></table></figure>

<p>这串长不拉机的东东有个术语叫做 <em>chaining</em> ，它能这么干的原因是每一个调用都返回一个 jQuery 对象。</p>
<p>但是别 chian 的太长了。</p>
<p>有 <code>next()</code> 也有 <code>prev()</code> 。</p>
<p>一个要写出 jQuery 的秘诀是写之前先念一遍，再直观地写出来，大部分都是对的哈哈。</p>
<p>不过这个贼长的 jQuery 你一般都会写成：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>$(<span class="string">'ul.emphasis'</span>).children(<span class="string">'li'</span>).eq(<span class="number">1</span>).next().text(<span class="string">'Hello from jQuery'</span>);
<span class="comment">// better</span>
$(<span class="string">'ul.emphasis li:nth-child(2)'</span>).text(<span class="string">'Hello from jQuery'</span>);
</pre></td></tr></table></figure>

<p>chaining 比较慢，代码也比较长，但你还是会需要动态地使用 chaining。</p>
<p>这么长的代码也可以这样缩排：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre>$(<span class="string">'ul.emphasis'</span>).children(<span class="string">'li'</span>).eq(<span class="number">1</span>).next().text(<span class="string">'Hello from jQuery'</span>);

<span class="comment">// 等同于</span>
$(<span class="string">'ul.emphasis'</span>)
truetrue.children(<span class="string">'li'</span>)
truetruetrue.eq(<span class="number">1</span>)
truetruetrue.next().text(<span class="string">'Hello from jQuery'</span>);
</pre></td></tr></table></figure>

<h2>parent() parents() closest()</h2>
<p>HTML 实际上就是一个语法树，不懂语法树就想成家庭树，有爷爷奶奶老爸老妈儿子女儿孙子孙女。</p>
<p>好，看个例子，今天我们想要移除 <code>li</code> 的父节点的类别</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(li).parent().removeClass(<span class="string">'emphasis'</span>);
</pre></td></tr></table></figure>

<p>也可以显式指定要找的 parent 的类型：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(li).parent(<span class="string">'ul'</span>).removeClass(<span class="string">'emphasis'</span>);
</pre></td></tr></table></figure>

<p>你可以使用浏览器的开发工具查看源代码来检查是否移除成功。</p>
<p>现在让我们加入一个新样式：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>.container { color: green; }
</pre></td></tr></table></figure>

<p>刷新页面，整面绿油油。如果我不想要整片绿油油，我想要移除 parent 的类：container，</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(li).parent(<span class="string">'.container'</span>).removeClass(<span class="string">'emphasis'</span>);
</pre></td></tr></table></figure>

<p>刷新页面，擦，没作用，这是因为这跟 direct children 一样，只会找到上一层的 parent，如果我把 parent 换成：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(li).parents(<span class="string">'.container'</span>).removeClass(<span class="string">'emphasis'</span>);
</pre></td></tr></table></figure>

<p>注意那个 <strong>s</strong> ，这样就会像 <code>find</code> 一样，一直往上找。</p>
<p>你也可以更具体的说，你要移除的是这个 <code>div.container</code> 元素:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(li).parents(<span class="string">'div.container'</span>).removeClass(<span class="string">'emphasis'</span>);
</pre></td></tr></table></figure>

<p>而这行代码等同于：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(li).closest(<span class="string">'div.container'</span>).removeClass(<span class="string">'emphasis'</span>);
</pre></td></tr></table></figure>

<p>让我们到 <a href="http://api.jquery.com/">http://api.jquery.com/</a> 查查这个函数是干嘛使的。</p>
<h2>.closest()</h2>
<blockquote>
<p>Get the first element that matches the selector, beginning at the current element and progressing up through the DOM tree.</p>
</blockquote>
<p>我们这个例子是，从 <code>$(li)</code> 开始往上爬 DOM 树，寻找第一个匹配 <code>(&#39;div.container&#39;)</code> 的元素。</p>
<h2>.removeClass()</h2>
<blockquote>
<p>Remove a single class, multiple classes, or all classes from each element in the set of matched elements.</p>
</blockquote>
<p>移除匹配元素集合中的每一个元素的单一、多个或整个类别。</p>
<h2>parents() 与 closest() 的差异？</h2>
<p>其实是一个微妙的差异，你可以研读一下 API，或是这次我直接跟你说了吧：</p>
<p><code>parents()</code> 会根据选择器条件，往上爬树，找出所有符合的。</p>
<p><code>closest()</code> 只会根据选择器条件，找到最近符合的那一个。</p>
<p>查询 API 与源代码是学习 jQuery 的不二法门。</p>
<p>本篇结束。</p>
]]></content>
    <category scheme="http://lisp.es//tags/jQuery/" term="jQuery"/>
    <category scheme="http://lisp.es//categories/jQuery/" term="jQuery"/>
  </entry>
  <entry>
    <title type="html"><![CDATA[jQuery 1.7 介绍（下）]]></title>
    <link href="http://lisp.es//2012/05/18/jquery-intro-2/"/>
    <id>http://lisp.es//2012/05/18/jquery-intro-2/</id>
    <published>2012-05-17T16:31:00.000Z</published>
    <updated>2013-05-18T19:15:28.000Z</updated>
    <content type="html"><![CDATA[<p>建议不要看我写的文章，赶快到这里学会时下最火最流行的 jQuery!</p>
<p><a href="http://tutsplus.com/course/30-days-to-learn-jquery/">30 天学会 jQuery</a></p>
<h2>＄号</h2>
<p>我希望你还记得 <code>$</code> 号是什么：</p>
<p>型別</p>
<pre><code>window<span class="preprocessor">.jQuery</span> = window.$ = jQuery<span class="comment">;</span>
</code></pre>
<p>拿来引用 jQuery 函数的快捷方式。</p>
<p>首先讲 jQuery 之前，假定我们有一个 HTML 文件：</p>
<figure class="highlight lang-html"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="code"><pre>&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
true&lt;meta charset=utf-8&gt;
true&lt;title&gt;&lt;/title&gt;
true&lt;style&gt;
true.emphasis { font-weight: bold;}
true&lt;/style&gt;
true&lt;script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.js"&gt;&lt;/script&gt;
true&lt;script&gt;

true&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;ul&gt;
true&lt;li&gt;hello&lt;/li&gt;
true&lt;li&gt;hello 2&lt;/li&gt;
true&lt;li&gt;hello 3&lt;/li&gt;
&lt;/ul&gt;

&lt;/body&gt;
&lt;/html&gt;
</pre></td></tr></table></figure>

<p>下面讲述的代码请填入 <code>&lt;/head&gt;</code> 上方的 script 标签内。</p>
<p>OK. 开始。</p>
<p>假设我们要取得 <code>ul</code> 的第一个 <code>li</code>：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'li:first-child'</span>).addClass(<span class="string">'emphasis'</span>);
</pre></td></tr></table></figure>

<p>打开你的浏览器看看，干，怎么不行，这是因为。。。</p>
<p>你的代码放在 head 标签内，下面的 HTML 都还没有载入完毕 (DOM)，就执行了这行代码，执行代码的时候，这会儿根本还没有看到 ul li 呢。</p>
<p>你可以把 <code>&lt;script&gt; ... &lt;/script&gt;</code> 搬到 <code>&lt;/body&gt;</code> 上方，这样就可以了。要是你很坚持你的代码要放在 head 标签内，没问题，使用 jQuery 的 ready 函数：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="keyword">var</span> foo = <span class="keyword">function</span>() {};
$(document).ready(foo);
</pre></td></tr></table></figure>

<p><code>$(document)</code> 叫 jQuery 去把 DOM 抓出来。</p>
<p>等到 document 载入完毕，准备好要给我们玩弄的时候，执行 <code>ready</code> 函数内的 <code>foo</code> 函数。</p>
<p>更简洁的写法、传入匿名函数、或叫回呼函数 (callback function)：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>$(document).ready(<span class="keyword">function</span>() {

});
</pre></td></tr></table></figure>

<p>接下来在这个匿名函数内放入我们之前想做的事儿：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>$(document).ready(<span class="keyword">function</span>() {
truetrue$(<span class="string">'li:first-child'</span>).addClass(<span class="string">'emphasis'</span>);
});
</pre></td></tr></table></figure>

<p>这个 ready 函数会大概每 10 ms 去检查 DOM 准备好给我们玩弄了没，准备好了就执行里面的函数。</p>
<p>把 <code>$(document).ready()</code> 变得更简洁一点：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>$(<span class="keyword">function</span>() {
<span class="literal">true</span>$(<span class="string">'li:first-child'</span>).addClass(<span class="string">'emphasis'</span>);
});
</pre></td></tr></table></figure>

<p>好了，好奇的你又问了，这是为什么？</p>
<p>请看 <a href="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.js">jQuery 源代码</a>，搜索这个关键字 <code>jQuery.fn = jQuery.prototype = {</code></p>
<p>这下面一整段代码，说明了我们调用 jQuery 函数 <code>$()</code> 时，碰到选择器、函数、上下文时该怎么处理。</p>
<p>好，我们现在是传入了一个函数：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>$(<span class="keyword">function</span>() {
<span class="literal">true</span>$(<span class="string">'li:first-child'</span>).addClass(<span class="string">'emphasis'</span>);
});
</pre></td></tr></table></figure>

<p>看到没有，<code>$( function() { ... } )</code>，我们来找找处理传入函数的源代码，一直往下找：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre><span class="comment">// HANDLE: $(function)</span>
<span class="comment">// Shortcut for document ready</span>
} <span class="keyword">else</span> <span class="keyword">if</span> ( jQuery.isFunction( selector ) ) {
truereturn rootjQuery.ready( selector );
}
</pre></td></tr></table></figure>

<p>阿哈，这里写的明明白白，document ready 的缩写。</p>
<p>这里的 <code>selector</code> 就是我们所传入的：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="keyword">function</span>() {
<span class="literal">true</span>$(<span class="string">'li:first-child'</span>).addClass(<span class="string">'emphasis'</span>);
}
</pre></td></tr></table></figure>

<p>而它说:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="keyword">if</span> ( jQuery.isFunction( selector ) ) {
truereturn rootjQuery.ready( selector );
}
</pre></td></tr></table></figure>

<p>如果传入的 <code>selector</code> 是函数的话，返回 <code>rootjQuery.ready( selector );</code></p>
<p>呵呵。。。所以这两段代码是等效的：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre>$(document).ready(<span class="keyword">function</span>() {
<span class="literal">true</span>$(<span class="string">'li:first-child'</span>).addClass(<span class="string">'emphasis'</span>);
});

$(<span class="keyword">function</span>() {
<span class="literal">true</span>$(<span class="string">'li:first-child'</span>).addClass(<span class="string">'emphasis'</span>);
});
</pre></td></tr></table></figure>

<p>很多人觉得使用第二种这个缩写不太好，第一种的可读性比较高，这是你个人的选择，如果你知道你在干什么，两个都很好。</p>
<p>本篇结束。</p>
]]></content>
    <category scheme="http://lisp.es//tags/jQuery/" term="jQuery"/>
    <category scheme="http://lisp.es//categories/jQuery/" term="jQuery"/>
  </entry>
  <entry>
    <title type="html"><![CDATA[jQuery 1.7 介绍（上）]]></title>
    <link href="http://lisp.es//2012/05/17/jquery-intro/"/>
    <id>http://lisp.es//2012/05/17/jquery-intro/</id>
    <published>2012-05-17T15:43:00.000Z</published>
    <updated>2013-05-18T19:15:28.000Z</updated>
    <content type="html"><![CDATA[<p>建议不要看我写的文章，赶快到这里学会时下最火最流行的 jQuery!</p>
<p><a href="http://tutsplus.com/course/30-days-to-learn-jquery/">30 天学会 jQuery</a></p>
<h2>神马是 jQuery？</h2>
<p>地球上最受欢迎的 Javascript 函式库、软件攻城狮必备技能之一、网页看起来美妙的魔法之一。</p>
<p>2012.05.17 现在的版本是 1.7.2。</p>
<p>型別</p>
<h2>去哪里获得 jQuery</h2>
<p>通常有开发版本与生产版本 <strong>32KB</strong> ，建议本地开发使用开发版本 <strong>247KB</strong> ，使用 jQuery 时顺便研读源代码。</p>
<blockquote>
<p>开发版本：无压缩、带注释；生产版本：压缩过、不堪入目。</p>
</blockquote>
<p><a href="http://jquery.com/">jQuery 官网</a></p>
<p>jQuery CDN: <a href="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.js">1.7.2 development</a> <a href="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js">1.7.2 production</a></p>
<blockquote>
<p>不建议使用 CDN，可以参考我的不要使用 CDN 来放第三方 Javascript</p>
</blockquote>
<h2>怎么在 HTML 里面玩弄 Javascript 代码</h2>
<p>把 JS 代码放在 script 标签内即可。</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>&lt;script&gt;

&lt;<span class="regexp">/script&gt;
</pre></td></tr></table></figure>

<h2>如何引用 jQuery 至你的 HTML</h2>
<p>假设我有一个 app 目录，下面有一个 js 文件夹、一个 index.html，js 目录下有一个 jquery-1.7.1.js。</p>
<p>使用 script 标签引用：</p>
<figure class="highlight lang-html"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>&lt;script src="js/jquery-1.7.1.js"&gt;&lt;/script&gt;
</pre></td></tr></table></figure>

<p>使用 CDN 引用：</p>
<figure class="highlight lang-html"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>&lt;script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.js"&gt;&lt;/script&gt;
</pre></td></tr></table></figure>

<p><strong>建议摆放位置</strong> <code>&lt;/body&gt;</code> 标签的正上方。</p>
<p>理由：浏览器一旦碰到 script 得载入完或下载完才会继续往下载入，所以放在 <code>&lt;/body&gt;</code> 上方可以确保你的页面先载入 HTML 以及 CSS。</p>
<h2>第一个 jQuery 代码</h2>
<h3>如何引用 jQuery?</h3>
<p>jQuery 其实就是一个函数，你可以这样子引用它：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>jQuery(...)
</pre></td></tr></table></figure>

<p>好，让我们看看怎么让 jQuery 玩弄页面的 CSS。</p>
<p>假设我们有一个 HTML 页面:</p>
<figure class="highlight lang-html"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="code"><pre>&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
true&lt;meta charset=utf-8&gt;
true&lt;title&gt;&lt;/title&gt;
true&lt;style&gt;
true.emphasis{ color: green; }
true&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;ul&gt;
true&lt;li&gt;hello&lt;/li&gt;
true&lt;li&gt;hello 2&lt;/li&gt;
true&lt;li&gt;hello 3&lt;/li&gt;
&lt;/ul&gt;
&lt;script src="js/jquery-1.7.1.js"&gt;&lt;/script&gt;
&lt;script&gt;

&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre></td></tr></table></figure>

<p>以下代码添加至 <code>&lt;/body&gt;</code> 上方的 script 标签。</p>
<p>要怎么样用 jQuery 来添加 CSS 样式？</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>jQuery(<span class="string">'ul li'</span>);
</pre></td></tr></table></figure>

<p>这一行的作用是，你跟 jQuery 说，帮我根据这个 CSS 选择器搜寻一下 DOM。</p>
<p>存到一个变量里，并打印到浏览器的 console 看看：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="keyword">var</span> lis = jQuery(<span class="string">'ul li'</span>);
console.log(lis);
</pre></td></tr></table></figure>

<p>阿哈，你打开浏览器、打开开发者工具，切换到 console tab，会看到</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>[&lt;li&gt;​hello​&lt;<span class="regexp">/li&gt;​, &lt;li&gt;​hello 2​&lt;/</span>li&gt;​, &lt;li&gt;​hello <span class="number">3</span>​&lt;<span class="regexp">/li&gt;​]
</pre></td></tr></table></figure>

<p><code>console.log()</code> 可以当之后调试代码的手段之一。</p>
<p>猛阿，基本上只要懂 CSS 选择器，jQuery 几乎都学会了！呵呵。。。</p>
<p>再举个例子，怎么给这些清单元素添加红色呢？</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>jQuery(<span class="string">'ul li'</span>).css(<span class="string">'color'</span>,<span class="string">'red'</span>);
</pre></td></tr></table></figure>

<blockquote>
<p>尽量把所有的样式交给 CSS 来做，你偶尔才会需要用到 jQuery 来更改样式。</p>
</blockquote>
<p>另一个例子，给这些清单元素添加 <code>style</code> 标签内的 <code>.emphasis</code> 这个类：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>jQuery(<span class="string">'ul li'</span>).addClass(<span class="string">'.emphasis'</span>);
</pre></td></tr></table></figure>

<h3>使用缩写引用 jQuery</h3>
<p>这一行</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>jQuery(<span class="string">'ul li'</span>).addClass(<span class="string">'.emphasis'</span>);
</pre></td></tr></table></figure>

<p>等同于</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'ul li'</span>).addClass(<span class="string">'.emphasis'</span>);
</pre></td></tr></table></figure>

<p>等同于</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>window.jQuery(<span class="string">'ul li'</span>).addClass(<span class="string">'.emphasis'</span>);
</pre></td></tr></table></figure>

<p><strong>你怎么知道的！？</strong></p>
<p>请看 <a href="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.js">jQuery 源代码</a>的最下方：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="comment">// Expose jQuery to the global object</span>
window.jQuery = window.$ = jQuery;
</pre></td></tr></table></figure>

<p>呵呵，人家都写在那呢。</p>
<p>这篇就介绍到这儿吧。</p>
]]></content>
    <category scheme="http://lisp.es//tags/jQuery/" term="jQuery"/>
    <category scheme="http://lisp.es//categories/jQuery/" term="jQuery"/>
  </entry>
  <entry>
    <title type="html"><![CDATA[Python 简易解析 XML JSON]]></title>
    <link href="http://lisp.es//2012/05/17/parse-xml-json/"/>
    <id>http://lisp.es//2012/05/17/parse-xml-json/</id>
    <published>2012-05-17T14:06:00.000Z</published>
    <updated>2013-05-18T19:15:28.000Z</updated>
    <content type="html"><![CDATA[<h3>XML</h3>
<h4>使用轻量快速的 minidom 函式库</h4>
<p>引用 minidom:</p>
<pre><code><span class="title">from</span> xml.dom <span class="import"><span class="keyword">import</span> minidom</span>
</code></pre>
<blockquote>
<p>DOM -- Document Object Model</p>
</blockquote>
<p>minidom 有一个 parseString 函数可以解析 XML 字串。</p>
<p>型別</p>
<p>解析一个随意取名的 XML 字串，存入 x：</p>
<pre><code>x = minidom.parseString("<span class="tag">&lt;<span class="title">foo</span>&gt;</span>Lorem ipsum<span class="tag">&lt;<span class="title">children</span>&gt;</span><span class="tag">&lt;<span class="title">item</span>&gt;</span>1<span class="tag">&lt;/<span class="title">item</span>&gt;</span><span class="tag">&lt;<span class="title">item</span>&gt;</span>2<span class="tag">&lt;/<span class="title">item</span>&gt;</span><span class="tag">&lt;<span class="title">item</span>&gt;</span>3<span class="tag">&lt;/<span class="title">item</span>&gt;</span><span class="tag">&lt;/<span class="title">children</span>&gt;</span><span class="tag">&lt;/<span class="title">foo</span>&gt;</span>")
</code></pre>
<p>x 现在是一个 xml.dom.minidom.Document instance 实例。</p>
<p><strong>注意</strong> XML 不像 HTML，严格要求每个 open 标签要有一个相应的 close 标签！</p>
<p>看看 x 有什么可以调用的属性、方法：</p>
<pre><code><span class="function"><span class="title">dir</span><span class="params">(x)</span>

[<span class="title">'ATTRIBUTE_NODE'</span>, <span class="title">'CDATA_SECTION_NODE'</span>, <span class="title">'COMMENT_NODE'</span>, <span class="title">'DOCUMENT_FRAGMENT_NODE'</span>, <span class="title">'DOCUMENT_NODE'</span>, <span class="title">'DOCUMENT_TYPE_NODE'</span>, <span class="title">'ELEMENT_NODE'</span>, <span class="title">'ENTITY_NODE'</span>, <span class="title">'ENTITY_REFERENCE_NODE'</span>, <span class="title">'NOTATION_NODE'</span>, <span class="title">'PROCESSING_INSTRUCTION_NODE'</span>, <span class="title">'TEXT_NODE'</span>, <span class="title">'__doc__'</span>, <span class="title">'__init__'</span>, <span class="title">'__module__'</span>, <span class="title">'__nonzero__'</span>, <span class="title">'_call_user_data_handler'</span>, <span class="title">'_child_node_types'</span> ... <span class="title">'standalone'</span>, <span class="title">'strictErrorChecking'</span>, <span class="title">'toprettyxml'</span>, <span class="title">'toxml'</span>, <span class="title">'unlink'</span>, <span class="title">'version'</span>, <span class="title">'writexml'</span>]
</code></pre>
<p>转回 xml:</p>
<pre><code><span class="attribute">x.toprettyxml()
</code></pre>
<p>印出来看看：</p>
<pre><code><span class="title">print</span> x.toprettyxml()
</code></pre>
<p>输出：</p>
<pre><code><span class="tag">&lt;<span class="title">foo</span>&gt;</span>
    Lorem ipsum
    <span class="tag">&lt;<span class="title">children</span>&gt;</span>
        <span class="tag">&lt;<span class="title">item</span>&gt;</span>
            1
        <span class="tag">&lt;/<span class="title">item</span>&gt;</span>
        <span class="tag">&lt;<span class="title">item</span>&gt;</span>
            2
        <span class="tag">&lt;/<span class="title">item</span>&gt;</span>
        <span class="tag">&lt;<span class="title">item</span>&gt;</span>
            3
        <span class="tag">&lt;/<span class="title">item</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">children</span>&gt;</span>
<span class="tag">&lt;/<span class="title">foo</span>&gt;</span>
</code></pre>
<p>取得第二个 item 标签内的值 2：</p>
<pre><code><span class="transposed_variable">x.</span>getElementsByTagName(<span class="string">'item'</span>)<span class="matrix">[<span class="number">1</span>].</span>childNodes<span class="matrix">[<span class="number">0</span>].</span>nodeValue
</code></pre>
<p>你可以看看 dir 里面有什么函数可以用，在 python 的直译器里面玩玩看。</p>
<h3>RSS</h3>
<p>比如说想要知道 <a href="http://www.nytimes.com/services/xml/rss/nyt/Science.xml">http://www.nytimes.com/services/xml/rss/nyt/Science.xml</a> 有几个 item：</p>
<pre><code><span class="title">from</span> xml.dom <span class="import"><span class="keyword">import</span> minidom</span>

<span class="import"><span class="keyword">import</span> urllib2</span>

<span class="title">contents</span> = urllib2.urlopen(<span class="string">"http://www.nytimes.com/services/xml/rss/nyt/Science.xml"</span>).read()

<span class="title">d</span> = minidom.parseString(contents)

<span class="title">len</span>(d.getElementsByTagName(<span class="string">"item"</span>)) # =&gt; <span class="number">38</span> on <span class="number">2012.05</span><span class="number">.17</span>
</code></pre>
<h3>JSON</h3>
<p>Javascript Object Notation</p>
<p>在 Python 用 dictionary 混 List 的形式储存 <code>{ foo: [{&quot;a&quot;: 1}, ... {&quot;c&quot;: 3}] }</code></p>
<p>使用 JSON 库：</p>
<pre><code><span class="import"><span class="keyword">import</span> json</span>
</code></pre>
<p>假设今天我们有一个 json 格式的字串 j，具有两个键 <code>mon</code> 与 <code>numbers</code>：</p>
<pre><code><span class="setting">j = <span class="value">'{<span class="string">"mon"</span>: <span class="number">1</span>, <span class="string">"numbers"</span>: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">9.9</span>]}'</span></span>
</code></pre>
<p>载入这个 json ，存到 d 里：</p>
<pre><code><span class="setting">d = <span class="value">json.loads(j)</span></span>
</code></pre>
<p>载入后我们得到一个 python 字典（无序）：</p>
<pre><code>{<span class="string">u'mon'</span>: <span class="number">1</span>, <span class="string">u'numbers'</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">9.9</span>]}
</code></pre>
<p>取出 <code>mon</code> 的值：</p>
<pre><code>d[<span class="string">'mon'</span>] <span class="comment"># =&gt; 1</span>
d[<span class="string">'numbers'</span>][2] <span class="comment"># =&gt; 9.9</span>
</code></pre>
<p>你也可以 <code>eval</code> 这个 json 格式的字串：</p>
<pre><code><span class="keyword">eval</span>(j)
<span class="comment"># =&gt; {'mon': 1, 'numbers': [1, 2, 9.9]}</span>
</code></pre>
<p><strong>永远别用 eval 来解析 json</strong> 。</p>
<p>Q: 加总 www.reddit.com 帖子的 up votes。</p>
<p>A:</p>
<figure class="highlight lang-python"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
</pre></td><td class="code"><pre>r = urllib2.urlopen(<span class="string">"http://www.reddit.com/.json"</span>)
j = json.loads(r)

j.keys() <span class="comment"># =&gt; [u'kind', u'data']</span>
j[<span class="string">'data'</span>].keys() <span class="comment"># =&gt; [u'modhash', u'children', u'after', u'before']</span>
j[<span class="string">'data'</span>][<span class="string">'children'</span>][<span class="number">0</span>].keys() <span class="comment"># =&gt; [u'kind', u'data']</span>
j[<span class="string">'data'</span>][<span class="string">'children'</span>][<span class="number">0</span>][<span class="string">'data'</span>].keys() <span class="comment"># =&gt; [..., u'ups']</span>
j[<span class="string">'data'</span>][<span class="string">'children'</span>][<span class="number">0</span>][<span class="string">'data'</span>][<span class="string">'ups'</span>] <span class="comment"># =&gt; 7902</span>

sum(c[<span class="string">'data'</span>][<span class="string">'ups'</span>] <span class="keyword">for</span> c <span class="keyword">in</span> j[<span class="string">'data'</span>][<span class="string">'children'</span>]) <span class="comment"># =&gt; 84500</span>
</pre></td></tr></table></figure>

<p>DONE.</p>
]]></content>
    <category scheme="http://lisp.es//tags/xml-json/" term="xml json"/>
    <category scheme="http://lisp.es//categories/xml-json/" term="xml json"/>
  </entry>
  <entry>
    <title type="html"><![CDATA[CSS 一个常见 nth-child 的误区]]></title>
    <link href="http://lisp.es//2012/05/12/nth-child-common-gotcha/"/>
    <id>http://lisp.es//2012/05/12/nth-child-common-gotcha/</id>
    <published>2012-05-12T15:04:00.000Z</published>
    <updated>2013-05-18T19:15:28.000Z</updated>
    <content type="html"><![CDATA[<p>给定有如下的 HTML 代码片段：</p>
<p>型別</p>
<figure class="highlight lang-html"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="code"><pre>&lt;html&gt;
...
&lt;style&gt;
truedt {
truetrueboder-top: 1px solid white;
truetrueboder-bottom: 1px solid gray;
true}
&lt;/style&gt;
&lt;body&gt;
true&lt;dl&gt;
truetrue&lt;dt&gt;How to install&lt;/dt&gt;
truetrue&lt;dd&gt;Check ...&lt;/dd&gt;
truetrue&lt;dt&gt;How to install&lt;/dt&gt;
truetrue&lt;dd&gt;Check ...&lt;/dd&gt;
truetrue&lt;dt&gt;How to install&lt;/dt&gt;
truetrue&lt;dd&gt;Check ...&lt;/dd&gt;
truetrue&lt;dt&gt;How to install&lt;/dt&gt;
truetrue&lt;dd&gt;Check ...&lt;/dd&gt;
truetrue&lt;dt&gt;How to install&lt;/dt&gt;
truetrue&lt;dd&gt;last ...&lt;/dd&gt;
true&lt;/dl&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre></td></tr></table></figure>

<p>假设这是一个 FAQ，我们有一个 Definition list (<code>dl</code>)，并有五个 item (<code>dt</code>)，五个 item 描述 (<code>dd</code>)，</p>
<p>每个 <code>dt</code> 的上下有边界，分别是白色、黑色。</p>
<p>今天假如我们想要第一个 <code>dt</code> 上方没有 boder，以及最后一个 <code>dt</code> 下方没有 boder，这时候 CSS 该怎么写呢？</p>
<p>我们可以使用 CSS3 的 <code>first-child</code>：</p>
<pre><code><span class="tag">dt</span><span class="pseudo">:first-child</span> <span class="rules">{ <span class="rule"><span class="attribute">boder-top</span>:<span class="value"> none;</span></span> <span class="rule">}</span></span>
</code></pre>
<p>现在你可能会想要使用 <code>last-child</code> 来把 最后一个 dd 的 boder-bottom 拿掉：</p>
<pre><code><span class="tag">dt</span><span class="pseudo">:last-child</span> <span class="rules">{ <span class="rule"><span class="attribute">boder-bottom</span>:<span class="value"> none;</span></span> <span class="rule">}</span></span>
</code></pre>
<p>而这样不行，因为 <code>last-child</code> 是选择 parent 的最后一个 child，这个例子里会选中：</p>
<pre><code>&lt;dd&gt;last <span class="keyword">...</span>&lt;/dd&gt;
</code></pre>
<p>那该怎么办呢？可以使用 <code>nth-last-child</code> ：</p>
<pre><code><span class="tag">dt</span><span class="pseudo">:nth-last-child(2)</span> <span class="rules">{ <span class="rule"><span class="attribute">boder-bottom</span>:<span class="value"> none;</span></span> <span class="rule">}</span></span>
</code></pre>
<p>这样子会从 <code>dl</code> 的最后一个 child 开始往上 2 个，也就是我们想要的最后一个 <code>dt</code>。</p>
<p>That&#39;s it!!!</p>
]]></content>
    <category scheme="http://lisp.es//tags/css/" term="css"/>
    <category scheme="http://lisp.es//categories/css/" term="css"/>
  </entry>
  <entry>
    <title type="html"><![CDATA[不要使用 CDN 来放第三方 Javascript]]></title>
    <link href="http://lisp.es//2012/05/12/dont-use-cdn-html5shiv/"/>
    <id>http://lisp.es//2012/05/12/dont-use-cdn-html5shiv/</id>
    <published>2012-05-12T09:33:00.000Z</published>
    <updated>2013-05-18T19:15:28.000Z</updated>
    <content type="html"><![CDATA[<p><a href="http://code.google.com/p/html5shiv/">HTML5shiv</a> 是一个让 IE 8 启用 HTML5 元素的第三方 JS，通常 CDN 引用的链接是：</p>
<p><a href="http://html5shiv.googlecode.com/svn/trunk/html5.js">http://html5shiv.googlecode.com/svn/trunk/html5.js</a></p>
<p>不要这么做的理由：</p>
<p>型別</p>
<ol>
<li><p>没有使用 HTTP 压缩</p>
</li>
<li><p>没有 cached，通常这个文件只缓存 180 秒。</p>
</li>
<li><p>googlecode.com 不支援 partial response (可以提高效能的东东)</p>
</li>
<li><p>你连到别人的地方，无法控制什么事情会发生，说不定那哥儿们不爽了直接删掉。。。</p>
</li>
<li><p>实际上压缩后才 1200 Bytes，造成很多额外的 Overhead (DNS lookup, TCP handshake...etc.)</p>
</li>
</ol>
<p>原始文章：<a href="http://zoompf.com/blog/2012/05/html5shiv-and-serving-content-from-code-repositories">html5shiv and Serving Content From Code Repositories</a></p>
]]></content>
    <category scheme="http://lisp.es//tags/HTML5/" term="HTML5"/>
    <category scheme="http://lisp.es//categories/HTML5/" term="HTML5"/>
  </entry>
  <entry>
    <title type="html"><![CDATA[Python 解决 Zebra 谜题]]></title>
    <link href="http://lisp.es//2012/05/10/python-zebra/"/>
    <id>http://lisp.es//2012/05/10/python-zebra/</id>
    <published>2012-05-10T14:35:00.000Z</published>
    <updated>2013-05-18T19:15:28.000Z</updated>
    <content type="html"><![CDATA[<p>爱因斯坦养鱼问题的学名就叫 Zebra Puzzle。之所以叫爱因斯坦养鱼问题是为了刊登在杂志上吸引读者的注意，其实这个问题不是爱因斯坦搞的...</p>
<p>问题可以到这里看：<a href="http://en.wikipedia.org/wiki/Zebra_Puzzle">Zebra Puzzle</a></p>
<p>型別</p>
<p>首先实现了 2 个 小函数，<code>imright</code> 跟 <code>nextto</code></p>
<p>确定某房是不是在某房右边、或是两个房挨著。</p>
<p>接下来给每个房子编上号，12345，</p>
<p>然后使用了 Python 自带的排列工具 <code>itertools.permutations</code> 给出房子可能的排列。</p>
<p>接著用了一个 Python 的奇技淫巧，叫做 Generator Expression，</p>
<p>语法是：<code>(term for- 子句 (选择性) for-if- 子句)</code></p>
<p>这个 generator expression 会返回一个 Generator 对象。</p>
<p>恩，给个例子好了：</p>
<p>先定义一个算平方的函数，然后用 Generator Expression：</p>
<pre><code><span class="function"><span class="keyword">def</span> <span class="title">sqr</span><span class="params">(x)</span>:</span> <span class="keyword">print</span> <span class="string">'调用 sqr, 参数 '</span>, x; <span class="keyword">return</span> x*x

g = (sq(x) <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">10</span>) <span class="keyword">if</span> x%<span class="number">2</span>==<span class="number">0</span>)
</code></pre>
<p>这个时候如果调用 g ：</p>
<pre><code>&gt;&gt;&gt; <span class="comment">g</span>
&lt;<span class="comment">GeneratorObject</span> <span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span>&gt;
</code></pre>
<p>不会去调用函数，只返回一个 Generator 对象、然而</p>
<pre><code>&gt;&gt;&gt; <span class="keyword">next</span>(g)
调用 <span class="built_in">sqr</span>, 参数 <span class="number">0</span>
<span class="number">0</span>
</code></pre>
<p>才会调用这个 Generator 所绑定的函数。。。汗。。。</p>
<p>这个问题要找，水在哪个房子被喝的，哪个房子养斑马。</p>
<p>藉由把 Constraint 移到对的地方，减少需要的计算，再搭配 Generator-exp 的特性，最后大概 0.00028 秒之类的就算好了，
本来用 嵌套 For-loop 要算 1 小时。</p>
<p>至于那个 c 函数 是拿来显示统计数据跟除错用的。</p>
<p>完整代码：</p>
<script src="https://gist.github.com/2653290.js"></script>]]></content>
    <category scheme="http://lisp.es//tags/Python/" term="Python"/>
    <category scheme="http://lisp.es//categories/Python/" term="Python"/>
  </entry>
  <entry>
    <title type="html"><![CDATA[Python For 循环的迭代器实现]]></title>
    <link href="http://lisp.es//2012/05/10/python-for-inside/"/>
    <id>http://lisp.es//2012/05/10/python-for-inside/</id>
    <published>2012-05-10T14:09:00.000Z</published>
    <updated>2013-05-18T19:15:28.000Z</updated>
    <content type="html"><![CDATA[<p>给定一段 Python 代码：</p>
<pre><code><span class="keyword">for</span> x <span class="keyword">in</span> items:
    <span class="built_in">print</span> x
</code></pre>
<p>这个 items 可以是字串、列表、等等，这种可以迭代的集合称之为 iterable。</p>
<p>型別</p>
<p>这个 iter 就是创一个迭代器出来，相信有学过 Java 的人都不陌生。</p>
<p>然后用一个 <code>try .. except</code> 语句包住，迭代至停为止，停时会抛出 StopIteration。</p>
<p>实际上是这样实现的：</p>
<pre><code>it = iter(items)
<span class="keyword">try</span>:
    <span class="keyword">while</span> <span class="built_in">True</span>
        x = next(it)
        <span class="keyword">print</span> x
<span class="keyword">except</span> StopIteration:
    <span class="keyword">pass</span>
</code></pre>
]]></content>
    <category scheme="http://lisp.es//tags/Python/" term="Python"/>
    <category scheme="http://lisp.es//categories/Python/" term="Python"/>
  </entry>
  <entry>
    <title type="html"><![CDATA[Homebrew Install growlnotify on Snow Leopard and Lion]]></title>
    <link href="http://lisp.es//2012/05/01/mac-install-growlnotify/"/>
    <id>http://lisp.es//2012/05/01/mac-install-growlnotify/</id>
    <published>2012-04-30T16:51:00.000Z</published>
    <updated>2013-05-18T19:15:28.000Z</updated>
    <content type="html"><![CDATA[<p>Currently homebrew already removed formula of growlnotify. If you want to use the Gem <a href="http://rubygems.org/gems/growl">growl</a> with a well-known app growlnotify and you may encounter this error with Growlnotify on Snow Leopard:</p>
<pre><code>dyld: Symbol <span class="keyword">not</span> found: _kSecRandomDefault
  Referenced from: <span class="regexp">/usr/local/bin/g</span>rowlnotify
  Expected <span class="keyword">in</span>: <span class="regexp">/System/Library/Frameworks/Security.framework/Versions/A/</span>Security
 <span class="keyword">in</span> <span class="regexp">/usr/local/bin/g</span>rowlnotify
Trace/BPT trap
</code></pre>
<p>型別</p>
<p>Here are the formulas:</p>
<h3>For Snow Leopard with growlnotify v1.2.2</h3>
<pre><code>brew install https://raw<span class="preprocessor">.github</span><span class="preprocessor">.com</span>/mxcl/homebrew/bd40f1e5f89fad962b021c827d56a9fdea0c847d/Library/Formula/growlnotify<span class="preprocessor">.rb</span>
</code></pre>
<h3>For Lion with growlnotify v1.3</h3>
<pre><code>brew install https://raw<span class="preprocessor">.github</span><span class="preprocessor">.com</span>/mxcl/homebrew/<span class="number">15</span>d6da0023924969fa6ad8a7cf743c4b39838e6e/Library/Formula/growlnotify<span class="preprocessor">.rb</span>
</code></pre>
<p>Alternatively you could try on their <a href="http://growl.info/downloads">offical download page</a></p>
]]></content>
    <category scheme="http://lisp.es//tags/MacOSX/" term="MacOSX"/>
    <category scheme="http://lisp.es//categories/MacOSX/" term="MacOSX"/>
  </entry>
  <entry>
    <title type="html"><![CDATA[Rails 3.2.3 使用 Spork + Guard + RSpec + Capybara]]></title>
    <link href="http://lisp.es//2012/04/30/sprok-guard-rspec/"/>
    <id>http://lisp.es//2012/04/30/sprok-guard-rspec/</id>
    <published>2012-04-30T05:46:00.000Z</published>
    <updated>2013-05-18T19:15:28.000Z</updated>
    <content type="html"><![CDATA[<h2>比较匆忙的同学请看</h2>
<p>0) <code>rails new appname --skip-test-unit --skip-bundle</code></p>
<p>1) 复制这个 Gemfile(<a href="https://gist.github.com/2555402">OSX</a> / <a href="https://gist.github.com/2555397">Linux</a> / <a href="https://gist.github.com/2555403">Windows</a>)，替换掉项目下的 Gemfile。</p>
<p>安装需要的 Gems，你有两个选择：</p>
<p>2-a) <code>bundle install</code> ，之后使用 <code>bundle exec xxx</code><br>2-b) <code>bundle install --binstubs</code>  ，之后使用 <code>bin/xxx</code></p>
<p>3) <code>rails g rspec:install</code></p>
<p>4) 运行 <code>bin/guard init rspec &amp;&amp; bin/guard init spork</code><br>5) 复制这个 <a href="https://gist.github.com/2555614">Guardfile</a>，覆盖掉项目下的 Guardfile。<br>6) 添加 <code>--drb</code> 至项目的根目录下的 <code>.rspec</code>。 
7) 复制这个 <a href="https://gist.github.com/2555618">spec/spec_helper.rb</a>，覆盖 <code>spec/spec_helper.rb</code>  </p>
<p>8-a) <code>bundle exec spork --bootstrap</code><br>8-b) <code>bin/sprok --bootstrap</code>  </p>
<p>9-a) <code>bundle exec guard</code><br>9-b) <code>bin/guard</code>  </p>
<p>型別</p>
<h2>有 10 分钟的同学请看</h2>
<h3>为什么使用 <a href="http://rubygems.org/gems/guard">Guard</a>？</h3>
<ol>
<li>要切回终端机敲 rspec 命令  </li>
<li>启动速度太慢 (使用 Spork 来加速)</li>
</ol>
<p>Guard 人如其名，自动侦测改动并运行测试。</p>
<h4>配置 Guard</h4>
<p>Gemfile:</p>
<p>在 <code>:development group</code> 加入：  </p>
<pre><code><span class="title">gem</span> <span class="string">'guard-rspec'</span>, <span class="string">'0.5.5'</span>
</code></pre>
<p>在 <code>:test group</code> 加入一些相依的 Gems，OSX 可能还需要安装 <a href="http://growl.info/downloads#generaldownloads">growl-notify</a>：</p>
<p><strong>MacOSX</strong></p>
<pre><code>gem <span class="string">'rb-fsevent'</span>, <span class="string">'0.4.3.1'</span>, :<span class="keyword">require</span> =&gt; <span class="keyword">false</span>
gem <span class="string">'growl'</span>, <span class="string">'1.0.3'</span>
</code></pre>
<p><strong>Linux</strong></p>
<pre><code><span class="title">gem</span><span class="string"> 'rb-inotify'</span>,<span class="string"> '0.8.8'</span>
<span class="title">gem</span><span class="string"> 'libnotify'</span>,<span class="string"> '0.5.9'</span>
</code></pre>
<p><strong>Windows</strong></p>
<pre><code><span class="title">gem</span><span class="string"> 'rb-fchange'</span>,<span class="string"> '0.0.5'</span>
<span class="title">gem</span><span class="string"> 'rb-notifu'</span>,<span class="string"> '0.0.4'</span>
<span class="title">gem</span><span class="string"> 'win32console'</span>,<span class="string"> '1.3.0'</span>
</code></pre>
<p>范例 Gemfile，放在 Gist:</p>
<p><a href="https://gist.github.com/2555278">MacOSX</a><br><a href="https://gist.github.com/2555344">Linux</a><br><a href="https://gist.github.com/2555343">Windows</a>  </p>
<p>Gemfile 配置好运行 <code>bundle install</code> ，初始化 Guard：</p>
<pre><code><span class="title">bundle</span> exec guard init rspec
</code></pre>
<p>或是运行 <code>bundle install --binstubs</code>，初始化 Guard：</p>
<pre><code><span class="title">bin</span>/guard init rspec
</code></pre>
<p>会产生一个 Guardfile，最上方加入此行：</p>
<pre><code><span class="title">require</span> <span class="string">'active_support/core_ext'</span>
</code></pre>
<p>并改动此行 <code>guard &#39;rspec&#39;, :version =&gt; 2 do</code> ：</p>
<pre><code>guard <span class="string">'rspec'</span>, <span class="symbol">:version</span> =&gt; <span class="number">2</span>, <span class="symbol">:all_after_pass</span> =&gt; <span class="keyword">false</span> <span class="keyword">do</span>
</code></pre>
<p>确保 Guard 不再一个失败测试通过后继续运行（加快<strong>红绿重构</strong>周期）</p>
<p>再添加：</p>
<pre><code>guard <span class="string">'rspec'</span>, <span class="symbol">:version</span> =&gt; <span class="number">2</span>, <span class="symbol">:all_after_pass</span> =&gt; <span class="keyword">false</span> <span class="keyword">do</span>
    .
    .
    .
    watch(%r{^app/controllers/(.+)<span class="number">_</span>(controller)\.rb<span class="variable">$}</span>)  <span class="keyword">do</span> |m|
      [<span class="string">"spec/routing/<span class="subst">#{m[<span class="number">1</span>]}</span>_routing_spec.rb"</span>,
       <span class="string">"spec/<span class="subst">#{m[<span class="number">2</span>]}</span>s/<span class="subst">#{m[<span class="number">1</span>]}</span>_<span class="subst">#{m[<span class="number">2</span>]}</span>_spec.rb"</span>,
       <span class="string">"spec/acceptance/<span class="subst">#{m[<span class="number">1</span>]}</span>_spec.rb"</span>,
       (m[<span class="number">1</span>][<span class="regexp">/_pages/</span>] ? <span class="string">"spec/requests/<span class="subst">#{m[<span class="number">1</span>]}</span>_spec.rb"</span> <span class="symbol">:</span> 
                         <span class="string">"spec/requests/<span class="subst">#{m[<span class="number">1</span>].singularize}</span>_pages_spec.rb"</span>)]
    <span class="keyword">end</span>
    watch(%r{^app/views/(.+)/}) <span class="keyword">do</span> |m|
      <span class="string">"spec/requests/<span class="subst">#{m[<span class="number">1</span>].singularize}</span>_pages_spec.rb"</span>
    <span class="keyword">end</span>
    .
    .
    .
<span class="keyword">end</span>
</code></pre>
<p>当 integration tests 及 views 有变动时，会自动运行测试。</p>
<p>这些都设置好了，启动 guard </p>
<pre><code><span class="title">bundle</span> exec guard
</code></pre>
<p>或</p>
<pre><code><span class="attribute">bin/guard
</code></pre>
<p>更多信息请参考：<a href="https://github.com/guard/guard">Guard Github 页面</a></p>
<h3>使用 Spork 来加速测试</h3>
<p>运行 rspec 很慢的原因是每次都得重加载整个 Rails 环境。Spork 测试服务器透过加载 Rails 环境，并维护一个进程池 (pool of processes) 给之后的测试使用。跟 Guard 搭配使用顺风顺水。</p>
<p>配置 Gemfile，将此行加入 <code>:test group</code>：</p>
<pre><code><span class="title">gem</span><span class="string"> 'guard-spork'</span>,<span class="string"> '0.3.2'</span>
<span class="title">gem</span><span class="string"> 'spork'</span>,<span class="string"> '0.9.0'</span>
</code></pre>
<p>范例 Gemfile，放在 Gist:</p>
<p><a href="https://gist.github.com/2555402">MacOSX</a><br><a href="https://gist.github.com/2555397">Linux</a><br><a href="https://gist.github.com/2555403">Windows</a>  </p>
<p>运行 <code>bundle install</code> 并运行 spork ：</p>
<pre><code><span class="comment">bundle</span> <span class="comment">exec</span> <span class="comment">spork</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">bootstrap
</code></pre>
<p>运行 <code>bundle install --binstubs</code> 并运行 spork：</p>
<pre><code><span class="comment">spork</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">bootstrap</span> <span class="comment">#</span> <span class="comment">or</span> <span class="comment">bin/spork</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">bootstrap
</code></pre>
<p>添加需加载的环境信息至 <code>spec/spec_helper.rb</code> 里的 <code>Spork.prefork</code>：</p>
<pre><code>require <span class="comment">'rubygems'</span>
require <span class="comment">'spork'</span>

Spork.prefork <span class="keyword">do</span>
  # Loading more <span class="keyword">in</span> this block will cause your tests <span class="keyword">to</span> run faster. However, 
  # <span class="keyword">if</span> you change any configuration <span class="keyword">or</span> code from libraries loaded here, you<span class="comment">'ll</span>
  # need <span class="keyword">to</span> restart spork <span class="keyword">for</span> it take effect.
  # This file <span class="keyword">is</span> copied <span class="keyword">to</span> spec/ when you run <span class="comment">'rails generate rspec:install'</span>
  ENV[<span class="string">"RAILS_ENV"</span>] ||= <span class="comment">'test'</span>
  require File.expand_path(<span class="string">"../../config/environment"</span>, __FILE__)
  require <span class="comment">'rspec/rails'</span>
  require <span class="comment">'rspec/autorun'</span>

  # Requires supporting ruby files <span class="keyword">with</span> custom matchers <span class="keyword">and</span> macros, etc,
  # <span class="keyword">in</span> spec/support/ <span class="keyword">and</span> its subdirectories.
  Dir[Rails.root.<span class="built_in">join</span>(<span class="string">"spec/support/**/*.rb"</span>)].<span class="keyword">each</span> {|f| require f}

  RSpec.configure <span class="keyword">do</span> |config|
    # == Mock Framework
    #
    # <span class="keyword">If</span> you prefer <span class="keyword">to</span> use mocha, flexmock <span class="keyword">or</span> RR, uncomment the appropriate line:
    #
    # config.mock_with :mocha
    # config.mock_with :flexmock
    # config.mock_with :rr
    config.mock_with :rspec

    # Remove this line <span class="keyword">if</span> you<span class="comment">'re not using ActiveRecord or ActiveRecord fixtures</span>
    config.fixture_path = <span class="string">"#{::Rails.root}/spec/fixtures"</span>

    # <span class="keyword">If</span> you<span class="comment">'re not using ActiveRecord, or you'd prefer not to run each of your</span>
    # examples within a transaction, remove the following line <span class="keyword">or</span> assign <span class="literal">false</span>
    # instead of <span class="literal">true</span>.
    config.use_transactional_fixtures = <span class="literal">true</span>

    # <span class="keyword">If</span> <span class="literal">true</span>, the base <span class="keyword">class</span> of anonymous controllers will be inferred
    # automatically. This will be the <span class="keyword">default</span> behavior <span class="keyword">in</span> future versions of
    # rspec-rails.
    config.infer_base_class_for_anonymous_controllers = <span class="literal">false</span>
  <span class="keyword">end</span>
<span class="keyword">end</span>

Spork.each_run <span class="keyword">do</span>
  # This code will be run <span class="keyword">each</span> <span class="built_in">time</span> you run your specs.

<span class="keyword">end</span>
</code></pre>
<p>启动 Spork 服务器：</p>
<p>之前使用 <code>bundle install</code>：</p>
<p><code>bundle exec spork</code> </p>
<p>之前使用 <code>bundle install --binstubs</code></p>
<p><code>bin/spork</code></p>
<p>加入此行至 <code>.rspec</code> ，让 RSpec 缺省使用 spork：</p>
<pre><code><span class="literal">-</span><span class="literal">-</span><span class="comment">drb
</code></pre>
<p><strong>提示</strong> ：</p>
<p>如果改动了 <code>routes.rb</code> 需重启 Spork 服务器，如果你觉得测试是对的，但是失败了，也可以重启 Spork 服务器试试看。</p>
<p>更多信息请参考 <a href="https://github.com/sporkrb/spork">Spork Github 页面</a></p>
<h3>Guard 搭配 Spork</h3>
<p>有了 Guard 与 Spork 以后，让它们合体：</p>
<pre><code><span class="title">bundle</span> exec guard init spork
<span class="title">bin</span>/guard init spork
</code></pre>
<p>加入此行至 Guardfile：</p>
<pre><code>guard <span class="string">'spork'</span>, <span class="symbol">:rspec_env</span> =&gt; { <span class="string">'RAILS_ENV'</span> =&gt; <span class="string">'test'</span> } <span class="keyword">do</span>
  watch(<span class="string">'config/application.rb'</span>)
  watch(<span class="string">'config/environment.rb'</span>)
  watch(%r{^config/environments/.+\.rb<span class="variable">$}</span>)
  watch(%r{^config/initializers/.+\.rb<span class="variable">$}</span>)
  watch(<span class="string">'Gemfile'</span>)
  watch(<span class="string">'Gemfile.lock'</span>)
  watch(<span class="string">'spec/spec_helper.rb'</span>)
  watch(<span class="string">'test/test_helper.rb'</span>)
  watch(<span class="string">'spec/support/'</span>)
<span class="keyword">end</span>

guard <span class="string">'rspec'</span>, <span class="symbol">:version</span> =&gt; <span class="number">2</span>, <span class="symbol">:all_after_pass</span> =&gt; <span class="keyword">false</span>, <span class="symbol">:cli</span> =&gt; <span class="string">'--drb'</span> <span class="keyword">do</span>
  .
  .
  .
<span class="keyword">end</span>
</code></pre>
<p>现在全都设定好了，以后只要</p>
<p><code>bundle exec guard</code> 或 <code>bin/guard</code> </p>
<p>Guard 就会自动启动 Spork 服务器并侦测你的改动！</p>
<p>打完收工。。。</p>
]]></content>
    <category scheme="http://lisp.es//tags/Rails/" term="Rails"/>
    <category scheme="http://lisp.es//categories/Rails/" term="Rails"/>
  </entry>
  <entry>
    <title type="html"><![CDATA[RSpec 行为驱动测试简介 - 003]]></title>
    <link href="http://lisp.es//2012/04/25/ror-3-rspec/"/>
    <id>http://lisp.es//2012/04/25/ror-3-rspec/</id>
    <published>2012-04-25T02:52:00.000Z</published>
    <updated>2013-05-18T19:15:28.000Z</updated>
    <content type="html"><![CDATA[<p><strong>1000 个小时学会 Rails 系列</strong></p>
<blockquote>
<p>关关雎鸠，在河之洲。
窈窕淑女，君子好逑。</p>
</blockquote>
<p>今天要介绍的是 RSpec 这个 Gem。</p>
<p>这个 Gem 是干啥用的呢，RSpec 是一个 BDD 测试工具，用起来跟 TDD 工具差不多，只是包了一层 DSL 外衣，也就是说语法比较接近咱人类在用的语言（据说这样开发者与客户可以直接沟通了？）；还有一个 Gem 叫做 Capybara，这个贼难念的单词是 Capybara，水豚，发音可以来<a href="http://goo.gl/mqpiQ">这里</a>听看看，声音没有 <a href="http://railscasts-china.com/">Rails 视频教程</a>的 Terry 老师 (@poshboytl) 那么性感就是了。Capybara 是一个整合测试 Rack 应用的工具，可以模拟真实用户使用你的网站的行为。Capybara 跟 RSpec 起来非常好用！</p>
<p>但今天先介绍 RSpec。。。</p>
<p>型別</p>
<p>接下来要讲的例子呢，你不需要有 Rails 的环境，只需要有 Ruby 与 RubyGems 即可。</p>
<p>Let&#39;s Dive in!!!</p>
<p>RSpec 的测试是用 Ruby <a href="http://en.wikipedia.org/wiki/Domain-specific_language">DSL</a> 写成的，看起来像是这样子：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre>describe Programmer <span class="keyword">do</span>
  it <span class="string">"is lonely"</span> <span class="keyword">do</span>
    Programmer<span class="variable">.lonely</span>?<span class="variable">.should</span> be_true
  <span class="keyword">end</span>
<span class="keyword">end</span>
</pre></td></tr></table></figure>

<p>程序员寂寞么？恩。。。。。。这语法看起来跟英语差不多吧 : ）这样写的好处是比较 Geek 一点的客户也能在<a href="http://en.wikipedia.org/wiki/Acceptance_testing">验收测试 (Acceptance Testing)</a>的阶段直接跟你讨论，看看上帝的要求有没有都满足了！我们这儿有句话说客户是上帝，不知道你们那。。。圣经有一段：上帝说有光，就有光，客户说这个，就这个。。。而这对一个开发人员呢有什么好处呢？可以看看，嗯，这个功能具体是要做什么，然后去实现它。另外一个用 DSL 写的好处是，客户、开发者、代码，都可以用这种近似英语的语言交流（理想、理想嘛）。</p>
<p>而实际上 RSpec 是扩展一些 <code>Test::Unit</code> 已经提供的方法。你喜欢的话，也可以在 RSpec 的测试里混著用。好，下面我们会用另外一个例子，讲讲怎么用这个 RSpec。。。</p>
<p>关关雎鸠，在河之洲，窈窕淑女，君子好逑。。。</p>
<h3>安装 RSpec</h3>
<p>一如往常的一键安装 <code>gem install rspec</code> （目前是 2.9.0 ＠20120423)</p>
<p>会顺便安装相依的 Gem：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre><span class="attribute">Fetching</span>: <span class="string">rspec-core-2.9.0.gem (100%)</span>
<span class="attribute">Fetching</span>: <span class="string">diff-lcs-1.1.3.gem (100%)</span>
<span class="attribute">Fetching</span>: <span class="string">rspec-expectations-2.9.1.gem (100%)</span>
<span class="attribute">Fetching</span>: <span class="string">rspec-mocks-2.9.0.gem (100%)</span>
<span class="attribute">Fetching</span>: <span class="string">rspec-2.9.0.gem (100%)</span>
</pre></td></tr></table></figure>

<p>最后一行你可以看到我们安了 <code>rspec-2.9.0.gem</code> ，而这些相依的 Gem 是要装的，就像水和鱼，过儿与龙儿，我和苍老师，是离不开彼此的。</p>
<h3>一个简单例子</h3>
<p>很好，很好，Gem 装好以后呢，让我们添加一个新的目录叫做 <code>girl</code> ，爱存哪就存哪，而下面再添加一个 <code>spec</code> 目录：</p>
<p>一键完成： <code>mkdir -p girl/spec</code> </p>
<p>在 <code>spec</code> 目录下建立一个文件叫做 <code>girl_spec.rb</code> ，注意到这个 <code>_spec</code> 了吗，这样一看就知道是一个 RSpec 的测试文件，有木有！！！！！用你喜欢的编辑器打开 <code>girl_spec.rb</code> 并敲入以下代码：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre><span class="title">describe</span> <span class="type">Girl</span> <span class="keyword">do</span>
<span class="title">trueit</span> <span class="string">"has chance?"</span> <span class="keyword">do</span>
<span class="title">truetrueGirl</span>.chance?.should be_true
<span class="title">trueend</span>
<span class="title">end</span>
</pre></td></tr></table></figure>

<p>好了，相信各位都看的懂这个例子，我们描述了一个女孩，有机会吗？应该有吧！让我们在更深入的理解以上这位女孩之前，不是，是深入理解这段代码。。。首先 <code>describe</code> 区块 (block) 包含了一个描述这个女孩的测试 (<code>it</code>)，而你宣称你应该有机会 (<code>Girl.chance?.should be_true</code>)。这跟断言有点像 (<code>assert</code>)。而如果其结果不如预期的话，RSpec 会报错并停止这个测试 (spec)。</p>
<p>那这个 <code>should</code> 哪来的，它还有一个兄弟 <code>should_not</code>，呵呵，RSpec 帮你定义好的。</p>
<blockquote>
<p>When RSpec executes specifications, 
  it defines #should and #should_not 
  on every object in the system. 
  These methods are your entry to the    magic of RSpec.
  -- <a href="http://rspec.info/">RSpec.info</a></p>
</blockquote>
<p>现在让我们运行看看，将终端切换到 <code>girl</code> 目录下：<code>[your-path-to/girl] $</code> ，接著输入：</p>
<p><code>rspec spec</code></p>
<p>究竟你跟她有没有机会呢。。。登登登。。。</p>
<p>神马！？</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre><span class="title">uninitialized</span> constant Girl (NameError)
</pre></td></tr></table></figure>

<p>你根本就不知道这女孩是谁，就想追人家了，好小子你，接下来让我们定义一下这个 Girl 常量（类）。要定义她的话，得先添加另外一个目录，叫做 <code>lib</code> ，为什么呢？因为女孩都喜欢住在房子里 (live in building，无恶意。。。)，不是，因为之后 RSpec 会替你识别这个目录，帮你引用进来。。。</p>
<p>在这个目录里添加一个 <code>girl.rb</code>，并填入：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="class"><span class="keyword">class</span> <span class="title">Girl</span>

<span class="title">end</span>
</pre></td></tr></table></figure>

<p>好了，再来我们还得回头告诉 RSpec 咱要追的是哪个女孩，回到 <code>girl_spec.rb</code> ，添加：<code>require girl</code> 呵呵，大家都需要。。。当你再次运行这个测试 <code>rspec spec</code> ，因为你告诉了 RSpec 要载入这个 <code>girl</code> ，RSpec 会把 <code>lib</code> 目录添加到与 <code>spec</code> 同一层，这就是为什么你可以找到 <code>lib/girl.rb</code> 的原因，但是唉妈呀！又出错了：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="code"><pre>F

Failures:

  <span class="number">1</span>) Girl has chance?
     Failure/<span class="keyword">Error</span>: Girl.chance?.should be_true
     NoMethodError:
       undefined method `chance?<span class="comment">' for Girl:Class</span>
     # ./spec/girl_spec.rb:<span class="number">5</span>:<span class="keyword">in</span> `block (<span class="number">2</span> levels) <span class="keyword">in</span> &lt;top (required)&gt;<span class="comment">'</span>

Finished <span class="keyword">in</span> <span class="number">0.00056</span> seconds
<span class="number">1</span> example, <span class="number">1</span> failure

Failed examples:
</pre></td></tr></table></figure>

<p>真是完整的错误信息阿！<code>F</code> 告诉我们失败了，就像你在 <code>Test::Unit</code> 里看到的一样，而下面它告诉你详细的错误信息，让你可以即时改正，所以说呢，女生找老公，找程序员是靠谱的了，每天都拼命找哪里犯了错，并且马上改！心动不如马上行动，有兴趣的姑娘立即发短信至 <a href="http://v.youku.com/v_show/id_XMjQzNTkzMDM2.html">13910733521</a>，童叟无欺。</p>
<p>回头看这到底哪儿错了：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre>NoMethodError:
trueundefined method `chance?' <span class="keyword">for</span> Girl:Class
</pre></td></tr></table></figure>

<p>哦，原来我们还没研究出，我们和一个女孩到底有没有戏的方法，让我们现在来定义一个：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre><span class="class"><span class="keyword">class</span> <span class="title">Girl</span>
<span class="title">truedef</span> <span class="title">self</span>.<span class="title">chance</span>?
<span class="title">truetruetrue</span>
<span class="title">trueend</span>
<span class="title">end</span>
</pre></td></tr></table></figure>

<p>这里我们用了 <code>self.chance?</code> ，在类的级别定义。意思是说呢，只要是女孩这个类的，都有戏！如果你没有加这个 <code>self</code> 的话，那就得是属于女孩这个类产生的实体才有戏了。现在我们在运行看看 <code>rspec spec</code> ：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre>.

Finished <span class="keyword">in</span> 0.00367 seconds
1 example, 0 failures
</pre></td></tr></table></figure>

<p>和 <code>Test::Unit</code> 一样，用一个极富深意的点，告诉我们测试通过！太棒了！这是我们写的第一个 RSpec 测试，欢呼！</p>
<p>好，假设今天，你不想要每个是女孩类别的都有戏，这样子太困扰了，每天都被骚扰。你只想要女孩类别所产生的实体有戏就好了。让我们看看怎么做，首先呢，你打开 <code>lib/girl.rb</code> ，并把 <code>self</code> 拿掉：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre><span class="class"><span class="keyword">class</span> <span class="title">Girl</span>
<span class="title">truedef</span> <span class="title">chance</span>?
<span class="title">truetruetrue</span>
<span class="title">trueend</span>
<span class="title">end</span>
</pre></td></tr></table></figure>

<p>并且相应的改动你的 spec：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre>require <span class="comment">'girl'</span>

describe Girl <span class="keyword">do</span>
  it <span class="string">"has chance?"</span> <span class="keyword">do</span>
    Girl.<span class="keyword">new</span>.chance?.should be_true
  <span class="keyword">end</span>
<span class="keyword">end</span>
</pre></td></tr></table></figure>

<p>运行： <code>rspec spec</code> ，呼，终于摆脱了一卡车的女孩了，呵呵！</p>
<p>现在让我们再来往这个测试添点东西，加入一个 <code>taken!</code> 方法，被把走了，也就是说这个女孩没戏了。这个方法呢，在 <code>Girl</code> 对象上创了一个实体变量叫做 <code>@taken</code>，而你将使用 <code>chance?</code> 方法来检验。</p>
<p>首先呢，你得先在测试里，测试这个 <code>taken!</code> 方法，是否是做你想要做的事儿。让我们在 <code>spec/girl_spec.rb</code> 里面再添一个例子：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="code"><pre>require <span class="comment">'girl'</span>

describe Girl <span class="keyword">do</span>
  it <span class="string">"has chance?"</span> <span class="keyword">do</span>
    Girl.<span class="keyword">new</span>.chance?.should be_true
  <span class="keyword">end</span>

  it <span class="string">"taken!"</span> <span class="keyword">do</span>
    girl = Girl.<span class="keyword">new</span>
    girl.taken!
    girl.should be_chance
  <span class="keyword">end</span>
<span class="keyword">end</span>
</pre></td></tr></table></figure>

<p>再我们测试之前，发现到了没有，有木有？你 YRY 了，You Repeat Yourself! 你可以看到我们定义了一个 <code>Girl.new</code> 然后第一个例子里又使用了 <code>Girl.new</code> ，而我们是果断支持 DRY 的，所以...</p>
<p>嗯嗯，让我们思索一下如何整理代码，1, 2, 3 秒，OK! 让我们把 <code>Bacon.new</code> 放到一个 <code>subject</code> 区块。 <code>subject</code> 允许你在所有位于 <code>describe</code> 区块内的测试里建立一个对象的索引。你可以这样定义一个 <code>subject</code> ：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>subject { Girl.<span class="keyword">new</span> }
</pre></td></tr></table></figure>

<p>而现在我们的测试文件：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="code"><pre>require <span class="comment">'girl'</span>

describe Girl <span class="keyword">do</span>

truesubject { Girl.<span class="keyword">new</span> }

  it <span class="string">"has chance?"</span> <span class="keyword">do</span>
    Girl.<span class="keyword">new</span>.chance?.should be_true
  <span class="keyword">end</span>

  it <span class="string">"taken!"</span> <span class="keyword">do</span>
    girl = Girl.<span class="keyword">new</span>
    girl.taken!
    girl.should be_chance
  <span class="keyword">end</span>
<span class="keyword">end</span>
</pre></td></tr></table></figure>

<p>你在这个测试的语境中，宣告了一个 <code>subject</code> ，然后我们来改写一下，比如第一个测试，有没有戏呢，你现在可以这样子替换：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre><span class="function"><span class="title">its</span><span class="params">(:chance?)</span> { <span class="title">should</span> <span class="title">be_true</span> }
</pre></td></tr></table></figure>

<p>这个 <code>its</code> 方法，接受一个方法的名字来调用这个 <code>subject</code> (Ruby 继承自 smalltalk，调用方法其实都是给对象发信息) 。然而后方这个 <code>{ ... }</code> 区块应该要包含一个预测这个方法调用完的结果。</p>
<p>然而我们还可以这样调用：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre>it <span class="string">"taken!"</span> <span class="keyword">do</span>
  subject<span class="variable">.taken</span>!
  subject<span class="variable">.should_not</span> be_chance
<span class="keyword">end</span>
</pre></td></tr></table></figure>

<p>而这里 <code>taken!</code> 方法必须使用 <code>subject</code> 来调用，因为我们只在 <code>Girl</code> 类别里有定义她。在这个情况，你没有使用 <code>its</code> ，因为你想要调用 <code>taken!</code> 方法，并且确认这个方法是否改变了 <code>chance?</code> 方法所返回的结果。</p>
<p>呼，意思就是女孩被追走了，还有没有戏啊？</p>
<p>而为了让我们的代码的可读性更猛一点，我使用了 <code>should_not</code> 来判断 <code>be_chance</code> 。</p>
<p>现在你的 <code>girl_spec.rb</code> 看起来是：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="code"><pre><span class="keyword">require</span> <span class="string">'girl'</span>

describe <span class="constant">Girl</span> <span class="keyword">do</span>

  subject { <span class="constant">Girl</span>.new }

  its(<span class="symbol">:chance?</span>) { should be_true }

  it <span class="string">"taken!"</span> <span class="keyword">do</span>
    subject.taken!
    subject.should_not be_chance
  <span class="keyword">end</span>
<span class="keyword">end</span>
</pre></td></tr></table></figure>

<p>好了，让我们运行看看，土地公公老爷爷阿，究竟女孩与我。。。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre>NoMethodError:
  undefined method `taken!' <span class="keyword">for</span> <span class="preprocessor">#&lt;Girl:0x0000010087bcb0&gt;</span>
</pre></td></tr></table></figure>

<p>搞半天我根本还没定义 <code>taken!</code> 方法啊，失败！立马定义一个，打开 <code>lib/girl.rb</code> ：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="function"><span class="keyword">def</span> <span class="title">taken!</span></span>
trueself.taken = be_true
<span class="keyword">end</span>
</pre></td></tr></table></figure>

<p>OK，再运行一次：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre>NoMethodError:
trueundefined method `taken=' <span class="keyword">for</span> <span class="preprocessor">#&lt;Girl:0x0000010087f838&gt;</span>
</pre></td></tr></table></figure>

<p>呜呜，咋回事儿呢？</p>
<p>原来我用了 <code>self.taken = true</code> ，Ruby 在跟我抱怨找不到这个 <code>taken=</code> 方法。我们可以使用 Ruby 提供的 <code>attr_accessor</code> 方法来定义这些琐碎的 <code>getter/setter</code> : ） 添加这行代码至 <code>lib/girl.rb</code> 最上方：</p>
<p><code>attr_accessor :taken</code></p>
<p>这里 <code>attr</code> 是 attribute 的缩写，学 Ruby 还学英语呢，真好！当你把一个符号（符号是一个冒号带名字 <code>:xxx</code>）传给这个 <code>attr_accessor</code> 方法时，它替你定义了把 <code>taken</code> 设定与取出值的方法。它也替你定义了一个实体变量叫做 <code>@taken</code> 给每一个这个类别的对象设值时使用。</p>
<p>好的，咱的女孩儿现在看起来像是这样：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="code"><pre><span class="class"><span class="keyword">class</span> <span class="title">Girl</span>

<span class="title">trueattr_accessor</span> :<span class="title">taken</span>

<span class="title">truedef</span> <span class="title">chance</span>?
<span class="title">truetruetrue</span>
<span class="title">trueend</span>

<span class="title">truedef</span> <span class="title">taken</span>!
<span class="title">truetrueself</span>.<span class="title">taken</span> = <span class="title">true</span>
<span class="title">trueend</span>

<span class="title">end</span>
</pre></td></tr></table></figure>

<p>再运行一次 <code>rspec spec</code>，月老公公老奶奶阿，看你的了阿：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre><span class="title">expected</span> chance? to return <span class="built_in">false</span>, got <span class="built_in">true</span>
</pre></td></tr></table></figure>

<p>唔？预期没戏，返回的结果是有戏，怎么会这样呢？哎呀，因为 <code>chance?</code> 永远都返回真嘛，我们应该要判断这个女孩是否被把走了，然后再下手。。。嗯嗯嗯：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="function"><span class="keyword">def</span> <span class="title">chance?</span></span>
<span class="keyword">true</span>!taken
<span class="keyword">end</span>
</pre></td></tr></table></figure>

<p>运行 <code>rspec spec</code> !</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre><span class="string">.</span><span class="string">.</span>

<span class="comment">Finished</span> <span class="comment">in</span> <span class="comment">0</span>.<span class="comment">00917</span> <span class="comment">seconds</span>
<span class="comment">2</span> <span class="comment">examples</span>, <span class="comment">0</span> <span class="comment">failures
</pre></td></tr></table></figure>

<p>阿哈，终于成功了！！！！！！！！</p>
<p>但是，要是我们粗心大意，不小心忘了加 <code>self</code> 前缀呢？现在让我们把 <code>self.taken</code> 的 <code>self</code> 拿掉看看。。。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="number">1</span>) Girl taken!
   Failure/Error: subject<span class="variable">.should_not</span> be_chance
     expected chance? to <span class="keyword">return</span> <span class="literal">false</span>, got <span class="literal">true</span>
</pre></td></tr></table></figure>

<p>RSpec 告诉我们：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="number">1</span>) 女孩被把了！
<span class="literal">true</span>失败 / 错误：subject<span class="variable">.should_not</span> be_chance
<span class="literal">true</span>预期没戏，却有戏。
</pre></td></tr></table></figure>

<p>这样还不用 RSpec 么？太牛了！哈哈哈哈。。。</p>
<p>好啦，RSpec 可以避免我们犯这种明显的错误，若犯错，即改之。如果你先写测试，然后让你的代码通过测试，你就会有很强大的自信，你的代码是工作的！而之后重构时，也可以一点一点的重构，在跑的过测试的前提之下。</p>
<p>好的，我们把它改回正确的吧：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="function"><span class="keyword">def</span> <span class="title">taken!</span></span>
trueself.taken = <span class="keyword">true</span>
<span class="keyword">end</span>
</pre></td></tr></table></figure>

<p>运行成功。。。</p>
<p>OK! 现在你对 RSpec 有了基础的认识，之后当你想要这样子开发你的应用时，当然不是我这样子轻浮的方式，是用行为驱动开发方式来开发应用时，你将会需要看看这本书：<a href="http://pragprog.com/book/achbd/the-rspec-book">The RSpec Book</a>。</p>
<p>最后，路上把妹的时候要注意阿各位，记得先测试一下。</p>
<p>待续。。。</p>
<p>延伸阅读：</p>
<p><a href="http://pragprog.com/book/achbd/the-rspec-book">The RSpec Book</a></p>
<p><a href="http://www.slideshare.net/ihower/rspec-7394497">RSpec 让你愛上写测试</a></p>
<p><a href="http://jhjguxin.sinaapp.com/2012/02/26/rspec-best-practices-and-tips/">RSpec Best practices and tips</a></p>
<p><a href="http://blog.csdn.net/onlyqi/article/details/6740930">CSDN 一篇不错的 对测试的认识</a></p>
<p><a href="http://www.letrails.cn/archives/20/">RSpec 简明指南</a></p>
<p><a href="http://vdisk.weibo.com/s/4vJBP">RSpec on Rails PDF</a></p>
<p><a href="http://bookapp.book.qq.com/origin/book/?workid=1956140">低成本泡妞</a></p>
]]></content>
    <category scheme="http://lisp.es//tags/Rails/" term="Rails"/>
    <category scheme="http://lisp.es//categories/Rails/" term="Rails"/>
  </entry>
  <entry>
    <title type="html"><![CDATA[測試！測試！ - 002]]></title>
    <link href="http://lisp.es//2012/04/25/ror-2-test-unit/"/>
    <id>http://lisp.es//2012/04/25/ror-2-test-unit/</id>
    <published>2012-04-25T02:51:00.000Z</published>
    <updated>2013-05-18T19:15:28.000Z</updated>
    <content type="html"><![CDATA[<p><strong>1000 个小时学会 Rails 系列</strong></p>
<blockquote>
<p>The general idea behind unit testing is that you write a test method that makes certain assertions about your code, working against a test fixture. A bunch of these test methods are bundled up into a test suite and can be run any time the developer wants. The results of a run are gathered in a test result and displayed to the user through some UI.
-- Nathaniel Talbott</p>
</blockquote>
<p>好了，Rails 真的很牛。Ruby 是如此优雅精妙，那么程序员真的性福美满了吗？那究竟要如何写出可维护的代码呢？拜读松本行弘的程序世界？不是！连读七遍 Programming Ruby 1.9？有可能！每天上 Ruby-china 学习？这就对了！好了那到底是什么？答案是写测试！</p>
<p>型別</p>
<p>为什么要写测试呢？恩，先谈谈两种程序员吧。一种是自负的程序员，他们觉得：“日出东方，唯我代码不坏”，这种思想其实很好，是社会进步的动力之一。这种人要嘛特别牛，要嘛特别。。。0010，但我们要看清一个事实，是人都会犯错。另一种程序员，怎么著都怕出错，在论坛四处发问，哪本书最好，哪个教程最猛，写程序战战兢兢，就跟相亲挑老婆，结果如墨菲先生预言：只要有可能出错，那就一定会出错。第一种程序员，根本不屑写测试，第二种程序员，拼命学写测试，学的连代码都不会写了。该怎么办？</p>
<p>还是写测试！在编码前先写测试，这有什么好处？预测程序的行为、确保程序如你想的那般工作、有写测试让你更有自信，更容易重构代码，理清你的思路，等等好处。那为什么大家都不写测试呢？呃。。。很多原因是老板太凶、日期太紧，但我相信测试可以救你于水火之中。而 Rails 也替你打点了许多的测试工具，让你不用在「编码 -&gt; 储存 -&gt; 刷新 -&gt; 编码 -&gt; 储存 -&gt; 刷新...」、要是一个个视图、一个个模型、一个个控制器都是如此手工测试，搞得你晚上八点还在公司，一出错又不知从何查起，真是一场永远不会醒的恶梦。测试可以使我们确保程序正常运作，将用户行为转为测试，让我们有一个开发的方向。未来出错时，可以改动现有的测试来适应新的情况，让你可以早日回家陪老婆孩子（家庭第一），正所谓，测试写得好，挣钱挣到老，测试写的巧，上班没烦恼。</p>
<p>月有阴晴圆缺，而生命会自己找到出口，就这样，有了<a href="http://zh.wikipedia.org/wiki/%E6%B5%8B%E8%AF%95%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91">测试驱动开发</a>（Test-Driven Development, TDD）以及<a href="http://zh.wikipedia.org/wiki/%E8%A1%8C%E4%B8%BA%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91">行为驱动开发</a>（Behavior-Driven Development, BDD）。TDD 又有一个名字叫做 Red-Green-Refactor。先写好测试，运行，错误一堆（满江红），撰写可以通过测试的代码（绿油油），测试通过后再重构，确保代码仍然工作。这样子的好处是？一来先写测试可以先让你想想程序的思路，与下棋有异曲同功之妙，只不过下棋咱是在脑里演练；二来写测试可以确保你的程序正常工作，预期未来可能发生的错误。然而我们从小的教育不是这样，导致我们害怕犯错，以前可以考试先考差了，再让你重写一次考卷嘛？现在机会来了。写测试吧！</p>
<p>恩，至于这 BDD 与 TDD 精确的定义呢，危机、摆渡百科都有，谷歌百度一下吧，就不赘述了，用了就知道！BDD 是基于 TDD 所造出来的，旨在测试整个程序中，各个“正常工作代码”之间的互动。也就是说呢，TDD 搭配 BDD 使用。TDD 的工具我们将粗浅介绍 Test::Unit，BDD 我们将介绍的是 RSpec 搭配 海豚 (Capybara)，小黄瓜 (Cucumber) 就别用了，太坑爹了，还是留著配炸酱面吧！</p>
<p>还是不怎么信么？那我再好好讲一次测试的好处，你想想，如果你要测试某个页面的表单，填了某个值会发生什么事，要是这个表单一共有九种变化，共有九种不同表单，九九八十一个变化，还不算你手滑按错的错误，这测起来真是想死的心都有了（爱惜生命！）。让计算机自动帮我们测试，比起手工测试好、省时又省心。另一个好处是，测试可以预防你犯傻。当你犯了一个再明显不过的错误时，测试可以替你找出来，替你的程序做一个健康检查，让你获得更多信息，由测试通知你，总比暴跳如雷的老板来得好。用户永远都有无止尽的好奇心，会在你想都想不到的地方，把东西弄坏！有了之前的测试，你可以轻松的改写之前的测试，来满足这个你未预期的情况，这又叫作<a href="http://zh.wikipedia.org/wiki/%E5%9B%9E%E5%BD%92%E6%B5%8B%E8%AF%95">回归测试</a> (Regression Test)</p>
<p>现在我们来看怎么用 Test::Unit 写测试吧！</p>
<h3>撰写第一个测试</h3>
<p>Ruby 的 <code>Test::Unit</code> 写了一堆的函式库，就在哪里，等著、盼著、寂寞地等你调用它们。接下来我来讲一个简单的 <code>Test::Unit</code> 例子。首先建立一个目录，叫作 <code>example</code> ，在这个目录里你创一个文件：<code>example_test.rb</code> 。记得把测试加上 <code>_test</code> 的字尾，这样子一看就知道这是一个测试文件。打开这个 <code>example_test.rb</code> ，敲入以下代码：</p>
<pre><code>require <span class="string">'test/unit'</span>

<span class="class"><span class="keyword">class</span> <span class="title">ExampleTest</span> &lt; <span class="title">Test</span>::<span class="title">Unit</span>::<span class="title">TestCase</span>
  <span class="title">def</span> <span class="title">test_truth</span>
    <span class="title">assert</span> <span class="title">true</span>
  <span class="title">end</span>
<span class="title">end</span>
</code></pre>
<p><code>Test::Unit</code> 测试呢，首先引入 Ruby 标准函式库的 <code>&#39;test/unit&#39;</code> 。这让你可以从 <code>Test::Unit::TestCase</code> 继承它所有的东西（要是可以 <code>require &#39; 李嘉诚 &#39;</code> 就好了，我也不用。。。）。那究竟继承了什么？继承了让你可以在类里面，将名字取为 <code>test_</code> 打头的方法来写测试的功能，<code>test_xxxx</code> 会被识别成是测试。</p>
<p>第一个测试写好了！！！！！！！（咆哮体），让我们来运行看看： </p>
<p><code>ruby example_test.rb</code> </p>
<p>你会看到像是这样的输出：</p>
<pre><code>.

Finished tests <span class="keyword">in</span> <span class="number">0.000866</span>s, <span class="number">1154.7344</span> tests<span class="regexp">/s, 1154.7344 assertions/</span>s.

<span class="number">1</span> tests, <span class="number">1</span> assertions, <span class="number">0</span> failures, <span class="number">0</span> errors, <span class="number">0</span> skips
</code></pre>
<p>那个奇怪的点是什么呢？这是 <code>Test::Unit</code> 告诉你一个测试成功通过的方式， <code>F</code> 代表不通过的测试, <code>E</code> 代表有错误的测试，那 <code>(.)(.)</code> 呢？哈哈开个玩笑，确保你有认真看。跟著点之后是一些统计数据，告诉你一个测试、一个断言 (assertion)、零个失败、零个错误、零个跳过。</p>
<p>在你的测试中你用了一个 <code>assert</code> 方法，你断言传入的参数为真。然而我们传入的是真（非 <code>nil</code> 与 <code>false</code> 亦为真），假如不知为何的这个方法失败了，会引起一个 exception 告诉你。 </p>
<p>如果你的方法名不是 <code>test_</code> 打头：</p>
<pre><code>test <span class="string">"truth"</span> <span class="keyword">do</span>
    <span class="built_in">assert</span> <span class="keyword">true</span>
<span class="keyword">end</span>
</code></pre>
<p>你再运行看看 (<code>ruby example_test.rb</code>)，会发现</p>
<pre><code><span class="title">No</span> tests were specified.
<span class="number">1</span> tests, <span class="number">1</span> assertions, <span class="number">1</span> failures, <span class="number">0</span> errors
</code></pre>
<p>这是因为 <code>Test::Unit</code> 调用了缺省的 <code>default_test</code> 缘故，若你使用的是 1.9.3+ 的 Ruby 只会显示没有测试。</p>
<p>所以记得把测试方法名用 <code>test_</code> 开头！</p>
<p>接下来让我们考虑一个更复杂的方法，建立一个 <code>love_test.rb</code> ：</p>
<pre><code>require <span class="string">'test/unit'</span>
<span class="class"><span class="keyword">class</span> <span class="title">LoveTest</span> &lt; <span class="title">Test</span>::<span class="title">Unit</span>::<span class="title">TestCase</span>
  <span class="title">def</span> <span class="title">test_saved</span>
    <span class="title">assert</span> <span class="title">Love</span>.<span class="title">saved</span>?
  <span class="title">end</span>
<span class="title">end</span>
</code></pre>
<p>当然了，你想确保你的愛情有保存，但是当你运行时 <code>ruby love_test.rb</code> ，哎呀：</p>
<pre><code><span class="attribute">NameError</span>: <span class="string">uninitialized constant LoveTest::Love</span>
</code></pre>
<p>哪知道你根本还没有愛情，让我们来定义爱情：</p>
<pre><code><span class="class"><span class="keyword">class</span> <span class="title">Love</span>

<span class="title">end</span>
</code></pre>
<p>那这个愛情要放在测试之前呢，还是测试之后呢？在 <code>Test::Unit</code> 里是都可以，在 Ruby 里面东西都是得先定义才能使用，但是 <code>Test::Unit</code> 会先把所有的代码求值，再来运行测试，所以现在 <code>love_test.rb</code> ：</p>
<pre><code>require <span class="string">'test/unit'</span>

<span class="class"><span class="keyword">class</span> <span class="title">Love</span>

<span class="title">end</span>

<span class="title">class</span> <span class="title">LoveTest</span> &lt; <span class="title">Test</span>::<span class="title">Unit</span>::<span class="title">TestCase</span>
  <span class="title">def</span> <span class="title">test_saved</span>
    <span class="title">assert</span> <span class="title">Love</span>.<span class="title">saved</span>?
  <span class="title">end</span>
<span class="title">end</span>
</code></pre>
<p>接下来再运行看看 <code>ruby love_test.rb</code> ：</p>
<pre><code><span class="attribute">NoMethodError</span>: <span class="string">undefined method `saved?' for Love:Class</span>
</code></pre>
<p>错误信息明确的告诉我们，愛情是不能保质的，看来 Ruby 也挺懂人情事理的，但我們可以自己定義一個保存的方法：</p>
<pre><code><span class="class"><span class="keyword">class</span> <span class="title">Love</span></span>
    <span class="function"><span class="keyword">def</span> <span class="title"><span class="keyword">self</span></span>.<span class="title">saved?</span></span>
      <span class="keyword">true</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>
</code></pre>
<p>接著运行你会如预期的发现测试通过，但是有一天，就是風雨交加的那天，不知为何某女把你的测试改成 <code>false</code> ：</p>
<pre><code>F

Finished tests <span class="keyword">in</span> <span class="number">0.001137</span>s, <span class="number">879.5075</span> tests<span class="regexp">/s, 879.5075 assertions/</span>s.

  <span class="number">1</span>) Failure:
test_saved(LoveTest) [love_test.rb:<span class="number">14</span>]:
Failed assertion, <span class="literal">no</span> message given.
</code></pre>
<p>失败，最惨的是 <code>no message given</code> 。。。</p>
<p>居然什么信息也不给，唉，其实这是 <code>Test::Unit</code> 一贯回报测试失败的方式，</p>
<p>然而某女突然觉得过意不去，又回头给你加上一个更清楚的信息：</p>
<pre><code>  <span class="comment">assert</span> <span class="comment">Love</span>.<span class="comment">saved?</span>, <span class="comment">"咱俩不合适！</span> <span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="comment">"</span> 
</code></pre>
<p>现在你再运行测试，你会得到一个清楚的错误信息</p>
<pre><code>  1) <span class="tag">Failure</span>:
<span class="tag">test_saved</span>(<span class="tag">LoveTest</span>) <span class="attr_selector">[love_test.rb:16]</span>:
咱俩不合适！
</code></pre>
<p>嗯，你懂得，我的朋友。。。。。他说风雨中这点痛算什么，擦乾泪不要问，至少我们还有梦！</p>
<p>这就是使用 <code>Test::Unit</code> 非非非非非非常基本的 TDD 了， <code>Test::Unit</code> 是 Rails 缺省的测试框架，在我们漫长的学习 Rails 的旅途中，你将会常常看到它，并且克制不住的或是被逼迫的使用它。</p>
<p>记得哦，爱情是没有保质期的，亲。</p>
<p>距离学会 Rails 还有 965 个小时。。。</p>
<p>待续。。。</p>
<h3>延伸阅读</h3>
<p><a href="http://courseware.codeschool.com.s3.amazonaws.com/rails_testing.pdf">CodeSchool: Rails Testing for Zombies slides</a></p>
<p><a href="http://guides.rubyonrails.org/testing.html">A Guide to Testing Rails Applications</a></p>
<p><a href="http://ihower.tw/rails3/testing.html">测试 Testing</a></p>
<p><a href="http://rubykoans.com/">Ruby Koans</a></p>
<p><a href="http://ruby-china.org/search?q=Test%3A%3AUnit">Ruby-china 上关于测试的帖子</a></p>
<p><a href="http://ruby-doc.org/stdlib-1.9.3/libdoc/test/unit/rdoc/Test/Unit.html">Ruby Test::Unit 函式库</a></p>
<p><a href="http://www.google.com.hk/webhp?hl=zh-CN&amp;sourceid=cnhp#hl=zh-CN&amp;safe=strict&amp;site=webhp&amp;source=hp&amp;q=%E4%B8%BA%E4%BB%80%E4%B9%88%E5%A5%B3%E6%9C%8B%E5%8F%8B%E4%B8%8D%E8%A6%81%E6%88%91%E4%BA%86&amp;oq=%E4%B8%BA%E4%BB%80%E4%B9%88%E5%A5%B3%E6%9C%8B%E5%8F%8B%E4%B8%8D%E8%A6%81%E6%88%91%E4%BA%86&amp;aq=f&amp;aqi=&amp;aql=&amp;gs_nf=1&amp;gs_l=hp.3...1405.6419.0.6789.34.32.1.0.0.0.105.1818.30j1.31.0.uZEfYhm1ZUM&amp;bav=on.2,or.r_gc.r_pw.,cf.osb&amp;fp=4de69b13c14b576b">为什么女朋友不要我了</a></p>
]]></content>
    <category scheme="http://lisp.es//tags/Rails/" term="Rails"/>
    <category scheme="http://lisp.es//categories/Rails/" term="Rails"/>
  </entry>
  <entry>
    <title type="html"><![CDATA[你的第一个 Rails 应用 - 001]]></title>
    <link href="http://lisp.es//2012/04/22/ror-1-first-app/"/>
    <id>http://lisp.es//2012/04/22/ror-1-first-app/</id>
    <published>2012-04-22T14:11:00.000Z</published>
    <updated>2013-05-18T19:15:28.000Z</updated>
    <content type="html"><![CDATA[<p><strong>1000 個小時學會 Rails 系列</strong></p>
<h2>001 你的第一个 Rails 应用</h2>
<p>在我们来做第一个 Rails 应用之前，先讲讲 Rails 框架的三大哲学：</p>
<ul>
<li><p>DRY 不是 DIY 阿，可别看错了。意思是不要重造轮子，要在前人的大树下乘凉。</p>
</li>
<li><p>Convention Over Configuration，约定优于配置，很多事儿大牛们都替你想好了。</p>
</li>
<li><p>REST 网络应用最佳模式，让你组织你的应用，符合标准的 HTTP 操作。</p>
</li>
</ul>
<p>型別</p>
<p>再来不免俗的我也来讲讲 MVC，MVC 是 Model View Controller 的缩写，模型、视图、控制器。恩不负责任的解释一下大概是：</p>
<ul>
<li><p>模型 -- 让程序员远离操作数据库的恶梦</p>
</li>
<li><p>视图 -- 用户看到的页面</p>
</li>
<li><p>控制器 -- 模型与视图的仲介，跟模型要资料拿给视图显示。</p>
</li>
</ul>
<p>为神马要使用 MVC 呢？恩，让业务逻辑脱离页面，还记得<strong>那些年我们一起在 HTML 里面塞 PHP 代码的日子吗？</strong>放心，都过去了，一切都会好起来的。还有一个好处是，让你重复利用你的代码、让你的代码可以更简单的维护。但是这样听起来还是很抽象，等你学了 200 小时左右，你差不多就能有点感觉了，还是没感觉的话，那去 OGC 吧（头转 90 度...）。</p>
<p>好现在让我们开始一个最简单的 Rails 应用... 在这之前，得先安装好环境。</p>
<h3>安装 Rails</h3>
<ul>
<li><p>Windows 有 Installer -&gt; <a href="http://railsinstaller.org/">点我点我点我</a></p>
</li>
<li><p>Mac 的朋友可以看看这个安装脚本：<a href="https://github.com/thoughtbot/laptop">ThoughtBot Laptop Script</a></p>
</li>
</ul>
<p>还可以顺便装一下 RVM，RVM 是 Ruby 版本管理工具，可以让你尝鲜安装最新版的 Ruby，也可以装往日美好的 Ruby，重要的是它还替你的 Gems 造了一个空间，让你不怕把系统弄坏！更多信息：<a href="http://beginrescueend.com/">RVM 官网</a>、<a href="http://blog.eddie.com.tw/2011/04/08/rvm-and-gemsets/">RVM 与 Gemset</a>。</p>
<p>我使用 Rails 3.2.3 版本来讲解之后的例子，你可能需要 Ruby 1.9.3：</p>
<p><code>rvm install 1.9.3</code> (设为缺省：<code>rvm use --default 1.9.3</code> )</p>
<p>如果你的电脑已经有了 Ruby 1.9.2+ 与 <a href="http://ruby.taobao.org/">RubyGems</a>，Mac/Unix 安装 Rails 就是：</p>
<p>  gem install rails -v 3.2.3</p>
<p>也可说是一键安装了...</p>
<p><strong>为什么坊间及各大论坛有无数的帖子及书籍教你如何装 Rails？</strong></p>
<p>恩，很高兴你这么问，Rails 受益于它集成了很多个第三方的 Gems，这可能是你家楼下卖油条的老伯写的 Gem，或是远在太平洋那端美国小伙子边喝酒边写的，也可能是德艺双馨苍老师写的 Gem ，谁知道呢？说不定那人不维护了，以及 Rails 的版本更迭很快，Gem 的版本也更新的很快，同时 Ruby 也在更新，这些组织起来就会有兼容问题，新的好功能不支援旧语法，就变成现在这个情况了，呃。。。每一次 bundle 胆颤心惊，building native ... 看到这个讯息，很有可能又不兼容了，啊！！！！！！！而 GFW 又大大的加大了我们的难度（详见：<a href="RGC">RubyGems 镜像</a>），真是用心，这样子磨练我们，为了让我们都成为一个更好的人，一个更好的程序员。</p>
<p>但是我们不怕，其实我略懂命理，我算过了，萤幕前的你，上辈子的名字是... 折腾。</p>
<p><strong>活著就是快乐的折腾著！</strong></p>
<p>好了，我相信你已经成功安装 Rails。上车吧，动车要开动了。。。</p>
<p>呜——呜—— 呜——呜——</p>
<h3>第一个 Rails 应用</h3>
<p>这个例子呢，叫做 <code>girls_I_loved</code> ，这个应用呢主要是记录我们曾经深爱过的女孩，唉也只是曾经了。</p>
<p>首先我们使用 <code>rails</code> 命令来创建这个应用：</p>
<pre><code><span class="title">rails</span> new girls_I_loved
</code></pre>
<p>接下来，啪拉，一堆信息喷出，<strong>DONT PANIC！</strong> 握紧你的鼠标，真是激动人心的一刻，你终于成为一个大菜鸟 Rails 程序员了。这些产生出来的文件，我们之后会慢慢解释。</p>
<p><em>温馨提示</em> ：<code>rails help</code> 可以看到 <code>rails</code> 命令的帮助信息。</p>
<h4>启动你的应用</h4>
<p>要启动你的应用呢，首先先来一招 <code>cd girls_I_loved</code> 俐落地切换到应用目录下</p>
<p>(<code>[path-to-your-app/girls_I_loved] $</code>)</p>
<p>接下来我们使用 <code>rails server</code> 来启动我们的应用，缺省是使用 Ruby 标配的 WEBrick 服务器，端口三千，打开你的浏览器，</p>
<p>到 <code>http://0.0.0.0:3000/</code> 或是 <code>http://localhost:3000/</code> 或是 <code>http://127.0.0.1:3000/</code> ，</p>
<p>取决于你的喜好，你会看到一个安心上路的页面：</p>
<p><img src="https://github.com/JuanitoFatas/Girls_I_Loved/raw/master/app/assets/images/Ruby%20on%20Rails_%20Welcome%20aboard.png" alt="welcome-page"></p>
<p>右边有两个关于 Rails 的链接，两个 Ruby 文档的链接，你还可以进入：</p>
<p>About your application’s environment 看看你的 Rails 环境。</p>
<p>在里面你会看到有一行：</p>
<p>Environment development</p>
<p>Rails 提供你三种环境：<code>development</code>, <code>test</code>, <code>production</code> ，开发、测试、生产。缺省是 <code>development</code> 模式，在开发模式下呢，你的类不会被缓存的（cached），也就是说你在类里改动你的代码，不需重启服务器，嘿嘿。但是生产模式就不是如此了。</p>
<p>还有这行告诉我们正使用缺省的 <code>sqlite3</code> 数据库：</p>
<p>Database adapter  sqlite3</p>
<p><em>温馨提示</em> ：要跳出服务器，可以按 <code>ctrl + C</code> 。<code>rails s</code> ＝ <code>rails server</code>。</p>
<h4>给我一个鹰架，我可以搭起整个 Rails 应用。</h4>
<p><strong>scaffold</strong> 是 Rails 提供的一个命令，搭载许多基本的功能，让你快速建个原型来看看，我们将会使用鹰架来演示这个例子，基本上实际的项目是不用鹰架的，因为根据不同客户的需求，我们手工打造我们的应用，也有人称 Rails 程序员是 craftman 就是这个缘故。</p>
<p>让我们来创建这个 <code>我们深爱过的女孩</code> 应用吧：</p>
<pre><code>rails generate scaffold girl <span class="property">name</span>:<span class="type">string</span> <span class="type">number</span>:<span class="type">integer</span>
</code></pre>
<p>又是一堆信息，别慌张，其实就是产生了模型、视图、控制器、剩下的稍后叙述。</p>
<p>而</p>
<pre><code>girl <span class="property">name</span>:<span class="type">string</span> <span class="type">number</span>:<span class="type">integer</span>
</code></pre>
<p>这段命令是什么呢？首先 <code>girl</code> 是你深爱过的女孩，<code>name</code> 是她的芳名，类别是字串；<code>number</code> 是第几任，类别是整数。。。</p>
<p>这个命令顺便也替你把数据库、物件属性（attribute）相关的东西都搞好了，接下来让我们在数据库创建这个表。要创建这个表呢，在 Rails 当中叫做迁移（Migration）。</p>
<p>迁移是 Rails 管理数据库版本的一种形式，让你的数据库可以滚动增加它的 schema。为什么说它可以管理数据库的版本呢？嗯，每一个迁移都会盖上一个时间戳章（Timestamp），注明了数据库的日期。这样子别人来跟你一起开发应用时，就知道你确切的数据库日期了。不过这个我们深爱过的女孩应用，还是自己开发就好了，你有注意到刚刚产生的信息中，有一个这样子的文件吗：</p>
<p>db/migrate/[YYYYMMDDHHMMSS]_create_girls.rb</p>
<p>让我们打开这个文件看看（在 <code>db/migrate/</code> 目录下）：</p>
<pre><code><span class="class"><span class="keyword">class</span> <span class="title">CreateGirls</span> &lt; <span class="title">ActiveRecord</span>::<span class="title">Migration</span>
  <span class="title">def</span> <span class="title">change</span>
    <span class="title">create_table</span> :<span class="title">girls</span> <span class="title">do</span> |<span class="title">t</span>|
      <span class="title">t</span>.<span class="title">string</span> :<span class="title">name</span>
      <span class="title">t</span>.<span class="title">integer</span> :<span class="title">number</span>

      <span class="title">t</span>.<span class="title">timestamps</span>
    <span class="title">end</span>
  <span class="title">end</span>
<span class="title">end</span>
</code></pre>
<p>可以看到这个类继承自 <code>ActiveRecord::Migration</code> ，在类里面呢，定义了一个 <code>change</code> 方法。</p>
<p>让我们接著看下去：</p>
<pre><code>create_table <span class="symbol">:girls</span> <span class="keyword">do</span> |t|
</code></pre>
<p>很显然的替我们在数据库建立一个叫做 <code>girls</code> 的表，带有名字与任号，后面的 <code>t.timestamps</code> 就是我刚刚说的时间戳章，会设置成目前的时间（ <code>created_at</code> 与 <code>updated_at</code> ）。有了这个时间戳，Rails 之后还能帮我们恢复数据呢（术语叫做回滚 rollback）！其实呢，这个 <code>change</code> 方法隐含了 <code>up</code> 与 <code>down</code> ，建立与删除资料表，但我们现在不用担心这个，等到你的迁移够复杂时，在拆开来写就好。</p>
<p>OK! 接下来让我们正式迁移看看，敲入这行命令 <code>rake db:migrate</code> ，产生：</p>
<pre><code><span class="comment">==</span>  <span class="comment">CreateGirls:</span> <span class="comment">migrating</span> <span class="comment">====================================================</span>
<span class="literal">-</span><span class="literal">-</span> <span class="comment">create_table(:girls)</span>
   <span class="literal">-</span>&gt; <span class="comment">0</span>.<span class="comment">0021s</span>
<span class="comment">==</span>  <span class="comment">CreateGirls:</span> <span class="comment">migrated</span> <span class="comment">(0</span>.<span class="comment">0022s)</span> <span class="comment">===========================================
</code></pre>
<p>这个 <code>rake db:migrate</code> 命令实际调用了隐含的 <code>up</code> 方法，因为这是你第一次运行迁移命令， Rails 会产生一个 <code>db/development.sqlite3</code> 文件，并产生 <code>girls</code> 表。注意！这个 <code>rake db:migrate</code> 不仅仅只执行一个迁移，它会依序执行你所有的迁移！</p>
<p>Rails 同时也持续关注你的一个文件 <code>db/schema.rb</code> ：</p>
<pre><code>ActiveRecord::Schema<span class="variable">.define</span>(:version =&gt; YYYYMMDDHHMMSS) <span class="keyword">do</span>

  create_table <span class="string">"girls"</span>, :force =&gt; <span class="literal">true</span> <span class="keyword">do</span> |t|
    t<span class="variable">.string</span>   <span class="string">"name"</span>
    t<span class="variable">.integer</span>  <span class="string">"number"</span>
    t<span class="variable">.datetime</span> <span class="string">"created_at"</span>, :null =&gt; <span class="literal">false</span>
    t<span class="variable">.datetime</span> <span class="string">"updated_at"</span>, :null =&gt; <span class="literal">false</span>
  <span class="keyword">end</span>

<span class="keyword">end</span>
</code></pre>
<p>这里的 <code>YYYYMMDDHHMMSS</code> 应跟你的迁移档</p>
<p>（ <code>db/migrate/[YYYYMMDDHHMMSS]_create_girls.rb</code> ）匹配，这让你之后可以这样子加载旧的数据库：</p>
<pre><code><span class="tag">rake</span> <span class="tag">db</span><span class="pseudo">:schema</span><span class="pseudo">:load</span>
</code></pre>
<p><em>温馨提示</em> ：回滚可以透过 <code>rake db:rollback</code> 来给最新一次的迁移做 <code>down</code> 方法。</p>
<h4>加入及浏览深爱过的女孩</h4>
<p>让我们再次启动服务器： <code>rails s</code> ，并开启这个页面： <a href="http://localhost:3000/girls/">http://localhost:3000/girls/</a> ：</p>
<p><img src="https://github.com/JuanitoFatas/Girls_I_Loved/raw/master/app/assets/images/GirlsILoved.png" alt="GirlsILoved"></p>
<p>还没有深爱过的女孩列在上面，让我们按 <code>New Girl</code> 来添加一个：</p>
<p><img src="https://github.com/JuanitoFatas/Girls_I_Loved/raw/master/app/assets/images/NewGirl.png" alt="NewGirl"></p>
<p>你看到你刚刚产生的栏位了吧（名字、任号），这个页面实际上是 <code>GirlsController</code> 的 <code>new</code> 动作（action）的结果。</p>
<p>而这个视图就放在 <code>app/views/girls/new.html.erb</code> ，其内容为：</p>
<pre><code><span class="tag">&lt;<span class="title">h1</span>&gt;</span>New girl<span class="tag">&lt;/<span class="title">h1</span>&gt;</span>

<span class="vbscript">&lt;%= render <span class="comment">'form' %&gt;</span></span>

<span class="vbscript">&lt;%= link_to <span class="comment">'Back', girls_path %&gt;</span></span>
</code></pre>
<p>这是一个 ERB 文件，什么是 ERB 呢？Embedded RuBy。其实是嵌入 Ruby 代码的 HTML 文件。可以这样嵌入：</p>
<p><code>&lt;%=  %&gt;</code> 以及 <code>&lt;%  %&gt;</code> ，带等号会输出在页面上，没带等号不会输出至页面。你可以拿不带等号的来创一些变量：</p>
<pre><code><span class="vbscript">&lt;% hot=<span class="literal">true</span> %&gt;</span>
</code></pre>
<p>呵呵... 在这个 ERB 文件里，</p>
<p>第一行我们可以看到，我们给这个页面下了一个 <code>h1</code> 标题，<code>render</code> 方法传入了一个字串 <code>&#39;form&#39;</code> ，这个 <code>render</code> 方法会去渲染（render）这个字串名字的 <code>partial</code> 。</p>
<p>什么是 <code>partial</code> ？一个 <code>partial</code> 是一个模版，我们可以把它加进来，达到不重用代码的最高原则 DRY！！！！！！</p>
<p><code>link_to</code> 方法替你产生了一个 <code>a</code> 标签，带有 <code>Back</code> 名字，其 <code>href</code> 属性设置为 <code>girls_path</code> ，会自动转成 <code>/girls</code> ，至于为什么我们以后再谈。</p>
<p>很好！现在我们来看看 <code>_form.html.erb</code> 这个文件：</p>
<pre><code>&lt;%= form_for(@girl) do |f| %&gt;
  <span class="keyword">...</span>
&lt;% end %&gt;
</code></pre>
<p>这里定义了一个表单，使用了 <code>form_for</code> 这个 helper。<code>form_for</code> 方法传入了一个参数，一个实体变量叫做 <code>@gril</code> ， 并用这个变量 <code>@girl</code> 来产生一个表单，这个变量是从哪来的呢？茫茫人海中。。。</p>
<p>是从 <code>GirlsController</code> 控制器的 <code>new</code> 动作来的：</p>
<pre><code><span class="function"><span class="keyword">def</span> <span class="title">new</span></span>
  <span class="variable">@girl</span> = <span class="constant">Girl</span>.new

  respond_to <span class="keyword">do</span> |format|
    format.html <span class="comment"># new.html.erb</span>
    format.json { render <span class="symbol">json:</span> <span class="variable">@girl</span> }
  <span class="keyword">end</span>
<span class="keyword">end</span>
</code></pre>
<p>第一行我们呼叫了 Girl 模型的 <code>new</code> 方法，建立了一个实体变量 <code>@girl</code> 。而这个实体变量 <code>@girl</code> 自动由 Rails 替你传给视图。</p>
<p>接下来，有一个 <code>respond_to</code> 方法，定义了这个动作回应的方法（HTML 与 JSON 格式），这里 <code>format.html</code> 会渲染 <code>new.html.erb</code> 这个文件，<code>format.json</code> 会回传一个 <code>@girl</code> 的 JSON 版本。</p>
<p>呼，直到现在你只写了一行代码：</p>
<pre><code>rails generate scaffold girl <span class="property">name</span>:<span class="type">string</span> <span class="type">number</span>:<span class="type">integer</span>
</code></pre>
<p>就得到了这么多，<a href="http://www.washingtonpost.com/business/technology/steve-jobss-last-words-oh-wow-oh-wow-oh-wow/2011/10/31/gIQA3vKCZM_story.html">喔！哇！喔！哇！喔！哇！</a></p>
<p>让我们再回来看看 <code>_form.html.erb</code> ，在 <code>&lt;%= form_for(@girl) do |f| %&gt;</code> 与 <code>&lt;% end %&gt;</code> 之间的区块：</p>
<pre><code>&lt;% <span class="keyword">if</span> @girl.errors.any? %&gt;
  <span class="xml"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"error_explanation"</span>&gt;</span>
    <span class="tag">&lt;<span class="title">h2</span>&gt;</span><span class="vbscript">&lt;%= pluralize(@girl.errors.count, <span class="string">"error"</span>) %&gt;</span> prohibited this girl from being saved:<span class="tag">&lt;/<span class="title">h2</span>&gt;</span>

    <span class="tag">&lt;<span class="title">ul</span>&gt;</span>
    <span class="vbscript">&lt;% @girl.errors.full_messages.<span class="keyword">each</span> <span class="keyword">do</span> |msg| %&gt;</span>
      <span class="tag">&lt;<span class="title">li</span>&gt;</span><span class="vbscript">&lt;%= msg %&gt;</span><span class="tag">&lt;/<span class="title">li</span>&gt;</span>
    <span class="vbscript">&lt;% <span class="keyword">end</span> %&gt;</span>
    <span class="tag">&lt;/<span class="title">ul</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
<span class="vbscript">&lt;% <span class="keyword">end</span> %&gt;</span></span>
</code></pre>
<p>先是检查 <code>@girl</code> 对象是否有任何错误（挑女孩可不能这样哦！），这些错误会从模型来，比如你的这个 <code>@girl</code> 对象没有通过模型所设置的验证（validation）需求，验证稍后讲解。如果有任何错误存在的话，就会被渲染成 <code>if</code> 区块内的内容。</p>
<p>让我们来看看这个 <code>_form.html.erb</code> 的后半部：</p>
<pre><code><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"field"</span>&gt;</span>
  <span class="vbscript">&lt;%= f.label :name %&gt;</span><span class="tag">&lt;<span class="title">br</span> /&gt;</span>
  <span class="vbscript">&lt;%= f.text_field :name %&gt;</span>
<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
<span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"field"</span>&gt;</span>
  <span class="vbscript">&lt;%= f.label :number %&gt;</span><span class="tag">&lt;<span class="title">br</span> /&gt;</span>
  <span class="vbscript">&lt;%= f.number_field :number %&gt;</span>
<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
<span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"actions"</span>&gt;</span>
  <span class="vbscript">&lt;%= f.submit %&gt;</span>
<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
</code></pre>
<p>相信聪明如你，已经看出来这里建立了给我们填入的栏位及按钮。</p>
<p>现在让我们回到浏览器，填入深爱过的女孩的名字，你会看到类似于下图的结果：</p>
<p><img src="https://github.com/JuanitoFatas/Girls_I_Loved/raw/master/app/assets/images/new%20girl%2001.png" alt="new girl 01"></p>
<p>让我们来深入探讨一下是如何得到这个结果的（孤单、寂寞、D 槽）：</p>
<p>当你按下 <code>submit</code> 按钮时，它帮你把数据传给控制器的 <code>create</code> 动作：</p>
<pre><code><span class="function"><span class="keyword">def</span> <span class="title">create</span></span>
  <span class="variable">@girl</span> = <span class="constant">Girl</span>.new(params[<span class="symbol">:girl</span>])

  respond_to <span class="keyword">do</span> |format|
    <span class="keyword">if</span> <span class="variable">@girl</span>.save
      format.html { redirect_to <span class="variable">@girl</span>, <span class="symbol">notice:</span> <span class="string">'Girl was successfully created.'</span> }
      format.json { render <span class="symbol">json:</span> <span class="variable">@girl</span>, <span class="symbol">status:</span> <span class="symbol">:created</span>, <span class="symbol">location:</span> <span class="variable">@girl</span> }
    <span class="keyword">else</span>
      format.html { render <span class="symbol">action:</span> <span class="string">"new"</span> }
      format.json { render <span class="symbol">json:</span> <span class="variable">@girl</span>.errors, <span class="symbol">status:</span> <span class="symbol">:unprocessable_entity</span> }
    <span class="keyword">end</span>
  <span class="keyword">end</span>
<span class="keyword">end</span>
</code></pre>
<p>这里你同样使用了你在 <code>new</code> 动作看过的 <code>Girl.new</code> 。但这次你传入了一个参数，<code>params[:girl]</code> 。params 是 parameters 的缩写，会回传一个从表单传来的像是哈希 (hash) 的对象。当你把这个 <code>params[:girl]</code> 传给 <code>new</code> 方法时，Rails 使用表单的值帮你设定对象的属性。</p>
<p>在 <code>respond_to</code> 是一个 <code>if-else</code> 结构，if 这里的 <code>@girl.save</code> 确保这个记录（record）是合法的，如果储存成功即返回真并存入数据库。</p>
<p>如果我与苍老师之间是真愛，这个 <code>redirect_to</code> 方法将你重導向至新產生的 <code>@girl</code> 对象，这个方法接受一个路径或对象，替你转成相应的路径。这个 <code>redirect_to</code> 方法解读你传入的 <code>@girl</code> 对象，并判断你要到 <code>girl_path</code> 因为这是一个 Girl 模型的对象。这个路径把你带到控制器的 <code>show</code> 动作。里面的 <code>notice:</code> 会显示一个 <code>flash</code> 信息。一个 <code>flash</code> 信息是一个在下次请求（request）所显示的信息。（也就是上图上方的绿色字体）</p>
<p>那要是我跟苍老师的愛是禁断的愛恋怎么办？（not valid），<code>@girl.save</code> 会返回假（任何不是 <code>nil</code> <code>false</code> 视为假）。并使用 <code>render</code> 方法来显示 <code>new</code> 动作的模版。但注意，这里并没有呼叫 <code>new</code> 动作，仅显示模版而已（要让他再次呼叫 <code>new</code> 动作可是非常难的一件事情，这个我留给 Ruby-china 社区的大神解释）。</p>
<p>我们可以使用验证 (validation)，让 <code>@girl</code> 不合法。让我们看看如何做吧！</p>
<h4>验证你与女孩之间的愛</h4>
<p>你可以在模型里加入验证，比如你娘亲要求你只能跟有名字的女孩交往，不能用程序员的方式定义任号（从第一任开始，而不是第零任），且每个女孩只能独立一任。。。世上只有妈妈最伟大，我们只好硬著头皮来实现这个艰钜的请求。</p>
<p>让我们来看看如何实现吧，打开 <code>Girl</code> 模型（ <code>app/models/girl.rb</code>），并将其内容改为：</p>
<pre><code><span class="class"><span class="keyword">class</span> <span class="title">Girl</span> &lt; <span class="title">ActiveRecord</span>::<span class="title">Base</span>
  <span class="title">attr_accessible</span> :<span class="title">name</span>, :<span class="title">number</span>
  <span class="title">validates</span> :<span class="title">name</span>, :<span class="title">presence</span> =&gt; <span class="title">true</span>
  <span class="title">validates</span> :<span class="title">number</span>, :<span class="title">presence</span> =&gt; <span class="title">true</span>,
                     :<span class="title">uniqueness</span> =&gt; <span class="title">true</span>,
                     :<span class="title">numericality</span> =&gt; {</span> :greater_than =&gt; <span class="number">1</span> }
end
</code></pre>
<p>你使用了 <code>validates</code> 方法来定义一个验证，确保有输入名字，任号确保有输入、唯一、大于一。现在让我们试试看，打开这个页面：<a href="http://localhost:3000/girls">http://localhost:3000/girls</a> 按下 <code>New Girl</code> 链接，并直接按 <code>Create Girl</code> 按钮，你会看到如下图般的错误：</p>
<p><img src="https://github.com/JuanitoFatas/Girls_I_Loved/raw/master/app/assets/images/validate-errors.png" alt="validate-errors"></p>
<p>如你预期的错误，现在你可以依照伟大母亲大人的指示输入栏位，</p>
<p>name：<code>&quot;#{初恋情人}&quot;</code></p>
<pre><code>希望不是 NameError: undefined <span class="keyword">local</span> variable <span class="keyword">or</span> method <span class="string">`初恋情人' for main:Object
</code></pre>
<p>让我们在试试看我们的 <code>greater_than</code> 有没有起作用，任号输入 <code>-1</code> 看看：</p>
<p><img src="https://github.com/JuanitoFatas/Girls_I_Loved/raw/master/app/assets/images/minus1.png" alt="minus-one"></p>
<p>It works! 让我们完成这些栏位：</p>
<p><img src="https://github.com/JuanitoFatas/Girls_I_Loved/raw/master/app/assets/images/first-love.png" alt="first-love"></p>
<p>有的朋友会问，怎么任号是 2 了，不对吧？不好意思各位，<strong>1 号的位置我留给了永远的苍老师。</strong></p>
<p>在网址栏的结尾你会看到</p>
<p><a href="http://localhost:3000/girls/N">http://localhost:3000/girls/N</a></p>
<p><code>N</code> 是模型 Girl 中一个独一无二的数字 ID。这哪来的？让我们看看控制器中的 <code>show</code> 动作的视图模版（在 <code>app/views/girls/show.html.erb</code> ）：</p>
<pre><code><span class="tag">&lt;<span class="title">p</span> <span class="attribute">id</span>=<span class="value">"notice"</span>&gt;</span><span class="vbscript">&lt;%= notice %&gt;</span><span class="tag">&lt;/<span class="title">p</span>&gt;</span>

<span class="tag">&lt;<span class="title">p</span>&gt;</span>
  <span class="tag">&lt;<span class="title">b</span>&gt;</span>Name:<span class="tag">&lt;/<span class="title">b</span>&gt;</span>
  <span class="vbscript">&lt;%= @girl.name %&gt;</span>
<span class="tag">&lt;/<span class="title">p</span>&gt;</span>

<span class="tag">&lt;<span class="title">p</span>&gt;</span>
  <span class="tag">&lt;<span class="title">b</span>&gt;</span>Number:<span class="tag">&lt;/<span class="title">b</span>&gt;</span>
  <span class="vbscript">&lt;%= @girl.number %&gt;</span>
<span class="tag">&lt;/<span class="title">p</span>&gt;</span>


<span class="vbscript">&lt;%= link_to <span class="comment">'Edit', edit_girl_path(@girl) %&gt;</span></span> |
<span class="vbscript">&lt;%= link_to <span class="comment">'Back', girls_path %&gt;</span></span>
</code></pre>
<p>第一行是 <code>notice</code> 方法，显示由 <code>create</code> 动作内，重定向 <code>redirec_to</code> 里设置的 <code>notice</code> ：</p>
<p>  format.html { redirect_to @girl, notice: &#39;Girl was successfully created.&#39; }</p>
<p>之后在 <code>p</code> 标签里，呼叫 <code>@girl</code> 的 <code>name</code> 与 <code>number</code> 方法，显示名字及任号，这个对象是在你控制器的 <code>show</code> 动作所定义的：</p>
<pre><code>def show
  @girl = Girl.find(params[:id])

  <span class="keyword">...</span>
end
</code></pre>
<p>这个 <code>Girl</code> 类别的 <code>find</code> 方法让你找到 ID 是 <code>params[:id]</code> 的纪录（record），创建一个新的 <code>Girl</code> 对象，并把 <code>params[:id]</code> 作为网址的结尾数字 <code>N</code>。</p>
<p>让我们在回到 <code>show.html.erb</code> 文件的下方：</p>
<pre><code>&lt;<span class="variable">%=</span> link_to <span class="string">'Edit'</span>, edit_girl_path(<span class="variable">@girl</span>) <span class="variable">%&gt;</span> |
&lt;<span class="variable">%=</span> link_to <span class="string">'Back'</span>, girls_path <span class="variable">%&gt;</span>
</code></pre>
<p>产生了两个链接，Edit 与 Back。第一个 <code>link_to</code> 方法的第二个参数 <code>edit_girl_path(@girl)</code> 方法是由 <code>config/routes.rb</code> 里的一个方法调用所提供的。让我们现在来看看 <code>config/routes.rb</code> 。</p>
<h4>陆游：山重水复疑无路，柳暗花明又一村</h4>
<p>看来我们南宋朝的诗人就懂得 Rails 的路由了。。。（唉你现在知道为什么这篇文章分类是瞎扯淡了吧）</p>
<p>这柳暗花明又一村呢，是哪一村，让我们看看 <code>config/routes.rb</code> 这一村（没有注解）：</p>
<pre><code>GirlsILoved::Application<span class="variable">.routes</span><span class="variable">.draw</span> <span class="keyword">do</span>
  resources :girls
<span class="keyword">end</span>
</code></pre>
<p>每个 Rails 应用的 <code>config/routes.rb</code> 文件，都用了简洁的 Ruby 语法定义了应用程序的路由。这个文件里使用的方法，定义了请求至控制器之间的路线。</p>
<pre><code><span class="title">resources</span> :girls
</code></pre>
<p>在 Rails 当中，相似对象的集合，称为资源（resources）。这个方法定义了路由（routes）与路由的 helpers，这个 helper 比如我们使用的这个 <code>edit_girl_path</code> 。下表列出了路由以及对应的 helper：</p>
<p><img src="https://github.com/JuanitoFatas/Girls_I_Loved/raw/master/app/assets/images/helpers-routes.png" alt="helpers-routes"></p>
<p>在这个表里，:id 可以被记录的 ID 替换。每一个路由的 helper 都有一个替代版本，可以给你全部的网址。把 <code>girls_path</code> 换成 <code>girls_url</code> 就会给你完整的网址：<a href="http://localhost:3000/girls。">http://localhost:3000/girls。</a></p>
<p>另外，有两个路由会根据不同的请求（request），做出不同的动作。如果你使用 <code>GET</code> 请求的话，第一个路由：<code>/girls</code> 会带你到 <code>GirlsController</code> 的 <code>index</code> 动作。<code>GET</code> 请求是标准浏览器的请求之一，这是你对这个应用做的第一个请求（到 <a href="http://localhost:3000/">http://localhost:3000/</a> 页面）如果你对这个路由 <code>/girls</code> 做 <code>POST</code> 请求，它会去调用控制器的 <code>create</code> 动作。这也是你先前按下 New Girl 的动作。恩，我讲你可能不太相信，让我带你看看，先跳到 <a href="http://localhost:3000/girls/new">http://localhost:3000/girls/new</a> 页面，并鼠标右键 -&gt; 检视源代码，你会看到表单中：</p>
<pre><code><span class="tag">&lt;<span class="title">form</span> <span class="attribute">accept-charset</span>=<span class="value">"UTF-8"</span> <span class="attribute">action</span>=<span class="value">"/girls"</span> <span class="attribute">class</span>=<span class="value">"new_girl"</span> <span class="attribute">id</span>=<span class="value">"new_girl"</span> <span class="attribute">method</span>=<span class="value">"post"</span>&gt;</span>

<span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">"/purchases"</span> <span class="attribute">class</span>=<span class="value">"new_purchase"</span> <span class="attribute">id</span>=<span class="value">"new_purchase"</span> <span class="attribute">method</span>=<span class="value">"post"</span>&gt;</span>
</code></pre>
<p>嘿嘿！这里有两个要注意的属性，就是 <code>action</code> 与 <code>method</code> 属性。<code>action</code> 指出了这个表单要去的路由，而 <code>method</code> 告诉浏览器何种 HTTP 请求。</p>
<p>这个表单是在哪渲染的呢？呵呵，你先前已经看过了，在 <code>app/views/girls/new.html.erb</code> ：</p>
<pre><code><span class="tag">&lt;<span class="title">h1</span>&gt;</span>New girl<span class="tag">&lt;/<span class="title">h1</span>&gt;</span>

<span class="vbscript">&lt;%= render <span class="comment">'form' %&gt;</span></span>

<span class="vbscript">&lt;%= link_to <span class="comment">'Back', girls_path %&gt;</span></span>
</code></pre>
<p>这里我们渲染了一个 <code>partial</code>，位于 <code>app/views/girls/_form.html.erb</code> 的 <code>form</code>：</p>
<pre><code>&lt;<span class="variable">%=</span> form_for(<span class="variable">@girl</span>) <span class="keyword">do</span> |f| <span class="variable">%&gt;</span>
</code></pre>
<p>这一行伟大的代码产生了 <code>form</code> 表单！等会儿我们看看 <code>edit</code> 动作时，你会发现同样的表单有不同的结果，太猛了！</p>
<p>另一个不同的路由是 <code>/girls/{id}</code> 路由，这个路由有三个方式。第一个是你已经看过的，你加入一个你深愛的女孩，使用 GET 请求来重定向的 <code>show</code> 动作，第二个是我们现在要讨论的 <code>update</code> ，更新你深愛的女孩的数据。</p>
<p>现在让我们来改动一下女孩的任号，或许初恋情人是你的第五任也说不定（有的人觉得直到他找到对的女孩才算初恋，之前的一点恋愛感觉都没有）打开
<a href="http://localhost:3000/girls">http://localhost:3000/girls</a> 页面，按下 Edit 链接，你会看到如下的图示：</p>
<p><img src="https://github.com/JuanitoFatas/Girls_I_Loved/raw/master/app/assets/images/edit-first-love.png" alt="edit-first-love"></p>
<p>这个页面跟我们看到的 <code>new</code> 动作所产生的页面相似。体会到 <code>partial</code> 的威力了么？你可以根据不同的请求，使用同样的代码。这个 <code>edit.html.erb</code> 的内容为：</p>
<pre><code><span class="tag">&lt;<span class="title">h1</span>&gt;</span>Editing girl<span class="tag">&lt;/<span class="title">h1</span>&gt;</span>

<span class="vbscript">&lt;%= render <span class="comment">'form' %&gt;</span></span>

<span class="vbscript">&lt;%= link_to <span class="comment">'Show', @girl %&gt;</span></span> |
<span class="vbscript">&lt;%= link_to <span class="comment">'Back', girls_path %&gt;</span></span>
</code></pre>
<p>然而这个动作呢，你在修改的是先前存在的对象，而不是像你在 <code>new</code> 动作所使用的一个新的对象。这个已经存在的对象是透过 <code>GirlsController</code> 的 <code>edit</code> 动作找到的：</p>
<pre><code><span class="function"><span class="keyword">def</span> <span class="title">edit</span></span>
  <span class="variable">@girl</span> = <span class="constant">Girl</span>.find(params[<span class="symbol">:id</span>])
<span class="keyword">end</span>
</code></pre>
<p>如何找到一个对象的代码跟之前我们看过的 <code>show action</code> 一模一样！！！！！！！也就是说咱重复了代码，但现在先不讨论这个。</p>
<p>再回到刚刚的 <code>edit.html.erb</code> ：</p>
<pre><code><span class="tag">&lt;<span class="title">h1</span>&gt;</span>Editing girl<span class="tag">&lt;/<span class="title">h1</span>&gt;</span>

<span class="vbscript">&lt;%= render <span class="comment">'form' %&gt;</span></span>

<span class="vbscript">&lt;%= link_to <span class="comment">'Show', @girl %&gt;</span></span> |
<span class="vbscript">&lt;%= link_to <span class="comment">'Back', girls_path %&gt;</span></span>
</code></pre>
<p>下面你使用了 <code>link_to</code> 来创建两个链接，Show 与 Back 链接。Show 链接连到你在控制器的 <code>edit</code> 动作设置好的 <code>@girl</code> 对象。按下这个链接会带你到 <code>girl_path(@girl)</code> (<code>/girls/:id</code>)。Rails 会自己根据对象的类别，想出链接接下来要去哪，使用这种 Rails 特殊的语法，它会去调用 <code>girl_path</code> 方法（因为这个对象是 Girl 类别），并且产生相应的网址给你。</p>
<p>接下来看看 Back 链接，使用了 <code>girls_path</code>。它不能使用一个对象，因为没道理，你要返回的是你深爱过的女人的清单。。。而呼叫 <code>girls_path</code> 是一个回到 <code>index</code> 动作的简单方法。</p>
<p>好现在我们来试试看填入这个表单，举例来说，把初恋情人改为第五任好了，并按下 Update Girl 按钮，你会看到：</p>
<p><img src="https://github.com/JuanitoFatas/Girls_I_Loved/raw/master/app/assets/images/fifth.png" alt="fifth"></p>
<p>按下 Update Girl 会带你回到 <code>show</code> 页面。这是怎么发生的？按下 Back 按钮回到清单，并看看此页的源代码 ( <a href="http://localhost:3000/2/edit/)，你会看到：">http://localhost:3000/2/edit/)，你会看到：</a></p>
<pre><code class="lang-html">  <span class="tag">&lt;<span class="title">form</span> <span class="attribute">accept-charset</span>=<span class="value">"UTF-8"</span> <span class="attribute">action</span>=<span class="value">"/girls/2"</span> <span class="attribute">class</span>=<span class="value">"edit_girl"</span> <span class="attribute">id</span>=<span class="value">"edit_girl_2"</span> <span class="attribute">method</span>=<span class="value">"post"</span>
  &lt;<span class="attribute">div</span> <span class="attribute">style</span>=<span class="value">"margin:0;padding:0;display:inline"</span>&gt;</span><span class="tag">&lt;<span class="title">input</span> <span class="attribute">name</span>=<span class="value">"utf8"</span> <span class="attribute">type</span>=<span class="value">"hidden"</span> <span class="attribute">value</span>=<span class="value">"&amp;#x2713;"</span> /&gt;</span><span class="tag">&lt;<span class="title">input</span> <span class="attribute">name</span>=<span class="value">"_method"</span> <span class="attribute">type</span>=<span class="value">"hidden"</span> <span class="attribute">value</span>=<span class="value">"put"</span> /&gt;</span>...
  <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
</code></pre>
<p>这个表单的 <code>action</code> 指向 <code>/girls/2</code> ，也就是 <code>GirlsController</code> 的 <code>show</code> 动作。这里使用的 <code>method</code> 使用的是 POST。结束了吗？还没，看看下面透过 <code>_method</code> 参数的 <code>input</code> 标签，其中 <code>value</code> 被设为 PUT。Rails 注意到这个参数，并且把这个 POST 请求变成 PUT 请求。这是我们刚刚说的三个方式之一，这是第二个。藉由给这个路由 <code>/girls/{id}</code> 发送一个 PUT 请求，你被带到了 <code>GirlsController</code> 的 <code>update</code> 动作，让我们来看看 <code>update</code> 动作都干了什么：</p>
<pre><code>def update
  @girl = <span class="transposed_variable">Girl.</span><span class="built_in">find</span>(params<span class="matrix">[:id]</span>)

  respond_to do |format|
    <span class="keyword">if</span> @<span class="transposed_variable">girl.</span>update_attributes(params<span class="matrix">[:girl]</span>)
      <span class="transposed_variable">format.</span>html <span class="cell">{ redirect_to @girl, notice: <span class="string">'Girl was successfully updated.'</span> }</span>
      <span class="transposed_variable">format.</span>json <span class="cell">{ head :no_content }</span>
    <span class="keyword">else</span>
      <span class="transposed_variable">format.</span>html <span class="cell">{ render action: "edit" }</span>
      <span class="transposed_variable">format.</span>json <span class="cell">{ render json: @girl.errors, status: :unprocessable_entity }</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span>
<span class="keyword">end</span>
</code></pre>
<p>和 <code>show</code> 与 <code>edit</code> 动作一样，你用 <code>find</code> 把对象拿出来。而表单的参数和 <code>create</code> 动作使用一样的路数透过 <code>params[:girl]</code> 传进来。而下面不同的是，这里用的是一个 <code>update_attributes</code> 方法。这个方法人如其名，更新属性！而这个方法的名字还有一件你不知道的事儿，它同时也验证了属性，确保你的属性是合法的，如果合法的话呢，更新、储存、返回真。念起来真顺口，哈哈！</p>
<p>当 <code>update_attributes</code> 返回真的时候呢，你被重定向至这个女孩的 <code>show</code> 动作。那返回假的时候呢？你被显示在 <code>edit</code> 模版，并提示出错的信息，这里跟我们之前看过的 <code>create</code> 方法一样，只是回页面，没有使用 <code>edit</code> 动作：</p>
<pre><code>def create
<span class="keyword">...</span>
<span class="keyword">else</span>
  format.html { render action: <span class="string">"new"</span> }
  format.json { render json: @girl.errors, status: :unprocessable_entity }
end
</code></pre>
<p>呼，终于讲完验证了，希望你可以让你的娘亲高兴。</p>
<h4>删除... 删除那些不愉快的记忆</h4>
<p>好，要是那个女孩伤你很深，你要把它从记录中抹去呢？（抹的掉记录，抹不掉回忆的。。。）</p>
<p>在 Rails，<code>DELETE</code> 用一个更强硬的名字，<code>DESTROY</code> ！！！一旦 <code>DESTROY</code> 了，那就是掰掰了，再也不见了。</p>
<p>好，现在把页面切换到 <a href="http://localhost:3000/girls">http://localhost:3000/girls</a> ：</p>
<p><img src="https://github.com/JuanitoFatas/Girls_I_Loved/raw/master/app/assets/images/delete.png" alt="delete"></p>
<p>按下 Destroy ：</p>
<p><img src="https://github.com/JuanitoFatas/Girls_I_Loved/raw/master/app/assets/images/only-one.png" alt="only-one"></p>
<p>现在你应该只看到苍老师，唯一的苍老师（或是你输入的）。</p>
<p>好，现在来讲讲这是怎么工作的。让我们看看 <code>app/views/girls/index.html.erb</code> 中间这一段 ：</p>
<pre><code><span class="tag">&lt;<span class="title">h1</span>&gt;</span>Listing girls<span class="tag">&lt;/<span class="title">h1</span>&gt;</span>

...

<span class="vbscript">&lt;% @girls.<span class="keyword">each</span> <span class="keyword">do</span> |girl| %&gt;</span>
  <span class="tag">&lt;<span class="title">tr</span>&gt;</span>
    <span class="tag">&lt;<span class="title">td</span>&gt;</span><span class="vbscript">&lt;%= girl.name %&gt;</span><span class="tag">&lt;/<span class="title">td</span>&gt;</span>
    <span class="tag">&lt;<span class="title">td</span>&gt;</span><span class="vbscript">&lt;%= girl.number %&gt;</span><span class="tag">&lt;/<span class="title">td</span>&gt;</span>
    <span class="tag">&lt;<span class="title">td</span>&gt;</span><span class="vbscript">&lt;%= link_to <span class="comment">'Show', girl %&gt;</span></span><span class="tag">&lt;/<span class="title">td</span>&gt;</span>
    <span class="tag">&lt;<span class="title">td</span>&gt;</span><span class="vbscript">&lt;%= link_to <span class="comment">'Edit', edit_girl_path(girl) %&gt;</span></span><span class="tag">&lt;/<span class="title">td</span>&gt;</span>
    <span class="tag">&lt;<span class="title">td</span>&gt;</span><span class="vbscript">&lt;%= link_to <span class="comment">'Destroy', girl, confirm: 'Are you sure?', method: :delete %&gt;</span></span><span class="tag">&lt;/<span class="title">td</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">tr</span>&gt;</span>
<span class="vbscript">&lt;% <span class="keyword">end</span> %&gt;</span>
<span class="tag">&lt;/<span class="title">table</span>&gt;</span>

<span class="tag">&lt;<span class="title">br</span> /&gt;</span>

<span class="vbscript">&lt;%= link_to <span class="comment">'New Girl', new_girl_path %&gt;</span></span>
</code></pre>
<p>在这里，<code>@girls</code> 是一个从 <code>Girl</code> 模型来的所有对象的集合，很难懂吗？所有我们深爱过的女孩。我们遍历每一个女孩，并把每个特别的女孩关在一个小房间里：<code>|girl|</code> 呵呵，我相信你们都这么做过！哈哈，正经的说呢，这么做就是给下面的区块创了一个 <code>girl</code> 变量。</p>
<p><code>name</code> 与 <code>number</code> 方法跟我们在 <code>app/views/girls/show.html.erb</code> 使用过的一样，是用来显示栏位值的。在这之后，建了三个链接， Show, Edit, Destroy。</p>
<p>第一个链接把 <code>girl</code> 对象传进来，藉由一个像是 <code>/girls/{id}</code> 的路由连到 <code>GirlsController</code> 的 <code>show</code> 动作， <code>{id}</code> 是这个对象在表里面的 ID。</p>
<p>第二个链接使用 <code>edit_girl_path</code> 并传入 <code>girl</code> 对象连到 <code>edit</code> 动作，这个 helper 对应的路径是 <code>/girls/{id}/edit</code> 。</p>
<p>第三个链接和第一个一样把 <code>girl</code> 对象传进来，但是后面指名了方法是 <code>:delete</code> ，这也就是我们的第三个方式，也是这个路由 <code>/girls/{id}</code> 有的最后一个方式。因为你把 <code>method:</code> 设为 <code>:delete</code> Rails 理解你要忘记一个女孩，并带你到 <code>GirlsController</code> 的 <code>destroy</code> 动作：</p>
<p>  def destroy
    @girl = Girl.find(params[:id])
    @girl.destroy</p>
<pre><code><span class="title">respond_to</span> do |format|
  format.html { <span class="title">redirect_to</span> girls_url }
  format.json { <span class="title">head</span> :no_content }
end
</code></pre>
<p>  end</p>
<p>就跟我们之前看过的 <code>show</code> , <code>edit</code> , <code>update</code> 动作一样，先把 <code>@girl</code> 对象取出来（ <code>Girl.find(params[:id]</code> ）。</p>
<p>然后摧毁她（<code>@girl.destroy</code>）。。。再见了，我的愛人。</p>
<p>这把你数据库的纪录永远地删除了。然后把你重定向至 <code>girls_url</code> 也就是这里 <a href="http://localhost:3000/girls">http://localhost:3000/girls</a> 。注意！！！ 这里使用的是 <code>girls_url</code> （ <code>path</code> 换成 <code>url</code> ），会产生一个完整的 URL。</p>
<p>呼，讲到这里讲完了你的第一个 Rails 应用，是不是很简单呢？</p>
<p>最后献上苍老师的图片一只：</p>
<p><a href="http://zh.wikipedia.org/wiki/%E8%92%BC%E4%BA%95%E7%A9%BA"><img src="http://ww2.sinaimg.cn/bmiddle/67b532d1jw1dq6lvk4vylj.jpg" alt="蒼井そら"></a></p>
<p>距离学会 Rails 还有 970 个小时。。。</p>
<p>つづく</p>
<h4>延伸阅读：</h4>
<p><a href="http://ihower.tw/rails3/basic.html">打造 CRUD by ihower</a></p>
<p><a href="http://guides.rubyonrails.org/routing.html">Rails Routing from the Outside In</a></p>
<p><a href="http://ruby.railstutorial.org/chapters/a-demo-app">Demo App from Learn Rails By Example</a></p>
<p><a href="http://railsforzombies.org/">Rails For Zombies</a></p>
]]></content>
    <category scheme="http://lisp.es//tags/Rails/" term="Rails"/>
    <category scheme="http://lisp.es//categories/Rails/" term="Rails"/>
  </entry>
  <entry>
    <title type="html"><![CDATA[Rails 前世今生 - 000]]></title>
    <link href="http://lisp.es//2012/04/20/ror-0-intro/"/>
    <id>http://lisp.es//2012/04/20/ror-0-intro/</id>
    <published>2012-04-20T10:52:00.000Z</published>
    <updated>2013-05-18T19:15:28.000Z</updated>
    <content type="html"><![CDATA[<p><strong>1000 個小時學會 Rails 系列</strong></p>
<blockquote>
<p>Any intelligent fool can make things bigger, more 
  complex, and more violent. It takes a touch of genius
  – and a lot of courage – to move in the opposite 
  direction.
  -- Albert Einstein</p>
</blockquote>
<p>相信你一定听过 PHP, ASP.NET, JSP 等红火到不行的网络开发技术。近年才开始有听到 Ruby on Rails。究竟是什么？是 Ruby 还是 Rails？</p>
<p>型別</p>
<p>时间来到了 1998 年，盖兹被奶油派砸中、乔帮主从 NeXT 重返苹果、谷歌刚刚成立，互联网正要起步，有一家公司也在 1999 年成立了 – <a href="http://37signals.com/">37 信号</a>，一个开发网路应用的世界级小公司。直到 2004 年，有一件事情，可能改变了世界，好吧，是改变了网络程序员的世界。一个丹麦小伙 – <a href="http://en.wikipedia.org/wiki/David_Heinemeier_Hansson/">David Heinemeier Hansson</a> ，简称 DHH， 创造了 <a href="http://zh.wikipedia.org/wiki/Ruby_on_Rails/">Ruby on Rails 框架</a>。那 2004 年还有什么大事呢？谷歌拥有了 80 亿个条目、祖克柏被女友甩了，发布 Thefacebook、Gmail 在愚人节发布、Mac OSX 10.4 发布、乌邦屠、火狐推出了 1.0。那是最好的时代，也是最坏的时代，互联网正要起飞...。</p>
<p>时间回到 2003 年，从遥远的美国芝加哥，37 信号公司来了一通电话，接电话的小子是一个高中数学拿了 F、20 岁以前没编过程、大学本科读的是商学院的 DHH，37 信号公司雇用 DHH 来开发一个网络应用，一个项目管理工具 – <a href="http://basecamp.com/">basecamp</a>。DHH 非常兴奋，这是一个非常有挑战性的项目，尽管他只在毕业设计用过 J2EE，只有 2 年的 PHP 开发经验（他也开发过一个 PHP 框架），但他对自己的开发实力与理解力有很大的自信，他知道自己有一种化繁为简的能力。然而真正令 DHH 性奋的是日本的三大产物之一（成人艺术、动漫以及红宝石），Ruby（Ruby 是一门由松本行弘所开发出来的程序语言）！PHP 的语法与设计实在使他抓狂，尽管 PHP 的开发速度很快、尽管 PHP 存在着好多的优点，但是语言的天生缺陷令他决定放弃 PHP，他在朋友的怂恿下，开始使用了 Ruby，来开发他之前所写过的 PHP 框架。</p>
<p>一周过后，开发的效率实在是太惊人了，他只花了一周就把 PHP 一个多月要做的事都做好了。Ruby 优雅异常的语法及设计，一切竟是如此简单。他二话不说立马打给美国总部说，我要用 Ruby 开发。两个月后，DHH 开发了自己用的网络框架，再过两个月，整个 basecamp 产品完成了，basecamp 横空出世，一发布就引起轰动，有人觉得这是世界上最好的网络应用。DHH 又兴奋了，他决定把 basecamp 背后的框架公布，Ruby on Rails 诞生了，一个开源的网络框架，旨在提高程序员的幸福与生产力。藉由约定大于配置的概念，写出一行行的美丽代码。</p>
<h3>Rails 成功案例</h3>
<p>Rails 框架成熟吗？当然了！目前 2012 年 4 月的版本是 3.2.3，并有许多活跃的开发者正在开发 4.0。看看 Github、Twitter 还有 basecamp， Github 是一个基于 git 的网络代码管控社交工具，这里有一篇关于 GITHUB 写的很好的文章可以看看，<a href="http://www.yangzhiping.com/tech/github.html">如何高效利用 Github</a>。推特是国外知名的微博，每秒有成千上万的人发信息，basecamp 是世界上最好的项目管理工具之一，其它更多知名的网站（参考<a href="http://ruby-china.org/sites/">这里</a>与<a href="http://www.setfiremedia.com/blog/50-of-the-best-websites-developed-using-ruby-on-rails">这里</a>），都是由 Rails 所开发出来的。所以学习 Rails 可说是相当靠谱。</p>
<h3>基础知识</h3>
<p>在学习 Rails 之前，最好先掌握一些基础的知识，你可以看看下面我所列的资源，慢慢学，勿躁进。别担心，我们有 1000 个小时，万事起头难，就怕自己懒。现在就卷起袖子，开始吧：</p>
<p><strong>Ruby</strong>：</p>
<ul>
<li><a href="http://tryruby.org/">试试 Ruby</a></li>
<li><a href="http://saito.im/slide/ruby-new.html/">Ruby 语言新手教程</a></li>
<li><a href="http://lrthw.github.com/">笨方法学 Ruby</a></li>
</ul>
<p><strong>HTML 与 CSS</strong>：</p>
<ul>
<li><a href="http://book.42qu.com/">42 区漫游指南</a></li>
<li><a href="http://learncss.tutsplus.com/">30 天学会 HTML 与 CSS</a></li>
</ul>
<p><strong>Rails</strong>：</p>
<ul>
<li><a href="http://railscasts-china.com/episodes/1-rails-tutorial/">Railscast 视频教程 #1</a></li>
<li><a href="http://guides.ruby-china.org/getting_started.html/">Ruby 官方指南 起步</a></li>
<li><a href="http://pragprog.com/book/rails4/agile-web-development-with-rails/">AWDWR4 第 1 至 4 章</a></li>
</ul>
<p>恭喜你，如果你觉得已经有充足的基础知识，你可以进入下一章了！</p>
<p>距离学会 Rails 还有倒数 980 个小时。。。</p>
]]></content>
    <category scheme="http://lisp.es//tags/Rails/" term="Rails"/>
    <category scheme="http://lisp.es//categories/Rails/" term="Rails"/>
  </entry>
</feed>
