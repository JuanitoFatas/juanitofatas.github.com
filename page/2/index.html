<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>第 2 頁 | I'm Juanito Fatas</title>
  <meta name="author" content="Juanito Fatas">
  
  <meta name="description" content="This site contains technical articles, presentations, thoughts, software, and other materials by Juanito Fatas.">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="I'm Juanito Fatas"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="I'm Juanito Fatas" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  
    <link rel="stylesheet" type="text/css" href="//cdn.moot.it/1/moot.css">
  
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
  <script>
  $(document).ready(function() {
    $('#sidebar').delay(400).animate({ width: '285px' }, 500, function() {
      $('.personal-info').css({display: 'table'}).hide().fadeIn(500);
    });
  });
  </script>
  
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-41041908-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

</head>


<body>
  <header id="header" class="inner"><!-- <div class="alignleft">
  <h1><a href="/">I'm Juanito Fatas</a></h1>
  <h2><a href="/">C-x C-f...C-x C-s...</a></h2>
</div>
 --><!-- <nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">首頁</a></li>
    
      <li><a href="/archives">彙整</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
 --></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignright"><div id="wrapper">
  <!-- <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon depth"></div>
        <time class="depth" datetime="2012-05-17T15:43:00.000Z"><a href="/2012/05/17/jquery-intro/">May 17 2012</a></time>
      
      
  
    <h1 class="title depth"><a href="/2012/05/17/jquery-intro/">jQuery 1.7 介绍（上）</a></h1>
  

    </header>
    <div class="entry depth">
      
        <p>建议不要看我写的文章，赶快到这里学会时下最火最流行的 jQuery!</p>
<p><a href="http://tutsplus.com/course/30-days-to-learn-jquery/">30 天学会 jQuery</a></p>
<h2>神马是 jQuery？</h2>
<p>地球上最受欢迎的 Javascript 函式库、软件攻城狮必备技能之一、网页看起来美妙的魔法之一。</p>
<p>2012.05.17 现在的版本是 1.7.2。</p>
<p>型別</p>
<h2>去哪里获得 jQuery</h2>
<p>通常有开发版本与生产版本 <strong>32KB</strong> ，建议本地开发使用开发版本 <strong>247KB</strong> ，使用 jQuery 时顺便研读源代码。</p>
<blockquote>
<p>开发版本：无压缩、带注释；生产版本：压缩过、不堪入目。</p>
</blockquote>
<p><a href="http://jquery.com/">jQuery 官网</a></p>
<p>jQuery CDN: <a href="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.js">1.7.2 development</a> <a href="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js">1.7.2 production</a></p>
<blockquote>
<p>不建议使用 CDN，可以参考我的不要使用 CDN 来放第三方 Javascript</p>
</blockquote>
<h2>怎么在 HTML 里面玩弄 Javascript 代码</h2>
<p>把 JS 代码放在 script 标签内即可。</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>&lt;script&gt;

&lt;<span class="regexp">/script&gt;
</pre></td></tr></table></figure>

<h2>如何引用 jQuery 至你的 HTML</h2>
<p>假设我有一个 app 目录，下面有一个 js 文件夹、一个 index.html，js 目录下有一个 jquery-1.7.1.js。</p>
<p>使用 script 标签引用：</p>
<figure class="highlight lang-html"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>&lt;script src="js/jquery-1.7.1.js"&gt;&lt;/script&gt;
</pre></td></tr></table></figure>

<p>使用 CDN 引用：</p>
<figure class="highlight lang-html"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>&lt;script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.js"&gt;&lt;/script&gt;
</pre></td></tr></table></figure>

<p><strong>建议摆放位置</strong> <code>&lt;/body&gt;</code> 标签的正上方。</p>
<p>理由：浏览器一旦碰到 script 得载入完或下载完才会继续往下载入，所以放在 <code>&lt;/body&gt;</code> 上方可以确保你的页面先载入 HTML 以及 CSS。</p>
<h2>第一个 jQuery 代码</h2>
<h3>如何引用 jQuery?</h3>
<p>jQuery 其实就是一个函数，你可以这样子引用它：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>jQuery(...)
</pre></td></tr></table></figure>

<p>好，让我们看看怎么让 jQuery 玩弄页面的 CSS。</p>
<p>假设我们有一个 HTML 页面:</p>
<figure class="highlight lang-html"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="code"><pre>&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
true&lt;meta charset=utf-8&gt;
true&lt;title&gt;&lt;/title&gt;
true&lt;style&gt;
true.emphasis{ color: green; }
true&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;ul&gt;
true&lt;li&gt;hello&lt;/li&gt;
true&lt;li&gt;hello 2&lt;/li&gt;
true&lt;li&gt;hello 3&lt;/li&gt;
&lt;/ul&gt;
&lt;script src="js/jquery-1.7.1.js"&gt;&lt;/script&gt;
&lt;script&gt;

&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre></td></tr></table></figure>

<p>以下代码添加至 <code>&lt;/body&gt;</code> 上方的 script 标签。</p>
<p>要怎么样用 jQuery 来添加 CSS 样式？</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>jQuery(<span class="string">'ul li'</span>);
</pre></td></tr></table></figure>

<p>这一行的作用是，你跟 jQuery 说，帮我根据这个 CSS 选择器搜寻一下 DOM。</p>
<p>存到一个变量里，并打印到浏览器的 console 看看：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="keyword">var</span> lis = jQuery(<span class="string">'ul li'</span>);
console.log(lis);
</pre></td></tr></table></figure>

<p>阿哈，你打开浏览器、打开开发者工具，切换到 console tab，会看到</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>[&lt;li&gt;​hello​&lt;<span class="regexp">/li&gt;​, &lt;li&gt;​hello 2​&lt;/</span>li&gt;​, &lt;li&gt;​hello <span class="number">3</span>​&lt;<span class="regexp">/li&gt;​]
</pre></td></tr></table></figure>

<p><code>console.log()</code> 可以当之后调试代码的手段之一。</p>
<p>猛阿，基本上只要懂 CSS 选择器，jQuery 几乎都学会了！呵呵。。。</p>
<p>再举个例子，怎么给这些清单元素添加红色呢？</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>jQuery(<span class="string">'ul li'</span>).css(<span class="string">'color'</span>,<span class="string">'red'</span>);
</pre></td></tr></table></figure>

<blockquote>
<p>尽量把所有的样式交给 CSS 来做，你偶尔才会需要用到 jQuery 来更改样式。</p>
</blockquote>
<p>另一个例子，给这些清单元素添加 <code>style</code> 标签内的 <code>.emphasis</code> 这个类：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>jQuery(<span class="string">'ul li'</span>).addClass(<span class="string">'.emphasis'</span>);
</pre></td></tr></table></figure>

<h3>使用缩写引用 jQuery</h3>
<p>这一行</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>jQuery(<span class="string">'ul li'</span>).addClass(<span class="string">'.emphasis'</span>);
</pre></td></tr></table></figure>

<p>等同于</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'ul li'</span>).addClass(<span class="string">'.emphasis'</span>);
</pre></td></tr></table></figure>

<p>等同于</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>window.jQuery(<span class="string">'ul li'</span>).addClass(<span class="string">'.emphasis'</span>);
</pre></td></tr></table></figure>

<p><strong>你怎么知道的！？</strong></p>
<p>请看 <a href="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.js">jQuery 源代码</a>的最下方：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="comment">// Expose jQuery to the global object</span>
window.jQuery = window.$ = jQuery;
</pre></td></tr></table></figure>

<p>呵呵，人家都写在那呢。</p>
<p>这篇就介绍到这儿吧。</p>

      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2012/05/17/jquery-intro/#more" class="more-link">閱讀全文</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



<a class="moot" href="https://moot.it/i/lisp_es">
   <h1 class="title">留言</h1>
</a> -->


  <div class="archive">

    <article class="post">
      <div class="post-content">
        <header>
            
              <a href="/2012/05/17/jquery-intro/"><div class="icon depth"></div> </a>
              <h2 class="depth title" ><a href="/2012/05/17/jquery-intro/">jQuery 1.7 介绍（上）</a></h2>
            
            <time class="time title depth" datetime="2012-05-17T15:43:00.000Z"><a href="/2012/05/17/jquery-intro/">May 17 2012</a></time>
          </header>
      </div>
    </article>
  </div>


  <!-- <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon depth"></div>
        <time class="depth" datetime="2012-05-17T14:06:00.000Z"><a href="/2012/05/17/parse-xml-json/">May 17 2012</a></time>
      
      
  
    <h1 class="title depth"><a href="/2012/05/17/parse-xml-json/">Python 简易解析 XML JSON</a></h1>
  

    </header>
    <div class="entry depth">
      
        <h3>XML</h3>
<h4>使用轻量快速的 minidom 函式库</h4>
<p>引用 minidom:</p>
<pre><code><span class="title">from</span> xml.dom <span class="import"><span class="keyword">import</span> minidom</span>
</code></pre>
<blockquote>
<p>DOM -- Document Object Model</p>
</blockquote>
<p>minidom 有一个 parseString 函数可以解析 XML 字串。</p>
<p>型別</p>
<p>解析一个随意取名的 XML 字串，存入 x：</p>
<pre><code>x = minidom.parseString("<span class="tag">&lt;<span class="title">foo</span>&gt;</span>Lorem ipsum<span class="tag">&lt;<span class="title">children</span>&gt;</span><span class="tag">&lt;<span class="title">item</span>&gt;</span>1<span class="tag">&lt;/<span class="title">item</span>&gt;</span><span class="tag">&lt;<span class="title">item</span>&gt;</span>2<span class="tag">&lt;/<span class="title">item</span>&gt;</span><span class="tag">&lt;<span class="title">item</span>&gt;</span>3<span class="tag">&lt;/<span class="title">item</span>&gt;</span><span class="tag">&lt;/<span class="title">children</span>&gt;</span><span class="tag">&lt;/<span class="title">foo</span>&gt;</span>")
</code></pre>
<p>x 现在是一个 xml.dom.minidom.Document instance 实例。</p>
<p><strong>注意</strong> XML 不像 HTML，严格要求每个 open 标签要有一个相应的 close 标签！</p>
<p>看看 x 有什么可以调用的属性、方法：</p>
<pre><code><span class="function"><span class="title">dir</span><span class="params">(x)</span>

[<span class="title">'ATTRIBUTE_NODE'</span>, <span class="title">'CDATA_SECTION_NODE'</span>, <span class="title">'COMMENT_NODE'</span>, <span class="title">'DOCUMENT_FRAGMENT_NODE'</span>, <span class="title">'DOCUMENT_NODE'</span>, <span class="title">'DOCUMENT_TYPE_NODE'</span>, <span class="title">'ELEMENT_NODE'</span>, <span class="title">'ENTITY_NODE'</span>, <span class="title">'ENTITY_REFERENCE_NODE'</span>, <span class="title">'NOTATION_NODE'</span>, <span class="title">'PROCESSING_INSTRUCTION_NODE'</span>, <span class="title">'TEXT_NODE'</span>, <span class="title">'__doc__'</span>, <span class="title">'__init__'</span>, <span class="title">'__module__'</span>, <span class="title">'__nonzero__'</span>, <span class="title">'_call_user_data_handler'</span>, <span class="title">'_child_node_types'</span> ... <span class="title">'standalone'</span>, <span class="title">'strictErrorChecking'</span>, <span class="title">'toprettyxml'</span>, <span class="title">'toxml'</span>, <span class="title">'unlink'</span>, <span class="title">'version'</span>, <span class="title">'writexml'</span>]
</code></pre>
<p>转回 xml:</p>
<pre><code><span class="attribute">x.toprettyxml()
</code></pre>
<p>印出来看看：</p>
<pre><code><span class="title">print</span> x.toprettyxml()
</code></pre>
<p>输出：</p>
<pre><code><span class="tag">&lt;<span class="title">foo</span>&gt;</span>
    Lorem ipsum
    <span class="tag">&lt;<span class="title">children</span>&gt;</span>
        <span class="tag">&lt;<span class="title">item</span>&gt;</span>
            1
        <span class="tag">&lt;/<span class="title">item</span>&gt;</span>
        <span class="tag">&lt;<span class="title">item</span>&gt;</span>
            2
        <span class="tag">&lt;/<span class="title">item</span>&gt;</span>
        <span class="tag">&lt;<span class="title">item</span>&gt;</span>
            3
        <span class="tag">&lt;/<span class="title">item</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">children</span>&gt;</span>
<span class="tag">&lt;/<span class="title">foo</span>&gt;</span>
</code></pre>
<p>取得第二个 item 标签内的值 2：</p>
<pre><code><span class="transposed_variable">x.</span>getElementsByTagName(<span class="string">'item'</span>)<span class="matrix">[<span class="number">1</span>].</span>childNodes<span class="matrix">[<span class="number">0</span>].</span>nodeValue
</code></pre>
<p>你可以看看 dir 里面有什么函数可以用，在 python 的直译器里面玩玩看。</p>
<h3>RSS</h3>
<p>比如说想要知道 <a href="http://www.nytimes.com/services/xml/rss/nyt/Science.xml">http://www.nytimes.com/services/xml/rss/nyt/Science.xml</a> 有几个 item：</p>
<pre><code><span class="title">from</span> xml.dom <span class="import"><span class="keyword">import</span> minidom</span>

<span class="import"><span class="keyword">import</span> urllib2</span>

<span class="title">contents</span> = urllib2.urlopen(<span class="string">"http://www.nytimes.com/services/xml/rss/nyt/Science.xml"</span>).read()

<span class="title">d</span> = minidom.parseString(contents)

<span class="title">len</span>(d.getElementsByTagName(<span class="string">"item"</span>)) # =&gt; <span class="number">38</span> on <span class="number">2012.05</span><span class="number">.17</span>
</code></pre>
<h3>JSON</h3>
<p>Javascript Object Notation</p>
<p>在 Python 用 dictionary 混 List 的形式储存 <code>{ foo: [{&quot;a&quot;: 1}, ... {&quot;c&quot;: 3}] }</code></p>
<p>使用 JSON 库：</p>
<pre><code><span class="import"><span class="keyword">import</span> json</span>
</code></pre>
<p>假设今天我们有一个 json 格式的字串 j，具有两个键 <code>mon</code> 与 <code>numbers</code>：</p>
<pre><code><span class="setting">j = <span class="value">'{<span class="string">"mon"</span>: <span class="number">1</span>, <span class="string">"numbers"</span>: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">9.9</span>]}'</span></span>
</code></pre>
<p>载入这个 json ，存到 d 里：</p>
<pre><code><span class="setting">d = <span class="value">json.loads(j)</span></span>
</code></pre>
<p>载入后我们得到一个 python 字典（无序）：</p>
<pre><code>{<span class="string">u'mon'</span>: <span class="number">1</span>, <span class="string">u'numbers'</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">9.9</span>]}
</code></pre>
<p>取出 <code>mon</code> 的值：</p>
<pre><code>d[<span class="string">'mon'</span>] <span class="comment"># =&gt; 1</span>
d[<span class="string">'numbers'</span>][2] <span class="comment"># =&gt; 9.9</span>
</code></pre>
<p>你也可以 <code>eval</code> 这个 json 格式的字串：</p>
<pre><code><span class="keyword">eval</span>(j)
<span class="comment"># =&gt; {'mon': 1, 'numbers': [1, 2, 9.9]}</span>
</code></pre>
<p><strong>永远别用 eval 来解析 json</strong> 。</p>
<p>Q: 加总 www.reddit.com 帖子的 up votes。</p>
<p>A:</p>
<figure class="highlight lang-python"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
</pre></td><td class="code"><pre>r = urllib2.urlopen(<span class="string">"http://www.reddit.com/.json"</span>)
j = json.loads(r)

j.keys() <span class="comment"># =&gt; [u'kind', u'data']</span>
j[<span class="string">'data'</span>].keys() <span class="comment"># =&gt; [u'modhash', u'children', u'after', u'before']</span>
j[<span class="string">'data'</span>][<span class="string">'children'</span>][<span class="number">0</span>].keys() <span class="comment"># =&gt; [u'kind', u'data']</span>
j[<span class="string">'data'</span>][<span class="string">'children'</span>][<span class="number">0</span>][<span class="string">'data'</span>].keys() <span class="comment"># =&gt; [..., u'ups']</span>
j[<span class="string">'data'</span>][<span class="string">'children'</span>][<span class="number">0</span>][<span class="string">'data'</span>][<span class="string">'ups'</span>] <span class="comment"># =&gt; 7902</span>

sum(c[<span class="string">'data'</span>][<span class="string">'ups'</span>] <span class="keyword">for</span> c <span class="keyword">in</span> j[<span class="string">'data'</span>][<span class="string">'children'</span>]) <span class="comment"># =&gt; 84500</span>
</pre></td></tr></table></figure>

<p>DONE.</p>

      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2012/05/17/parse-xml-json/#more" class="more-link">閱讀全文</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



<a class="moot" href="https://moot.it/i/lisp_es">
   <h1 class="title">留言</h1>
</a> -->


  <div class="archive">

    <article class="post">
      <div class="post-content">
        <header>
            
              <a href="/2012/05/17/parse-xml-json/"><div class="icon depth"></div> </a>
              <h2 class="depth title" ><a href="/2012/05/17/parse-xml-json/">Python 简易解析 XML JSON</a></h2>
            
            <time class="time title depth" datetime="2012-05-17T14:06:00.000Z"><a href="/2012/05/17/parse-xml-json/">May 17 2012</a></time>
          </header>
      </div>
    </article>
  </div>


  <!-- <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon depth"></div>
        <time class="depth" datetime="2012-05-12T15:04:00.000Z"><a href="/2012/05/12/nth-child-common-gotcha/">May 12 2012</a></time>
      
      
  
    <h1 class="title depth"><a href="/2012/05/12/nth-child-common-gotcha/">CSS 一个常见 nth-child 的误区</a></h1>
  

    </header>
    <div class="entry depth">
      
        <p>给定有如下的 HTML 代码片段：</p>
<p>型別</p>
<figure class="highlight lang-html"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="code"><pre>&lt;html&gt;
...
&lt;style&gt;
truedt {
truetrueboder-top: 1px solid white;
truetrueboder-bottom: 1px solid gray;
true}
&lt;/style&gt;
&lt;body&gt;
true&lt;dl&gt;
truetrue&lt;dt&gt;How to install&lt;/dt&gt;
truetrue&lt;dd&gt;Check ...&lt;/dd&gt;
truetrue&lt;dt&gt;How to install&lt;/dt&gt;
truetrue&lt;dd&gt;Check ...&lt;/dd&gt;
truetrue&lt;dt&gt;How to install&lt;/dt&gt;
truetrue&lt;dd&gt;Check ...&lt;/dd&gt;
truetrue&lt;dt&gt;How to install&lt;/dt&gt;
truetrue&lt;dd&gt;Check ...&lt;/dd&gt;
truetrue&lt;dt&gt;How to install&lt;/dt&gt;
truetrue&lt;dd&gt;last ...&lt;/dd&gt;
true&lt;/dl&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre></td></tr></table></figure>

<p>假设这是一个 FAQ，我们有一个 Definition list (<code>dl</code>)，并有五个 item (<code>dt</code>)，五个 item 描述 (<code>dd</code>)，</p>
<p>每个 <code>dt</code> 的上下有边界，分别是白色、黑色。</p>
<p>今天假如我们想要第一个 <code>dt</code> 上方没有 boder，以及最后一个 <code>dt</code> 下方没有 boder，这时候 CSS 该怎么写呢？</p>
<p>我们可以使用 CSS3 的 <code>first-child</code>：</p>
<pre><code><span class="tag">dt</span><span class="pseudo">:first-child</span> <span class="rules">{ <span class="rule"><span class="attribute">boder-top</span>:<span class="value"> none;</span></span> <span class="rule">}</span></span>
</code></pre>
<p>现在你可能会想要使用 <code>last-child</code> 来把 最后一个 dd 的 boder-bottom 拿掉：</p>
<pre><code><span class="tag">dt</span><span class="pseudo">:last-child</span> <span class="rules">{ <span class="rule"><span class="attribute">boder-bottom</span>:<span class="value"> none;</span></span> <span class="rule">}</span></span>
</code></pre>
<p>而这样不行，因为 <code>last-child</code> 是选择 parent 的最后一个 child，这个例子里会选中：</p>
<pre><code>&lt;dd&gt;last <span class="keyword">...</span>&lt;/dd&gt;
</code></pre>
<p>那该怎么办呢？可以使用 <code>nth-last-child</code> ：</p>
<pre><code><span class="tag">dt</span><span class="pseudo">:nth-last-child(2)</span> <span class="rules">{ <span class="rule"><span class="attribute">boder-bottom</span>:<span class="value"> none;</span></span> <span class="rule">}</span></span>
</code></pre>
<p>这样子会从 <code>dl</code> 的最后一个 child 开始往上 2 个，也就是我们想要的最后一个 <code>dt</code>。</p>
<p>That&#39;s it!!!</p>

      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2012/05/12/nth-child-common-gotcha/#more" class="more-link">閱讀全文</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



<a class="moot" href="https://moot.it/i/lisp_es">
   <h1 class="title">留言</h1>
</a> -->


  <div class="archive">

    <article class="post">
      <div class="post-content">
        <header>
            
              <a href="/2012/05/12/nth-child-common-gotcha/"><div class="icon depth"></div> </a>
              <h2 class="depth title" ><a href="/2012/05/12/nth-child-common-gotcha/">CSS 一个常见 nth-child 的误区</a></h2>
            
            <time class="time title depth" datetime="2012-05-12T15:04:00.000Z"><a href="/2012/05/12/nth-child-common-gotcha/">May 12 2012</a></time>
          </header>
      </div>
    </article>
  </div>


  <!-- <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon depth"></div>
        <time class="depth" datetime="2012-05-12T09:33:00.000Z"><a href="/2012/05/12/dont-use-cdn-html5shiv/">May 12 2012</a></time>
      
      
  
    <h1 class="title depth"><a href="/2012/05/12/dont-use-cdn-html5shiv/">不要使用 CDN 来放第三方 Javascript</a></h1>
  

    </header>
    <div class="entry depth">
      
        <p><a href="http://code.google.com/p/html5shiv/">HTML5shiv</a> 是一个让 IE 8 启用 HTML5 元素的第三方 JS，通常 CDN 引用的链接是：</p>
<p><a href="http://html5shiv.googlecode.com/svn/trunk/html5.js">http://html5shiv.googlecode.com/svn/trunk/html5.js</a></p>
<p>不要这么做的理由：</p>
<p>型別</p>
<ol>
<li><p>没有使用 HTTP 压缩</p>
</li>
<li><p>没有 cached，通常这个文件只缓存 180 秒。</p>
</li>
<li><p>googlecode.com 不支援 partial response (可以提高效能的东东)</p>
</li>
<li><p>你连到别人的地方，无法控制什么事情会发生，说不定那哥儿们不爽了直接删掉。。。</p>
</li>
<li><p>实际上压缩后才 1200 Bytes，造成很多额外的 Overhead (DNS lookup, TCP handshake...etc.)</p>
</li>
</ol>
<p>原始文章：<a href="http://zoompf.com/blog/2012/05/html5shiv-and-serving-content-from-code-repositories">html5shiv and Serving Content From Code Repositories</a></p>

      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2012/05/12/dont-use-cdn-html5shiv/#more" class="more-link">閱讀全文</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



<a class="moot" href="https://moot.it/i/lisp_es">
   <h1 class="title">留言</h1>
</a> -->


  <div class="archive">

    <article class="post">
      <div class="post-content">
        <header>
            
              <a href="/2012/05/12/dont-use-cdn-html5shiv/"><div class="icon depth"></div> </a>
              <h2 class="depth title" ><a href="/2012/05/12/dont-use-cdn-html5shiv/">不要使用 CDN 来放第三方 Javascript</a></h2>
            
            <time class="time title depth" datetime="2012-05-12T09:33:00.000Z"><a href="/2012/05/12/dont-use-cdn-html5shiv/">May 12 2012</a></time>
          </header>
      </div>
    </article>
  </div>


  <!-- <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon depth"></div>
        <time class="depth" datetime="2012-05-10T14:35:00.000Z"><a href="/2012/05/10/python-zebra/">May 10 2012</a></time>
      
      
  
    <h1 class="title depth"><a href="/2012/05/10/python-zebra/">Python 解决 Zebra 谜题</a></h1>
  

    </header>
    <div class="entry depth">
      
        <p>爱因斯坦养鱼问题的学名就叫 Zebra Puzzle。之所以叫爱因斯坦养鱼问题是为了刊登在杂志上吸引读者的注意，其实这个问题不是爱因斯坦搞的...</p>
<p>问题可以到这里看：<a href="http://en.wikipedia.org/wiki/Zebra_Puzzle">Zebra Puzzle</a></p>
<p>型別</p>
<p>首先实现了 2 个 小函数，<code>imright</code> 跟 <code>nextto</code></p>
<p>确定某房是不是在某房右边、或是两个房挨著。</p>
<p>接下来给每个房子编上号，12345，</p>
<p>然后使用了 Python 自带的排列工具 <code>itertools.permutations</code> 给出房子可能的排列。</p>
<p>接著用了一个 Python 的奇技淫巧，叫做 Generator Expression，</p>
<p>语法是：<code>(term for- 子句 (选择性) for-if- 子句)</code></p>
<p>这个 generator expression 会返回一个 Generator 对象。</p>
<p>恩，给个例子好了：</p>
<p>先定义一个算平方的函数，然后用 Generator Expression：</p>
<pre><code><span class="function"><span class="keyword">def</span> <span class="title">sqr</span><span class="params">(x)</span>:</span> <span class="keyword">print</span> <span class="string">'调用 sqr, 参数 '</span>, x; <span class="keyword">return</span> x*x

g = (sq(x) <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">10</span>) <span class="keyword">if</span> x%<span class="number">2</span>==<span class="number">0</span>)
</code></pre>
<p>这个时候如果调用 g ：</p>
<pre><code>&gt;&gt;&gt; <span class="comment">g</span>
&lt;<span class="comment">GeneratorObject</span> <span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span>&gt;
</code></pre>
<p>不会去调用函数，只返回一个 Generator 对象、然而</p>
<pre><code>&gt;&gt;&gt; <span class="keyword">next</span>(g)
调用 <span class="built_in">sqr</span>, 参数 <span class="number">0</span>
<span class="number">0</span>
</code></pre>
<p>才会调用这个 Generator 所绑定的函数。。。汗。。。</p>
<p>这个问题要找，水在哪个房子被喝的，哪个房子养斑马。</p>
<p>藉由把 Constraint 移到对的地方，减少需要的计算，再搭配 Generator-exp 的特性，最后大概 0.00028 秒之类的就算好了，
本来用 嵌套 For-loop 要算 1 小时。</p>
<p>至于那个 c 函数 是拿来显示统计数据跟除错用的。</p>
<p>完整代码：</p>
<script src="https://gist.github.com/2653290.js"></script>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2012/05/10/python-zebra/#more" class="more-link">閱讀全文</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



<a class="moot" href="https://moot.it/i/lisp_es">
   <h1 class="title">留言</h1>
</a> -->


  <div class="archive">

    <article class="post">
      <div class="post-content">
        <header>
            
              <a href="/2012/05/10/python-zebra/"><div class="icon depth"></div> </a>
              <h2 class="depth title" ><a href="/2012/05/10/python-zebra/">Python 解决 Zebra 谜题</a></h2>
            
            <time class="time title depth" datetime="2012-05-10T14:35:00.000Z"><a href="/2012/05/10/python-zebra/">May 10 2012</a></time>
          </header>
      </div>
    </article>
  </div>


  <!-- <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon depth"></div>
        <time class="depth" datetime="2012-05-10T14:09:00.000Z"><a href="/2012/05/10/python-for-inside/">May 10 2012</a></time>
      
      
  
    <h1 class="title depth"><a href="/2012/05/10/python-for-inside/">Python For 循环的迭代器实现</a></h1>
  

    </header>
    <div class="entry depth">
      
        <p>给定一段 Python 代码：</p>
<pre><code><span class="keyword">for</span> x <span class="keyword">in</span> items:
    <span class="built_in">print</span> x
</code></pre>
<p>这个 items 可以是字串、列表、等等，这种可以迭代的集合称之为 iterable。</p>
<p>型別</p>
<p>这个 iter 就是创一个迭代器出来，相信有学过 Java 的人都不陌生。</p>
<p>然后用一个 <code>try .. except</code> 语句包住，迭代至停为止，停时会抛出 StopIteration。</p>
<p>实际上是这样实现的：</p>
<pre><code>it = iter(items)
<span class="keyword">try</span>:
    <span class="keyword">while</span> <span class="built_in">True</span>
        x = next(it)
        <span class="keyword">print</span> x
<span class="keyword">except</span> StopIteration:
    <span class="keyword">pass</span>
</code></pre>

      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2012/05/10/python-for-inside/#more" class="more-link">閱讀全文</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



<a class="moot" href="https://moot.it/i/lisp_es">
   <h1 class="title">留言</h1>
</a> -->


  <div class="archive">

    <article class="post">
      <div class="post-content">
        <header>
            
              <a href="/2012/05/10/python-for-inside/"><div class="icon depth"></div> </a>
              <h2 class="depth title" ><a href="/2012/05/10/python-for-inside/">Python For 循环的迭代器实现</a></h2>
            
            <time class="time title depth" datetime="2012-05-10T14:09:00.000Z"><a href="/2012/05/10/python-for-inside/">May 10 2012</a></time>
          </header>
      </div>
    </article>
  </div>


  <!-- <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon depth"></div>
        <time class="depth" datetime="2012-04-30T16:51:00.000Z"><a href="/2012/05/01/mac-install-growlnotify/">May 1 2012</a></time>
      
      
  
    <h1 class="title depth"><a href="/2012/05/01/mac-install-growlnotify/">Homebrew Install growlnotify on Snow Leopard and Lion</a></h1>
  

    </header>
    <div class="entry depth">
      
        <p>Currently homebrew already removed formula of growlnotify. If you want to use the Gem <a href="http://rubygems.org/gems/growl">growl</a> with a well-known app growlnotify and you may encounter this error with Growlnotify on Snow Leopard:</p>
<pre><code>dyld: Symbol <span class="keyword">not</span> found: _kSecRandomDefault
  Referenced from: <span class="regexp">/usr/local/bin/g</span>rowlnotify
  Expected <span class="keyword">in</span>: <span class="regexp">/System/Library/Frameworks/Security.framework/Versions/A/</span>Security
 <span class="keyword">in</span> <span class="regexp">/usr/local/bin/g</span>rowlnotify
Trace/BPT trap
</code></pre>
<p>型別</p>
<p>Here are the formulas:</p>
<h3>For Snow Leopard with growlnotify v1.2.2</h3>
<pre><code>brew install https://raw<span class="preprocessor">.github</span><span class="preprocessor">.com</span>/mxcl/homebrew/bd40f1e5f89fad962b021c827d56a9fdea0c847d/Library/Formula/growlnotify<span class="preprocessor">.rb</span>
</code></pre>
<h3>For Lion with growlnotify v1.3</h3>
<pre><code>brew install https://raw<span class="preprocessor">.github</span><span class="preprocessor">.com</span>/mxcl/homebrew/<span class="number">15</span>d6da0023924969fa6ad8a7cf743c4b39838e6e/Library/Formula/growlnotify<span class="preprocessor">.rb</span>
</code></pre>
<p>Alternatively you could try on their <a href="http://growl.info/downloads">offical download page</a></p>

      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2012/05/01/mac-install-growlnotify/#more" class="more-link">閱讀全文</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



<a class="moot" href="https://moot.it/i/lisp_es">
   <h1 class="title">留言</h1>
</a> -->


  <div class="archive">

    <article class="post">
      <div class="post-content">
        <header>
            
              <a href="/2012/05/01/mac-install-growlnotify/"><div class="icon depth"></div> </a>
              <h2 class="depth title" ><a href="/2012/05/01/mac-install-growlnotify/">Homebrew Install growlnotify on Snow Leopard and Lion</a></h2>
            
            <time class="time title depth" datetime="2012-04-30T16:51:00.000Z"><a href="/2012/05/01/mac-install-growlnotify/">May 1 2012</a></time>
          </header>
      </div>
    </article>
  </div>


  <!-- <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon depth"></div>
        <time class="depth" datetime="2012-04-30T05:46:00.000Z"><a href="/2012/04/30/sprok-guard-rspec/">Apr 30 2012</a></time>
      
      
  
    <h1 class="title depth"><a href="/2012/04/30/sprok-guard-rspec/">Rails 3.2.3 使用 Spork + Guard + RSpec + Capybara</a></h1>
  

    </header>
    <div class="entry depth">
      
        <h2>比较匆忙的同学请看</h2>
<p>0) <code>rails new appname --skip-test-unit --skip-bundle</code></p>
<p>1) 复制这个 Gemfile(<a href="https://gist.github.com/2555402">OSX</a> / <a href="https://gist.github.com/2555397">Linux</a> / <a href="https://gist.github.com/2555403">Windows</a>)，替换掉项目下的 Gemfile。</p>
<p>安装需要的 Gems，你有两个选择：</p>
<p>2-a) <code>bundle install</code> ，之后使用 <code>bundle exec xxx</code><br>2-b) <code>bundle install --binstubs</code>  ，之后使用 <code>bin/xxx</code></p>
<p>3) <code>rails g rspec:install</code></p>
<p>4) 运行 <code>bin/guard init rspec &amp;&amp; bin/guard init spork</code><br>5) 复制这个 <a href="https://gist.github.com/2555614">Guardfile</a>，覆盖掉项目下的 Guardfile。<br>6) 添加 <code>--drb</code> 至项目的根目录下的 <code>.rspec</code>。 
7) 复制这个 <a href="https://gist.github.com/2555618">spec/spec_helper.rb</a>，覆盖 <code>spec/spec_helper.rb</code>  </p>
<p>8-a) <code>bundle exec spork --bootstrap</code><br>8-b) <code>bin/sprok --bootstrap</code>  </p>
<p>9-a) <code>bundle exec guard</code><br>9-b) <code>bin/guard</code>  </p>
<p>型別</p>
<h2>有 10 分钟的同学请看</h2>
<h3>为什么使用 <a href="http://rubygems.org/gems/guard">Guard</a>？</h3>
<ol>
<li>要切回终端机敲 rspec 命令  </li>
<li>启动速度太慢 (使用 Spork 来加速)</li>
</ol>
<p>Guard 人如其名，自动侦测改动并运行测试。</p>
<h4>配置 Guard</h4>
<p>Gemfile:</p>
<p>在 <code>:development group</code> 加入：  </p>
<pre><code><span class="title">gem</span> <span class="string">'guard-rspec'</span>, <span class="string">'0.5.5'</span>
</code></pre>
<p>在 <code>:test group</code> 加入一些相依的 Gems，OSX 可能还需要安装 <a href="http://growl.info/downloads#generaldownloads">growl-notify</a>：</p>
<p><strong>MacOSX</strong></p>
<pre><code>gem <span class="string">'rb-fsevent'</span>, <span class="string">'0.4.3.1'</span>, :<span class="keyword">require</span> =&gt; <span class="keyword">false</span>
gem <span class="string">'growl'</span>, <span class="string">'1.0.3'</span>
</code></pre>
<p><strong>Linux</strong></p>
<pre><code><span class="title">gem</span><span class="string"> 'rb-inotify'</span>,<span class="string"> '0.8.8'</span>
<span class="title">gem</span><span class="string"> 'libnotify'</span>,<span class="string"> '0.5.9'</span>
</code></pre>
<p><strong>Windows</strong></p>
<pre><code><span class="title">gem</span><span class="string"> 'rb-fchange'</span>,<span class="string"> '0.0.5'</span>
<span class="title">gem</span><span class="string"> 'rb-notifu'</span>,<span class="string"> '0.0.4'</span>
<span class="title">gem</span><span class="string"> 'win32console'</span>,<span class="string"> '1.3.0'</span>
</code></pre>
<p>范例 Gemfile，放在 Gist:</p>
<p><a href="https://gist.github.com/2555278">MacOSX</a><br><a href="https://gist.github.com/2555344">Linux</a><br><a href="https://gist.github.com/2555343">Windows</a>  </p>
<p>Gemfile 配置好运行 <code>bundle install</code> ，初始化 Guard：</p>
<pre><code><span class="title">bundle</span> exec guard init rspec
</code></pre>
<p>或是运行 <code>bundle install --binstubs</code>，初始化 Guard：</p>
<pre><code><span class="title">bin</span>/guard init rspec
</code></pre>
<p>会产生一个 Guardfile，最上方加入此行：</p>
<pre><code><span class="title">require</span> <span class="string">'active_support/core_ext'</span>
</code></pre>
<p>并改动此行 <code>guard &#39;rspec&#39;, :version =&gt; 2 do</code> ：</p>
<pre><code>guard <span class="string">'rspec'</span>, <span class="symbol">:version</span> =&gt; <span class="number">2</span>, <span class="symbol">:all_after_pass</span> =&gt; <span class="keyword">false</span> <span class="keyword">do</span>
</code></pre>
<p>确保 Guard 不再一个失败测试通过后继续运行（加快<strong>红绿重构</strong>周期）</p>
<p>再添加：</p>
<pre><code>guard <span class="string">'rspec'</span>, <span class="symbol">:version</span> =&gt; <span class="number">2</span>, <span class="symbol">:all_after_pass</span> =&gt; <span class="keyword">false</span> <span class="keyword">do</span>
    .
    .
    .
    watch(%r{^app/controllers/(.+)<span class="number">_</span>(controller)\.rb<span class="variable">$}</span>)  <span class="keyword">do</span> |m|
      [<span class="string">"spec/routing/<span class="subst">#{m[<span class="number">1</span>]}</span>_routing_spec.rb"</span>,
       <span class="string">"spec/<span class="subst">#{m[<span class="number">2</span>]}</span>s/<span class="subst">#{m[<span class="number">1</span>]}</span>_<span class="subst">#{m[<span class="number">2</span>]}</span>_spec.rb"</span>,
       <span class="string">"spec/acceptance/<span class="subst">#{m[<span class="number">1</span>]}</span>_spec.rb"</span>,
       (m[<span class="number">1</span>][<span class="regexp">/_pages/</span>] ? <span class="string">"spec/requests/<span class="subst">#{m[<span class="number">1</span>]}</span>_spec.rb"</span> <span class="symbol">:</span> 
                         <span class="string">"spec/requests/<span class="subst">#{m[<span class="number">1</span>].singularize}</span>_pages_spec.rb"</span>)]
    <span class="keyword">end</span>
    watch(%r{^app/views/(.+)/}) <span class="keyword">do</span> |m|
      <span class="string">"spec/requests/<span class="subst">#{m[<span class="number">1</span>].singularize}</span>_pages_spec.rb"</span>
    <span class="keyword">end</span>
    .
    .
    .
<span class="keyword">end</span>
</code></pre>
<p>当 integration tests 及 views 有变动时，会自动运行测试。</p>
<p>这些都设置好了，启动 guard </p>
<pre><code><span class="title">bundle</span> exec guard
</code></pre>
<p>或</p>
<pre><code><span class="attribute">bin/guard
</code></pre>
<p>更多信息请参考：<a href="https://github.com/guard/guard">Guard Github 页面</a></p>
<h3>使用 Spork 来加速测试</h3>
<p>运行 rspec 很慢的原因是每次都得重加载整个 Rails 环境。Spork 测试服务器透过加载 Rails 环境，并维护一个进程池 (pool of processes) 给之后的测试使用。跟 Guard 搭配使用顺风顺水。</p>
<p>配置 Gemfile，将此行加入 <code>:test group</code>：</p>
<pre><code><span class="title">gem</span><span class="string"> 'guard-spork'</span>,<span class="string"> '0.3.2'</span>
<span class="title">gem</span><span class="string"> 'spork'</span>,<span class="string"> '0.9.0'</span>
</code></pre>
<p>范例 Gemfile，放在 Gist:</p>
<p><a href="https://gist.github.com/2555402">MacOSX</a><br><a href="https://gist.github.com/2555397">Linux</a><br><a href="https://gist.github.com/2555403">Windows</a>  </p>
<p>运行 <code>bundle install</code> 并运行 spork ：</p>
<pre><code><span class="comment">bundle</span> <span class="comment">exec</span> <span class="comment">spork</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">bootstrap
</code></pre>
<p>运行 <code>bundle install --binstubs</code> 并运行 spork：</p>
<pre><code><span class="comment">spork</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">bootstrap</span> <span class="comment">#</span> <span class="comment">or</span> <span class="comment">bin/spork</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">bootstrap
</code></pre>
<p>添加需加载的环境信息至 <code>spec/spec_helper.rb</code> 里的 <code>Spork.prefork</code>：</p>
<pre><code>require <span class="comment">'rubygems'</span>
require <span class="comment">'spork'</span>

Spork.prefork <span class="keyword">do</span>
  # Loading more <span class="keyword">in</span> this block will cause your tests <span class="keyword">to</span> run faster. However, 
  # <span class="keyword">if</span> you change any configuration <span class="keyword">or</span> code from libraries loaded here, you<span class="comment">'ll</span>
  # need <span class="keyword">to</span> restart spork <span class="keyword">for</span> it take effect.
  # This file <span class="keyword">is</span> copied <span class="keyword">to</span> spec/ when you run <span class="comment">'rails generate rspec:install'</span>
  ENV[<span class="string">"RAILS_ENV"</span>] ||= <span class="comment">'test'</span>
  require File.expand_path(<span class="string">"../../config/environment"</span>, __FILE__)
  require <span class="comment">'rspec/rails'</span>
  require <span class="comment">'rspec/autorun'</span>

  # Requires supporting ruby files <span class="keyword">with</span> custom matchers <span class="keyword">and</span> macros, etc,
  # <span class="keyword">in</span> spec/support/ <span class="keyword">and</span> its subdirectories.
  Dir[Rails.root.<span class="built_in">join</span>(<span class="string">"spec/support/**/*.rb"</span>)].<span class="keyword">each</span> {|f| require f}

  RSpec.configure <span class="keyword">do</span> |config|
    # == Mock Framework
    #
    # <span class="keyword">If</span> you prefer <span class="keyword">to</span> use mocha, flexmock <span class="keyword">or</span> RR, uncomment the appropriate line:
    #
    # config.mock_with :mocha
    # config.mock_with :flexmock
    # config.mock_with :rr
    config.mock_with :rspec

    # Remove this line <span class="keyword">if</span> you<span class="comment">'re not using ActiveRecord or ActiveRecord fixtures</span>
    config.fixture_path = <span class="string">"#{::Rails.root}/spec/fixtures"</span>

    # <span class="keyword">If</span> you<span class="comment">'re not using ActiveRecord, or you'd prefer not to run each of your</span>
    # examples within a transaction, remove the following line <span class="keyword">or</span> assign <span class="literal">false</span>
    # instead of <span class="literal">true</span>.
    config.use_transactional_fixtures = <span class="literal">true</span>

    # <span class="keyword">If</span> <span class="literal">true</span>, the base <span class="keyword">class</span> of anonymous controllers will be inferred
    # automatically. This will be the <span class="keyword">default</span> behavior <span class="keyword">in</span> future versions of
    # rspec-rails.
    config.infer_base_class_for_anonymous_controllers = <span class="literal">false</span>
  <span class="keyword">end</span>
<span class="keyword">end</span>

Spork.each_run <span class="keyword">do</span>
  # This code will be run <span class="keyword">each</span> <span class="built_in">time</span> you run your specs.

<span class="keyword">end</span>
</code></pre>
<p>启动 Spork 服务器：</p>
<p>之前使用 <code>bundle install</code>：</p>
<p><code>bundle exec spork</code> </p>
<p>之前使用 <code>bundle install --binstubs</code></p>
<p><code>bin/spork</code></p>
<p>加入此行至 <code>.rspec</code> ，让 RSpec 缺省使用 spork：</p>
<pre><code><span class="literal">-</span><span class="literal">-</span><span class="comment">drb
</code></pre>
<p><strong>提示</strong> ：</p>
<p>如果改动了 <code>routes.rb</code> 需重启 Spork 服务器，如果你觉得测试是对的，但是失败了，也可以重启 Spork 服务器试试看。</p>
<p>更多信息请参考 <a href="https://github.com/sporkrb/spork">Spork Github 页面</a></p>
<h3>Guard 搭配 Spork</h3>
<p>有了 Guard 与 Spork 以后，让它们合体：</p>
<pre><code><span class="title">bundle</span> exec guard init spork
<span class="title">bin</span>/guard init spork
</code></pre>
<p>加入此行至 Guardfile：</p>
<pre><code>guard <span class="string">'spork'</span>, <span class="symbol">:rspec_env</span> =&gt; { <span class="string">'RAILS_ENV'</span> =&gt; <span class="string">'test'</span> } <span class="keyword">do</span>
  watch(<span class="string">'config/application.rb'</span>)
  watch(<span class="string">'config/environment.rb'</span>)
  watch(%r{^config/environments/.+\.rb<span class="variable">$}</span>)
  watch(%r{^config/initializers/.+\.rb<span class="variable">$}</span>)
  watch(<span class="string">'Gemfile'</span>)
  watch(<span class="string">'Gemfile.lock'</span>)
  watch(<span class="string">'spec/spec_helper.rb'</span>)
  watch(<span class="string">'test/test_helper.rb'</span>)
  watch(<span class="string">'spec/support/'</span>)
<span class="keyword">end</span>

guard <span class="string">'rspec'</span>, <span class="symbol">:version</span> =&gt; <span class="number">2</span>, <span class="symbol">:all_after_pass</span> =&gt; <span class="keyword">false</span>, <span class="symbol">:cli</span> =&gt; <span class="string">'--drb'</span> <span class="keyword">do</span>
  .
  .
  .
<span class="keyword">end</span>
</code></pre>
<p>现在全都设定好了，以后只要</p>
<p><code>bundle exec guard</code> 或 <code>bin/guard</code> </p>
<p>Guard 就会自动启动 Spork 服务器并侦测你的改动！</p>
<p>打完收工。。。</p>

      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2012/04/30/sprok-guard-rspec/#more" class="more-link">閱讀全文</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



<a class="moot" href="https://moot.it/i/lisp_es">
   <h1 class="title">留言</h1>
</a> -->


  <div class="archive">

    <article class="post">
      <div class="post-content">
        <header>
            
              <a href="/2012/04/30/sprok-guard-rspec/"><div class="icon depth"></div> </a>
              <h2 class="depth title" ><a href="/2012/04/30/sprok-guard-rspec/">Rails 3.2.3 使用 Spork + Guard + RSpec + Capybara</a></h2>
            
            <time class="time title depth" datetime="2012-04-30T05:46:00.000Z"><a href="/2012/04/30/sprok-guard-rspec/">Apr 30 2012</a></time>
          </header>
      </div>
    </article>
  </div>


  <!-- <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon depth"></div>
        <time class="depth" datetime="2012-04-25T02:52:00.000Z"><a href="/2012/04/25/ror-3-rspec/">Apr 25 2012</a></time>
      
      
  
    <h1 class="title depth"><a href="/2012/04/25/ror-3-rspec/">RSpec 行为驱动测试简介 - 003</a></h1>
  

    </header>
    <div class="entry depth">
      
        <p><strong>1000 个小时学会 Rails 系列</strong></p>
<blockquote>
<p>关关雎鸠，在河之洲。
窈窕淑女，君子好逑。</p>
</blockquote>
<p>今天要介绍的是 RSpec 这个 Gem。</p>
<p>这个 Gem 是干啥用的呢，RSpec 是一个 BDD 测试工具，用起来跟 TDD 工具差不多，只是包了一层 DSL 外衣，也就是说语法比较接近咱人类在用的语言（据说这样开发者与客户可以直接沟通了？）；还有一个 Gem 叫做 Capybara，这个贼难念的单词是 Capybara，水豚，发音可以来<a href="http://goo.gl/mqpiQ">这里</a>听看看，声音没有 <a href="http://railscasts-china.com/">Rails 视频教程</a>的 Terry 老师 (@poshboytl) 那么性感就是了。Capybara 是一个整合测试 Rack 应用的工具，可以模拟真实用户使用你的网站的行为。Capybara 跟 RSpec 起来非常好用！</p>
<p>但今天先介绍 RSpec。。。</p>
<p>型別</p>
<p>接下来要讲的例子呢，你不需要有 Rails 的环境，只需要有 Ruby 与 RubyGems 即可。</p>
<p>Let&#39;s Dive in!!!</p>
<p>RSpec 的测试是用 Ruby <a href="http://en.wikipedia.org/wiki/Domain-specific_language">DSL</a> 写成的，看起来像是这样子：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre>describe Programmer <span class="keyword">do</span>
  it <span class="string">"is lonely"</span> <span class="keyword">do</span>
    Programmer<span class="variable">.lonely</span>?<span class="variable">.should</span> be_true
  <span class="keyword">end</span>
<span class="keyword">end</span>
</pre></td></tr></table></figure>

<p>程序员寂寞么？恩。。。。。。这语法看起来跟英语差不多吧 : ）这样写的好处是比较 Geek 一点的客户也能在<a href="http://en.wikipedia.org/wiki/Acceptance_testing">验收测试 (Acceptance Testing)</a>的阶段直接跟你讨论，看看上帝的要求有没有都满足了！我们这儿有句话说客户是上帝，不知道你们那。。。圣经有一段：上帝说有光，就有光，客户说这个，就这个。。。而这对一个开发人员呢有什么好处呢？可以看看，嗯，这个功能具体是要做什么，然后去实现它。另外一个用 DSL 写的好处是，客户、开发者、代码，都可以用这种近似英语的语言交流（理想、理想嘛）。</p>
<p>而实际上 RSpec 是扩展一些 <code>Test::Unit</code> 已经提供的方法。你喜欢的话，也可以在 RSpec 的测试里混著用。好，下面我们会用另外一个例子，讲讲怎么用这个 RSpec。。。</p>
<p>关关雎鸠，在河之洲，窈窕淑女，君子好逑。。。</p>
<h3>安装 RSpec</h3>
<p>一如往常的一键安装 <code>gem install rspec</code> （目前是 2.9.0 ＠20120423)</p>
<p>会顺便安装相依的 Gem：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre><span class="attribute">Fetching</span>: <span class="string">rspec-core-2.9.0.gem (100%)</span>
<span class="attribute">Fetching</span>: <span class="string">diff-lcs-1.1.3.gem (100%)</span>
<span class="attribute">Fetching</span>: <span class="string">rspec-expectations-2.9.1.gem (100%)</span>
<span class="attribute">Fetching</span>: <span class="string">rspec-mocks-2.9.0.gem (100%)</span>
<span class="attribute">Fetching</span>: <span class="string">rspec-2.9.0.gem (100%)</span>
</pre></td></tr></table></figure>

<p>最后一行你可以看到我们安了 <code>rspec-2.9.0.gem</code> ，而这些相依的 Gem 是要装的，就像水和鱼，过儿与龙儿，我和苍老师，是离不开彼此的。</p>
<h3>一个简单例子</h3>
<p>很好，很好，Gem 装好以后呢，让我们添加一个新的目录叫做 <code>girl</code> ，爱存哪就存哪，而下面再添加一个 <code>spec</code> 目录：</p>
<p>一键完成： <code>mkdir -p girl/spec</code> </p>
<p>在 <code>spec</code> 目录下建立一个文件叫做 <code>girl_spec.rb</code> ，注意到这个 <code>_spec</code> 了吗，这样一看就知道是一个 RSpec 的测试文件，有木有！！！！！用你喜欢的编辑器打开 <code>girl_spec.rb</code> 并敲入以下代码：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre><span class="title">describe</span> <span class="type">Girl</span> <span class="keyword">do</span>
<span class="title">trueit</span> <span class="string">"has chance?"</span> <span class="keyword">do</span>
<span class="title">truetrueGirl</span>.chance?.should be_true
<span class="title">trueend</span>
<span class="title">end</span>
</pre></td></tr></table></figure>

<p>好了，相信各位都看的懂这个例子，我们描述了一个女孩，有机会吗？应该有吧！让我们在更深入的理解以上这位女孩之前，不是，是深入理解这段代码。。。首先 <code>describe</code> 区块 (block) 包含了一个描述这个女孩的测试 (<code>it</code>)，而你宣称你应该有机会 (<code>Girl.chance?.should be_true</code>)。这跟断言有点像 (<code>assert</code>)。而如果其结果不如预期的话，RSpec 会报错并停止这个测试 (spec)。</p>
<p>那这个 <code>should</code> 哪来的，它还有一个兄弟 <code>should_not</code>，呵呵，RSpec 帮你定义好的。</p>
<blockquote>
<p>When RSpec executes specifications, 
  it defines #should and #should_not 
  on every object in the system. 
  These methods are your entry to the    magic of RSpec.
  -- <a href="http://rspec.info/">RSpec.info</a></p>
</blockquote>
<p>现在让我们运行看看，将终端切换到 <code>girl</code> 目录下：<code>[your-path-to/girl] $</code> ，接著输入：</p>
<p><code>rspec spec</code></p>
<p>究竟你跟她有没有机会呢。。。登登登。。。</p>
<p>神马！？</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre><span class="title">uninitialized</span> constant Girl (NameError)
</pre></td></tr></table></figure>

<p>你根本就不知道这女孩是谁，就想追人家了，好小子你，接下来让我们定义一下这个 Girl 常量（类）。要定义她的话，得先添加另外一个目录，叫做 <code>lib</code> ，为什么呢？因为女孩都喜欢住在房子里 (live in building，无恶意。。。)，不是，因为之后 RSpec 会替你识别这个目录，帮你引用进来。。。</p>
<p>在这个目录里添加一个 <code>girl.rb</code>，并填入：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="class"><span class="keyword">class</span> <span class="title">Girl</span>

<span class="title">end</span>
</pre></td></tr></table></figure>

<p>好了，再来我们还得回头告诉 RSpec 咱要追的是哪个女孩，回到 <code>girl_spec.rb</code> ，添加：<code>require girl</code> 呵呵，大家都需要。。。当你再次运行这个测试 <code>rspec spec</code> ，因为你告诉了 RSpec 要载入这个 <code>girl</code> ，RSpec 会把 <code>lib</code> 目录添加到与 <code>spec</code> 同一层，这就是为什么你可以找到 <code>lib/girl.rb</code> 的原因，但是唉妈呀！又出错了：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="code"><pre>F

Failures:

  <span class="number">1</span>) Girl has chance?
     Failure/<span class="keyword">Error</span>: Girl.chance?.should be_true
     NoMethodError:
       undefined method `chance?<span class="comment">' for Girl:Class</span>
     # ./spec/girl_spec.rb:<span class="number">5</span>:<span class="keyword">in</span> `block (<span class="number">2</span> levels) <span class="keyword">in</span> &lt;top (required)&gt;<span class="comment">'</span>

Finished <span class="keyword">in</span> <span class="number">0.00056</span> seconds
<span class="number">1</span> example, <span class="number">1</span> failure

Failed examples:
</pre></td></tr></table></figure>

<p>真是完整的错误信息阿！<code>F</code> 告诉我们失败了，就像你在 <code>Test::Unit</code> 里看到的一样，而下面它告诉你详细的错误信息，让你可以即时改正，所以说呢，女生找老公，找程序员是靠谱的了，每天都拼命找哪里犯了错，并且马上改！心动不如马上行动，有兴趣的姑娘立即发短信至 <a href="http://v.youku.com/v_show/id_XMjQzNTkzMDM2.html">13910733521</a>，童叟无欺。</p>
<p>回头看这到底哪儿错了：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre>NoMethodError:
trueundefined method `chance?' <span class="keyword">for</span> Girl:Class
</pre></td></tr></table></figure>

<p>哦，原来我们还没研究出，我们和一个女孩到底有没有戏的方法，让我们现在来定义一个：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre><span class="class"><span class="keyword">class</span> <span class="title">Girl</span>
<span class="title">truedef</span> <span class="title">self</span>.<span class="title">chance</span>?
<span class="title">truetruetrue</span>
<span class="title">trueend</span>
<span class="title">end</span>
</pre></td></tr></table></figure>

<p>这里我们用了 <code>self.chance?</code> ，在类的级别定义。意思是说呢，只要是女孩这个类的，都有戏！如果你没有加这个 <code>self</code> 的话，那就得是属于女孩这个类产生的实体才有戏了。现在我们在运行看看 <code>rspec spec</code> ：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre>.

Finished <span class="keyword">in</span> 0.00367 seconds
1 example, 0 failures
</pre></td></tr></table></figure>

<p>和 <code>Test::Unit</code> 一样，用一个极富深意的点，告诉我们测试通过！太棒了！这是我们写的第一个 RSpec 测试，欢呼！</p>
<p>好，假设今天，你不想要每个是女孩类别的都有戏，这样子太困扰了，每天都被骚扰。你只想要女孩类别所产生的实体有戏就好了。让我们看看怎么做，首先呢，你打开 <code>lib/girl.rb</code> ，并把 <code>self</code> 拿掉：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre><span class="class"><span class="keyword">class</span> <span class="title">Girl</span>
<span class="title">truedef</span> <span class="title">chance</span>?
<span class="title">truetruetrue</span>
<span class="title">trueend</span>
<span class="title">end</span>
</pre></td></tr></table></figure>

<p>并且相应的改动你的 spec：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre>require <span class="comment">'girl'</span>

describe Girl <span class="keyword">do</span>
  it <span class="string">"has chance?"</span> <span class="keyword">do</span>
    Girl.<span class="keyword">new</span>.chance?.should be_true
  <span class="keyword">end</span>
<span class="keyword">end</span>
</pre></td></tr></table></figure>

<p>运行： <code>rspec spec</code> ，呼，终于摆脱了一卡车的女孩了，呵呵！</p>
<p>现在让我们再来往这个测试添点东西，加入一个 <code>taken!</code> 方法，被把走了，也就是说这个女孩没戏了。这个方法呢，在 <code>Girl</code> 对象上创了一个实体变量叫做 <code>@taken</code>，而你将使用 <code>chance?</code> 方法来检验。</p>
<p>首先呢，你得先在测试里，测试这个 <code>taken!</code> 方法，是否是做你想要做的事儿。让我们在 <code>spec/girl_spec.rb</code> 里面再添一个例子：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="code"><pre>require <span class="comment">'girl'</span>

describe Girl <span class="keyword">do</span>
  it <span class="string">"has chance?"</span> <span class="keyword">do</span>
    Girl.<span class="keyword">new</span>.chance?.should be_true
  <span class="keyword">end</span>

  it <span class="string">"taken!"</span> <span class="keyword">do</span>
    girl = Girl.<span class="keyword">new</span>
    girl.taken!
    girl.should be_chance
  <span class="keyword">end</span>
<span class="keyword">end</span>
</pre></td></tr></table></figure>

<p>再我们测试之前，发现到了没有，有木有？你 YRY 了，You Repeat Yourself! 你可以看到我们定义了一个 <code>Girl.new</code> 然后第一个例子里又使用了 <code>Girl.new</code> ，而我们是果断支持 DRY 的，所以...</p>
<p>嗯嗯，让我们思索一下如何整理代码，1, 2, 3 秒，OK! 让我们把 <code>Bacon.new</code> 放到一个 <code>subject</code> 区块。 <code>subject</code> 允许你在所有位于 <code>describe</code> 区块内的测试里建立一个对象的索引。你可以这样定义一个 <code>subject</code> ：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>subject { Girl.<span class="keyword">new</span> }
</pre></td></tr></table></figure>

<p>而现在我们的测试文件：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="code"><pre>require <span class="comment">'girl'</span>

describe Girl <span class="keyword">do</span>

truesubject { Girl.<span class="keyword">new</span> }

  it <span class="string">"has chance?"</span> <span class="keyword">do</span>
    Girl.<span class="keyword">new</span>.chance?.should be_true
  <span class="keyword">end</span>

  it <span class="string">"taken!"</span> <span class="keyword">do</span>
    girl = Girl.<span class="keyword">new</span>
    girl.taken!
    girl.should be_chance
  <span class="keyword">end</span>
<span class="keyword">end</span>
</pre></td></tr></table></figure>

<p>你在这个测试的语境中，宣告了一个 <code>subject</code> ，然后我们来改写一下，比如第一个测试，有没有戏呢，你现在可以这样子替换：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre><span class="function"><span class="title">its</span><span class="params">(:chance?)</span> { <span class="title">should</span> <span class="title">be_true</span> }
</pre></td></tr></table></figure>

<p>这个 <code>its</code> 方法，接受一个方法的名字来调用这个 <code>subject</code> (Ruby 继承自 smalltalk，调用方法其实都是给对象发信息) 。然而后方这个 <code>{ ... }</code> 区块应该要包含一个预测这个方法调用完的结果。</p>
<p>然而我们还可以这样调用：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre>it <span class="string">"taken!"</span> <span class="keyword">do</span>
  subject<span class="variable">.taken</span>!
  subject<span class="variable">.should_not</span> be_chance
<span class="keyword">end</span>
</pre></td></tr></table></figure>

<p>而这里 <code>taken!</code> 方法必须使用 <code>subject</code> 来调用，因为我们只在 <code>Girl</code> 类别里有定义她。在这个情况，你没有使用 <code>its</code> ，因为你想要调用 <code>taken!</code> 方法，并且确认这个方法是否改变了 <code>chance?</code> 方法所返回的结果。</p>
<p>呼，意思就是女孩被追走了，还有没有戏啊？</p>
<p>而为了让我们的代码的可读性更猛一点，我使用了 <code>should_not</code> 来判断 <code>be_chance</code> 。</p>
<p>现在你的 <code>girl_spec.rb</code> 看起来是：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="code"><pre><span class="keyword">require</span> <span class="string">'girl'</span>

describe <span class="constant">Girl</span> <span class="keyword">do</span>

  subject { <span class="constant">Girl</span>.new }

  its(<span class="symbol">:chance?</span>) { should be_true }

  it <span class="string">"taken!"</span> <span class="keyword">do</span>
    subject.taken!
    subject.should_not be_chance
  <span class="keyword">end</span>
<span class="keyword">end</span>
</pre></td></tr></table></figure>

<p>好了，让我们运行看看，土地公公老爷爷阿，究竟女孩与我。。。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre>NoMethodError:
  undefined method `taken!' <span class="keyword">for</span> <span class="preprocessor">#&lt;Girl:0x0000010087bcb0&gt;</span>
</pre></td></tr></table></figure>

<p>搞半天我根本还没定义 <code>taken!</code> 方法啊，失败！立马定义一个，打开 <code>lib/girl.rb</code> ：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="function"><span class="keyword">def</span> <span class="title">taken!</span></span>
trueself.taken = be_true
<span class="keyword">end</span>
</pre></td></tr></table></figure>

<p>OK，再运行一次：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre>NoMethodError:
trueundefined method `taken=' <span class="keyword">for</span> <span class="preprocessor">#&lt;Girl:0x0000010087f838&gt;</span>
</pre></td></tr></table></figure>

<p>呜呜，咋回事儿呢？</p>
<p>原来我用了 <code>self.taken = true</code> ，Ruby 在跟我抱怨找不到这个 <code>taken=</code> 方法。我们可以使用 Ruby 提供的 <code>attr_accessor</code> 方法来定义这些琐碎的 <code>getter/setter</code> : ） 添加这行代码至 <code>lib/girl.rb</code> 最上方：</p>
<p><code>attr_accessor :taken</code></p>
<p>这里 <code>attr</code> 是 attribute 的缩写，学 Ruby 还学英语呢，真好！当你把一个符号（符号是一个冒号带名字 <code>:xxx</code>）传给这个 <code>attr_accessor</code> 方法时，它替你定义了把 <code>taken</code> 设定与取出值的方法。它也替你定义了一个实体变量叫做 <code>@taken</code> 给每一个这个类别的对象设值时使用。</p>
<p>好的，咱的女孩儿现在看起来像是这样：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="code"><pre><span class="class"><span class="keyword">class</span> <span class="title">Girl</span>

<span class="title">trueattr_accessor</span> :<span class="title">taken</span>

<span class="title">truedef</span> <span class="title">chance</span>?
<span class="title">truetruetrue</span>
<span class="title">trueend</span>

<span class="title">truedef</span> <span class="title">taken</span>!
<span class="title">truetrueself</span>.<span class="title">taken</span> = <span class="title">true</span>
<span class="title">trueend</span>

<span class="title">end</span>
</pre></td></tr></table></figure>

<p>再运行一次 <code>rspec spec</code>，月老公公老奶奶阿，看你的了阿：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre><span class="title">expected</span> chance? to return <span class="built_in">false</span>, got <span class="built_in">true</span>
</pre></td></tr></table></figure>

<p>唔？预期没戏，返回的结果是有戏，怎么会这样呢？哎呀，因为 <code>chance?</code> 永远都返回真嘛，我们应该要判断这个女孩是否被把走了，然后再下手。。。嗯嗯嗯：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="function"><span class="keyword">def</span> <span class="title">chance?</span></span>
<span class="keyword">true</span>!taken
<span class="keyword">end</span>
</pre></td></tr></table></figure>

<p>运行 <code>rspec spec</code> !</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre><span class="string">.</span><span class="string">.</span>

<span class="comment">Finished</span> <span class="comment">in</span> <span class="comment">0</span>.<span class="comment">00917</span> <span class="comment">seconds</span>
<span class="comment">2</span> <span class="comment">examples</span>, <span class="comment">0</span> <span class="comment">failures
</pre></td></tr></table></figure>

<p>阿哈，终于成功了！！！！！！！！</p>
<p>但是，要是我们粗心大意，不小心忘了加 <code>self</code> 前缀呢？现在让我们把 <code>self.taken</code> 的 <code>self</code> 拿掉看看。。。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="number">1</span>) Girl taken!
   Failure/Error: subject<span class="variable">.should_not</span> be_chance
     expected chance? to <span class="keyword">return</span> <span class="literal">false</span>, got <span class="literal">true</span>
</pre></td></tr></table></figure>

<p>RSpec 告诉我们：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="number">1</span>) 女孩被把了！
<span class="literal">true</span>失败 / 错误：subject<span class="variable">.should_not</span> be_chance
<span class="literal">true</span>预期没戏，却有戏。
</pre></td></tr></table></figure>

<p>这样还不用 RSpec 么？太牛了！哈哈哈哈。。。</p>
<p>好啦，RSpec 可以避免我们犯这种明显的错误，若犯错，即改之。如果你先写测试，然后让你的代码通过测试，你就会有很强大的自信，你的代码是工作的！而之后重构时，也可以一点一点的重构，在跑的过测试的前提之下。</p>
<p>好的，我们把它改回正确的吧：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="function"><span class="keyword">def</span> <span class="title">taken!</span></span>
trueself.taken = <span class="keyword">true</span>
<span class="keyword">end</span>
</pre></td></tr></table></figure>

<p>运行成功。。。</p>
<p>OK! 现在你对 RSpec 有了基础的认识，之后当你想要这样子开发你的应用时，当然不是我这样子轻浮的方式，是用行为驱动开发方式来开发应用时，你将会需要看看这本书：<a href="http://pragprog.com/book/achbd/the-rspec-book">The RSpec Book</a>。</p>
<p>最后，路上把妹的时候要注意阿各位，记得先测试一下。</p>
<p>待续。。。</p>
<p>延伸阅读：</p>
<p><a href="http://pragprog.com/book/achbd/the-rspec-book">The RSpec Book</a></p>
<p><a href="http://www.slideshare.net/ihower/rspec-7394497">RSpec 让你愛上写测试</a></p>
<p><a href="http://jhjguxin.sinaapp.com/2012/02/26/rspec-best-practices-and-tips/">RSpec Best practices and tips</a></p>
<p><a href="http://blog.csdn.net/onlyqi/article/details/6740930">CSDN 一篇不错的 对测试的认识</a></p>
<p><a href="http://www.letrails.cn/archives/20/">RSpec 简明指南</a></p>
<p><a href="http://vdisk.weibo.com/s/4vJBP">RSpec on Rails PDF</a></p>
<p><a href="http://bookapp.book.qq.com/origin/book/?workid=1956140">低成本泡妞</a></p>

      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2012/04/25/ror-3-rspec/#more" class="more-link">閱讀全文</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



<a class="moot" href="https://moot.it/i/lisp_es">
   <h1 class="title">留言</h1>
</a> -->


  <div class="archive">

    <article class="post">
      <div class="post-content">
        <header>
            
              <a href="/2012/04/25/ror-3-rspec/"><div class="icon depth"></div> </a>
              <h2 class="depth title" ><a href="/2012/04/25/ror-3-rspec/">RSpec 行为驱动测试简介 - 003</a></h2>
            
            <time class="time title depth" datetime="2012-04-25T02:52:00.000Z"><a href="/2012/04/25/ror-3-rspec/">Apr 25 2012</a></time>
          </header>
      </div>
    </article>
  </div>


  <!-- <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon depth"></div>
        <time class="depth" datetime="2012-04-25T02:51:00.000Z"><a href="/2012/04/25/ror-2-test-unit/">Apr 25 2012</a></time>
      
      
  
    <h1 class="title depth"><a href="/2012/04/25/ror-2-test-unit/">測試！測試！ - 002</a></h1>
  

    </header>
    <div class="entry depth">
      
        <p><strong>1000 个小时学会 Rails 系列</strong></p>
<blockquote>
<p>The general idea behind unit testing is that you write a test method that makes certain assertions about your code, working against a test fixture. A bunch of these test methods are bundled up into a test suite and can be run any time the developer wants. The results of a run are gathered in a test result and displayed to the user through some UI.
-- Nathaniel Talbott</p>
</blockquote>
<p>好了，Rails 真的很牛。Ruby 是如此优雅精妙，那么程序员真的性福美满了吗？那究竟要如何写出可维护的代码呢？拜读松本行弘的程序世界？不是！连读七遍 Programming Ruby 1.9？有可能！每天上 Ruby-china 学习？这就对了！好了那到底是什么？答案是写测试！</p>
<p>型別</p>
<p>为什么要写测试呢？恩，先谈谈两种程序员吧。一种是自负的程序员，他们觉得：“日出东方，唯我代码不坏”，这种思想其实很好，是社会进步的动力之一。这种人要嘛特别牛，要嘛特别。。。0010，但我们要看清一个事实，是人都会犯错。另一种程序员，怎么著都怕出错，在论坛四处发问，哪本书最好，哪个教程最猛，写程序战战兢兢，就跟相亲挑老婆，结果如墨菲先生预言：只要有可能出错，那就一定会出错。第一种程序员，根本不屑写测试，第二种程序员，拼命学写测试，学的连代码都不会写了。该怎么办？</p>
<p>还是写测试！在编码前先写测试，这有什么好处？预测程序的行为、确保程序如你想的那般工作、有写测试让你更有自信，更容易重构代码，理清你的思路，等等好处。那为什么大家都不写测试呢？呃。。。很多原因是老板太凶、日期太紧，但我相信测试可以救你于水火之中。而 Rails 也替你打点了许多的测试工具，让你不用在「编码 -&gt; 储存 -&gt; 刷新 -&gt; 编码 -&gt; 储存 -&gt; 刷新...」、要是一个个视图、一个个模型、一个个控制器都是如此手工测试，搞得你晚上八点还在公司，一出错又不知从何查起，真是一场永远不会醒的恶梦。测试可以使我们确保程序正常运作，将用户行为转为测试，让我们有一个开发的方向。未来出错时，可以改动现有的测试来适应新的情况，让你可以早日回家陪老婆孩子（家庭第一），正所谓，测试写得好，挣钱挣到老，测试写的巧，上班没烦恼。</p>
<p>月有阴晴圆缺，而生命会自己找到出口，就这样，有了<a href="http://zh.wikipedia.org/wiki/%E6%B5%8B%E8%AF%95%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91">测试驱动开发</a>（Test-Driven Development, TDD）以及<a href="http://zh.wikipedia.org/wiki/%E8%A1%8C%E4%B8%BA%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91">行为驱动开发</a>（Behavior-Driven Development, BDD）。TDD 又有一个名字叫做 Red-Green-Refactor。先写好测试，运行，错误一堆（满江红），撰写可以通过测试的代码（绿油油），测试通过后再重构，确保代码仍然工作。这样子的好处是？一来先写测试可以先让你想想程序的思路，与下棋有异曲同功之妙，只不过下棋咱是在脑里演练；二来写测试可以确保你的程序正常工作，预期未来可能发生的错误。然而我们从小的教育不是这样，导致我们害怕犯错，以前可以考试先考差了，再让你重写一次考卷嘛？现在机会来了。写测试吧！</p>
<p>恩，至于这 BDD 与 TDD 精确的定义呢，危机、摆渡百科都有，谷歌百度一下吧，就不赘述了，用了就知道！BDD 是基于 TDD 所造出来的，旨在测试整个程序中，各个“正常工作代码”之间的互动。也就是说呢，TDD 搭配 BDD 使用。TDD 的工具我们将粗浅介绍 Test::Unit，BDD 我们将介绍的是 RSpec 搭配 海豚 (Capybara)，小黄瓜 (Cucumber) 就别用了，太坑爹了，还是留著配炸酱面吧！</p>
<p>还是不怎么信么？那我再好好讲一次测试的好处，你想想，如果你要测试某个页面的表单，填了某个值会发生什么事，要是这个表单一共有九种变化，共有九种不同表单，九九八十一个变化，还不算你手滑按错的错误，这测起来真是想死的心都有了（爱惜生命！）。让计算机自动帮我们测试，比起手工测试好、省时又省心。另一个好处是，测试可以预防你犯傻。当你犯了一个再明显不过的错误时，测试可以替你找出来，替你的程序做一个健康检查，让你获得更多信息，由测试通知你，总比暴跳如雷的老板来得好。用户永远都有无止尽的好奇心，会在你想都想不到的地方，把东西弄坏！有了之前的测试，你可以轻松的改写之前的测试，来满足这个你未预期的情况，这又叫作<a href="http://zh.wikipedia.org/wiki/%E5%9B%9E%E5%BD%92%E6%B5%8B%E8%AF%95">回归测试</a> (Regression Test)</p>
<p>现在我们来看怎么用 Test::Unit 写测试吧！</p>
<h3>撰写第一个测试</h3>
<p>Ruby 的 <code>Test::Unit</code> 写了一堆的函式库，就在哪里，等著、盼著、寂寞地等你调用它们。接下来我来讲一个简单的 <code>Test::Unit</code> 例子。首先建立一个目录，叫作 <code>example</code> ，在这个目录里你创一个文件：<code>example_test.rb</code> 。记得把测试加上 <code>_test</code> 的字尾，这样子一看就知道这是一个测试文件。打开这个 <code>example_test.rb</code> ，敲入以下代码：</p>
<pre><code>require <span class="string">'test/unit'</span>

<span class="class"><span class="keyword">class</span> <span class="title">ExampleTest</span> &lt; <span class="title">Test</span>::<span class="title">Unit</span>::<span class="title">TestCase</span>
  <span class="title">def</span> <span class="title">test_truth</span>
    <span class="title">assert</span> <span class="title">true</span>
  <span class="title">end</span>
<span class="title">end</span>
</code></pre>
<p><code>Test::Unit</code> 测试呢，首先引入 Ruby 标准函式库的 <code>&#39;test/unit&#39;</code> 。这让你可以从 <code>Test::Unit::TestCase</code> 继承它所有的东西（要是可以 <code>require &#39; 李嘉诚 &#39;</code> 就好了，我也不用。。。）。那究竟继承了什么？继承了让你可以在类里面，将名字取为 <code>test_</code> 打头的方法来写测试的功能，<code>test_xxxx</code> 会被识别成是测试。</p>
<p>第一个测试写好了！！！！！！！（咆哮体），让我们来运行看看： </p>
<p><code>ruby example_test.rb</code> </p>
<p>你会看到像是这样的输出：</p>
<pre><code>.

Finished tests <span class="keyword">in</span> <span class="number">0.000866</span>s, <span class="number">1154.7344</span> tests<span class="regexp">/s, 1154.7344 assertions/</span>s.

<span class="number">1</span> tests, <span class="number">1</span> assertions, <span class="number">0</span> failures, <span class="number">0</span> errors, <span class="number">0</span> skips
</code></pre>
<p>那个奇怪的点是什么呢？这是 <code>Test::Unit</code> 告诉你一个测试成功通过的方式， <code>F</code> 代表不通过的测试, <code>E</code> 代表有错误的测试，那 <code>(.)(.)</code> 呢？哈哈开个玩笑，确保你有认真看。跟著点之后是一些统计数据，告诉你一个测试、一个断言 (assertion)、零个失败、零个错误、零个跳过。</p>
<p>在你的测试中你用了一个 <code>assert</code> 方法，你断言传入的参数为真。然而我们传入的是真（非 <code>nil</code> 与 <code>false</code> 亦为真），假如不知为何的这个方法失败了，会引起一个 exception 告诉你。 </p>
<p>如果你的方法名不是 <code>test_</code> 打头：</p>
<pre><code>test <span class="string">"truth"</span> <span class="keyword">do</span>
    <span class="built_in">assert</span> <span class="keyword">true</span>
<span class="keyword">end</span>
</code></pre>
<p>你再运行看看 (<code>ruby example_test.rb</code>)，会发现</p>
<pre><code><span class="title">No</span> tests were specified.
<span class="number">1</span> tests, <span class="number">1</span> assertions, <span class="number">1</span> failures, <span class="number">0</span> errors
</code></pre>
<p>这是因为 <code>Test::Unit</code> 调用了缺省的 <code>default_test</code> 缘故，若你使用的是 1.9.3+ 的 Ruby 只会显示没有测试。</p>
<p>所以记得把测试方法名用 <code>test_</code> 开头！</p>
<p>接下来让我们考虑一个更复杂的方法，建立一个 <code>love_test.rb</code> ：</p>
<pre><code>require <span class="string">'test/unit'</span>
<span class="class"><span class="keyword">class</span> <span class="title">LoveTest</span> &lt; <span class="title">Test</span>::<span class="title">Unit</span>::<span class="title">TestCase</span>
  <span class="title">def</span> <span class="title">test_saved</span>
    <span class="title">assert</span> <span class="title">Love</span>.<span class="title">saved</span>?
  <span class="title">end</span>
<span class="title">end</span>
</code></pre>
<p>当然了，你想确保你的愛情有保存，但是当你运行时 <code>ruby love_test.rb</code> ，哎呀：</p>
<pre><code><span class="attribute">NameError</span>: <span class="string">uninitialized constant LoveTest::Love</span>
</code></pre>
<p>哪知道你根本还没有愛情，让我们来定义爱情：</p>
<pre><code><span class="class"><span class="keyword">class</span> <span class="title">Love</span>

<span class="title">end</span>
</code></pre>
<p>那这个愛情要放在测试之前呢，还是测试之后呢？在 <code>Test::Unit</code> 里是都可以，在 Ruby 里面东西都是得先定义才能使用，但是 <code>Test::Unit</code> 会先把所有的代码求值，再来运行测试，所以现在 <code>love_test.rb</code> ：</p>
<pre><code>require <span class="string">'test/unit'</span>

<span class="class"><span class="keyword">class</span> <span class="title">Love</span>

<span class="title">end</span>

<span class="title">class</span> <span class="title">LoveTest</span> &lt; <span class="title">Test</span>::<span class="title">Unit</span>::<span class="title">TestCase</span>
  <span class="title">def</span> <span class="title">test_saved</span>
    <span class="title">assert</span> <span class="title">Love</span>.<span class="title">saved</span>?
  <span class="title">end</span>
<span class="title">end</span>
</code></pre>
<p>接下来再运行看看 <code>ruby love_test.rb</code> ：</p>
<pre><code><span class="attribute">NoMethodError</span>: <span class="string">undefined method `saved?' for Love:Class</span>
</code></pre>
<p>错误信息明确的告诉我们，愛情是不能保质的，看来 Ruby 也挺懂人情事理的，但我們可以自己定義一個保存的方法：</p>
<pre><code><span class="class"><span class="keyword">class</span> <span class="title">Love</span></span>
    <span class="function"><span class="keyword">def</span> <span class="title"><span class="keyword">self</span></span>.<span class="title">saved?</span></span>
      <span class="keyword">true</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>
</code></pre>
<p>接著运行你会如预期的发现测试通过，但是有一天，就是風雨交加的那天，不知为何某女把你的测试改成 <code>false</code> ：</p>
<pre><code>F

Finished tests <span class="keyword">in</span> <span class="number">0.001137</span>s, <span class="number">879.5075</span> tests<span class="regexp">/s, 879.5075 assertions/</span>s.

  <span class="number">1</span>) Failure:
test_saved(LoveTest) [love_test.rb:<span class="number">14</span>]:
Failed assertion, <span class="literal">no</span> message given.
</code></pre>
<p>失败，最惨的是 <code>no message given</code> 。。。</p>
<p>居然什么信息也不给，唉，其实这是 <code>Test::Unit</code> 一贯回报测试失败的方式，</p>
<p>然而某女突然觉得过意不去，又回头给你加上一个更清楚的信息：</p>
<pre><code>  <span class="comment">assert</span> <span class="comment">Love</span>.<span class="comment">saved?</span>, <span class="comment">"咱俩不合适！</span> <span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="comment">"</span> 
</code></pre>
<p>现在你再运行测试，你会得到一个清楚的错误信息</p>
<pre><code>  1) <span class="tag">Failure</span>:
<span class="tag">test_saved</span>(<span class="tag">LoveTest</span>) <span class="attr_selector">[love_test.rb:16]</span>:
咱俩不合适！
</code></pre>
<p>嗯，你懂得，我的朋友。。。。。他说风雨中这点痛算什么，擦乾泪不要问，至少我们还有梦！</p>
<p>这就是使用 <code>Test::Unit</code> 非非非非非非常基本的 TDD 了， <code>Test::Unit</code> 是 Rails 缺省的测试框架，在我们漫长的学习 Rails 的旅途中，你将会常常看到它，并且克制不住的或是被逼迫的使用它。</p>
<p>记得哦，爱情是没有保质期的，亲。</p>
<p>距离学会 Rails 还有 965 个小时。。。</p>
<p>待续。。。</p>
<h3>延伸阅读</h3>
<p><a href="http://courseware.codeschool.com.s3.amazonaws.com/rails_testing.pdf">CodeSchool: Rails Testing for Zombies slides</a></p>
<p><a href="http://guides.rubyonrails.org/testing.html">A Guide to Testing Rails Applications</a></p>
<p><a href="http://ihower.tw/rails3/testing.html">测试 Testing</a></p>
<p><a href="http://rubykoans.com/">Ruby Koans</a></p>
<p><a href="http://ruby-china.org/search?q=Test%3A%3AUnit">Ruby-china 上关于测试的帖子</a></p>
<p><a href="http://ruby-doc.org/stdlib-1.9.3/libdoc/test/unit/rdoc/Test/Unit.html">Ruby Test::Unit 函式库</a></p>
<p><a href="http://www.google.com.hk/webhp?hl=zh-CN&amp;sourceid=cnhp#hl=zh-CN&amp;safe=strict&amp;site=webhp&amp;source=hp&amp;q=%E4%B8%BA%E4%BB%80%E4%B9%88%E5%A5%B3%E6%9C%8B%E5%8F%8B%E4%B8%8D%E8%A6%81%E6%88%91%E4%BA%86&amp;oq=%E4%B8%BA%E4%BB%80%E4%B9%88%E5%A5%B3%E6%9C%8B%E5%8F%8B%E4%B8%8D%E8%A6%81%E6%88%91%E4%BA%86&amp;aq=f&amp;aqi=&amp;aql=&amp;gs_nf=1&amp;gs_l=hp.3...1405.6419.0.6789.34.32.1.0.0.0.105.1818.30j1.31.0.uZEfYhm1ZUM&amp;bav=on.2,or.r_gc.r_pw.,cf.osb&amp;fp=4de69b13c14b576b">为什么女朋友不要我了</a></p>

      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2012/04/25/ror-2-test-unit/#more" class="more-link">閱讀全文</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



<a class="moot" href="https://moot.it/i/lisp_es">
   <h1 class="title">留言</h1>
</a> -->


  <div class="archive">

    <article class="post">
      <div class="post-content">
        <header>
            
              <a href="/2012/04/25/ror-2-test-unit/"><div class="icon depth"></div> </a>
              <h2 class="depth title" ><a href="/2012/04/25/ror-2-test-unit/">測試！測試！ - 002</a></h2>
            
            <time class="time title depth" datetime="2012-04-25T02:51:00.000Z"><a href="/2012/04/25/ror-2-test-unit/">Apr 25 2012</a></time>
          </header>
      </div>
    </article>
  </div>



<nav id="pagination">
  
    <a href="/" class="alignleft prev">上一頁</a>
  
  
    <a href="/page/3/" class="alignright next">下一頁</a>
  
  <div class="clearfix"></div>
</nav></div></div>
    <aside id="sidebar" class="alignleft"><!-- 
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜尋">
    <input type="hidden" name="q" value="site:lisp.es/">
  </form>
</div>

  
<div class="widget twitter">
  <h3 class="title">推文</h3>
  <ul id="tweets"></ul>
</div>

<script type="text/javascript">
var twitter_stream = ['JuanitoFatas', 5, false];
var moment_js_path = '/js/moment.min.js';
</script>
<script src="/js/twitter.js"></script>


 -->
<div class="personal-info">
  <figure>
    
      <a href="/">
        <img class="personal-photo" src="https://secure.gravatar.com/avatar/771951f55ed37335f238e1a80dfda9cd?s=420&d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-user-420.png" alt="Juanito Fatas">
      </a>
    
    <figcaption>
      <h3 class=>Juanito Fatas</h3>
      <p>城市中的迷途小碼農</p>
    </figcaption>
  </figure>
  <section class="social">
    
      <a target="_blank" class="icon twitter depth" href="http://twitter.com/JuanitoFatas"></a>
    
    
    
      <a target="_blank" class="icon github depth" href="http://github.com/JuanitoFatas"></a>
    
    
      <a target="_blank" class="icon email depth" href="mailto:katehuang0320@gmail.com"></a>
    
  </section>
</div>
</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignright depth">
  <a class="footer-link" href="/about">About Me</a>
  <a class="footer-link" href="http://github.com/thiagopnts/hexo-persona-dark">Based on Persona Dark Theme</a> 
  &copy; - 2013 Juanito Fatas
  
</div>
<div class="clearfix"></div></footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



<script src="//cdn.moot.it/latest/moot.min.js"></script>

</body>
</html>