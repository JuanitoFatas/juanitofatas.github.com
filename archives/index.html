<!--
       _                   _ _          ______    _
      | |                 (_) |        |  ____|  | |
      | |_   _  __ _ _ __  _| |_ ___   | |__ __ _| |_ __ _ ___
  _   | | | | |/ _` | '_ \| | __/ _ \  |  __/ _` | __/ _` / __|
 | |__| | |_| | (_| | | | | | || (_) | | | | (_| | || (_| \__ \
  \____/ \__,_|\__,_|_| |_|_|\__\___/  |_|  \__,_|\__\__,_|___/
-->
<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>彙整 | I'm Juanito Fatas</title>
  <meta name="author" content="Juanito Fatas">
  
  <meta name="description" content="This site contains technical articles, presentations, thoughts, software, and other materials by Juanito Fatas.">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="I'm Juanito Fatas"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="I'm Juanito Fatas" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  
    <link rel="stylesheet" type="text/css" href="//cdn.moot.it/1/moot.css">
  
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
  <script>
  $(document).ready(function() {
    $('#sidebar').delay(400).animate({ width: '285px' }, 500, function() {
      $('.personal-info').css({display: 'table'}).hide().fadeIn(500);
    });
  });
  </script>
  
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-41041908-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

</head>


<body>
  <header id="header" class="inner"><!-- <div class="alignleft">
  <h1><a href="/">I'm Juanito Fatas</a></h1>
  <h2><a href="/">C-x C-f...C-x C-s...</a></h2>
</div>
 --><!-- <nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">首頁</a></li>
    
      <li><a href="/archives">彙整</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
 --></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignright"><div id="wrapper">
<h2 class="archive-title">彙整</h2>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon depth"></div>
        <time class="depth" datetime="2013-07-07T05:01:23.000Z"><a href="/2013/07/07/meta-object-intro/">Jul 7 2013</a></time>
      
      
  
    <h1 class="title depth"><a href="/2013/07/07/meta-object-intro/">Metaobject 元对象</a></h1>
  

    </header>
    <div class="entry depth">
      
        <p>元对象 metaobject
在计算机科学里，一个元对象是任何可以操作、创建、描述或实现别的对象的实体。</p>
<p>基础对象 base object
关于 metaobject 的对象称作基础对象。</p>
<p>一个元对象可储存的信息为基础对象的类型 (type)、介面 (interface)、类别 (class)、方法 (methods)、属性 (attributes)、变量 (variables)、函数 (functions)、控制结构 (control structures) 等。</p>
<p>一个元对象协议 (metaobject protocol) 是一个程序语义的直译器，而此直译器是公开且可扩展的。因此，一个 MOP 决定了一个程序的行为与意义是什么，并且 MOP 是可扩展的，使得一个程序员可以通过扩展 MOP 的部分，来改变程序的行为。MOP 揭露了直译器某些或全部的内部结构给程序员。MOP 也许表现的像是一组类别与方法，允许一个程序来检查支援系统的状态以及改变系统的行为。MOP 面向对象的程序所实现，其中所有的对象是元对象</p>
<p>MOP 分成执行期或编译期两种。执行期 MOP 的元对象于程序运行、执行时存在。而编译期 MOP 的元对象仅在程序编译时存在。它们或许可以改变或扩展编译过程，但当程序运行时它们是不存在的。</p>
<p>最为人所知的执行期 MOP 是 The Art of Metaobject Protocol (AMOP) 所描述的 MOP。它应用在 Common Lisp 对象系统上 (CLOS)，并允许我们可以操作继承、方法派发、类别实例化…等等，这些机制。在全录帕罗奥多研究中心 Xerox PARC，AMOP 作者之一，Gregor Kiczales，在 Scheme 上开发了一个小巧但威力强大的基于 MOP 的执行期对象系统，称为 TinyCLOS。被移植到许多 Scheme 实现上。</p>
<p>一个 MOP 的用途例子是改变多重继承的实作。一个反覆出现的议题是如何解决 slot 的冲突与方法的 superclass。通常语言设计者选择一个解决方案，而语言使用者必须遵循它。取而代之的，元对象协议使得我们可以改变继承的规则，并替每一个单一类别选择不同的解决方案。一个元对象是一种实现 aspect-oriented programming 语言的方法。许多早期 MOP 的创始者，包括 Gregor Kiczales 为早期 aspect-oriented 程序设计的提倡者。</p>
<p>未完待續...</p>

      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2013/07/07/meta-object-intro/#more" class="more-link">閱讀全文</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon depth"></div>
        <time class="depth" datetime="2013-07-07T04:58:30.000Z"><a href="/2013/07/07/spanish-ending-words/">Jul 7 2013</a></time>
      
      
  
    <h1 class="title depth"><a href="/2013/07/07/spanish-ending-words/">西文一些結尾問候語的說法</a></h1>
  

    </header>
    <div class="entry depth">
      
        <p>一些禮貌性的結尾問候語：</p>
<ul>
<li>un beso (A kiss)</li>
<li>un besote (A big kiss)</li>
<li>un besazo (A big big kiss)</li>
<li>un besito （小親親，有那種親小孩的感覺，啾啾啾的那種親親）</li>
<li>un besico （跟 besito 一樣，但是妳如果跟從 zaragoza 來的人，說 besico，他們會很驚訝！）</li>
<li>un besiko （跟 besico 一樣，只是 k 的音跟 c 一樣。）</li>
</ul>
<p><code>-ito</code> <code>-ico</code> 字根，就是變小的意思</p>
<p><code>-azo</code> 字根，有變大的意思</p>
<ul>
<li>un abrazo （擁抱）</li>
<li>un abrazo fuerte （一個強烈的擁抱，抱的很緊的那種）</li>
<li>un beso enorme （超大的親親）</li>
<li>un superbesote de vaca （像牛一樣舔妳的臉。乳牛的舌頭很長，這句很有趣喔!）</li>
<li>un morreo （台灣話的喇舌）</li>
<li>mua! （就是 <strong>ㄇㄨㄚˋ</strong> 一下囉）</li>
<li>un saludo (a greeting)</li>
<li>TQM Te quiero mucho (I love you very much!!)</li>
<li>Cuidate (take care)</li>
</ul>
<p>可以在問候語的後面加很多東西，譬如：un beso guapisimo (大帥哥）</p>
<p>還有很多囉，其實就只是好玩而已，是西班牙人表達禮貌與思念的方式!</p>
<p>un beso a todos ; ) !!!</p>

      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2013/07/07/spanish-ending-words/#more" class="more-link">閱讀全文</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon depth"></div>
        <time class="depth" datetime="2013-07-01T17:57:51.000Z"><a href="/2013/07/02/hello-ruby/">Jul 2 2013</a></time>
      
      
  
    <h1 class="title depth"><a href="/2013/07/02/hello-ruby/">Hello Ruby，走進琳達里優可絲的夢遊仙境。</a></h1>
  

    </header>
    <div class="entry depth">
      
        <p>來分享一下，一個人、一本書。</p>
<p>那個人？<a href="http://lindaliukas.fi/">Linda Liukas</a>，Rails Girls 共同創辦人，Codecademy 的社群管理員。2013 年的 Ruby 英雄。哪本書？由她所寫的 Ruby 童書<a href="http://helloruby.com/">《Hello Ruby》</a>，我是從 Heroku Waza 2013 Conf 看到的一個影片，由 Codecademy 的 Linda 小姐帶來的題目：人人有程編，發現到這位 Linda 小姐。</p>
<p>她分享了兩個故事，前半段簡略的講了下《Hello Ruby》，後半段講她的心路歷程，提到編程世界的女權問題、教學問題、文化問題，很精采也很有感染力，我就不多說了，留給你與她來一個面對面的交流！</p>
<p>我這邊稍稍介紹下《Hello Ruby》。</p>
<p>由 Linda Liukas (念法：琳達●里優可絲）撰寫的 Ruby 童書，《Hello Ruby》，不久之後即將推出，這是一本什麼樣的書呢？</p>
<p>故事的內容大概是這樣：有一個古靈精怪充滿好奇心、調皮搗蛋又頑強的可愛小女孩，叫做“露比”，</p>
<p><img src="https://raw.github.com/JuanitoFatas/Foto/master/hello-ruby/01-little-ruby.png" alt=""></p>
<p>有一天，她與她的好朋友，“潔姆絲”們，在一起玩耍，突然間北風叔叔來了，北風叔叔把她的好朋友潔姆絲吹走了，散落到世界各地。於是露比踏上了冒險的旅途，要找回她的好朋友們。在旅途當中，她碰到許許多多的人，並在旅途中，向遇到的人們尋求幫助。</p>
<p><img src="https://raw.github.com/JuanitoFatas/Foto/master/hello-ruby/02-android.png" alt=""></p>
<p>有一次她遇到了機器人安卓依，有數以百計的安卓依，正在快樂地烘焙拐杖糖、餅乾、牛奶與彩虹糖，她問安卓依有看到潔姆絲嗎？安卓依們看起來很奇怪，總是同時一起說話，她感到很混亂，但仍然很喜歡安卓依。</p>
<p><img src="https://raw.github.com/JuanitoFatas/Foto/master/hello-ruby/03-snow-leopard.png" alt=""></p>
<p>她遇到了喜歡簡單美好事物的的美麗小雪豹：絲諾梨歐趴，小雪豹喜歡一人獨處，但她與 Ruby 相處的很好。</p>
<p><img src="https://raw.github.com/JuanitoFatas/Foto/master/hello-ruby/04-penguins.png" alt=""></p>
<p>她遇到了充滿好奇心的小企鵝們，小企鵝們很愛胡思亂想也很聒噪，有著許許多多的意見，有時候露比聽不懂小企鵝們在說什麼，但她認為小企鵝們很聰明並有很多知識。</p>
<p><img src="https://raw.github.com/JuanitoFatas/Foto/master/hello-ruby/05-firefox.png" alt=""></p>
<p>她遇到了小火狐，小火狐喜歡很多小東西，就如同她喜歡與小露比一起玩。</p>
<p><img src="https://raw.github.com/JuanitoFatas/Foto/master/hello-ruby/06-Django.png" alt=""></p>
<p>她遇到了一個小男孩，嬉皮士姜狗，姜狗試著要與露比來一場對決。。。</p>
<p>露比的朋友每個都很不一樣，每個人都不是完美的，有著各自調皮的地方，露比從他們每個人身上學到許多東西，而這個世界需要他們。</p>
<p><img src="https://raw.github.com/JuanitoFatas/Foto/master/hello-ruby/07-magic-book.png" alt=""></p>
<p>Linda Liukas 如是說：“我相信每個人小時候，都有一本屬於童年的魔法書。一本讓你看到世界是如此美麗，充滿著無限可能性的一本魔法書。而這本是我的魔法書（笑）。”</p>
<p>聽聽她精妙絕倫的演講，找回編程最初的感動吧！</p>
<p>傳送門：<a href="https://vimeo.com/61113155">https://vimeo.com/61113155</a></p>

      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2013/07/02/hello-ruby/#more" class="more-link">閱讀全文</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon depth"></div>
        <time class="depth" datetime="2013-06-19T17:08:44.000Z"><a href="/2013/06/20/ruby-test-in-sublime-with-spork/">Jun 20 2013</a></time>
      
      
  
    <h1 class="title depth"><a href="/2013/06/20/ruby-test-in-sublime-with-spork/">在 Sublime Text 里面运行 Ruby 测试</a></h1>
  

    </header>
    <div class="entry depth">
      
        <ol>
<li>安装 package:</li>
</ol>
<p>安装办法见 Ruby Tests GitHub 说明页面：<a href="https://github.com/maltize/sublime-text-2-ruby-tests">https://github.com/maltize/sublime-text-2-ruby-tests</a></p>
<p>安装好后，重启 Sublime Text，RubyTest 提供了以下热键：</p>
<ul>
<li>Command-Shift-R: run a single test (if run on an it block) or group of tests (if run on a describe block)</li>
<li>Command-Shift-E: run the last test(s)</li>
<li>Command-Shift-T: run all the tests in current file</li>
</ul>
<p>由于测试总运行的暴慢，能单独运行是非常好的。</p>
<p>一个工作流程示例：</p>
<ol>
<li>终端启动 Spork。</li>
<li>写个测试。</li>
<li>Command-Shift-R 确保测试为失败（红灯）。</li>
<li>写相应的代码。</li>
<li>Command-Shift-E 运行刚刚的测试，确保测试通过（绿灯）。</li>
<li>反覆操作 2-5。</li>
</ol>
<p>等代码写到一个阶段的时候， <del>或是女朋友来了</del> ，则抓紧时间运行 <code>rspec spec/</code> ，来确保整组测试通过。</p>

      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2013/06/20/ruby-test-in-sublime-with-spork/#more" class="more-link">閱讀全文</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon depth"></div>
        <time class="depth" datetime="2012-11-21T13:43:00.000Z"><a href="/2012/11/21/jquery-bind-live-delegate/">Nov 21 2012</a></time>
      
      
  
    <h1 class="title depth"><a href="/2012/11/21/jquery-bind-live-delegate/">JQuery bind() live() delegate() on() 差别</a></h1>
  

    </header>
    <div class="entry depth">
      
        <h2>bind() live() delegate()...and on()</h2>
<p><strong>这些都是干嘛的？</strong></p>
<p><strong>为什么我们需要这些方法？</strong></p>
<p>首先给一个示例用 html:</p>
<script src="https://gist.github.com/4124940.js"></script>

<p>很好！ 让我们开始吧！</p>

      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2012/11/21/jquery-bind-live-delegate/#more" class="more-link">閱讀全文</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon depth"></div>
        <time class="depth" datetime="2012-06-04T16:24:00.000Z"><a href="/2012/06/05/scope-and-extent-in-cl/">Jun 5 2012</a></time>
      
      
  
    <h1 class="title depth"><a href="/2012/06/05/scope-and-extent-in-cl/">Common Lisp 的 Scope 与 Extent</a></h1>
  

    </header>
    <div class="entry depth">
      
        <h2>为什么要理解 Scope 与 Extent?</h2>
<p>这两个概念在理解许多 Common Lisp 语言的特色时是很有用的，这两个概念出现在某个对象 (object) 或建构子 (construct) 需要被一个程序的某个部分参照时。</p>
<h2>Scope</h2>
<p>Scope 在一个程序中或是一个程序中特定的范围里，参照可能发生的地方。</p>
<h2>Extent</h2>
<p>Extent 参照可能发生的时间区间。</p>
<p>一个简单的例子：</p>
<figure class="highlight lang-cl"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="list">(<span class="title">defun</span><span class="body"> copy-cell <span class="list">(<span class="title">x</span><span class="body">)</span></span>
  <span class="list">(<span class="title">cons</span><span class="body"> <span class="list">(<span class="title">car</span><span class="body"> x)</span></span> <span class="list">(<span class="title">cdr</span><span class="body"> x)</span></span>)</span></span>)</span></span>
</pre></td></tr></table></figure>

<p>在这个例子里，我们只能在 <code>copy-cell</code> 函数主体中来参照到 <code>x</code> 参数，这个就是参数 <code>x</code> 的 scope。而参数 <code>x</code> 的 extent 是当函数 <code>copy-cell</code> 被调用至离开的这段时间区间。但是参数的 extent 是有可能在离开函数后仍存在的，但上面这个简单的例子是不可能发生的。</p>
<p>数种描述 Common Lisp 特别有用的 scope 与 extent:</p>
<ul>
<li>Lexical scope 由某个特殊建构子所建立的程序區塊（通常是一個主體 body）。可以想想 Common Lisp 的 let、defun 所設立的參數。</li>
</ul>
<p>例子 1:</p>
<figure class="highlight lang-cl"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="list">(<span class="title">let</span><span class="body"> <span class="list">(<span class="body"><span class="list">(<span class="title">x</span><span class="body"> <span class="number">1</span>)</span></span>
      <span class="list">(<span class="title">y</span><span class="body"> <span class="number">2</span>)</span></span>)</span></span>
  <span class="list">(<span class="title">+</span><span class="body"> x y)</span></span>)</span></span>
</pre></td></tr></table></figure>

<p>x 与 y 的 scope 就是由 let 建构子所建构的主体。</p>
<p>例子 2:</p>
<figure class="highlight lang-cl"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="list">(<span class="title">defun</span><span class="body"> foo <span class="list">(<span class="title">x</span><span class="body">)</span></span>
true<span class="list">(<span class="title">+</span><span class="body"> x <span class="number">1</span>)</span></span>)</span></span>
</pre></td></tr></table></figure>

<p><code>x</code> 的 scope 在 defun 建构子所建构的主体。</p>
<ul>
<li><p>Indefinite scope. 在程序任何地方都可以參照的叫做 Indefinite scope。</p>
</li>
<li><p>Dynamic extent 参照可以发生在配置 (established) 与释放 (disestablished) entity 时发生。 Entity 通常可以想成是对象 (如 cons 核、符號）、变量绑定或是 go 可以到的地方。什么时候释放呢？在配置的 entity 执行完毕或是终止时。因此有 dynamic extent 的 entity 遵循著一种类似栈的规范，同时有著平行执行嵌套的建构。</p>
</li>
</ul>
<p>例子：<code>with-open-file</code> 建构子开启了一个与文件 (file) 的连接并构造了一个流对象来表示这个连接。流对象有著 <code>indefinite extent</code> ，但开启文件的连接有著 dynamic extent: 当 <code>with-open-file</code> 建构子交出控制权时，流会自动关闭。</p>
<p>例子 2: 一个“特殊”变量的绑定是 dynamic extent。</p>
<ul>
<li>Indefinite extent Entity 在离开建构子所设立的区块时，仍有参照的可能性存在。</li>
</ul>
<p>例子：大多数的 Common Lisp 数据对象 (data objecs) 是 indefinite extent 的。
例子：绑定一个函数 lexcially scoped 的参数是 indefinite extent 的。</p>
<p>考虑以下函数定义：</p>
<figure class="highlight lang-cl"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="list">(<span class="title">defun</span><span class="body"> compose <span class="list">(<span class="title">f</span><span class="body"> g)</span></span>
  #<span class="quoted">'(lambda (x)
      (funcall f (funcall g x)))</span>)</span></span>
</pre></td></tr></table></figure>

<p>当给定两个参数时，返回一个函数作为返回值。参数 <code>f</code> 与 <code>g</code> 的绑定由于返回的函数存在，所以并没有消失。当我们调用这个返回的函数时，我们仍可以参照到 <code>f</code> 与 <code>g</code> 。因此</p>
<figure class="highlight lang-cl"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre><span class="list">(<span class="title">funcall</span><span class="body"> <span class="list">(<span class="title">compose</span><span class="body"> #'sqrt #'abs)</span></span> <span class="number">-9.0</span>)</span></span>
</pre></td></tr></table></figure>

<p>会返回 <code>3.0</code> 。</p>
<p>除了上面这些术语之外，通常我们把 dynamic scope 定义成表示 indefinite scope 与 dynamic extent。所以我们说特殊的变数有著 dynamic scope，或是被 dynamically scoped 了，因为它们有 indefinite scope 与 dynamic extent: 一个特别变数可以在任何地方被参照，只要它的绑定 (binding) 仍有效。</p>
<h2>Shadowing</h2>
<p>以上的定义没有考虑到 Shadowing，当我们定义两个同样名称的 entities 时，第二个会遮蔽了第一个，在这个情况下，我们就无法参照到第一个了。</p>
<p>在 lexcial scope 的情况，如果两个建构子设置了同名的 entities 时，会做嵌套的动作。内部的会遮蔽外部的。举个例子：</p>
<figure class="highlight lang-cl"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre><span class="list">(<span class="title">defun</span><span class="body"> foo <span class="list">(<span class="title">x</span><span class="body"> z)</span></span>
  <span class="list">(<span class="title">let</span><span class="body"> <span class="list">(<span class="body"><span class="list">(<span class="title">z</span><span class="body"> <span class="list">(<span class="title">*</span><span class="body"> x <span class="number">2</span>)</span></span>)</span></span>)</span></span>
    <span class="list">(<span class="title">print</span><span class="body"> z)</span></span>)</span></span>
  z)</span></span>
</pre></td></tr></table></figure>

<p>内部的 <code>z</code> 会是 <code>(* x 2)</code>，而外部的 z 会是传入的参数 <code>z</code> 。</p>
<p>在 dynamic extent 的情况，如果两个 entities 的发生时间区间重叠时，一个会被嵌套在另一个里面。</p>
<p>一个有著 dynamic extent 的 entity 透过名字来参照时，总是参照到最近一次尚未被释放的 (disestablished) entity。比如：</p>
<figure class="highlight lang-cl"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre><span class="list">(<span class="title">defun</span><span class="body"> fun<span class="number">1</span> <span class="list">(<span class="title">x</span><span class="body">)</span></span>
  <span class="list">(<span class="title">catch</span><span class="body"> 'trap <span class="list">(<span class="title">+</span><span class="body"> <span class="number">3</span> <span class="list">(<span class="title">fun2</span><span class="body"> x)</span></span>)</span></span>)</span></span>)</span></span>

<span class="list">(<span class="title">defun</span><span class="body"> fun<span class="number">2</span> <span class="list">(<span class="title">y</span><span class="body">)</span></span>
  <span class="list">(<span class="title">catch</span><span class="body"> 'trap <span class="list">(<span class="title">*</span><span class="body"> <span class="number">5</span> <span class="list">(<span class="title">fun3</span><span class="body"> y)</span></span>)</span></span>)</span></span>)</span></span>

<span class="list">(<span class="title">defun</span><span class="body"> fun<span class="number">3</span> <span class="list">(<span class="title">z</span><span class="body">)</span></span>
  <span class="list">(<span class="title">throw</span><span class="body"> 'trap z)</span></span>)</span></span>
</pre></td></tr></table></figure>

<p>调用 <code>(fun1 7)</code> 的结果会是 <code>10</code>。在 <code>throw</code> 执行时，同时有两个 <code>catch</code> 在监看 <code>trap</code> : 一个由 <code>fun1</code> 配置的，另一个是 <code>fun2</code> 。第二个 <code>fun2</code> 是最新的那个，所以 <code>7</code> 会在 <code>fun2</code> 里返回。从 <code>fun3</code> 内部来看， <code>fun2</code> 遮蔽了 <code>fun1</code> 。</p>
<p>若是 <code>fun2</code> 是这样定义的话：</p>
<figure class="highlight lang-cl"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="list">(<span class="title">defun</span><span class="body"> fun<span class="number">2</span> <span class="list">(<span class="title">y</span><span class="body">)</span></span>
  <span class="list">(<span class="title">catch</span><span class="body"> 'snare <span class="list">(<span class="title">*</span><span class="body"> <span class="number">5</span> <span class="list">(<span class="title">fun3</span><span class="body"> y)</span></span>)</span></span>)</span></span>)</span></span>
</pre></td></tr></table></figure>

<p>那么两个 <code>catch</code> 会有不同的名称，因此 <code>fun1</code> 不会被遮蔽。<code>(fun1 7)</code> 结果会是 <code>7</code>。</p>

      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2012/06/05/scope-and-extent-in-cl/#more" class="more-link">閱讀全文</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon depth"></div>
        <time class="depth" datetime="2012-05-18T18:40:00.000Z"><a href="/2012/05/19/jquery-events-2/">May 19 2012</a></time>
      
      
  
    <h1 class="title depth"><a href="/2012/05/19/jquery-events-2/">jQuery 事件简介（下）</a></h1>
  

    </header>
    <div class="entry depth">
      
        <p>注意，若是看不到下方的图片请留言，我再换到 GFW 友好的 HOST 服务上。</p>
<p>其实下面也就一张图。。。</p>
<p>OK，现在你有了基本的事件知识，现在我们看看如何实现一个简单的 FAQ，</p>
<p>型別</p>
<p>给定一个 HTML:</p>
<figure class="highlight lang-html"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="code"><pre>&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
true&lt;meta charset=utf-8&gt;
true&lt;title&gt;jQuery 事件（下）&lt;/title&gt;
true&lt;link rel="stylesheet" href="style.css"&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;dl&gt;
true&lt;dt&gt;FAQ 问题一 &lt;/dt&gt;
true&lt;dd&gt; 答案一 &lt;/dd&gt;
true&lt;dt&gt;FAQ 问题二 &lt;/dt&gt;
true&lt;dd&gt; 答案二 &lt;/dd&gt;
true&lt;dt&gt;FAQ 问题三 &lt;/dt&gt;
true&lt;dd&gt; 答案三 &lt;/dd&gt;
true&lt;dt&gt;FAQ 问题四 &lt;/dt&gt;
true&lt;dd&gt; 答案四 &lt;/dd&gt;
true&lt;dt&gt;FAQ 问题五 &lt;/dt&gt;
true&lt;dd&gt; 答案五 &lt;/dd&gt;
&lt;/dl&gt;

&lt;script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"&gt;&lt;/script&gt;
&lt;script&gt;

&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre></td></tr></table></figure>

<p>以及一些简单的 CSS 样式 <strong>style.css</strong> :</p>
<figure class="highlight lang-css"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="code"><pre><span class="tag">body</span> <span class="rules">{
    <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">960</span>px;</span></span>
    <span class="rule"><span class="attribute">margin</span>:<span class="value"> auto;</span></span>
    <span class="rule"><span class="attribute">text-align</span>:<span class="value"> center;</span></span>
<span class="rule">}</span></span>

<span class="tag">dd</span> <span class="rules">{
    <span class="rule"><span class="attribute">margin</span>:<span class="value"> <span class="number">0</span>;</span></span>
    <span class="rule"><span class="attribute">padding</span>:<span class="value"> <span class="number">1</span>em <span class="number">0</span>;</span></span>
<span class="rule">}</span></span>

<span class="tag">dt</span> <span class="rules">{
    <span class="rule"><span class="attribute">cursor</span>:<span class="value"> pointer;</span></span>
    <span class="rule"><span class="attribute">font-weight</span>:<span class="value"> bold;</span></span>
    <span class="rule"><span class="attribute">font-size </span>:<span class="value"> <span class="number">1.5</span>em;</span></span>
    <span class="rule"><span class="attribute">line-height</span>:<span class="value"> <span class="number">2</span>em;</span></span>
    <span class="rule"><span class="attribute">background</span>:<span class="value"> <span class="hexcolor">#b94846</span>;</span></span>
    <span class="rule"><span class="attribute">border-bottom</span>:<span class="value"> <span class="number">2</span>px solid <span class="hexcolor">#6f2b2a</span>;</span></span>
    <span class="rule"><span class="attribute">border-top</span>:<span class="value"> <span class="number">2</span>px solid white;</span></span>
<span class="rule">}</span></span>

<span class="tag">dt</span><span class="pseudo">:first-child</span> <span class="rules">{ <span class="rule"><span class="attribute">border-top</span>:<span class="value"> none;</span></span> <span class="rule">}</span></span>
<span class="tag">dt</span><span class="pseudo">:nth-last-child(2)</span> <span class="rules">{ <span class="rule"><span class="attribute">border-bottom</span>:<span class="value"> none;</span></span> <span class="rule">}</span></span>

<span class="class">.hide</span> <span class="rules">{ <span class="rule"><span class="attribute">display</span>:<span class="value"> none;</span></span><span class="rule">}</span></span>
</pre></td></tr></table></figure>

<p>注意 <code>dt</code> 下方我们用了一个较深的红色 border，上方用白色 border，来与别的区块做区别。</p>
<figure class="highlight lang-css"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="tag">dt</span><span class="pseudo">:first-child</span> <span class="rules">{ <span class="rule"><span class="attribute">border-top</span>:<span class="value"> none;</span></span> <span class="rule">}</span></span>
<span class="tag">dt</span><span class="pseudo">:nth-last-child(2)</span> <span class="rules">{ <span class="rule"><span class="attribute">border-bottom</span>:<span class="value"> none;</span></span> <span class="rule">}</span></span>
</pre></td></tr></table></figure>

<p>第一行是，最上方的 FAQ 有多馀的白色 border，因为没有上方元素，不需要加上白色来区别。</p>
<p>第二行是，最下方的 FAQ 有多馀的红色 border，因为是最后的元素，不需要加上红色来区别。</p>
<p>我用 <code>2px</code> 让它看起来更明显，实际上你可以使用 <code>1px</code>，或是你喜欢的大小。</p>
<p>你可能会使用 <code>dt:last-child</code> ，这是不对的，请参考我的这篇文章：<a href="http://blog.lisp.tw/blog/2012/05/12/nth-child-common-gotcha/">CSS 一个常见 Nth-child 的误区</a></p>
<img src="https://img.skitch.com/20120518-jgbpd1k1i2cjwt5eq7g31cf5gd.png">

<p>当我们鼠标悬停至 FAQ 标题时 (<code>dt</code>)，就显示相对应的答案 (<code>dd</code>)。</p>
<p><em>下面讲述的代码请放至 <code>&lt;/body&gt;</code> 上方的 script 标签内。</em></p>
<h2>hide() show() fadeIn() slideDown() toggle()</h2>
<p>好，现在让我们看看如何做到隐藏的效果:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
truevar $dd = $(<span class="string">'dd'</span>);

<span class="literal">true</span>$dd.hide();
<span class="literal">true</span><span class="comment">// $dd.toggle();</span>
<span class="literal">true</span><span class="comment">// $dd.show();</span>
<span class="literal">true</span><span class="comment">// $dd.fadeIn();</span>
<span class="literal">true</span><span class="comment">// $dd.slideDown();</span>
})();
</pre></td></tr></table></figure>

<p>你可以试试看我放在注解里的代码，看看是什么效果。</p>
<blockquote>
<p>toggle() 可视变不可视、不可视变可视。</p>
</blockquote>
<p>当我们使用 <code>dd.hide()</code> 的时候，实际上 jQuery 是把 <code>dd</code> 加上 <code>style=&quot;display: none;&quot;</code></p>
<p>第二种方法是先写一个 CSS 类别 <code>.hide { display: none; }</code>，把选中的元素添加类上去：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$dd.addClass(<span class="string">'hide'</span>);
</pre></td></tr></table></figure>

<h2>filter()</h2>
<p>OK。现在我们知道如何先把答案藏起来，不过通常用户来到我们页面时，我们通常会想显示第一个问题及第一个答案：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
truevar $dd = $(<span class="string">'dd'</span>);
<span class="literal">true</span>$dd.(<span class="string">':nth-child(n+4)'</span>).addClass(<span class="string">'hide'</span>);
})();
</pre></td></tr></table></figure>

<p>filter() 函数根据你传入的选择器，返回匹配的元素。</p>
<p>这个博大精深的 <code>:nth-child(n+4)</code> 是啥？看起来好可怕！DONT PANIC! 这是 CSS3 选择器，这其实是说，我要选中由第 4 个开始的所有元素，也就是</p>
<figure class="highlight lang-html"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre>&lt;dl&gt;
true&lt;dt&gt;FAQ 问题一 &lt;/dt&gt;
true&lt;dd&gt; 答案一 &lt;/dd&gt;
true&lt;dt&gt;FAQ 问题二 &lt;/dt&gt;
true&lt;dd&gt; 答案二 &lt;/dd&gt;
true&lt;dt&gt;FAQ 问题三 &lt;/dt&gt;
true&lt;dd&gt; 答案三 &lt;/dd&gt;
true&lt;dt&gt;FAQ 问题四 &lt;/dt&gt;
true&lt;dd&gt; 答案四 &lt;/dd&gt;
true&lt;dt&gt;FAQ 问题五 &lt;/dt&gt;
true&lt;dd&gt; 答案五 &lt;/dd&gt;
&lt;/dl&gt;
</pre></td></tr></table></figure>

<p>1, 2, 3, 4，选中 <code>&lt;dd&gt; 答案二 &lt;/dd&gt;</code> 以及之后所有的元素。你可以试试看 console.log 一下，看看 <code>dd.(&#39;:nth-child(n+4)&#39;)</code> 选中的是什么，你就理解了。</p>
<p>OK. 讲解到这里，差不多 HTML CSS 都讲明白了，接下来看看怎么绑定事件上元素，来实现我们想要的功能。</p>
<h2>mouseenter() siblings()</h2>
<p>先讲简单的方法：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
truevar $dd = $(<span class="string">'dd'</span>);
<span class="literal">true</span>$dd.(<span class="string">':nth-child(n+4)'</span>).addClass(<span class="string">'hide'</span>);

<span class="literal">true</span>$(<span class="string">'dt'</span>).on(<span class="string">'mouseenter'</span>, <span class="keyword">function</span>() {
truetrue$(<span class="keyword">this</span>).next().show();
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>我们给 <code>dt</code> 绑定一个 mouseenter 事件，在鼠标进入 <code>dt</code> 时，我们知道 <code>dd</code> 是 <code>dt</code> 的下一个，我们显示它：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="keyword">this</span>).next().show();
</pre></td></tr></table></figure>

<p>但是显示完我们还得隐藏它：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
truevar $dd = $(<span class="string">'dd'</span>);
<span class="literal">true</span>$dd.(<span class="string">':nth-child(n+4)'</span>).addClass(<span class="string">'hide'</span>);

<span class="literal">true</span>$(<span class="string">'dt'</span>).on(<span class="string">'mouseenter'</span>, <span class="keyword">function</span>() {
truetrue$(<span class="keyword">this</span>).next().siblings(<span class="string">'dd'</span>).hide();
truetrue$(<span class="keyword">this</span>).next().show();
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>我们鼠标移到某个特定 <code>dt</code> 时，把所有 <code>dd</code> 的 <code>siblings(&#39;dd&#39;)</code> 都隐藏起来就可以了。</p>
<p>注意到我故意使用重复的代码，让我们重构它：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
truevar $dd = $(<span class="string">'dd'</span>);
<span class="literal">true</span>$dd.(<span class="string">':nth-child(n+4)'</span>).addClass(<span class="string">'hide'</span>);

<span class="literal">true</span>$(<span class="string">'dt'</span>).on(<span class="string">'mouseenter'</span>, <span class="keyword">function</span>() {
truetrue$(<span class="keyword">this</span>)
truetruetrue.next()
truetruetruetrue.show()
truetruetruetrue.siblings(<span class="string">'dd'</span>)
truetruetruetruetrue.hide();
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>看你是要排成一行，还是像我这样有缩排，喜好问题。</p>
<p>OK. 成功拉，现在让我们加上 animation，与其隐藏，我们可以使用 <code>slideUp() slideDown()</code>：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
truevar $dd = $(<span class="string">'dd'</span>);
<span class="literal">true</span>$dd.(<span class="string">':nth-child(n+4)'</span>).addClass(<span class="string">'hide'</span>);

<span class="literal">true</span>$(<span class="string">'dt'</span>).on(<span class="string">'mouseenter'</span>, <span class="keyword">function</span>() {
truetrue$(<span class="keyword">this</span>)
truetruetrue.next()
truetruetruetrue.slideDown(<span class="number">300</span>)
truetruetruetrue.siblings(<span class="string">'dd'</span>)
truetruetruetruetrue.slideUp(<span class="number">300</span>);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p><code>slideDown()</code>, <code>slideUp()</code> 这种函数你可以传入参数，指定毫秒数，通常 200-400 ms，看起来挺舒服的。</p>
<p>OK. 现在功能出来了，看看有没有什么可以改善的，永远记得，在 <strong>功能完整后再改进</strong> 。</p>
<p>现在我们的代码实际上只用到了一次 <code>$(&#39;dd&#39;)</code>，所以不需要将它存到变量里，节省空间：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){

<span class="literal">true</span>$(<span class="string">'dd'</span>).(<span class="string">':nth-child(n+4)'</span>).addClass(<span class="string">'hide'</span>);

<span class="literal">true</span>$(<span class="string">'dt'</span>).on(<span class="string">'mouseenter'</span>, <span class="keyword">function</span>() {
truetrue$(<span class="keyword">this</span>)
truetruetrue.next()
truetruetruetrue.slideDown(<span class="number">300</span>)
truetruetruetrue.siblings(<span class="string">'dd'</span>)
truetruetruetruetrue.slideUp(<span class="number">300</span>);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>现在看看这行代码：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>$(<span class="string">'dt'</span>).on(<span class="string">'mouseenter'</span>, <span class="keyword">function</span>() {
<span class="literal">true</span>...
}
</pre></td></tr></table></figure>

<p>这行代码不太好，要是咱页面有一百个 <code>dt</code>，那效能不好，最好是你给 <code>dl</code> 上一个 <code>id=&quot;FAQ&quot;</code>，将选择器改为 <code>dl#FAQ</code>，这样子每次我们只会选中 FAQ，而不会去选到其他的，在这里我们演示的关系，选中 <code>$(&#39;dl&#39;)</code> 就好了。</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){

<span class="literal">true</span>$(<span class="string">'dd'</span>).(<span class="string">':nth-child(n+4)'</span>).addClass(<span class="string">'hide'</span>);

<span class="literal">true</span>$(<span class="string">'dl'</span>).on(<span class="string">'mouseenter'</span>, <span class="string">'dt'</span>, <span class="keyword">function</span>() {
truetrue$(<span class="keyword">this</span>)
truetruetrue.next()
truetruetruetrue.slideDown(<span class="number">300</span>)
truetruetruetrue.siblings(<span class="string">'dd'</span>)
truetruetruetruetrue.slideUp(<span class="number">300</span>);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>注意我在 <code>on</code> 函数里又多传了一个参数，<code>&#39;dt&#39;</code> ，这叫做 选择器字串 (slector string)。</p>
<p>现在这整行代码的意思是，当用户鼠标进入 <code>dl</code> 时，选中 <code>dl</code> 的 <code>dt</code>：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'dl'</span>).on(<span class="string">'mouseenter'</span>, <span class="string">'dt'</span>, <span class="keyword">function</span>()
</pre></td></tr></table></figure>

<p>仅仅重构了这一下，我们省去了给所有 <code>dt</code> 加上 event listener，只给特定的 <code>dt</code> 加上 event listener，尽量养成这样子的习惯，首先写一个能动的 jQuery，想想该怎么重构，并重构它。</p>
<p>打完收工。</p>

      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2012/05/19/jquery-events-2/#more" class="more-link">閱讀全文</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon depth"></div>
        <time class="depth" datetime="2012-05-18T14:11:00.000Z"><a href="/2012/05/18/jquery-events-1/">May 18 2012</a></time>
      
      
  
    <h1 class="title depth"><a href="/2012/05/18/jquery-events-1/">jQuery 事件简介（上）</a></h1>
  

    </header>
    <div class="entry depth">
      
        <p>什么是事件？</p>
<p>比如一个链接被按下、鼠标悬停在某元素上面，这都是事件。</p>
<p>假设今天我们想要实现，按下某个按钮套用不同的 CSS。</p>
<p>给定一个 HTML:</p>
<p>型別</p>
<figure class="highlight lang-html"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="code"><pre>&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
true&lt;meta charset=utf-8&gt;
true&lt;title&gt;jQuery 事件（上）&lt;/title&gt;
true&lt;link rel="stylesheet" href="day.css"&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;h1&gt; 我的网站 &lt;/h1&gt;

&lt;button&gt;Day&lt;/button&gt;
&lt;button&gt;Night&lt;/button&gt;

&lt;script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"&gt;&lt;/script&gt;
&lt;script&gt;

&lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;
</pre></td></tr></table></figure>

<p>以及两个 CSS, day.css, night.css:</p>
<h4>night.css</h4>
<figure class="highlight lang-css"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre><span class="tag">body</span> <span class="rules">{
<span class="rule"><span class="attribute">truebackground</span>:<span class="value"> black;</span></span>
<span class="rule"><span class="attribute">truecolor</span>:<span class="value"> white;</span></span>
<span class="rule">}</span></span>
</pre></td></tr></table></figure>

<h4>night.css</h4>
<figure class="highlight lang-css"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="tag">body</span> <span class="rules">{
<span class="rule"><span class="attribute">truebackground</span>:<span class="value"> yellow;</span></span>
<span class="rule">}</span></span>
</pre></td></tr></table></figure>

<p>下面讲述的代码请加至 <code>&lt;/body&gt;</code> 上方的 script 标签内。</p>
<p>当按下 Day 按钮的时候要套用 day.css、按下 Night 按钮的时候要套用 night.css。</p>
<p>OK. 我们要怎么达到我们想做的功能呢？第一是我们要有一个监听按钮状态的方法，给按钮加上 event listener。</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){

})();
</pre></td></tr></table></figure>

<p>首先这个奇怪的:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){

})();
</pre></td></tr></table></figure>

<p>是什么？这是一个 <strong>自调用函数</strong> (self invoke function)。</p>
<p>可以想成是这样子:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre><span class="function"><span class="keyword">function</span> <span class="title">myFunc</span><span class="params">()</span>{</span>

}

myFunc();
</pre></td></tr></table></figure>

<p>这里宣告了 <code>myFunc()</code> ，在碰到这一行： <code>myFunc();</code> 的时候才会调用。</p>
<p>所以：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){

})();
</pre></td></tr></table></figure>

<p>一但载入这个 script 时，就会调用。</p>
<p>OK. 让我们继续往下看，那要怎么加入 event listener 呢？</p>
<h2>click() 函数</h2>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
<span class="literal">true</span>$(<span class="string">'button'</span>).click(<span class="keyword">function</span>() {
truetrueconsole.log(<span class="string">'button was clicked!'</span>);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>这跟 jQuery 说，哈罗，去 DOM 里帮我把 button 的元素都找出来，并在按下时在 cosole 记录信息：<code>&#39;button was clicked!&#39;</code></p>
<p>你可以去浏览器试试看是否成功。</p>
<p>现在我们知道如何加入一个 click 事件，现在让我们看看如何在按下按钮时，换一个 CSS 样式表。</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
<span class="literal">true</span>$(<span class="string">'button'</span>).click(<span class="keyword">function</span>() {
truetrueconsole.log(<span class="string">'button was clicked!'</span>);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<h2>this?</h2>
<p>现在让我们简单的看一下 this。</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
<span class="literal">true</span>$(<span class="string">'button'</span>).click(<span class="keyword">function</span>() {
truetrueconsole.log(<span class="keyword">this</span>);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>这里的 <code>this</code> 会参照到现在被按的这个按钮。但是要注意的是，这个 <code>this</code> 所返回的 <strong>不是</strong> 一个 jQuery 对象，仅是一个 DOM 对象，所以无法继续使用 jQuery 所提供的函数。</p>
<p>那如果我想要使用 <em>this</em> 来得到参照的对象，又想继续使用 jQuery 提供的函数呢？我们可以用 <code>$()</code> 把返回的 DOM 对象包起来：</p>
<p><code>$(this)</code> 呵呵，这样大概理解了吧？</p>
<p>有的时候，我们可能常常要用到 <code>$(this)</code> ，用到两次以上的东西，都用个变量存起来，来避免 jQuery 一直跑到 DOM 查询，假设我们一个页面有三十个按钮，一直重复的去查询 DOM 会大幅降低效能。</p>
<p>比如说上面我们改变了被参照的对象的 text()，之后又替它加上一个类，之后可能又移除那个类：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
<span class="literal">true</span>$(<span class="string">'button'</span>).click(<span class="keyword">function</span>() {
truetrue$(<span class="keyword">this</span>).text(...);

truetrue<span class="comment">// some code goes here...</span>
truetrue$(<span class="keyword">this</span>).addClass(...);

truetrue<span class="comment">// ...other codes</span>
truetrue$(<span class="keyword">this</span>).removeClass(...);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>可以这样子重构代码：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
<span class="literal">true</span>$(<span class="string">'button'</span>).click(<span class="keyword">function</span>() {
truetrue$<span class="keyword">this</span> = $(<span class="keyword">this</span>);
truetrue$<span class="keyword">this</span>.text(...);

truetrue<span class="comment">// some code goes here...</span>
truetrue$<span class="keyword">this</span>.addClass(...);

truetrue<span class="comment">// ...other codes</span>
truetrue$<span class="keyword">this</span>.removeClass(...);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p><code>$this</code> 前面的 <strong>$</strong> 号可以表明这是一个 jQuery 对象，this 可以代表是现在所参照的对象。</p>
<p>这 <code>$this</code> 称为是现在参照的对象 <code>this</code> 的缓存版本 (cached version)。</p>
<h2>attr()</h2>
<p>现在回到我们刚刚的问题，如何按下按钮时，改变 CSS 样式表：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
<span class="literal">true</span>$(<span class="string">'button'</span>).click(<span class="keyword">function</span>() {
truetrue$(<span class="string">'link'</span>).attr(<span class="string">'href'</span>, <span class="string">'night.css'</span>);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>这个 <code>attr()</code> 当传入一个参数时，返回这个参数名字的属性:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre><span class="keyword">var</span> href = $(<span class="string">'link'</span>).attr(<span class="string">'href'</span>);
</pre></td></tr></table></figure>

<p>我们就可以取得一个 link 的 href 属性。</p>
<p>传入两个参数时，是替第一个参数为名的属性设值:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'link'</span>).attr(<span class="string">'href'</span>, <span class="string">'night.css'</span>);
</pre></td></tr></table></figure>

<p>OK. 现在到浏览器试试看，你会发现无论按下哪个按钮时，样式表都会换成 night.css。</p>
<p>这样不行，我们要有一个办法来指定按下 day 按钮时，换成 day.css。</p>
<p>让我们试试看：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
<span class="literal">true</span>$(<span class="string">'button'</span>).click(<span class="keyword">function</span>() {
truetruevar stylesheet = $(<span class="keyword">this</span>).text().toLowerCase();
truetrue$(<span class="string">'link'</span>).attr(<span class="string">'href'</span>, stylesheet + <span class="string">'.css'</span>);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>这样子在按下按钮时，我们得到按下按钮的 text，并转成小写，并替换 link 的 href。</p>
<p>这样是可以工作的，但是会被按钮的 text 限制了 css 文件的名字，以及有很大的不弹性，让我们看看怎么样做的更好：</p>
<p>改动 HTML：</p>
<figure class="highlight lang-html"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre>&lt;button data-file="day"&gt;Day&lt;/button&gt;
&lt;button data-file="night"&gt;Night&lt;/button&gt;
</pre></td></tr></table></figure>

<p>加上 <code>data-file</code> 属性。</p>
<p>也可以自定义属性，只要前缀是 <code>data-</code> 即可，比如 <code>data-yourCustomAttr</code>。</p>
<p>要取得这个 <code>data-file</code>，我们可以用刚刚学过的 <code>attr()</code>，仅传入一个参数：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
<span class="literal">true</span>$(<span class="string">'button'</span>).click(<span class="keyword">function</span>() {
truetruevar stylesheet = $(<span class="keyword">this</span>).attr(<span class="string">'data-file'</span>);
truetrue$(<span class="string">'link'</span>).attr(<span class="string">'href'</span>, stylesheet + <span class="string">'.css'</span>);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>但是 jQuery 有一个更好的方法：<code>data()</code>：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="keyword">this</span>).data(<span class="string">'file'</span>);
</pre></td></tr></table></figure>

<p>这里因为用的是，<code>data()</code> 方法，所以不需要使用多馀的 <code>data-</code> 前缀。</p>
<p>看看这行：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'link'</span>).attr(<span class="string">'href'</span>, stylesheet + <span class="string">'.css'</span>);
</pre></td></tr></table></figure>

<p>每次我们按下按钮时，jQuery 都会跑到 DOM 里面去寻找符合选择器条件的元素，这样非常的没有效率，所以我们可以缓存起来：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
truevar $link = $(<span class="string">'link'</span>);
<span class="literal">true</span>$(<span class="string">'button'</span>).click(<span class="keyword">function</span>() {
truetruevar stylesheet = $(<span class="keyword">this</span>).attr(<span class="string">'data-file'</span>);
truetrue$link.attr(<span class="string">'href'</span>, stylesheet + <span class="string">'.css'</span>);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>现在另一个问题来了，当前是 day.css，按下 night 按钮时，会换成 night.css，换成 night.css 再按下 night 按钮时，还是会调用这个自调用函数，并换成 night.css，这样子还是浪费资源，我们可以：</p>
<ul>
<li><p>停用当前 CSS 的按钮（day.css 就停用 day 按钮、night.css 就停用 night 按钮）</p>
</li>
<li><p>写一个判断式侦测按下按钮是否为现下的 CSS，是的话就不做任何事，不是的话替换成另一个 CSS。</p>
</li>
</ul>
<p>我们试试看第一个方法：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
truevar $link = $(<span class="string">'link'</span>);
<span class="literal">true</span>$(<span class="string">'button'</span>).click(<span class="keyword">function</span>() {
truetruevar $<span class="keyword">this</span> = $(<span class="keyword">this</span>);
truetruevar stylesheet = $<span class="keyword">this</span>.attr(<span class="string">'data-file'</span>);
truetrue$link.attr(<span class="string">'href'</span>, stylesheet + <span class="string">'.css'</span>);
truetrue$<span class="keyword">this</span>.attr(<span class="string">'disabled'</span>, <span class="string">'disabled'</span>);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>这边我们缓存了用到两次的 <code>$(this)</code> : <code>$this</code>。</p>
<p>记得 <code>attr()</code> 一个参数是返回属性、两个是设值：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>$<span class="keyword">this</span>.attr(<span class="string">'disabled'</span>, <span class="string">'disabled'</span>);
<span class="comment">// 等同于</span>
$<span class="keyword">this</span>.attr(<span class="string">'disabled'</span>, <span class="string">''</span>);
</pre></td></tr></table></figure>

<p>传入第二个参数是为了设值的目的。</p>
<p>你到浏览器试试看会发现一旦 disabled 以后，按钮就死了，回不去了。</p>
<h2>siblings()</h2>
<p><code>siblings()</code> 可以取得目前参照对象的 siblings (同层元素)，可以选择性的传入选择器来筛选匹配的元素。</p>
<blockquote>
<p>Get the siblings of each element in the set of matched elements, optionally filtered by a selector.</p>
</blockquote>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
truevar $link = $(<span class="string">'link'</span>);
<span class="literal">true</span>$(<span class="string">'button'</span>).click(<span class="keyword">function</span>() {
truetruevar $<span class="keyword">this</span> = $(<span class="keyword">this</span>);
truetruevar stylesheet = $<span class="keyword">this</span>.attr(<span class="string">'data-file'</span>);

truetrue$<span class="keyword">this</span>.siblings(<span class="string">'button'</span>).removeAttr(<span class="string">'disabled'</span>);

truetrue$link.attr(<span class="string">'href'</span>, stylesheet + <span class="string">'.css'</span>);
truetrue$<span class="keyword">this</span>.attr(<span class="string">'disabled'</span>, <span class="string">'disabled'</span>);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>哎呀，又发现一个可以重构的地方：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="keyword">var</span> $<span class="keyword">this</span> = $(<span class="keyword">this</span>);
<span class="keyword">var</span> stylesheet = $<span class="keyword">this</span>.attr(<span class="string">'data-file'</span>);
</pre></td></tr></table></figure>

<p>尽量使用单一个 var 来宣告变量：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="keyword">var</span> $<span class="keyword">this</span> = $(<span class="keyword">this</span>),
truetruestylesheet = $<span class="keyword">this</span>.attr(<span class="string">'data-file'</span>);
</pre></td></tr></table></figure>

<p>并把相同的代码放在一起、把 <code>$link.attr(...)</code> 移上去，这样下面那行就可以结合：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){
truevar $link = $(<span class="string">'link'</span>);
<span class="literal">true</span>$(<span class="string">'button'</span>).click(<span class="keyword">function</span>() {
truetruevar $<span class="keyword">this</span> = $(<span class="keyword">this</span>),
truetruetruetruestylesheet = $<span class="keyword">this</span>.attr(<span class="string">'data-file'</span>);

truetrue$link.attr(<span class="string">'href'</span>, stylesheet + <span class="string">'.css'</span>);

truetrue$<span class="keyword">this</span>
truetruetruetrue.siblings(<span class="string">'button'</span>).removeAttr(<span class="string">'disabled'</span>)
truetruetruetrue.removeAttr(<span class="string">'disabled'</span>);

truetrue$<span class="keyword">this</span>.attr(<span class="string">'disabled'</span>, <span class="string">'disabled'</span>);
<span class="literal">true</span>});
})();
</pre></td></tr></table></figure>

<p>如果这样是不行的：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre>	$<span class="keyword">this</span>
truetruetrue.siblings(<span class="string">'button'</span>).removeAttr(<span class="string">'disabled'</span>)
truetruetrue.removeAttr(<span class="string">'disabled'</span>)
truetruetrue.attr(<span class="string">'disabled'</span>, <span class="string">'disabled'</span>);
</pre></td></tr></table></figure>

<p>因为这时第三行 <code>.attr(&#39;disabled&#39;, &#39;disabled&#39;);</code> 所参照的是 <code>siblings()</code> 而不是本来按下的按钮。</p>
<h2>end() 函数</h2>
<p>如果想要这样子写的话，可以使用 jQuery 的 <code>end()</code> 函数。</p>
<blockquote>
<p>End the most recent filtering operation in the current chain and return the set of matched elements to its previous state.</p>
</blockquote>
<p>终止最近的过滤操作，并返回到先前匹配的状态：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre>	$<span class="keyword">this</span>
truetruetrue.siblings(<span class="string">'button'</span>).removeAttr(<span class="string">'disabled'</span>)
truetruetruetrue.removeAttr(<span class="string">'disabled'</span>)
truetruetruetrue.end()
truetruetrue.attr(<span class="string">'disabled'</span>, <span class="string">'disabled'</span>);
</pre></td></tr></table></figure>

<p>再提一下，这个 <code>click()</code> 函数也可以换成 <code>on()</code> ：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre>$(<span class="string">'button'</span>).click(<span class="keyword">function</span>() { ... }) <span class="comment">// 等同于</span>
$(<span class="string">'button'</span>).on(<span class="string">'click'</span>, <span class="keyword">function</span>() { ... })
</pre></td></tr></table></figure>

<p>我会建议你使用 jQuery 的 <code>on()</code> 函数，这个理由下集再谈吧。</p>
<p>有问题、讲错的欢迎下面留言发问。</p>

      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2012/05/18/jquery-events-1/#more" class="more-link">閱讀全文</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon depth"></div>
        <time class="depth" datetime="2012-05-17T17:04:00.000Z"><a href="/2012/05/18/jquery-query-dom/">May 18 2012</a></time>
      
      
  
    <h1 class="title depth"><a href="/2012/05/18/jquery-query-dom/">使用 jQuery 查询 DOM</a></h1>
  

    </header>
    <div class="entry depth">
      
        <p>哈罗，你又来看我文章了，谢谢，这篇讲的是巨基本的使用 jQuery 来查询 DOM。</p>
<p>给定一个 HTML：</p>
<figure class="highlight lang-html"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre></td><td class="code"><pre>&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
true&lt;meta charset=utf-8&gt;
true&lt;title&gt;&lt;/title&gt;
true&lt;style&gt;
trueli { color: black }
true&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;div class="container"&gt;
true&lt;h1&gt;Welcome to My Website &lt;/h1&gt;
true&lt;p&gt;
truetrueLorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
truetruetempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
truetruequis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
truetrueconsequat.
true&lt;/p&gt;

true&lt;ul class="emphasis"&gt;
truetrue&lt;li&gt;item 1&lt;/li&gt;
truetrue&lt;li&gt;item 2&lt;/li&gt;
truetrue&lt;li&gt;item 3&lt;/li&gt;
truetrue&lt;li&gt;item 4&lt;/li&gt;
truetrue&lt;li&gt;item 5&lt;/li&gt;
truetrue&lt;li&gt;
truetruetrue&lt;ul&gt;
truetruetruetrue&lt;li&gt;hello from the nest.&lt;/li&gt;
truetruetrue&lt;/ul
truetrue&lt;/li&gt;
true&lt;/ul&gt;
&lt;/div&gt;

&lt;script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.js"&gt;&lt;/script&gt;

&lt;script&gt;

&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre></td></tr></table></figure>
型別

为了讲解方便，我直接使用 CDN 来引用 jQuery。之后讲述的代码请放在 <code>&lt;/body&gt;</code> 前面的 <code>&lt;script&gt;</code> 标签内。

OK! 开始！

## children() find() next() prev() first()

假设今天我们想要选中类是 emphasis 的 <code>ul</code>：

<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'ul.emphasis'</span>);
</pre></td></tr></table></figure>

<p>上面这行：嘿，jQuery，帮我根据这个 CSS 选择器 <code>ul.emphasis</code> 去 DOM 把符合条件的找出来。</p>
<p>取出 <code>ul</code> 的第一个 <code>li</code> ，并添加绿色：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'ul.emphasis'</span>).children(<span class="string">'li'</span>).css(<span class="string">'color'</span>, <span class="string">'green'</span>);
</pre></td></tr></table></figure>

<p>这等同于 CSS:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>ul.emphasis &gt; li { color: green; }
</pre></td></tr></table></figure>

<p><strong>注意</strong> 这个 <code>&gt;</code> 在这边起的作用，这说明了我们只选中第一阶层的小孩，direct children。</p>
<p>试试看这个代码</p>
<p>你会发现嵌套的那个 ul li 是黑色，不是绿色。这样应该明白 direct children 了吧。</p>
<p>你也可以使用 jQuery 的 <code>find</code> 来找到：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'ul.emphasis'</span>).find(<span class="string">'li'</span>).css(<span class="string">'color'</span>, <span class="string">'green'</span>);
</pre></td></tr></table></figure>

<p>但要注意的是，这会从 <code>ul.emphasis</code> 搜寻所有的 li (all descendent)，等同于 CSS 的：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>ul.emphasis li { color: green; }
</pre></td></tr></table></figure>

<p>好，现在我们在 <code>style</code> 标签内添加一个样式：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>.emphasis { color: green; }
</pre></td></tr></table></figure>

<p>并移除刚刚那行代码。</p>
<p>现在我们想替 <code>ul.emphasis</code> 的第一个 <code>li</code> 加上类名的办法来上色，该怎么做呢？</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre>$(<span class="string">'ul.emphasis'</span>).children(<span class="string">'li:nth-child(1)'</span>).addClass(<span class="string">'emphasis'</span>);
<span class="comment">// 或是</span>
$(<span class="string">'ul.emphasis'</span>).find(<span class="string">'li:nth-child(1)'</span>).addClass(<span class="string">'emphasis'</span>);
<span class="comment">// 或是</span>
$(<span class="string">'ul.emphasis'</span>).children(<span class="string">'li:first'</span>).addClass(<span class="string">'emphasis'</span>);
</pre></td></tr></table></figure>

<p>你可能会说，干嘛不用 CSS 就好了，因为使用 jQuery 的话，这些新潮的 CSS3 选择器可以支援 IE6+。</p>
<p>都是万恶的 IE 害的，呜呜。。。</p>
<p>注意这行代码内的选择器：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'ul.emphasis'</span>).children(<span class="string">'li:first'</span>).addClass(<span class="string">'emphasis'</span>);
</pre></td></tr></table></figure>

<p>不是 CSS 的选择器，而是 jQuery 提供的 Helper。如果有自带的 CSS 选择器可用的话，就使用 CSS 选择器，再来才是使用 jQuery 提供的 Helper。因为这比使用 jQuery 提供的来得快一点点。</p>
<p>刚刚那行代码，使用 CSS 有的选择器：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'ul.emphasis'</span>).children(<span class="string">'li:first-child'</span>).addClass(<span class="string">'emphasis'</span>);
</pre></td></tr></table></figure>

<p>好，那 jQuery 还有别的方法可用吗，有：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'ul.emphasis'</span>).children(<span class="string">'li'</span>).first().addClass(<span class="string">'emphasis'</span>);
</pre></td></tr></table></figure>

<p>我们用了一个 jQuery 提供的 <code>first()</code>，作用一样。</p>
<p>那想选中第二个 <code>li</code> (item2) 呢，并把文字改为 Hello from jQuery？</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>$(<span class="string">'ul.emphasis'</span>).children(<span class="string">'li:nth-child(2)'</span>).text(<span class="string">'Hello from jQuery'</span>);
<span class="comment">// 或是</span>
$(<span class="string">'ul.emphasis'</span>).children(<span class="string">'li'</span>).eq(<span class="number">1</span>).text(<span class="string">'Hello from jQuery'</span>);
</pre></td></tr></table></figure>

<p>注意到，<code>eq(1)</code>，因为 Javascript 跟大多数程序语言一样是 <strong>零索引的</strong> ，从零开始数。</p>
<p>好如果我想要先选中 item2，再往后一个，该怎么写呢：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'ul.emphasis'</span>).children(<span class="string">'li'</span>).eq(<span class="number">1</span>).next().text(<span class="string">'Hello from jQuery'</span>);
</pre></td></tr></table></figure>

<p>这串长不拉机的东东有个术语叫做 <em>chaining</em> ，它能这么干的原因是每一个调用都返回一个 jQuery 对象。</p>
<p>但是别 chian 的太长了。</p>
<p>有 <code>next()</code> 也有 <code>prev()</code> 。</p>
<p>一个要写出 jQuery 的秘诀是写之前先念一遍，再直观地写出来，大部分都是对的哈哈。</p>
<p>不过这个贼长的 jQuery 你一般都会写成：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>$(<span class="string">'ul.emphasis'</span>).children(<span class="string">'li'</span>).eq(<span class="number">1</span>).next().text(<span class="string">'Hello from jQuery'</span>);
<span class="comment">// better</span>
$(<span class="string">'ul.emphasis li:nth-child(2)'</span>).text(<span class="string">'Hello from jQuery'</span>);
</pre></td></tr></table></figure>

<p>chaining 比较慢，代码也比较长，但你还是会需要动态地使用 chaining。</p>
<p>这么长的代码也可以这样缩排：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre>$(<span class="string">'ul.emphasis'</span>).children(<span class="string">'li'</span>).eq(<span class="number">1</span>).next().text(<span class="string">'Hello from jQuery'</span>);

<span class="comment">// 等同于</span>
$(<span class="string">'ul.emphasis'</span>)
truetrue.children(<span class="string">'li'</span>)
truetruetrue.eq(<span class="number">1</span>)
truetruetrue.next().text(<span class="string">'Hello from jQuery'</span>);
</pre></td></tr></table></figure>

<h2>parent() parents() closest()</h2>
<p>HTML 实际上就是一个语法树，不懂语法树就想成家庭树，有爷爷奶奶老爸老妈儿子女儿孙子孙女。</p>
<p>好，看个例子，今天我们想要移除 <code>li</code> 的父节点的类别</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(li).parent().removeClass(<span class="string">'emphasis'</span>);
</pre></td></tr></table></figure>

<p>也可以显式指定要找的 parent 的类型：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(li).parent(<span class="string">'ul'</span>).removeClass(<span class="string">'emphasis'</span>);
</pre></td></tr></table></figure>

<p>你可以使用浏览器的开发工具查看源代码来检查是否移除成功。</p>
<p>现在让我们加入一个新样式：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>.container { color: green; }
</pre></td></tr></table></figure>

<p>刷新页面，整面绿油油。如果我不想要整片绿油油，我想要移除 parent 的类：container，</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(li).parent(<span class="string">'.container'</span>).removeClass(<span class="string">'emphasis'</span>);
</pre></td></tr></table></figure>

<p>刷新页面，擦，没作用，这是因为这跟 direct children 一样，只会找到上一层的 parent，如果我把 parent 换成：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(li).parents(<span class="string">'.container'</span>).removeClass(<span class="string">'emphasis'</span>);
</pre></td></tr></table></figure>

<p>注意那个 <strong>s</strong> ，这样就会像 <code>find</code> 一样，一直往上找。</p>
<p>你也可以更具体的说，你要移除的是这个 <code>div.container</code> 元素:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(li).parents(<span class="string">'div.container'</span>).removeClass(<span class="string">'emphasis'</span>);
</pre></td></tr></table></figure>

<p>而这行代码等同于：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(li).closest(<span class="string">'div.container'</span>).removeClass(<span class="string">'emphasis'</span>);
</pre></td></tr></table></figure>

<p>让我们到 <a href="http://api.jquery.com/">http://api.jquery.com/</a> 查查这个函数是干嘛使的。</p>
<h2>.closest()</h2>
<blockquote>
<p>Get the first element that matches the selector, beginning at the current element and progressing up through the DOM tree.</p>
</blockquote>
<p>我们这个例子是，从 <code>$(li)</code> 开始往上爬 DOM 树，寻找第一个匹配 <code>(&#39;div.container&#39;)</code> 的元素。</p>
<h2>.removeClass()</h2>
<blockquote>
<p>Remove a single class, multiple classes, or all classes from each element in the set of matched elements.</p>
</blockquote>
<p>移除匹配元素集合中的每一个元素的单一、多个或整个类别。</p>
<h2>parents() 与 closest() 的差异？</h2>
<p>其实是一个微妙的差异，你可以研读一下 API，或是这次我直接跟你说了吧：</p>
<p><code>parents()</code> 会根据选择器条件，往上爬树，找出所有符合的。</p>
<p><code>closest()</code> 只会根据选择器条件，找到最近符合的那一个。</p>
<p>查询 API 与源代码是学习 jQuery 的不二法门。</p>
<p>本篇结束。</p>

      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2012/05/18/jquery-query-dom/#more" class="more-link">閱讀全文</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon depth"></div>
        <time class="depth" datetime="2012-05-17T16:31:00.000Z"><a href="/2012/05/18/jquery-intro-2/">May 18 2012</a></time>
      
      
  
    <h1 class="title depth"><a href="/2012/05/18/jquery-intro-2/">jQuery 1.7 介绍（下）</a></h1>
  

    </header>
    <div class="entry depth">
      
        <p>建议不要看我写的文章，赶快到这里学会时下最火最流行的 jQuery!</p>
<p><a href="http://tutsplus.com/course/30-days-to-learn-jquery/">30 天学会 jQuery</a></p>
<h2>＄号</h2>
<p>我希望你还记得 <code>$</code> 号是什么：</p>
<p>型別</p>
<pre><code>window<span class="preprocessor">.jQuery</span> = window.$ = jQuery<span class="comment">;</span>
</code></pre>
<p>拿来引用 jQuery 函数的快捷方式。</p>
<p>首先讲 jQuery 之前，假定我们有一个 HTML 文件：</p>
<figure class="highlight lang-html"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="code"><pre>&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
true&lt;meta charset=utf-8&gt;
true&lt;title&gt;&lt;/title&gt;
true&lt;style&gt;
true.emphasis { font-weight: bold;}
true&lt;/style&gt;
true&lt;script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.js"&gt;&lt;/script&gt;
true&lt;script&gt;

true&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;ul&gt;
true&lt;li&gt;hello&lt;/li&gt;
true&lt;li&gt;hello 2&lt;/li&gt;
true&lt;li&gt;hello 3&lt;/li&gt;
&lt;/ul&gt;

&lt;/body&gt;
&lt;/html&gt;
</pre></td></tr></table></figure>

<p>下面讲述的代码请填入 <code>&lt;/head&gt;</code> 上方的 script 标签内。</p>
<p>OK. 开始。</p>
<p>假设我们要取得 <code>ul</code> 的第一个 <code>li</code>：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$(<span class="string">'li:first-child'</span>).addClass(<span class="string">'emphasis'</span>);
</pre></td></tr></table></figure>

<p>打开你的浏览器看看，干，怎么不行，这是因为。。。</p>
<p>你的代码放在 head 标签内，下面的 HTML 都还没有载入完毕 (DOM)，就执行了这行代码，执行代码的时候，这会儿根本还没有看到 ul li 呢。</p>
<p>你可以把 <code>&lt;script&gt; ... &lt;/script&gt;</code> 搬到 <code>&lt;/body&gt;</code> 上方，这样就可以了。要是你很坚持你的代码要放在 head 标签内，没问题，使用 jQuery 的 ready 函数：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="keyword">var</span> foo = <span class="keyword">function</span>() {};
$(document).ready(foo);
</pre></td></tr></table></figure>

<p><code>$(document)</code> 叫 jQuery 去把 DOM 抓出来。</p>
<p>等到 document 载入完毕，准备好要给我们玩弄的时候，执行 <code>ready</code> 函数内的 <code>foo</code> 函数。</p>
<p>更简洁的写法、传入匿名函数、或叫回呼函数 (callback function)：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>$(document).ready(<span class="keyword">function</span>() {

});
</pre></td></tr></table></figure>

<p>接下来在这个匿名函数内放入我们之前想做的事儿：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>$(document).ready(<span class="keyword">function</span>() {
truetrue$(<span class="string">'li:first-child'</span>).addClass(<span class="string">'emphasis'</span>);
});
</pre></td></tr></table></figure>

<p>这个 ready 函数会大概每 10 ms 去检查 DOM 准备好给我们玩弄了没，准备好了就执行里面的函数。</p>
<p>把 <code>$(document).ready()</code> 变得更简洁一点：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>$(<span class="keyword">function</span>() {
<span class="literal">true</span>$(<span class="string">'li:first-child'</span>).addClass(<span class="string">'emphasis'</span>);
});
</pre></td></tr></table></figure>

<p>好了，好奇的你又问了，这是为什么？</p>
<p>请看 <a href="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.js">jQuery 源代码</a>，搜索这个关键字 <code>jQuery.fn = jQuery.prototype = {</code></p>
<p>这下面一整段代码，说明了我们调用 jQuery 函数 <code>$()</code> 时，碰到选择器、函数、上下文时该怎么处理。</p>
<p>好，我们现在是传入了一个函数：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>$(<span class="keyword">function</span>() {
<span class="literal">true</span>$(<span class="string">'li:first-child'</span>).addClass(<span class="string">'emphasis'</span>);
});
</pre></td></tr></table></figure>

<p>看到没有，<code>$( function() { ... } )</code>，我们来找找处理传入函数的源代码，一直往下找：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre><span class="comment">// HANDLE: $(function)</span>
<span class="comment">// Shortcut for document ready</span>
} <span class="keyword">else</span> <span class="keyword">if</span> ( jQuery.isFunction( selector ) ) {
truereturn rootjQuery.ready( selector );
}
</pre></td></tr></table></figure>

<p>阿哈，这里写的明明白白，document ready 的缩写。</p>
<p>这里的 <code>selector</code> 就是我们所传入的：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="keyword">function</span>() {
<span class="literal">true</span>$(<span class="string">'li:first-child'</span>).addClass(<span class="string">'emphasis'</span>);
}
</pre></td></tr></table></figure>

<p>而它说:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="keyword">if</span> ( jQuery.isFunction( selector ) ) {
truereturn rootjQuery.ready( selector );
}
</pre></td></tr></table></figure>

<p>如果传入的 <code>selector</code> 是函数的话，返回 <code>rootjQuery.ready( selector );</code></p>
<p>呵呵。。。所以这两段代码是等效的：</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre>$(document).ready(<span class="keyword">function</span>() {
<span class="literal">true</span>$(<span class="string">'li:first-child'</span>).addClass(<span class="string">'emphasis'</span>);
});

$(<span class="keyword">function</span>() {
<span class="literal">true</span>$(<span class="string">'li:first-child'</span>).addClass(<span class="string">'emphasis'</span>);
});
</pre></td></tr></table></figure>

<p>很多人觉得使用第二种这个缩写不太好，第一种的可读性比较高，这是你个人的选择，如果你知道你在干什么，两个都很好。</p>
<p>本篇结束。</p>

      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2012/05/18/jquery-intro-2/#more" class="more-link">閱讀全文</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  

  <nav id="pagination">
  
  
    <a href="/archives/page/2/" class="alignright next">下一頁</a>
  
  <div class="clearfix"></div>
</nav>
</div></div>
    <aside id="sidebar" class="alignleft"><!-- 
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜尋">
    <input type="hidden" name="q" value="site:lisp.es/">
  </form>
</div>

  
<div class="widget twitter">
  <h3 class="title">推文</h3>
  <ul id="tweets"></ul>
</div>

<script type="text/javascript">
var twitter_stream = ['JuanitoFatas', 5, false];
var moment_js_path = '/js/moment.min.js';
</script>
<script src="/js/twitter.js"></script>


 -->
<div class="personal-info">
  <figure>
    
      <a href="/">
        <img class="personal-photo" src="https://secure.gravatar.com/avatar/771951f55ed37335f238e1a80dfda9cd?s=420&d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-user-420.png" alt="Juanito Fatas">
      </a>
    
    <figcaption>
      <h3 class=>Juanito Fatas</h3>
      <p>城市中的迷途小碼農</p>
    </figcaption>
  </figure>
  <section class="social">
    
      <a target="_blank" class="icon twitter depth" href="http://twitter.com/JuanitoFatas"></a>
    
    
    
      <a target="_blank" class="icon github depth" href="http://github.com/JuanitoFatas"></a>
    
    
      <a target="_blank" class="icon email depth" href="mailto:katehuang0320@gmail.com"></a>
    
  </section>
</div>
</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignright depth">
  <a class="footer-link" href="/about">About Me</a>
  <a class="footer-link" href="http://github.com/thiagopnts/hexo-persona-dark">Based on Persona Dark Theme</a> 
  &copy; - 2013 Juanito Fatas
  
</div>
<div class="clearfix"></div></footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<script type="text/javascript">
var disqus_shortname = 'juanfatas';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



<script src="//cdn.moot.it/latest/moot.min.js"></script>

</body>
</html>